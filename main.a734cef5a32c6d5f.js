(self.webpackChunkngx_webrtc=self.webpackChunkngx_webrtc||[]).push([[179],{522:(wc,Hm,Kh)=>{"use strict";function L(r){return"function"==typeof r}let Ac=!1;const Ji={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){if(r){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else Ac&&console.log("RxJS: Back to a better error behavior. Thank you. <3");Ac=r},get useDeprecatedSynchronousErrorHandling(){return Ac}};function qo(r){setTimeout(()=>{throw r},0)}const Yo={closed:!0,next(r){},error(r){if(Ji.useDeprecatedSynchronousErrorHandling)throw r;qo(r)},complete(){}},pr=Array.isArray||(r=>r&&"number"==typeof r.length);function La(r){return null!==r&&"object"==typeof r}const $o=(()=>{function r(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((t,a)=>`${a+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return r.prototype=Object.create(Error.prototype),r})();class En{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:t,_ctorUnsubscribe:a,_unsubscribe:l,_subscriptions:u}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof En)t.remove(this);else if(null!==t)for(let f=0;f<t.length;++f)t[f].remove(this);if(L(l)){a&&(this._unsubscribe=void 0);try{l.call(this)}catch(f){e=f instanceof $o?Vv(f.errors):[f]}}if(pr(u)){let f=-1,g=u.length;for(;++f<g;){const y=u[f];if(La(y))try{y.unsubscribe()}catch(R){e=e||[],R instanceof $o?e=e.concat(Vv(R.errors)):e.push(R)}}}if(e)throw new $o(e)}add(e){let t=e;if(!e)return En.EMPTY;switch(typeof e){case"function":t=new En(e);case"object":if(t===this||t.closed||"function"!=typeof t.unsubscribe)return t;if(this.closed)return t.unsubscribe(),t;if(!(t instanceof En)){const u=t;t=new En,t._subscriptions=[u]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:a}=t;if(null===a)t._parentOrParents=this;else if(a instanceof En){if(a===this)return t;t._parentOrParents=[a,this]}else{if(-1!==a.indexOf(this))return t;a.push(this)}const l=this._subscriptions;return null===l?this._subscriptions=[t]:l.push(t),t}remove(e){const t=this._subscriptions;if(t){const a=t.indexOf(e);-1!==a&&t.splice(a,1)}}}var r;function Vv(r){return r.reduce((e,t)=>e.concat(t instanceof $o?t.errors:t),[])}En.EMPTY=((r=new En).closed=!0,r);const qh="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class Dn extends En{constructor(e,t,a){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Yo;break;case 1:if(!e){this.destination=Yo;break}if("object"==typeof e){e instanceof Dn?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new Bv(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new Bv(this,e,t,a)}}[qh](){return this}static create(e,t,a){const l=new Dn(e,t,a);return l.syncErrorThrowable=!1,l}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class Bv extends Dn{constructor(e,t,a,l){super(),this._parentSubscriber=e;let u,f=this;L(t)?u=t:t&&(u=t.next,a=t.error,l=t.complete,t!==Yo&&(f=Object.create(t),L(f.unsubscribe)&&this.add(f.unsubscribe.bind(f)),f.unsubscribe=this.unsubscribe.bind(this))),this._context=f,this._next=u,this._error=a,this._complete=l}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;Ji.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:a}=Ji;if(this._error)a&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)a?(t.syncErrorValue=e,t.syncErrorThrown=!0):qo(e),this.unsubscribe();else{if(this.unsubscribe(),a)throw e;qo(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);Ji.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(a){if(this.unsubscribe(),Ji.useDeprecatedSynchronousErrorHandling)throw a;qo(a)}}__tryOrSetError(e,t,a){if(!Ji.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,a)}catch(l){return Ji.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=l,e.syncErrorThrown=!0,!0):(qo(l),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const Bd="function"==typeof Symbol&&Symbol.observable||"@@observable";function Yh(r){return r}let Cn=(()=>{class r{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(t){const a=new r;return a.source=this,a.operator=t,a}subscribe(t,a,l){const{operator:u}=this,f=function m0(r,e,t){if(r){if(r instanceof Dn)return r;if(r[qh])return r[qh]()}return r||e||t?new Dn(r,e,t):new Dn(Yo)}(t,a,l);if(f.add(u?u.call(f,this.source):this.source||Ji.useDeprecatedSynchronousErrorHandling&&!f.syncErrorThrowable?this._subscribe(f):this._trySubscribe(f)),Ji.useDeprecatedSynchronousErrorHandling&&f.syncErrorThrowable&&(f.syncErrorThrowable=!1,f.syncErrorThrown))throw f.syncErrorValue;return f}_trySubscribe(t){try{return this._subscribe(t)}catch(a){Ji.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=a),function f0(r){for(;r;){const{closed:e,destination:t,isStopped:a}=r;if(e||a)return!1;r=t&&t instanceof Dn?t:null}return!0}(t)?t.error(a):console.warn(a)}}forEach(t,a){return new(a=Hv(a))((l,u)=>{let f;f=this.subscribe(g=>{try{t(g)}catch(y){u(y),f&&f.unsubscribe()}},u,l)})}_subscribe(t){const{source:a}=this;return a&&a.subscribe(t)}[Bd](){return this}pipe(...t){return 0===t.length?this:function jv(r){return 0===r.length?Yh:1===r.length?r[0]:function(t){return r.reduce((a,l)=>l(a),t)}}(t)(this)}toPromise(t){return new(t=Hv(t))((a,l)=>{let u;this.subscribe(f=>u=f,f=>l(f),()=>a(u))})}}return r.create=e=>new r(e),r})();function Hv(r){if(r||(r=Ji.Promise||Promise),!r)throw new Error("no Promise impl found");return r}const Rl=(()=>{function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r})();class g0 extends En{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const a=t.indexOf(this.subscriber);-1!==a&&t.splice(a,1)}}class Gv extends Dn{constructor(e){super(e),this.destination=e}}let hn=(()=>{class r extends Cn{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[qh](){return new Gv(this)}lift(t){const a=new Gm(this,this);return a.operator=t,a}next(t){if(this.closed)throw new Rl;if(!this.isStopped){const{observers:a}=this,l=a.length,u=a.slice();for(let f=0;f<l;f++)u[f].next(t)}}error(t){if(this.closed)throw new Rl;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:a}=this,l=a.length,u=a.slice();for(let f=0;f<l;f++)u[f].error(t);this.observers.length=0}complete(){if(this.closed)throw new Rl;this.isStopped=!0;const{observers:t}=this,a=t.length,l=t.slice();for(let u=0;u<a;u++)l[u].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new Rl;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new Rl;return this.hasError?(t.error(this.thrownError),En.EMPTY):this.isStopped?(t.complete(),En.EMPTY):(this.observers.push(t),new g0(this,t))}asObservable(){const t=new Cn;return t.source=this,t}}return r.create=(e,t)=>new Gm(e,t),r})();class Gm extends hn{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):En.EMPTY}}function Il(r){return r&&"function"==typeof r.schedule}function on(r,e){return function(a){if("function"!=typeof r)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return a.lift(new E0(r,e))}}class E0{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new v0(e,this.project,this.thisArg))}}class v0 extends Dn{constructor(e,t,a){super(e),this.project=t,this.count=0,this.thisArg=a||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(a){return void this.destination.error(a)}this.destination.next(t)}}const Wv=r=>e=>{for(let t=0,a=r.length;t<a&&!e.closed;t++)e.next(r[t]);e.complete()},$h=function S0(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),zv=r=>r&&"number"==typeof r.length&&"function"!=typeof r;function Kv(r){return!!r&&"function"!=typeof r.subscribe&&"function"==typeof r.then}const Wm=r=>{if(r&&"function"==typeof r[Bd])return(r=>e=>{const t=r[Bd]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)})(r);if(zv(r))return Wv(r);if(Kv(r))return(r=>e=>(r.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,qo),e))(r);if(r&&"function"==typeof r[$h])return(r=>e=>{const t=r[$h]();for(;;){let a;try{a=t.next()}catch(l){return e.error(l),e}if(a.done){e.complete();break}if(e.next(a.value),e.closed)break}return"function"==typeof t.return&&e.add(()=>{t.return&&t.return()}),e})(r);{const t=`You provided ${La(r)?"an invalid object":`'${r}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(t)}};function zm(r,e){return new Cn(t=>{const a=new En;let l=0;return a.add(e.schedule(function(){l!==r.length?(t.next(r[l++]),t.closed||a.add(this.schedule())):t.complete()})),a})}function mr(r,e){return e?function fr(r,e){if(null!=r){if(function w0(r){return r&&"function"==typeof r[Bd]}(r))return function T0(r,e){return new Cn(t=>{const a=new En;return a.add(e.schedule(()=>{const l=r[Bd]();a.add(l.subscribe({next(u){a.add(e.schedule(()=>t.next(u)))},error(u){a.add(e.schedule(()=>t.error(u)))},complete(){a.add(e.schedule(()=>t.complete()))}}))})),a})}(r,e);if(Kv(r))return function R0(r,e){return new Cn(t=>{const a=new En;return a.add(e.schedule(()=>r.then(l=>{a.add(e.schedule(()=>{t.next(l),a.add(e.schedule(()=>t.complete()))}))},l=>{a.add(e.schedule(()=>t.error(l)))}))),a})}(r,e);if(zv(r))return zm(r,e);if(function jd(r){return r&&"function"==typeof r[$h]}(r)||"string"==typeof r)return function I0(r,e){if(!r)throw new Error("Iterable cannot be null");return new Cn(t=>{const a=new En;let l;return a.add(()=>{l&&"function"==typeof l.return&&l.return()}),a.add(e.schedule(()=>{l=r[$h](),a.add(e.schedule(function(){if(t.closed)return;let u,f;try{const g=l.next();u=g.value,f=g.done}catch(g){return void t.error(g)}f?t.complete():(t.next(u),this.schedule())}))})),a})}(r,e)}throw new TypeError((null!==r&&typeof r||r)+" is not observable")}(r,e):r instanceof Cn?r:new Cn(Wm(r))}class Hd extends Dn{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Jh extends Dn{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function wl(r,e){if(e.closed)return;if(r instanceof Cn)return r.subscribe(e);let t;try{t=Wm(r)(e)}catch(a){e.error(a)}return t}function Ni(r,e,t=Number.POSITIVE_INFINITY){return"function"==typeof e?a=>a.pipe(Ni((l,u)=>mr(r(l,u)).pipe(on((f,g)=>e(l,f,u,g))),t)):("number"==typeof e&&(t=e),a=>a.lift(new Km(r,t)))}class Km{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new Yv(e,this.project,this.concurrent))}}class Yv extends Jh{constructor(e,t,a=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=a,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const a=this.index++;try{t=this.project(e,a)}catch(l){return void this.destination.error(l)}this.active++,this._innerSub(t)}_innerSub(e){const t=new Hd(this),a=this.destination;a.add(t);const l=wl(e,t);l!==t&&a.add(l)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function Dc(r=Number.POSITIVE_INFINITY){return Ni(Yh,r)}function Gd(r,e){return e?zm(r,e):new Cn(Wv(r))}function $v(...r){let e=Number.POSITIVE_INFINITY,t=null,a=r[r.length-1];return Il(a)?(t=r.pop(),r.length>1&&"number"==typeof r[r.length-1]&&(e=r.pop())):"number"==typeof a&&(e=r.pop()),null===t&&1===r.length&&r[0]instanceof Cn?r[0]:Dc(e)(Gd(r,t))}function Zn(){return function(e){return e.lift(new qm(e))}}class qm{constructor(e){this.connectable=e}call(e,t){const{connectable:a}=this;a._refCount++;const l=new D0(e,a),u=t.subscribe(l);return l.closed||(l.connection=a.connect()),u}}class D0 extends Dn{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:a}=this,l=e._connection;this.connection=null,l&&(!a||l===a)&&l.unsubscribe()}}class Xv extends Cn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new En,e.add(this.source.subscribe(new kN(this.getSubject(),this))),e.closed&&(this._connection=null,e=En.EMPTY)),e}refCount(){return Zn()(this)}}const Jv=(()=>{const r=Xv.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:r._subscribe},_isComplete:{value:r._isComplete,writable:!0},getSubject:{value:r.getSubject},connect:{value:r.connect},refCount:{value:r.refCount}}})();class kN extends Gv{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}class Qi{constructor(e,t){this.subjectFactory=e,this.selector=t}call(e,t){const{selector:a}=this,l=this.subjectFactory(),u=a(l).subscribe(e);return u.add(t.subscribe(l)),u}}function MN(){return new hn}function On(r){for(let e in r)if(r[e]===On)return e;throw Error("Could not find renamed property on target object.")}function $m(r,e){for(const t in e)e.hasOwnProperty(t)&&!r.hasOwnProperty(t)&&(r[t]=e[t])}function pn(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(pn).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const e=r.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function Xm(r,e){return null==r||""===r?null===e?"":e:null==e||""===e?r:r+" "+e}const LN=On({__forward_ref__:On});function Nn(r){return r.__forward_ref__=Nn,r.toString=function(){return pn(this())},r}function at(r){return N0(r)?r():r}function N0(r){return"function"==typeof r&&r.hasOwnProperty(LN)&&r.__forward_ref__===Nn}class Pe extends Error{constructor(e,t){super(function Qh(r,e){return`NG0${Math.abs(r)}${e?": "+e:""}`}(e,t)),this.code=e}}function ct(r){return"string"==typeof r?r:null==r?"":String(r)}function _r(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():ct(r)}function Qm(r,e){const t=e?` in ${e}`:"";throw new Pe(-201,`No provider for ${_r(r)} found${t}`)}function Br(r,e){null==r&&function sn(r,e,t,a){throw new Error(`ASSERTION ERROR: ${r}`+(null==a?"":` [Expected=> ${t} ${a} ${e} <=Actual]`))}(e,r,null,"!=")}function Ue(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function Yt(r){return{providers:r.providers||[],imports:r.imports||[]}}function e_(r){return P0(r,zd)||P0(r,ny)}function P0(r,e){return r.hasOwnProperty(e)?r[e]:null}function t_(r){return r&&(r.hasOwnProperty(ty)||r.hasOwnProperty(ro))?r[ty]:null}const zd=On({\u0275prov:On}),ty=On({\u0275inj:On}),ny=On({ngInjectableDef:On}),ro=On({ngInjectorDef:On});var et=(()=>((et=et||{})[et.Default=0]="Default",et[et.Host=1]="Host",et[et.Self=2]="Self",et[et.SkipSelf=4]="SkipSelf",et[et.Optional=8]="Optional",et))();let n_;function Fa(r){const e=n_;return n_=r,e}function ry(r,e,t){const a=e_(r);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:t&et.Optional?null:void 0!==e?e:void Qm(pn(r),"Injector")}function Ua(r){return{toString:r}.toString()}var gr=(()=>((gr=gr||{})[gr.OnPush=0]="OnPush",gr[gr.Default=1]="Default",gr))(),bs=(()=>(function(r){r[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom"}(bs||(bs={})),bs))();const Kd="undefined"!=typeof globalThis&&globalThis,k0="undefined"!=typeof window&&window,BN="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Pn=Kd||"undefined"!=typeof global&&global||k0||BN,qd={},an=[],r_=On({\u0275cmp:On}),oy=On({\u0275dir:On}),sy=On({\u0275pipe:On}),To=On({\u0275mod:On}),Va=On({\u0275fac:On}),Zh=On({__NG_ELEMENT_ID__:On});let ay=0;function Er(r){return Ua(()=>{const t={},a={type:r.type,providersResolver:null,decls:r.decls,vars:r.vars,factory:null,template:r.template||null,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:r.exportAs||null,onPush:r.changeDetection===gr.OnPush,directiveDefs:null,pipeDefs:null,selectors:r.selectors||an,viewQuery:r.viewQuery||null,features:r.features||null,data:r.data||{},encapsulation:r.encapsulation||bs.Emulated,id:"c",styles:r.styles||an,_:null,setInput:null,schemas:r.schemas||null,tView:null},l=r.directives,u=r.features,f=r.pipes;return a.id+=ay++,a.inputs=L0(r.inputs,t),a.outputs=L0(r.outputs),u&&u.forEach(g=>g(a)),a.directiveDefs=l?()=>("function"==typeof l?l():l).map(o_):null,a.pipeDefs=f?()=>("function"==typeof f?f():f).map(M0):null,a})}function o_(r){return Zi(r)||function Ro(r){return r[oy]||null}(r)}function M0(r){return function Ol(r){return r[sy]||null}(r)}const ly={};function kn(r){return Ua(()=>{const e={type:r.type,bootstrap:r.bootstrap||an,declarations:r.declarations||an,imports:r.imports||an,exports:r.exports||an,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null};return null!=r.id&&(ly[r.id]=r.type),e})}function L0(r,e){if(null==r)return qd;const t={};for(const a in r)if(r.hasOwnProperty(a)){let l=r[a],u=l;Array.isArray(l)&&(u=l[1],l=l[0]),t[l]=a,e&&(e[l]=u)}return t}const je=Er;function Ir(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,onDestroy:r.type.prototype.ngOnDestroy||null}}function Zi(r){return r[r_]||null}function Jo(r,e){const t=r[To]||null;if(!t&&!0===e)throw new Error(`Type ${pn(r)} does not have '\u0275mod' property.`);return t}function ta(r){return Array.isArray(r)&&"object"==typeof r[1]}function wo(r){return Array.isArray(r)&&!0===r[1]}function py(r){return 0!=(8&r.flags)}function rp(r){return 2==(2&r.flags)}function s_(r){return 1==(1&r.flags)}function Rs(r){return null!==r.template}function GN(r){return 0!=(512&r[2])}function Ll(r,e){return r.hasOwnProperty(Va)?r[Va]:null}class $N{constructor(e,t,a){this.previousValue=e,this.currentValue=t,this.firstChange=a}isFirstChange(){return this.firstChange}}function li(){return U0}function U0(r){return r.type.prototype.ngOnChanges&&(r.setInput=JN),XN}function XN(){const r=fy(this),e=null==r?void 0:r.current;if(e){const t=r.previous;if(t===qd)r.previous=e;else for(let a in e)t[a]=e[a];r.current=null,this.ngOnChanges(e)}}function JN(r,e,t,a){const l=fy(r)||function QN(r,e){return r[op]=e}(r,{previous:qd,current:null}),u=l.current||(l.current={}),f=l.previous,g=this.declaredInputs[t],y=f[g];u[g]=new $N(y&&y.currentValue,e,f===qd),r[a]=e}li.ngInherit=!0;const op="__ngSimpleChanges__";function fy(r){return r[op]||null}let Xd;function gi(r){return!!r.listen}const V0={createRenderer:(r,e)=>function gy(){return void 0!==Xd?Xd:"undefined"!=typeof document?document:void 0}()};function ki(r){for(;Array.isArray(r);)r=r[0];return r}function c_(r,e){return ki(e[r])}function wt(r,e){return ki(e[r.index])}function Ey(r,e){return r.data[e]}function Zd(r,e){return r[e]}function Hr(r,e){const t=e[r];return ta(t)?t:t[0]}function B0(r){return 4==(4&r[2])}function vy(r){return 128==(128&r[2])}function Ba(r,e){return null==e?null:r[e]}function j0(r){r[18]=0}function yy(r,e){r[5]+=e;let t=r,a=r[3];for(;null!==a&&(1===e&&1===t[5]||-1===e&&0===t[5]);)a[5]+=e,t=a,a=a[3]}const vt={lFrame:p_(null),bindingsEnabled:!0};function Sy(){return vt.bindingsEnabled}function _e(){return vt.lFrame.lView}function $t(){return vt.lFrame.tView}function es(r){return vt.lFrame.contextLView=r,r[8]}function Ki(){let r=G0();for(;null!==r&&64===r.type;)r=r.parent;return r}function G0(){return vt.lFrame.currentTNode}function na(r,e){const t=vt.lFrame;t.currentTNode=r,t.isParent=e}function l_(){return vt.lFrame.isParent}function lp(){vt.lFrame.isParent=!1}function Gr(){const r=vt.lFrame;let e=r.bindingRootIndex;return-1===e&&(e=r.bindingRootIndex=r.tView.bindingStartIndex),e}function eu(){return vt.lFrame.bindingIndex++}function dP(r,e){const t=vt.lFrame;t.bindingIndex=t.bindingRootIndex=r,by(e)}function by(r){vt.lFrame.currentDirectiveIndex=r}function z0(){return vt.lFrame.currentQueryIndex}function Ty(r){vt.lFrame.currentQueryIndex=r}function hP(r){const e=r[1];return 2===e.type?e.declTNode:1===e.type?r[6]:null}function Ry(r,e,t){if(t&et.SkipSelf){let l=e,u=r;for(;!(l=l.parent,null!==l||t&et.Host||(l=hP(u),null===l||(u=u[15],10&l.type))););if(null===l)return!1;e=l,r=u}const a=vt.lFrame=K0();return a.currentTNode=e,a.lView=r,!0}function h_(r){const e=K0(),t=r[1];vt.lFrame=e,e.currentTNode=t.firstChild,e.lView=r,e.tView=t,e.contextLView=r,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function K0(){const r=vt.lFrame,e=null===r?null:r.child;return null===e?p_(r):e}function p_(r){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=e),e}function f_(){const r=vt.lFrame;return vt.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const Re=f_;function dp(){const r=f_();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function Ar(){return vt.lFrame.selectedIndex}function Wa(r){vt.lFrame.selectedIndex=r}function di(){const r=vt.lFrame;return Ey(r.tView,r.selectedIndex)}function ws(){vt.lFrame.currentNamespace="svg"}function As(){!function _P(){vt.lFrame.currentNamespace=null}()}function m_(r,e){for(let t=e.directiveStart,a=e.directiveEnd;t<a;t++){const u=r.data[t].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:g,ngAfterViewInit:y,ngAfterViewChecked:R,ngOnDestroy:D}=u;f&&(r.contentHooks||(r.contentHooks=[])).push(-t,f),g&&((r.contentHooks||(r.contentHooks=[])).push(t,g),(r.contentCheckHooks||(r.contentCheckHooks=[])).push(t,g)),y&&(r.viewHooks||(r.viewHooks=[])).push(-t,y),R&&((r.viewHooks||(r.viewHooks=[])).push(t,R),(r.viewCheckHooks||(r.viewCheckHooks=[])).push(t,R)),null!=D&&(r.destroyHooks||(r.destroyHooks=[])).push(t,D)}}function up(r,e,t){q0(r,e,3,t)}function __(r,e,t,a){(3&r[2])===t&&q0(r,e,t,a)}function hp(r,e){let t=r[2];(3&t)===e&&(t&=2047,t+=1,r[2]=t)}function q0(r,e,t,a){const u=null!=a?a:-1,f=e.length-1;let g=0;for(let y=void 0!==a?65535&r[18]:0;y<f;y++)if("number"==typeof e[y+1]){if(g=e[y],null!=a&&g>=a)break}else e[y]<0&&(r[18]+=65536),(g<u||-1==u)&&(Y0(r,t,e,y),r[18]=(4294901760&r[18])+y+2),y++}function Y0(r,e,t,a){const l=t[a]<0,u=t[a+1],g=r[l?-t[a]:t[a]];if(l){if(r[2]>>11<r[18]>>16&&(3&r[2])===e){r[2]+=2048;try{u.call(g)}finally{}}}else try{u.call(g)}finally{}}class pp{constructor(e,t,a){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=a}}function E_(r,e,t){const a=gi(r);let l=0;for(;l<t.length;){const u=t[l];if("number"==typeof u){if(0!==u)break;l++;const f=t[l++],g=t[l++],y=t[l++];a?r.setAttribute(e,g,y,f):e.setAttributeNS(f,g,y)}else{const f=u,g=t[++l];v_(f)?a&&r.setProperty(e,f,g):a?r.setAttribute(e,f,g):e.setAttribute(f,g),l++}}return l}function tu(r){return 3===r||4===r||6===r}function v_(r){return 64===r.charCodeAt(0)}function mp(r,e){if(null!==e&&0!==e.length)if(null===r||0===r.length)r=e.slice();else{let t=-1;for(let a=0;a<e.length;a++){const l=e[a];"number"==typeof l?t=l:0===t||Iy(r,t,l,null,-1===t||2===t?e[++a]:null)}}return r}function Iy(r,e,t,a,l){let u=0,f=r.length;if(-1===e)f=-1;else for(;u<r.length;){const g=r[u++];if("number"==typeof g){if(g===e){f=-1;break}if(g>e){f=u-1;break}}}for(;u<r.length;){const g=r[u];if("number"==typeof g)break;if(g===t){if(null===a)return void(null!==l&&(r[u+1]=l));if(a===r[u+1])return void(r[u+2]=l)}u++,null!==a&&u++,null!==l&&u++}-1!==f&&(r.splice(f,0,e),u=f+1),r.splice(u++,0,t),null!==a&&r.splice(u++,0,a),null!==l&&r.splice(u++,0,l)}function Q0(r){return-1!==r}function nu(r){return 32767&r}function xl(r,e){let t=function SP(r){return r>>16}(r),a=e;for(;t>0;)a=a[15],t--;return a}let wy=!0;function _p(r){const e=wy;return wy=r,e}let CP=0;function gp(r,e){const t=Dy(r,e);if(-1!==t)return t;const a=e[1];a.firstCreatePass&&(r.injectorIndex=e.length,Ay(a.data,r),Ay(e,null),Ay(a.blueprint,null));const l=y_(r,e),u=r.injectorIndex;if(Q0(l)){const f=nu(l),g=xl(l,e),y=g[1].data;for(let R=0;R<8;R++)e[u+R]=g[f+R]|y[f+R]}return e[u+8]=l,u}function Ay(r,e){r.push(0,0,0,0,0,0,0,0,e)}function Dy(r,e){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===e[r.injectorIndex+8]?-1:r.injectorIndex}function y_(r,e){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let t=0,a=null,l=e;for(;null!==l;){const u=l[1],f=u.type;if(a=2===f?u.declTNode:1===f?l[6]:null,null===a)return-1;if(t++,l=l[15],-1!==a.injectorIndex)return a.injectorIndex|t<<16}return-1}function Ep(r,e,t){!function bP(r,e,t){let a;"string"==typeof t?a=t.charCodeAt(0)||0:t.hasOwnProperty(Zh)&&(a=t[Zh]),null==a&&(a=t[Zh]=CP++);const l=255&a;e.data[r+(l>>5)]|=1<<l}(r,e,t)}function nR(r,e,t){if(t&et.Optional)return r;Qm(e,"NodeInjector")}function iR(r,e,t,a){if(t&et.Optional&&void 0===a&&(a=null),0==(t&(et.Self|et.Host))){const l=r[9],u=Fa(void 0);try{return l?l.get(e,a,t&et.Optional):ry(e,a,t&et.Optional)}finally{Fa(u)}}return nR(a,e,t)}function rR(r,e,t,a=et.Default,l){if(null!==r){const u=function Ny(r){if("string"==typeof r)return r.charCodeAt(0)||0;const e=r.hasOwnProperty(Zh)?r[Zh]:void 0;return"number"==typeof e?e>=0?255&e:TP:e}(t);if("function"==typeof u){if(!Ry(e,r,a))return a&et.Host?nR(l,t,a):iR(e,t,a,l);try{const f=u(a);if(null!=f||a&et.Optional)return f;Qm(t)}finally{Re()}}else if("number"==typeof u){let f=null,g=Dy(r,e),y=-1,R=a&et.Host?e[16][6]:null;for((-1===g||a&et.SkipSelf)&&(y=-1===g?y_(r,e):e[g+8],-1!==y&&sR(a,!1)?(f=e[1],g=nu(y),e=xl(y,e)):g=-1);-1!==g;){const D=e[1];if(oR(u,g,D.data)){const x=RP(g,e,t,f,a,R);if(x!==Oy)return x}y=e[g+8],-1!==y&&sR(a,e[1].data[g+8]===R)&&oR(u,g,e)?(f=D,g=nu(y),e=xl(y,e)):g=-1}}}return iR(e,t,a,l)}const Oy={};function TP(){return new ru(Ki(),_e())}function RP(r,e,t,a,l,u){const f=e[1],g=f.data[r+8],D=iu(g,f,t,null==a?rp(g)&&wy:a!=f&&0!=(3&g.type),l&et.Host&&u===g);return null!==D?Mc(e,f,D,g):Oy}function iu(r,e,t,a,l){const u=r.providerIndexes,f=e.data,g=1048575&u,y=r.directiveStart,D=u>>20,j=l?g+D:r.directiveEnd;for(let G=a?g:g+D;G<j;G++){const q=f[G];if(G<y&&t===q||G>=y&&q.type===t)return G}if(l){const G=f[y];if(G&&Rs(G)&&G.type===t)return y}return null}function Mc(r,e,t,a){let l=r[t];const u=e.data;if(function $0(r){return r instanceof pp}(l)){const f=l;f.resolving&&function Pi(r,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${r}`:"";throw new Pe(-200,`Circular dependency in DI detected for ${r}${t}`)}(_r(u[t]));const g=_p(f.canSeeViewProviders);f.resolving=!0;const y=f.injectImpl?Fa(f.injectImpl):null;Ry(r,a,et.Default);try{l=r[t]=f.factory(void 0,u,r,a),e.firstCreatePass&&t>=a.directiveStart&&function EP(r,e,t){const{ngOnChanges:a,ngOnInit:l,ngDoCheck:u}=e.type.prototype;if(a){const f=U0(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(r,f),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(r,f)}l&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-r,l),u&&((t.preOrderHooks||(t.preOrderHooks=[])).push(r,u),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(r,u))}(t,u[t],e)}finally{null!==y&&Fa(y),_p(g),f.resolving=!1,Re()}}return l}function oR(r,e,t){return!!(t[e+(r>>5)]&1<<r)}function sR(r,e){return!(r&et.Self||r&et.Host&&e)}class ru{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,a){return rR(this._tNode,this._lView,e,a,t)}}function S_(r){return N0(r)?()=>{const e=S_(at(r));return e&&e()}:Ll(r)}function Lc(r){return function tR(r,e){if("class"===e)return r.classes;if("style"===e)return r.styles;const t=r.attrs;if(t){const a=t.length;let l=0;for(;l<a;){const u=t[l];if(tu(u))break;if(0===u)l+=2;else if("number"==typeof u)for(l++;l<a&&"string"==typeof t[l];)l++;else{if(u===e)return t[l+1];l+=2}}}return null}(Ki(),r)}const su="__parameters__";function au(r,e,t){return Ua(()=>{const a=function Py(r){return function(...t){if(r){const a=r(...t);for(const l in a)this[l]=a[l]}}}(e);function l(...u){if(this instanceof l)return a.apply(this,u),this;const f=new l(...u);return g.annotation=f,g;function g(y,R,D){const x=y.hasOwnProperty(su)?y[su]:Object.defineProperty(y,su,{value:[]})[su];for(;x.length<=D;)x.push(null);return(x[D]=x[D]||[]).push(f),y}}return t&&(l.prototype=Object.create(t.prototype)),l.prototype.ngMetadataName=r,l.annotationCls=l,l})}class Le{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Ue({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const C_=new Le("AnalyzeForEntryComponents");function so(r,e){void 0===e&&(e=r);for(let t=0;t<r.length;t++){let a=r[t];Array.isArray(a)?(e===r&&(e=r.slice(0,t)),so(a,e)):e!==r&&e.push(a)}return e}function Ds(r,e){r.forEach(t=>Array.isArray(t)?Ds(t,e):e(t))}function Ly(r,e,t){e>=r.length?r.push(t):r.splice(e,0,t)}function Vl(r,e){return e>=r.length-1?r.pop():r.splice(e,1)[0]}function xc(r,e){const t=[];for(let a=0;a<r;a++)t.push(e);return t}function Ao(r,e,t){let a=lu(r,e);return a>=0?r[1|a]=t:(a=~a,function OP(r,e,t,a){let l=r.length;if(l==e)r.push(t,a);else if(1===l)r.push(a,r[0]),r[0]=t;else{for(l--,r.push(r[l-1],r[l]);l>e;)r[l]=r[l-2],l--;r[e]=t,r[e+1]=a}}(r,a,e,t)),a}function xy(r,e){const t=lu(r,e);if(t>=0)return r[1|t]}function lu(r,e){return function uR(r,e,t){let a=0,l=r.length>>t;for(;l!==a;){const u=a+(l-a>>1),f=r[u<<t];if(e===f)return u<<t;f>e?l=u:a=u+1}return~(l<<t)}(r,e,1)}const ia={},Fy="__NG_DI_FLAG__",jl="ngTempTokenPath",R_=/\n/gm,_R="__source",FP=On({provide:String,useValue:On});let Sp;function ui(r){const e=Sp;return Sp=r,e}function UP(r,e=et.Default){if(void 0===Sp)throw new Pe(203,"");return null===Sp?ry(r,void 0,e):Sp.get(r,e&et.Optional?null:void 0,e)}function he(r,e=et.Default){return(function iy(){return n_}()||UP)(at(r),e)}const Uy=he;function I_(r){const e=[];for(let t=0;t<r.length;t++){const a=at(r[t]);if(Array.isArray(a)){if(0===a.length)throw new Pe(900,"");let l,u=et.Default;for(let f=0;f<a.length;f++){const g=a[f],y=VP(g);"number"==typeof y?-1===y?l=g.token:u|=y:l=g}e.push(he(l,u))}else e.push(he(a))}return e}function Cp(r,e){return r[Fy]=e,r.prototype[Fy]=e,r}function VP(r){return r[Fy]}const w_=Cp(au("Inject",r=>({token:r})),-1),Fc=Cp(au("Optional"),8),du=Cp(au("SkipSelf"),4);var Do=(()=>((Do=Do||{})[Do.Important=1]="Important",Do[Do.DashCase=2]="DashCase",Do))();const P_="__ngContext__";function Dr(r,e){r[P_]=e}function Vc(r){const e=function oa(r){return r[P_]||null}(r);return e?Array.isArray(e)?e:e.lView:null}function zy(r,e){return undefined(r,e)}function fu(r){const e=r[3];return wo(e)?e[3]:e}function M_(r){return IR(r[13])}function L_(r){return IR(r[4])}function IR(r){for(;null!==r&&!wo(r);)r=r[4];return r}function Gl(r,e,t,a,l){if(null!=a){let u,f=!1;wo(a)?u=a:ta(a)&&(f=!0,a=a[0]);const g=ki(a);0===r&&null!==t?null==l?jc(e,t,g):Bc(e,t,g,l||null,!0):1===r&&null!==t?Bc(e,t,g,l||null,!0):2===r?function W_(r,e,t){const a=Rp(r,e);a&&function QP(r,e,t,a){gi(r)?r.removeChild(e,t,a):e.removeChild(t)}(r,a,e,t)}(e,g,f):3===r&&e.destroyNode(g),null!=u&&function ek(r,e,t,a,l){const u=t[7];u!==ki(t)&&Gl(e,r,a,u,l);for(let g=10;g<t.length;g++){const y=t[g];Eu(y[1],y,r,e,a,u)}}(e,r,u,t,l)}}function qy(r,e,t){if(gi(r))return r.createElement(e,t);{const a=null!==t?function Oc(r){const e=r.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(t):null;return null===a?r.createElement(e):r.createElementNS(a,e)}}function mu(r,e){const t=r[9],a=t.indexOf(e),l=e[3];1024&e[2]&&(e[2]&=-1025,yy(l,-1)),t.splice(a,1)}function Yy(r,e){if(r.length<=10)return;const t=10+e,a=r[t];if(a){const l=a[17];null!==l&&l!==r&&mu(l,a),e>0&&(r[t-1][4]=a[4]);const u=Vl(r,10+e);!function XP(r,e){Eu(r,e,e[11],2,null,null),e[0]=null,e[6]=null}(a[1],a);const f=u[19];null!==f&&f.detachView(u[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function $y(r,e){if(!(256&e[2])){const t=e[11];gi(t)&&t.destroyNode&&Eu(r,e,t,3,null,null),function F_(r){let e=r[13];if(!e)return Oo(r[1],r);for(;e;){let t=null;if(ta(e))t=e[13];else{const a=e[10];a&&(t=a)}if(!t){for(;e&&!e[4]&&e!==r;)ta(e)&&Oo(e[1],e),e=e[3];null===e&&(e=r),ta(e)&&Oo(e[1],e),t=e&&e[4]}e=t}}(e)}}function Oo(r,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function V_(r,e){let t;if(null!=r&&null!=(t=r.destroyHooks))for(let a=0;a<t.length;a+=2){const l=e[t[a]];if(!(l instanceof pp)){const u=t[a+1];if(Array.isArray(u))for(let f=0;f<u.length;f+=2){const g=l[u[f]],y=u[f+1];try{y.call(g)}finally{}}else try{u.call(l)}finally{}}}}(r,e),function Wl(r,e){const t=r.cleanup,a=e[7];let l=-1;if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const f=t[u+1],g="function"==typeof f?f(e):ki(e[f]),y=a[l=t[u+2]],R=t[u+3];"boolean"==typeof R?g.removeEventListener(t[u],y,R):R>=0?a[l=R]():a[l=-R].unsubscribe(),u+=2}else{const f=a[l=t[u+1]];t[u].call(f)}if(null!==a){for(let u=l+1;u<a.length;u++)a[u]();e[7]=null}}(r,e),1===e[1].type&&gi(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&wo(e[3])){t!==e[3]&&mu(t,e);const a=e[19];null!==a&&a.detachView(r)}}}function OR(r,e,t){return function B_(r,e,t){let a=e;for(;null!==a&&40&a.type;)a=(e=a).parent;if(null===a)return t[0];if(2&a.flags){const l=r.data[a.directiveStart].encapsulation;if(l===bs.None||l===bs.Emulated)return null}return wt(a,t)}(r,e.parent,t)}function Bc(r,e,t,a,l){gi(r)?r.insertBefore(e,t,a,l):e.insertBefore(t,a,l)}function jc(r,e,t){gi(r)?r.appendChild(e,t):e.appendChild(t)}function Xy(r,e,t,a,l){null!==a?Bc(r,e,t,a,l):jc(r,e,t)}function Rp(r,e){return gi(r)?r.parentNode(e):e.parentNode}function _u(r,e,t){return j_(r,e,t)}let j_=function NR(r,e,t){return 40&r.type?wt(r,t):null};function zl(r,e,t,a){const l=OR(r,a,e),u=e[11],g=_u(a.parent||e[6],a,e);if(null!=l)if(Array.isArray(t))for(let y=0;y<t.length;y++)Xy(u,l,t[y],g,!1);else Xy(u,l,t,g,!1)}function gu(r,e){if(null!==e){const t=e.type;if(3&t)return wt(e,r);if(4&t)return G_(-1,r[e.index]);if(8&t){const a=e.child;if(null!==a)return gu(r,a);{const l=r[e.index];return wo(l)?G_(-1,l):ki(l)}}if(32&t)return zy(e,r)()||ki(r[e.index]);{const a=Jy(r,e);return null!==a?Array.isArray(a)?a[0]:gu(fu(r[16]),a):gu(r,e.next)}}return null}function Jy(r,e){return null!==e?r[16][6].projection[e.projection]:null}function G_(r,e){const t=10+r+1;if(t<e.length){const a=e[t],l=a[1].firstChild;if(null!==l)return gu(a,l)}return e[7]}function z_(r,e,t,a,l,u,f){for(;null!=t;){const g=a[t.index],y=t.type;if(f&&0===e&&(g&&Dr(ki(g),a),t.flags|=4),64!=(64&t.flags))if(8&y)z_(r,e,t.child,a,l,u,!1),Gl(e,r,l,g,u);else if(32&y){const R=zy(t,a);let D;for(;D=R();)Gl(e,r,l,D,u);Gl(e,r,l,g,u)}else 16&y?PR(r,e,a,t,l,u):Gl(e,r,l,g,u);t=f?t.projectionNext:t.next}}function Eu(r,e,t,a,l,u){z_(t,a,r.firstChild,e,l,u,!1)}function PR(r,e,t,a,l,u){const f=t[16],y=f[6].projection[a.projection];if(Array.isArray(y))for(let R=0;R<y.length;R++)Gl(e,r,l,y[R],u);else z_(r,e,y,f[3],l,u,!0)}function Qy(r,e,t){gi(r)?r.setAttribute(e,"style",t):e.style.cssText=t}function Zy(r,e,t){gi(r)?""===t?r.removeAttribute(e,"class"):r.setAttribute(e,"class",t):e.className=t}class MR{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function ts(r){return r instanceof MR?r.changingThisBreaksApplicationSecurity:r}const dk=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,uk=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Mi=(()=>((Mi=Mi||{})[Mi.NONE=0]="NONE",Mi[Mi.HTML=1]="HTML",Mi[Mi.STYLE=2]="STYLE",Mi[Mi.SCRIPT=3]="SCRIPT",Mi[Mi.URL=4]="URL",Mi[Mi.RESOURCE_URL=5]="RESOURCE_URL",Mi))();function Cu(r){const e=function Yl(){const r=_e();return r&&r[12]}();return e?e.sanitize(Mi.URL,r)||"":function yu(r,e){const t=function UR(r){return r instanceof MR&&r.getTypeName()||null}(r);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see https://g.co/ng/security#xss)`)}return t===e}(r,"URL")?ts(r):function Ap(r){return(r=String(r)).match(dk)||r.match(uk)?r:"unsafe:"+r}(ct(r))}function lS(r){return r.ngOriginalError}function Rk(r,...e){r.error(...e)}class Op{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),a=function Tk(r){return r&&r.ngErrorLogger||Rk}(e);a(this._console,"ERROR",e),t&&a(this._console,"ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&lS(e);for(;t&&lS(t);)t=lS(t);return t||null}}const Pk=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Pn))();function sa(r){return r instanceof Function?r():r}function qR(r,e,t){let a=r.length;for(;;){const l=r.indexOf(e,t);if(-1===l)return l;if(0===l||r.charCodeAt(l-1)<=32){const u=e.length;if(l+u===a||r.charCodeAt(l+u)<=32)return l}t=l+1}}const dS="ng-template";function Fk(r,e,t){let a=0;for(;a<r.length;){let l=r[a++];if(t&&"class"===l){if(l=r[a],-1!==qR(l.toLowerCase(),e,0))return!0}else if(1===l){for(;a<r.length&&"string"==typeof(l=r[a++]);)if(l.toLowerCase()===e)return!0;return!1}}return!1}function YR(r){return 4===r.type&&r.value!==dS}function J_(r,e,t){return e===(4!==r.type||t?r.value:dS)}function uS(r,e,t){let a=4;const l=r.attrs||[],u=function $R(r){for(let e=0;e<r.length;e++)if(tu(r[e]))return e;return r.length}(l);let f=!1;for(let g=0;g<e.length;g++){const y=e[g];if("number"!=typeof y){if(!f)if(4&a){if(a=2|1&a,""!==y&&!J_(r,y,t)||""===y&&1===e.length){if(ns(a))return!1;f=!0}}else{const R=8&a?y:e[++g];if(8&a&&null!==r.attrs){if(!Fk(r.attrs,R,t)){if(ns(a))return!1;f=!0}continue}const x=Q_(8&a?"class":y,l,YR(r),t);if(-1===x){if(ns(a))return!1;f=!0;continue}if(""!==R){let j;j=x>u?"":l[x+1].toLowerCase();const G=8&a?j:null;if(G&&-1!==qR(G,R,0)||2&a&&R!==j){if(ns(a))return!1;f=!0}}}}else{if(!f&&!ns(a)&&!ns(y))return!1;if(f&&ns(y))continue;f=!1,a=y|1&a}}return ns(a)||f}function ns(r){return 0==(1&r)}function Q_(r,e,t,a){if(null===e)return-1;let l=0;if(a||!t){let u=!1;for(;l<e.length;){const f=e[l];if(f===r)return l;if(3===f||6===f)u=!0;else{if(1===f||2===f){let g=e[++l];for(;"string"==typeof g;)g=e[++l];continue}if(4===f)break;if(0===f){l+=4;continue}}l+=u?1:2}return-1}return function XR(r,e){let t=r.indexOf(4);if(t>-1)for(t++;t<r.length;){const a=r[t];if("number"==typeof a)return-1;if(a===e)return t;t++}return-1}(e,r)}function hS(r,e,t=!1){for(let a=0;a<e.length;a++)if(uS(r,e[a],t))return!0;return!1}function Vk(r,e){e:for(let t=0;t<e.length;t++){const a=e[t];if(r.length===a.length){for(let l=0;l<r.length;l++)if(r[l]!==a[l])continue e;return!0}}return!1}function pS(r,e){return r?":not("+e.trim()+")":e}function JR(r){let e=r[0],t=1,a=2,l="",u=!1;for(;t<r.length;){let f=r[t];if("string"==typeof f)if(2&a){const g=r[++t];l+="["+f+(g.length>0?'="'+g+'"':"")+"]"}else 8&a?l+="."+f:4&a&&(l+=" "+f);else""!==l&&!ns(f)&&(e+=pS(u,l),l=""),a=f,u=u||!ns(a);t++}return""!==l&&(e+=pS(u,l)),e}const Et={};function Je(r){ZR($t(),_e(),Ar()+r,!1)}function ZR(r,e,t,a){if(!a)if(3==(3&e[2])){const u=r.preOrderCheckHooks;null!==u&&up(e,u,t)}else{const u=r.preOrderHooks;null!==u&&__(e,u,0,t)}Wa(t)}function Z_(r,e){return r<<17|e<<2}function Ns(r){return r>>17&32767}function eg(r){return 2|r}function Ps(r){return(131068&r)>>2}function tg(r,e){return-131069&r|e<<2}function fS(r){return 1|r}function fI(r,e){const t=r.contentQueries;if(null!==t)for(let a=0;a<t.length;a+=2){const l=t[a],u=t[a+1];if(-1!==u){const f=r.data[u];Ty(l),f.contentQueries(2,e[u],u)}}}function xp(r,e,t,a,l,u,f,g,y,R){const D=e.blueprint.slice();return D[0]=l,D[2]=140|a,j0(D),D[3]=D[15]=r,D[8]=t,D[10]=f||r&&r[10],D[11]=g||r&&r[11],D[12]=y||r&&r[12]||null,D[9]=R||r&&r[9]||null,D[6]=u,D[16]=2==e.type?r[16]:D,D}function Tu(r,e,t,a,l){let u=r.data[e];if(null===u)u=function CS(r,e,t,a,l){const u=G0(),f=l_(),y=r.data[e]=function EI(r,e,t,a,l,u){return{type:t,index:a,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:l,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?u:u&&u.parent,t,e,a,l);return null===r.firstChild&&(r.firstChild=y),null!==u&&(f?null==u.child&&null!==y.parent&&(u.child=y):null===u.next&&(u.next=y)),y}(r,e,t,a,l),function Ga(){return vt.lFrame.inI18n}()&&(u.flags|=64);else if(64&u.type){u.type=t,u.value=a,u.attrs=l;const f=function cp(){const r=vt.lFrame,e=r.currentTNode;return r.isParent?e:e.parent}();u.injectorIndex=null===f?-1:f.injectorIndex}return na(u,!0),u}function Ru(r,e,t,a){if(0===t)return-1;const l=e.length;for(let u=0;u<t;u++)e.push(a),r.blueprint.push(a),r.data.push(null);return l}function Fp(r,e,t){h_(e);try{const a=r.viewQuery;null!==a&&kS(1,a,t);const l=r.template;null!==l&&zr(r,e,l,1,t),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&fI(r,e),r.staticViewQueries&&kS(2,r.viewQuery,t);const u=r.components;null!==u&&function C(r,e){for(let t=0;t<e.length;t++)lM(r,e[t])}(e,u)}catch(a){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),a}finally{e[2]&=-5,dp()}}function Hc(r,e,t,a){const l=e[2];if(256!=(256&l)){h_(e);try{j0(e),function Pc(r){return vt.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==t&&zr(r,e,t,2,a);const f=3==(3&l);if(f){const R=r.preOrderCheckHooks;null!==R&&up(e,R,null)}else{const R=r.preOrderHooks;null!==R&&__(e,R,0,null),hp(e,0)}if(function aM(r){for(let e=M_(r);null!==e;e=L_(e)){if(!e[2])continue;const t=e[9];for(let a=0;a<t.length;a++){const l=t[a],u=l[3];0==(1024&l[2])&&yy(u,1),l[2]|=1024}}}(e),function sM(r){for(let e=M_(r);null!==e;e=L_(e))for(let t=10;t<e.length;t++){const a=e[t],l=a[1];vy(a)&&Hc(l,a,l.template,a[8])}}(e),null!==r.contentQueries&&fI(r,e),f){const R=r.contentCheckHooks;null!==R&&up(e,R)}else{const R=r.contentHooks;null!==R&&__(e,R,1),hp(e,1)}!function Lp(r,e){const t=r.hostBindingOpCodes;if(null!==t)try{for(let a=0;a<t.length;a++){const l=t[a];if(l<0)Wa(~l);else{const u=l,f=t[++a],g=t[++a];dP(f,u),g(2,e[u])}}}finally{Wa(-1)}}(r,e);const g=r.components;null!==g&&function $k(r,e){for(let t=0;t<e.length;t++)cM(r,e[t])}(e,g);const y=r.viewQuery;if(null!==y&&kS(2,y,a),f){const R=r.viewCheckHooks;null!==R&&up(e,R)}else{const R=r.viewHooks;null!==R&&__(e,R,2),hp(e,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),e[2]&=-73,1024&e[2]&&(e[2]&=-1025,yy(e[3],-1))}finally{dp()}}}function Xk(r,e,t,a){const l=e[10],f=B0(e);try{!f&&l.begin&&l.begin(),f&&Fp(r,e,a),Hc(r,e,t,a)}finally{!f&&l.end&&l.end()}}function zr(r,e,t,a,l){const u=Ar(),f=2&a;try{Wa(-1),f&&e.length>20&&ZR(r,e,20,!1),t(a,l)}finally{Wa(u)}}function bS(r,e,t){if(py(e)){const l=e.directiveEnd;for(let u=e.directiveStart;u<l;u++){const f=r.data[u];f.contentQueries&&f.contentQueries(1,t[u],u)}}}function TS(r,e,t){!Sy()||(function TI(r,e,t,a){const l=t.directiveStart,u=t.directiveEnd;r.firstCreatePass||gp(t,e),Dr(a,e);const f=t.initialInputs;for(let g=l;g<u;g++){const y=r.data[g],R=Rs(y);R&&iM(e,t,y);const D=Mc(e,r,g,t);Dr(D,e),null!==f&&rM(0,g-l,D,y,0,f),R&&(Hr(t.index,e)[8]=D)}}(r,e,t,wt(t,e)),128==(128&t.flags)&&function tM(r,e,t){const a=t.directiveStart,l=t.directiveEnd,f=t.index,g=function uP(){return vt.lFrame.currentDirectiveIndex}();try{Wa(f);for(let y=a;y<l;y++){const R=r.data[y],D=e[y];by(y),(null!==R.hostBindings||0!==R.hostVars||null!==R.hostAttrs)&&wS(R,D)}}finally{Wa(-1),by(g)}}(r,e,t))}function sg(r,e,t=wt){const a=e.localNames;if(null!==a){let l=e.index+1;for(let u=0;u<a.length;u+=2){const f=a[u+1],g=-1===f?t(e,r):r[f];r[l++]=g}}}function mI(r){const e=r.tView;return null===e||e.incompleteFirstPass?r.tView=Iu(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):e}function Iu(r,e,t,a,l,u,f,g,y,R){const D=20+a,x=D+l,j=function Jk(r,e){const t=[];for(let a=0;a<e;a++)t.push(a<r?null:Et);return t}(D,x),G="function"==typeof R?R():R;return j[1]={type:r,blueprint:j,template:t,queries:null,viewQuery:g,declTNode:e,data:j.slice().fill(null,D),bindingStartIndex:D,expandoStartIndex:x,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:y,consts:G,incompleteFirstPass:!1}}function RS(r,e,t,a){const l=NI(e);null===t?l.push(a):(l.push(t),r.firstCreatePass&&PI(r).push(a,l.length-1))}function vI(r,e,t){for(let a in r)if(r.hasOwnProperty(a)){const l=r[a];(t=null===t?{}:t).hasOwnProperty(a)?t[a].push(e,l):t[a]=[e,l]}return t}function No(r,e,t,a,l,u,f,g){const y=wt(e,t);let D,R=e.inputs;!g&&null!=R&&(D=R[a])?(LI(r,t,D,a,l),rp(e)&&function Zk(r,e){const t=Hr(e,r);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(a=function yI(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(a),l=null!=f?f(l,e.value||"",a):l,gi(u)?u.setProperty(y,a,l):v_(a)||(y.setProperty?y.setProperty(a,l):y[a]=l))}function Up(r,e,t,a){let l=!1;if(Sy()){const u=function RI(r,e,t){const a=r.directiveRegistry;let l=null;if(a)for(let u=0;u<a.length;u++){const f=a[u];hS(t,f.selectors,!1)&&(l||(l=[]),Ep(gp(t,e),r,f.type),Rs(f)?(Ja(r,t),l.unshift(f)):l.push(f))}return l}(r,e,t),f=null===a?null:{"":-1};if(null!==u){l=!0,wI(t,r.data.length,u.length);for(let D=0;D<u.length;D++){const x=u[D];x.providersResolver&&x.providersResolver(x)}let g=!1,y=!1,R=Ru(r,e,u.length,null);for(let D=0;D<u.length;D++){const x=u[D];t.mergedAttrs=mp(t.mergedAttrs,x.hostAttrs),AI(r,t,e,R,x),nM(R,x,f),null!==x.contentQueries&&(t.flags|=8),(null!==x.hostBindings||null!==x.hostAttrs||0!==x.hostVars)&&(t.flags|=128);const j=x.type.prototype;!g&&(j.ngOnChanges||j.ngOnInit||j.ngDoCheck)&&((r.preOrderHooks||(r.preOrderHooks=[])).push(t.index),g=!0),!y&&(j.ngOnChanges||j.ngDoCheck)&&((r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(t.index),y=!0),R++}!function Qk(r,e){const a=e.directiveEnd,l=r.data,u=e.attrs,f=[];let g=null,y=null;for(let R=e.directiveStart;R<a;R++){const D=l[R],x=D.inputs,j=null===u||YR(e)?null:oM(x,u);f.push(j),g=vI(x,R,g),y=vI(D.outputs,R,y)}null!==g&&(g.hasOwnProperty("class")&&(e.flags|=16),g.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=f,e.inputs=g,e.outputs=y}(r,t)}f&&function II(r,e,t){if(e){const a=r.localNames=[];for(let l=0;l<e.length;l+=2){const u=t[e[l+1]];if(null==u)throw new Pe(-301,!1);a.push(e[l],u)}}}(t,a,f)}return t.mergedAttrs=mp(t.mergedAttrs,t.attrs),l}function bI(r,e,t,a,l,u){const f=u.hostBindings;if(f){let g=r.hostBindingOpCodes;null===g&&(g=r.hostBindingOpCodes=[]);const y=~e.index;(function eM(r){let e=r.length;for(;e>0;){const t=r[--e];if("number"==typeof t&&t<0)return t}return 0})(g)!=y&&g.push(y),g.push(a,l,f)}}function wS(r,e){null!==r.hostBindings&&r.hostBindings(1,e)}function Ja(r,e){e.flags|=2,(r.components||(r.components=[])).push(e.index)}function nM(r,e,t){if(t){if(e.exportAs)for(let a=0;a<e.exportAs.length;a++)t[e.exportAs[a]]=r;Rs(e)&&(t[""]=r)}}function wI(r,e,t){r.flags|=1,r.directiveStart=e,r.directiveEnd=e+t,r.providerIndexes=e}function AI(r,e,t,a,l){r.data[a]=l;const u=l.factory||(l.factory=Ll(l.type)),f=new pp(u,Rs(l),null);r.blueprint[a]=f,t[a]=f,bI(r,e,0,a,Ru(r,t,l.hostVars,Et),l)}function iM(r,e,t){const a=wt(e,r),l=mI(t),u=r[10],f=Vp(r,xp(r,l,null,t.onPush?64:16,a,e,u,u.createRenderer(a,t),null,null));r[e.index]=f}function ks(r,e,t,a,l,u){const f=wt(r,e);!function AS(r,e,t,a,l,u,f){if(null==u)gi(r)?r.removeAttribute(e,l,t):e.removeAttribute(l);else{const g=null==f?ct(u):f(u,a||"",l);gi(r)?r.setAttribute(e,l,g,t):t?e.setAttributeNS(t,l,g):e.setAttribute(l,g)}}(e[11],f,u,r.value,t,a,l)}function rM(r,e,t,a,l,u){const f=u[e];if(null!==f){const g=a.setInput;for(let y=0;y<f.length;){const R=f[y++],D=f[y++],x=f[y++];null!==g?a.setInput(t,x,R,D):t[D]=x}}}function oM(r,e){let t=null,a=0;for(;a<e.length;){const l=e[a];if(0!==l)if(5!==l){if("number"==typeof l)break;r.hasOwnProperty(l)&&(null===t&&(t=[]),t.push(l,r[l],e[a+1])),a+=2}else a+=2;else a+=4}return t}function wu(r,e,t,a){return new Array(r,!0,!1,e,null,0,a,t,null,null)}function cM(r,e){const t=Hr(e,r);if(vy(t)){const a=t[1];80&t[2]?Hc(a,t,a.template,t[8]):t[5]>0&&DS(t)}}function DS(r){for(let a=M_(r);null!==a;a=L_(a))for(let l=10;l<a.length;l++){const u=a[l];if(1024&u[2]){const f=u[1];Hc(f,u,f.template,u[8])}else u[5]>0&&DS(u)}const t=r[1].components;if(null!==t)for(let a=0;a<t.length;a++){const l=Hr(t[a],r);vy(l)&&l[5]>0&&DS(l)}}function lM(r,e){const t=Hr(e,r),a=t[1];(function dM(r,e){for(let t=e.length;t<r.blueprint.length;t++)e.push(r.blueprint[t])})(a,t),Fp(a,t,t[8])}function Vp(r,e){return r[13]?r[14][4]=e:r[13]=e,r[14]=e,e}function OS(r){for(;r;){r[2]|=64;const e=fu(r);if(GN(r)&&!e)return r;r=e}return null}function OI(r){!function NS(r){for(let e=0;e<r.components.length;e++){const t=r.components[e],a=Vc(t),l=a[1];Xk(l,a,l.template,t)}}(r[8])}function kS(r,e,t){Ty(0),e(r,t)}const fM=(()=>Promise.resolve(null))();function NI(r){return r[7]||(r[7]=[])}function PI(r){return r.cleanup||(r.cleanup=[])}function MI(r,e){const t=r[9],a=t?t.get(Op,null):null;a&&a.handleError(e)}function LI(r,e,t,a,l){for(let u=0;u<t.length;){const f=t[u++],g=t[u++],y=e[f],R=r.data[f];null!==R.setInput?R.setInput(y,l,a,g):y[g]=l}}function aa(r,e,t){const a=c_(e,r);!function AR(r,e,t){gi(r)?r.setValue(e,t):e.textContent=t}(r[11],a,t)}function ag(r,e,t){let a=t?r.styles:null,l=t?r.classes:null,u=0;if(null!==e)for(let f=0;f<e.length;f++){const g=e[f];"number"==typeof g?u=g:1==u?l=Xm(l,g):2==u&&(a=Xm(a,g+": "+e[++f]+";"))}t?r.styles=a:r.stylesWithoutHost=a,t?r.classes=l:r.classesWithoutHost=l}const cg=new Le("INJECTOR",-1);class xI{get(e,t=ia){if(t===ia){const a=new Error(`NullInjectorError: No provider for ${pn(e)}!`);throw a.name="NullInjectorError",a}return t}}const MS=new Le("Set Injector scope."),Bp={},FI={};let LS;function UI(){return void 0===LS&&(LS=new xI),LS}function VI(r,e=null,t=null,a){const l=BI(r,e,t,a);return l._resolveInjectorDefTypes(),l}function BI(r,e=null,t=null,a){return new gM(r,t,e||UI(),a)}class gM{constructor(e,t,a,l=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const u=[];t&&Ds(t,g=>this.processProvider(g,e,t)),Ds([e],g=>this.processInjectorType(g,[],u)),this.records.set(cg,Au(void 0,this));const f=this.records.get(MS);this.scope=null!=f?f.value:null,this.source=l||("object"==typeof e?null:pn(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=ia,a=et.Default){this.assertNotDestroyed();const l=ui(this),u=Fa(void 0);try{if(!(a&et.SkipSelf)){let g=this.records.get(e);if(void 0===g){const y=function bM(r){return"function"==typeof r||"object"==typeof r&&r instanceof Le}(e)&&e_(e);g=y&&this.injectableDefInScope(y)?Au(xS(e),Bp):null,this.records.set(e,g)}if(null!=g)return this.hydrate(e,g)}return(a&et.Self?UI():this.parent).get(e,t=a&et.Optional&&t===ia?null:t)}catch(f){if("NullInjectorError"===f.name){if((f[jl]=f[jl]||[]).unshift(pn(e)),l)throw f;return function BP(r,e,t,a){const l=r[jl];throw e[_R]&&l.unshift(e[_R]),r.message=function jP(r,e,t,a=null){r=r&&"\n"===r.charAt(0)&&"\u0275"==r.charAt(1)?r.substr(2):r;let l=pn(e);if(Array.isArray(e))l=e.map(pn).join(" -> ");else if("object"==typeof e){let u=[];for(let f in e)if(e.hasOwnProperty(f)){let g=e[f];u.push(f+":"+("string"==typeof g?JSON.stringify(g):pn(g)))}l=`{${u.join(", ")}}`}return`${t}${a?"("+a+")":""}[${l}]: ${r.replace(R_,"\n  ")}`}("\n"+r.message,l,t,a),r.ngTokenPath=l,r[jl]=null,r}(f,e,"R3InjectorError",this.source)}throw f}finally{Fa(u),ui(l)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((a,l)=>e.push(pn(l))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Pe(205,!1)}processInjectorType(e,t,a){if(!(e=at(e)))return!1;let l=t_(e);const u=null==l&&e.ngModule||void 0,f=void 0===u?e:u,g=-1!==a.indexOf(f);if(void 0!==u&&(l=t_(u)),null==l)return!1;if(null!=l.imports&&!g){let D;a.push(f);try{Ds(l.imports,x=>{this.processInjectorType(x,t,a)&&(void 0===D&&(D=[]),D.push(x))})}finally{}if(void 0!==D)for(let x=0;x<D.length;x++){const{ngModule:j,providers:G}=D[x];Ds(G,q=>this.processProvider(q,j,G||an))}}this.injectorDefTypes.add(f);const y=Ll(f)||(()=>new f);this.records.set(f,Au(y,Bp));const R=l.providers;if(null!=R&&!g){const D=e;Ds(R,x=>this.processProvider(x,D,R))}return void 0!==u&&void 0!==e.providers}processProvider(e,t,a){let l=Du(e=at(e))?e:at(e&&e.provide);const u=function jI(r,e,t){return GI(r)?Au(void 0,r.useValue):Au(HI(r),Bp)}(e);if(Du(e)||!0!==e.multi)this.records.get(l);else{let f=this.records.get(l);f||(f=Au(void 0,Bp,!0),f.factory=()=>I_(f.multi),this.records.set(l,f)),l=e,f.multi.push(e)}this.records.set(l,u)}hydrate(e,t){return t.value===Bp&&(t.value=FI,t.value=t.factory()),"object"==typeof t.value&&t.value&&function CM(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=at(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function xS(r){const e=e_(r),t=null!==e?e.factory:Ll(r);if(null!==t)return t;if(r instanceof Le)throw new Pe(204,!1);if(r instanceof Function)return function EM(r){const e=r.length;if(e>0)throw xc(e,"?"),new Pe(204,!1);const t=function Xo(r){const e=r&&(r[zd]||r[ny]);if(e){const t=function Dl(r){if(r.hasOwnProperty("name"))return r.name;const e=(""+r).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(r);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(r);return null!==t?()=>t.factory(r):()=>new r}(r);throw new Pe(204,!1)}function HI(r,e,t){let a;if(Du(r)){const l=at(r);return Ll(l)||xS(l)}if(GI(r))a=()=>at(r.useValue);else if(function yM(r){return!(!r||!r.useFactory)}(r))a=()=>r.useFactory(...I_(r.deps||[]));else if(function vM(r){return!(!r||!r.useExisting)}(r))a=()=>he(at(r.useExisting));else{const l=at(r&&(r.useClass||r.provide));if(!function WI(r){return!!r.deps}(r))return Ll(l)||xS(l);a=()=>new l(...I_(r.deps))}return a}function Au(r,e,t=!1){return{factory:r,value:e,multi:t?[]:void 0}}function GI(r){return null!==r&&"object"==typeof r&&FP in r}function Du(r){return"function"==typeof r}let ir=(()=>{class r{static create(t,a){var l;if(Array.isArray(t))return VI({name:""},a,t,"");{const u=null!==(l=t.name)&&void 0!==l?l:"";return VI({name:u},t.parent,t.providers,u)}}}return r.THROW_IF_NOT_FOUND=ia,r.NULL=new xI,r.\u0275prov=Ue({token:r,providedIn:"any",factory:()=>he(cg)}),r.__NG_ELEMENT_ID__=-1,r})();function OM(r,e){m_(Vc(r)[1],Ki())}function Mt(r){let e=function YI(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),t=!0;const a=[r];for(;e;){let l;if(Rs(r))l=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Pe(903,"");l=e.\u0275dir}if(l){if(t){a.push(l);const f=r;f.inputs=HS(r.inputs),f.declaredInputs=HS(r.declaredInputs),f.outputs=HS(r.outputs);const g=l.hostBindings;g&&MM(r,g);const y=l.viewQuery,R=l.contentQueries;if(y&&PM(r,y),R&&kM(r,R),$m(r.inputs,l.inputs),$m(r.declaredInputs,l.declaredInputs),$m(r.outputs,l.outputs),Rs(l)&&l.data.animation){const D=r.data;D.animation=(D.animation||[]).concat(l.data.animation)}}const u=l.features;if(u)for(let f=0;f<u.length;f++){const g=u[f];g&&g.ngInherit&&g(r),g===Mt&&(t=!1)}}e=Object.getPrototypeOf(e)}!function NM(r){let e=0,t=null;for(let a=r.length-1;a>=0;a--){const l=r[a];l.hostVars=e+=l.hostVars,l.hostAttrs=mp(l.hostAttrs,t=mp(t,l.hostAttrs))}}(a)}function HS(r){return r===qd?{}:r===an?[]:r}function PM(r,e){const t=r.viewQuery;r.viewQuery=t?(a,l)=>{e(a,l),t(a,l)}:e}function kM(r,e){const t=r.contentQueries;r.contentQueries=t?(a,l,u)=>{e(a,l,u),t(a,l,u)}:e}function MM(r,e){const t=r.hostBindings;r.hostBindings=t?(a,l)=>{e(a,l),t(a,l)}:e}let pg=null;function $l(){if(!pg){const r=Pn.Symbol;if(r&&r.iterator)pg=r.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const a=e[t];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(pg=a)}}}return pg}function Pu(r){return!!GS(r)&&(Array.isArray(r)||!(r instanceof Map)&&$l()in r)}function GS(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function Ms(r,e,t){return r[e]=t}function vr(r,e,t){return!Object.is(r[e],t)&&(r[e]=t,!0)}function Gc(r,e,t,a){const l=vr(r,e,t);return vr(r,e+1,a)||l}function rr(r,e,t,a){const l=_e();return vr(l,eu(),e)&&($t(),ks(di(),l,r,e,t,a)),rr}function jn(r,e,t,a,l,u,f,g){const y=_e(),R=$t(),D=r+20,x=R.firstCreatePass?function Vu(r,e,t,a,l,u,f,g,y){const R=e.consts,D=Tu(e,r,4,f||null,Ba(R,g));Up(e,t,D,Ba(R,y)),m_(e,D);const x=D.tViews=Iu(2,D,a,l,u,e.directiveRegistry,e.pipeRegistry,null,e.schemas,R);return null!==e.queries&&(e.queries.template(e,D),x.queries=e.queries.embeddedTView(D)),D}(D,R,y,e,t,a,l,u,f):R.data[D];na(x,!1);const j=y[11].createComment("");zl(R,y,j,x),Dr(j,y),Vp(y,y[D]=wu(j,y,j,x)),s_(x)&&TS(R,y,x),null!=f&&sg(y,x,g)}function Bu(r){return Zd(function lP(){return vt.lFrame.contextLView}(),20+r)}function oe(r,e=et.Default){const t=_e();return null===t?he(r,e):rR(Ki(),t,at(r),e)}function Cg(){throw new Error("invalid")}function ot(r,e,t){const a=_e();return vr(a,eu(),e)&&No($t(),di(),a,r,e,a[11],t,!1),ot}function qp(r,e,t,a,l){const f=l?"class":"style";LI(r,t,e.inputs[f],f,a)}function Ae(r,e,t,a){const l=_e(),u=$t(),f=20+r,g=l[11],y=l[f]=qy(g,e,function gP(){return vt.lFrame.currentNamespace}()),R=u.firstCreatePass?function tw(r,e,t,a,l,u,f){const g=e.consts,R=Tu(e,r,2,l,Ba(g,u));return Up(e,t,R,Ba(g,f)),null!==R.attrs&&ag(R,R.attrs,!1),null!==R.mergedAttrs&&ag(R,R.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,R),R}(f,u,l,0,e,t,a):u.data[f];na(R,!0);const D=R.mergedAttrs;null!==D&&E_(g,y,D);const x=R.classes;null!==x&&Zy(g,y,x);const j=R.styles;return null!==j&&Qy(g,y,j),64!=(64&R.flags)&&zl(u,l,y,R),0===function oP(){return vt.lFrame.elementDepthCount}()&&Dr(y,l),function sP(){vt.lFrame.elementDepthCount++}(),s_(R)&&(TS(u,l,R),bS(u,R,l)),null!==a&&sg(l,R),Ae}function Be(){let r=Ki();l_()?lp():(r=r.parent,na(r,!1));const e=r;!function H0(){vt.lFrame.elementDepthCount--}();const t=$t();return t.firstCreatePass&&(m_(t,r),py(r)&&t.queries.elementEnd(r)),null!=e.classesWithoutHost&&function yP(r){return 0!=(16&r.flags)}(e)&&qp(t,e,_e(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function X0(r){return 0!=(32&r.flags)}(e)&&qp(t,e,_e(),e.stylesWithoutHost,!1),Be}function At(r,e,t,a){return Ae(r,e,t,a),Be(),At}function ed(r,e,t){const a=_e(),l=$t(),u=r+20,f=l.firstCreatePass?function ZM(r,e,t,a,l){const u=e.consts,f=Ba(u,a),g=Tu(e,r,8,"ng-container",f);return null!==f&&ag(g,f,!0),Up(e,t,g,Ba(u,l)),null!==e.queries&&e.queries.elementStart(e,g),g}(u,l,a,e,t):l.data[u];na(f,!0);const g=a[u]=a[11].createComment("");return zl(l,a,g,f),Dr(g,a),s_(f)&&(TS(l,a,f),bS(l,f,a)),null!=t&&sg(a,f),ed}function td(){let r=Ki();const e=$t();return l_()?lp():(r=r.parent,na(r,!1)),e.firstCreatePass&&(m_(e,r),py(r)&&e.queries.elementEnd(r)),td}function ca(){return _e()}function Yp(r){return!!r&&"function"==typeof r.then}function iw(r){return!!r&&"function"==typeof r.subscribe}const aC=iw;function zt(r,e,t,a){const l=_e(),u=$t(),f=Ki();return function rw(r,e,t,a,l,u,f,g){const y=s_(a),D=r.firstCreatePass&&PI(r),x=e[8],j=NI(e);let G=!0;if(3&a.type||g){const ue=wt(a,e),Ce=g?g(ue):ue,ce=j.length,De=g?Xe=>g(ki(Xe[a.index])):a.index;if(gi(t)){let Xe=null;if(!g&&y&&(Xe=function e1(r,e,t,a){const l=r.cleanup;if(null!=l)for(let u=0;u<l.length-1;u+=2){const f=l[u];if(f===t&&l[u+1]===a){const g=e[7],y=l[u+2];return g.length>y?g[y]:null}"string"==typeof f&&(u+=2)}return null}(r,e,l,a.index)),null!==Xe)(Xe.__ngLastListenerFn__||Xe).__ngNextListenerFn__=u,Xe.__ngLastListenerFn__=u,G=!1;else{u=Rg(a,e,x,u,!1);const Vt=t.listen(Ce,l,u);j.push(u,Vt),D&&D.push(l,De,ce,ce+1)}}else u=Rg(a,e,x,u,!0),Ce.addEventListener(l,u,f),j.push(u),D&&D.push(l,De,ce,f)}else u=Rg(a,e,x,u,!1);const q=a.outputs;let se;if(G&&null!==q&&(se=q[l])){const ue=se.length;if(ue)for(let Ce=0;Ce<ue;Ce+=2){const Ti=e[se[Ce]][se[Ce+1]].subscribe(u),Di=j.length;j.push(u,Ti),D&&D.push(l,a.index,Di,-(Di+1))}}}(u,l,l[11],f,r,e,!!t,a),zt}function ow(r,e,t,a){try{return!1!==t(a)}catch(l){return MI(r,l),!1}}function Rg(r,e,t,a,l){return function u(f){if(f===Function)return a;const g=2&r.flags?Hr(r.index,e):e;0==(32&e[2])&&OS(g);let y=ow(e,0,a,f),R=u.__ngNextListenerFn__;for(;R;)y=ow(e,0,R,f)&&y,R=R.__ngNextListenerFn__;return l&&!1===y&&(f.preventDefault(),f.returnValue=!1),y}}function Xt(r=1){return function pP(r){return(vt.lFrame.contextLView=function fP(r,e){for(;r>0;)e=e[15],r--;return e}(r,vt.lFrame.contextLView))[8]}(r)}function sw(r,e){let t=null;const a=function Uk(r){const e=r.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(r);for(let l=0;l<e.length;l++){const u=e[l];if("*"!==u){if(null===a?hS(r,u,!0):Vk(a,u))return l}else t=l}return t}function $p(r){const e=_e()[16][6];if(!e.projection){const a=e.projection=xc(r?r.length:1,null),l=a.slice();let u=e.child;for(;null!==u;){const f=r?sw(u,r):0;null!==f&&(l[f]?l[f].projectionNext=u:a[f]=u,l[f]=u),u=u.next}}}function co(r,e=0,t){const a=_e(),l=$t(),u=Tu(l,20+r,16,null,t||null);null===u.projection&&(u.projection=e),lp(),64!=(64&u.flags)&&function ZP(r,e,t){PR(e[11],0,e,t,OR(r,t,e),_u(t.parent||e[6],t,e))}(l,a,u)}function uC(r,e,t,a,l){const u=r[t+1],f=null===e;let g=a?Ns(u):Ps(u),y=!1;for(;0!==g&&(!1===y||f);){const D=r[g+1];dw(r[g],e)&&(y=!0,r[g+1]=a?fS(D):eg(D)),g=a?Ns(D):Ps(D)}y&&(r[t+1]=a?eg(u):fS(u))}function dw(r,e){return null===r||null==e||(Array.isArray(r)?r[1]:r)===e||!(!Array.isArray(r)||"string"!=typeof e)&&lu(r,e)>=0}function Gu(r,e,t){return Ls(r,e,t,!1),Gu}function vn(r,e){return Ls(r,e,null,!0),vn}function Ls(r,e,t,a){const l=_e(),u=$t(),f=function Ha(r){const e=vt.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+r,t}(2);u.firstUpdatePass&&function Ew(r,e,t,a){const l=r.data;if(null===l[t+1]){const u=l[Ar()],f=function gw(r,e){return e>=r.expandoStartIndex}(r,t);(function bw(r,e){return 0!=(r.flags&(e?16:32))})(u,a)&&null===e&&!f&&(e=!1),e=function c1(r,e,t,a){const l=function u_(r){const e=vt.lFrame.currentDirectiveIndex;return-1===e?null:r[e]}(r);let u=a?e.residualClasses:e.residualStyles;if(null===l)0===(a?e.classBindings:e.styleBindings)&&(t=Xp(t=fC(null,r,e,t,a),e.attrs,a),u=null);else{const f=e.directiveStylingLast;if(-1===f||r[f]!==l)if(t=fC(l,r,e,t,a),null===u){let y=function l1(r,e,t){const a=t?e.classBindings:e.styleBindings;if(0!==Ps(a))return r[Ns(a)]}(r,e,a);void 0!==y&&Array.isArray(y)&&(y=fC(null,r,e,y[1],a),y=Xp(y,e.attrs,a),function d1(r,e,t,a){r[Ns(t?e.classBindings:e.styleBindings)]=a}(r,e,a,y))}else u=function u1(r,e,t){let a;const l=e.directiveEnd;for(let u=1+e.directiveStylingLast;u<l;u++)a=Xp(a,r[u].hostAttrs,t);return Xp(a,e.attrs,t)}(r,e,a)}return void 0!==u&&(a?e.residualClasses=u:e.residualStyles=u),t}(l,u,e,a),function t1(r,e,t,a,l,u){let f=u?e.classBindings:e.styleBindings,g=Ns(f),y=Ps(f);r[a]=t;let D,R=!1;if(Array.isArray(t)){const x=t;D=x[1],(null===D||lu(x,D)>0)&&(R=!0)}else D=t;if(l)if(0!==y){const j=Ns(r[g+1]);r[a+1]=Z_(j,g),0!==j&&(r[j+1]=tg(r[j+1],a)),r[g+1]=function nI(r,e){return 131071&r|e<<17}(r[g+1],a)}else r[a+1]=Z_(g,0),0!==g&&(r[g+1]=tg(r[g+1],a)),g=a;else r[a+1]=Z_(y,0),0===g?g=a:r[y+1]=tg(r[y+1],a),y=a;R&&(r[a+1]=eg(r[a+1])),uC(r,D,a,!0),uC(r,D,a,!1),function n1(r,e,t,a,l){const u=l?r.residualClasses:r.residualStyles;null!=u&&"string"==typeof e&&lu(u,e)>=0&&(t[a+1]=fS(t[a+1]))}(e,D,r,a,u),f=Z_(g,y),u?e.classBindings=f:e.styleBindings=f}(l,u,e,t,f,a)}}(u,r,f,a),e!==Et&&vr(l,f,e)&&function Sw(r,e,t,a,l,u,f,g){if(!(3&e.type))return;const y=r.data,R=y[g+1];Og(function ng(r){return 1==(1&r)}(R)?Cw(y,e,t,l,Ps(R),f):void 0)||(Og(u)||function tI(r){return 2==(2&r)}(R)&&(u=Cw(y,null,t,l,g,f)),function tk(r,e,t,a,l){const u=gi(r);if(e)l?u?r.addClass(t,a):t.classList.add(a):u?r.removeClass(t,a):t.classList.remove(a);else{let f=-1===a.indexOf("-")?void 0:Do.DashCase;if(null==l)u?r.removeStyle(t,a,f):t.style.removeProperty(a);else{const g="string"==typeof l&&l.endsWith("!important");g&&(l=l.slice(0,-10),f|=Do.Important),u?r.setStyle(t,a,l,f):t.style.setProperty(a,l,g?"important":"")}}}(a,f,c_(Ar(),t),l,u))}(u,u.data[Ar()],l,l[11],r,l[f+1]=function p1(r,e){return null==r||("string"==typeof e?r+=e:"object"==typeof r&&(r=pn(ts(r)))),r}(e,t),a,f)}function fC(r,e,t,a,l){let u=null;const f=t.directiveEnd;let g=t.directiveStylingLast;for(-1===g?g=t.directiveStart:g++;g<f&&(u=e[g],a=Xp(a,u.hostAttrs,l),u!==r);)g++;return null!==r&&(t.directiveStylingLast=g),a}function Xp(r,e,t){const a=t?1:2;let l=-1;if(null!==e)for(let u=0;u<e.length;u++){const f=e[u];"number"==typeof f?l=f:l===a&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),Ao(r,f,!!t||e[++u]))}return void 0===r?null:r}function Cw(r,e,t,a,l,u){const f=null===e;let g;for(;l>0;){const y=r[l],R=Array.isArray(y),D=R?y[1]:y,x=null===D;let j=t[l+1];j===Et&&(j=x?an:void 0);let G=x?xy(j,a):D===a?j:void 0;if(R&&!Og(G)&&(G=xy(y,a)),Og(G)&&(g=G,f))return g;const q=r[l+1];l=f?Ns(q):Ps(q)}if(null!==e){let y=u?e.residualClasses:e.residualStyles;null!=y&&(g=xy(y,a))}return g}function Og(r){return void 0!==r}function Yi(r,e=""){const t=_e(),a=$t(),l=r+20,u=a.firstCreatePass?Tu(a,l,1,e,null):a.data[l],f=t[l]=function x_(r,e){return gi(r)?r.createText(e):r.createTextNode(e)}(t[11],e);zl(a,t,f,u),na(u,!1)}function Yc(r){return Jp("",r,""),Yc}function Jp(r,e,t){const a=_e(),l=function Mu(r,e,t,a){return vr(r,eu(),t)?e+ct(t)+a:Et}(a,r,e,t);return l!==Et&&aa(a,Ar(),l),Jp}function xg(r,e,t){const a=_e();return vr(a,eu(),e)&&No($t(),di(),a,r,e,a[11],t,!0),xg}const nf="en-US";let Jc=nf;function df(r,e,t,a,l){if(r=at(r),Array.isArray(r))for(let u=0;u<r.length;u++)df(r[u],e,t,a,l);else{const u=$t(),f=_e();let g=Du(r)?r:at(r.provide),y=HI(r);const R=Ki(),D=1048575&R.providerIndexes,x=R.directiveStart,j=R.providerIndexes>>20;if(Du(r)||!r.multi){const G=new pp(y,l,oe),q=hf(g,e,l?D:D+j,x);-1===q?(Ep(gp(R,f),u,g),uf(u,r,e.length),e.push(g),R.directiveStart++,R.directiveEnd++,l&&(R.providerIndexes+=1048576),t.push(G),f.push(G)):(t[q]=G,f[q]=G)}else{const G=hf(g,e,D+j,x),q=hf(g,e,D,D+j),se=G>=0&&t[G],ue=q>=0&&t[q];if(l&&!ue||!l&&!se){Ep(gp(R,f),u,g);const Ce=function Yg(r,e,t,a,l){const u=new pp(r,t,oe);return u.multi=[],u.index=e,u.componentProviders=0,Qc(u,l,a&&!t),u}(l?eA:Kg,t.length,l,a,y);!l&&ue&&(t[q].providerFactory=Ce),uf(u,r,e.length,0),e.push(g),R.directiveStart++,R.directiveEnd++,l&&(R.providerIndexes+=1048576),t.push(Ce),f.push(Ce)}else uf(u,r,G>-1?G:q,Qc(t[l?q:G],y,!l&&a));!l&&a&&ue&&t[q].componentProviders++}}}function uf(r,e,t,a){const l=Du(e),u=function SM(r){return!!r.useClass}(e);if(l||u){const y=(u?at(e.useClass):e).prototype.ngOnDestroy;if(y){const R=r.destroyHooks||(r.destroyHooks=[]);if(!l&&e.multi){const D=R.indexOf(t);-1===D?R.push(t,[a,y]):R[D+1].push(a,y)}else R.push(t,y)}}}function Qc(r,e,t){return t&&r.componentProviders++,r.multi.push(e)-1}function hf(r,e,t,a){for(let l=t;l<a;l++)if(e[l]===r)return l;return-1}function Kg(r,e,t,a){return qg(this.multi,[])}function eA(r,e,t,a){const l=this.multi;let u;if(this.providerFactory){const f=this.providerFactory.componentProviders,g=Mc(t,t[1],this.providerFactory.index,a);u=g.slice(0,f),qg(l,u);for(let y=f;y<g.length;y++)u.push(g[y])}else u=[],qg(l,u);return u}function qg(r,e){for(let t=0;t<r.length;t++)e.push((0,r[t])());return e}function xn(r,e=[]){return t=>{t.providersResolver=(a,l)=>function P1(r,e,t){const a=$t();if(a.firstCreatePass){const l=Rs(r);df(t,a.data,a.blueprint,l,!0),df(e,a.data,a.blueprint,l,!1)}}(a,l?l(r):r,e)}}class tA{}class IC{resolveComponentFactory(e){throw function M1(r){const e=Error(`No component factory found for ${pn(r)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=r,e}(e)}}let nc=(()=>{class r{}return r.NULL=new IC,r})();function L1(){return vi(Ki(),_e())}function vi(r,e){return new Rn(wt(r,e))}let Rn=(()=>{class r{constructor(t){this.nativeElement=t}}return r.__NG_ELEMENT_ID__=L1,r})();function nA(r){return r instanceof Rn?r.nativeElement:r}class pf{}let Lo=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function rA(){const r=_e(),t=Hr(Ki().index,r);return function iA(r){return r[11]}(ta(t)?t:r)}(),r})(),F1=(()=>{class r{}return r.\u0275prov=Ue({token:r,providedIn:"root",factory:()=>null}),r})();class ld{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const Yu=new ld("13.4.0"),ff={};function mf(r,e,t,a,l=!1){for(;null!==t;){const u=e[t.index];if(null!==u&&a.push(ki(u)),wo(u))for(let g=10;g<u.length;g++){const y=u[g],R=y[1].firstChild;null!==R&&mf(y[1],y,R,a)}const f=t.type;if(8&f)mf(r,e,t.child,a);else if(32&f){const g=zy(t,e);let y;for(;y=g();)a.push(y)}else if(16&f){const g=Jy(e,t);if(Array.isArray(g))a.push(...g);else{const y=fu(e[16]);mf(y[1],y,g,a,!0)}}t=l?t.projectionNext:t.next}return a}class $u{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return mf(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(wo(e)){const t=e[8],a=t?t.indexOf(this):-1;a>-1&&(Yy(e,a),Vl(t,a))}this._attachedToViewContainer=!1}$y(this._lView[1],this._lView)}onDestroy(e){RS(this._lView[1],this._lView,null,e)}markForCheck(){OS(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function PS(r,e,t){const a=e[10];a.begin&&a.begin();try{Hc(r,e,r.template,t)}catch(l){throw MI(e,l),l}finally{a.end&&a.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Pe(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function DR(r,e){Eu(r,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Pe(902,"");this._appRef=e}}class oA extends $u{constructor(e){super(e),this._view=e}detectChanges(){OI(this._view)}checkNoChanges(){}get context(){return null}}class Xg extends nc{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Zi(e);return new AC(t,this.ngModule)}}function wC(r){const e=[];for(let t in r)r.hasOwnProperty(t)&&e.push({propName:r[t],templateName:t});return e}class AC extends tA{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function Bk(r){return r.map(JR).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return wC(this.componentDef.inputs)}get outputs(){return wC(this.componentDef.outputs)}create(e,t,a,l){const u=(l=l||this.ngModule)?function aA(r,e){return{get:(t,a,l)=>{const u=r.get(t,ff,l);return u!==ff||a===ff?u:e.get(t,a,l)}}}(e,l.injector):e,f=u.get(pf,V0),g=u.get(F1,null),y=f.createRenderer(null,this.componentDef),R=this.componentDef.selectors[0][0]||"div",D=a?function gI(r,e,t){if(gi(r))return r.selectRootElement(e,t===bs.ShadowDom);let a="string"==typeof e?r.querySelector(e):e;return a.textContent="",a}(y,a,this.componentDef.encapsulation):qy(f.createRenderer(null,this.componentDef),R,function sA(r){const e=r.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(R)),x=this.componentDef.onPush?576:528,j=function Nu(r,e){return{components:[],scheduler:r||Pk,clean:fM,playerHandler:e||null,flags:0}}(),G=Iu(0,null,null,1,0,null,null,null,null,null),q=xp(null,G,j,x,null,null,f,y,g,u);let se,ue;h_(q);try{const Ce=function jS(r,e,t,a,l,u){const f=t[1];t[20]=r;const y=Tu(f,20,2,"#host",null),R=y.mergedAttrs=e.hostAttrs;null!==R&&(ag(y,R,!0),null!==r&&(E_(l,r,R),null!==y.classes&&Zy(l,r,y.classes),null!==y.styles&&Qy(l,r,y.styles)));const D=a.createRenderer(r,e),x=xp(t,mI(e),null,e.onPush?64:16,t[20],y,a,D,u||null,null);return f.firstCreatePass&&(Ep(gp(y,t),f,e.type),Ja(f,y),wI(y,t.length,1)),Vp(t,x),t[20]=x}(D,this.componentDef,q,f,y);if(D)if(a)E_(y,D,["ng-version",Yu.full]);else{const{attrs:ce,classes:De}=function QR(r){const e=[],t=[];let a=1,l=2;for(;a<r.length;){let u=r[a];if("string"==typeof u)2===l?""!==u&&e.push(u,r[++a]):8===l&&t.push(u);else{if(!ns(l))break;l=u}a++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);ce&&E_(y,D,ce),De&&De.length>0&&Zy(y,D,De.join(" "))}if(ue=Ey(G,20),void 0!==t){const ce=ue.projection=[];for(let De=0;De<this.ngContentSelectors.length;De++){const Xe=t[De];ce.push(null!=Xe?Array.from(Xe):null)}}se=function hg(r,e,t,a,l){const u=t[1],f=function CI(r,e,t){const a=Ki();r.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),AI(r,a,e,Ru(r,e,1,null),t));const l=Mc(e,r,a.directiveStart,a);Dr(l,e);const u=wt(a,e);return u&&Dr(u,e),l}(u,t,e);if(a.components.push(f),r[8]=f,l&&l.forEach(y=>y(f,e)),e.contentQueries){const y=Ki();e.contentQueries(1,f,y.directiveStart)}const g=Ki();return!u.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(Wa(g.index),bI(t[1],g,0,g.directiveStart,g.directiveEnd,e),wS(e,f)),f}(Ce,this.componentDef,q,j,[OM]),Fp(G,q,null)}finally{dp()}return new lA(this.componentType,se,vi(ue,q),q,ue)}}class lA extends class k1{}{constructor(e,t,a,l,u){super(),this.location=a,this._rootLView=l,this._tNode=u,this.instance=t,this.hostView=this.changeDetectorRef=new oA(l),this.componentType=e}get injector(){return new ru(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class va{}class DC{}const dd=new Map;class uA extends va{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Xg(this);const a=Jo(e);this._bootstrapComponents=sa(a.bootstrap),this._r3Injector=BI(e,t,[{provide:va,useValue:this},{provide:nc,useValue:this.componentFactoryResolver}],pn(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=ir.THROW_IF_NOT_FOUND,a=et.Default){return e===ir||e===va||e===cg?this:this._r3Injector.get(e,t,a)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class kC extends DC{constructor(e){super(),this.moduleType=e,null!==Jo(e)&&function NC(r){const e=new Set;!function t(a){const l=Jo(a,!0),u=l.id;null!==u&&(function OC(r,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${r} - ${pn(e)} vs ${pn(e.name)}`)}(u,dd.get(u),a),dd.set(u,a));const f=sa(l.imports);for(const g of f)e.has(g)||(e.add(g),t(g))}(r)}(e)}create(e){return new uA(this.moduleType,e)}}function fA(r,e,t,a,l,u,f){return function gf(r,e,t,a,l,u,f,g,y){const R=e+t;return function Mo(r,e,t,a,l,u){const f=Gc(r,e,t,a);return Gc(r,e+2,l,u)||f}(r,R,l,u,f,g)?Ms(r,R+4,y?a.call(y,l,u,f,g):a(l,u,f,g)):_f(r,R+4)}(_e(),Gr(),r,e,t,a,l,u,f)}function _f(r,e){const t=r[e];return t===Et?void 0:t}function gA(r,e,t,a,l,u){const f=e+t;return vr(r,f,l)?Ms(r,f+1,u?a.call(u,l):a(l)):_f(r,f+1)}function Xu(r,e){const t=$t();let a;const l=r+20;t.firstCreatePass?(a=function FC(r,e){if(e)for(let t=e.length-1;t>=0;t--){const a=e[t];if(r===a.name)return a}}(e,t.pipeRegistry),t.data[l]=a,a.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(l,a.onDestroy)):a=t.data[l];const u=a.factory||(a.factory=Ll(a.type)),f=Fa(oe);try{const g=_p(!1),y=u();return _p(g),function $S(r,e,t,a){t>=r.data.length&&(r.data[t]=null,r.blueprint[t]=null),e[t]=a}(t,_e(),l,y),y}finally{Fa(f)}}function Ef(r,e,t){const a=r+20,l=_e(),u=Zd(l,a);return function vf(r,e){return r[1].data[e].pure}(l,a)?gA(l,Gr(),e,u.transform,t,u):u.transform(t)}function VC(r){return e=>{setTimeout(r,void 0,e)}}const Qt=class K1 extends hn{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,a){var l,u,f;let g=e,y=t||(()=>null),R=a;if(e&&"object"==typeof e){const x=e;g=null===(l=x.next)||void 0===l?void 0:l.bind(x),y=null===(u=x.error)||void 0===u?void 0:u.bind(x),R=null===(f=x.complete)||void 0===f?void 0:f.bind(x)}this.__isAsync&&(y=VC(y),g&&(g=VC(g)),R&&(R=VC(R)));const D=super.subscribe({next:g,error:y,complete:R});return e instanceof En&&e.add(D),D}};function yA(){return this._results[$l()]()}class Qg{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=$l(),a=Qg.prototype;a[t]||(a[t]=yA)}get changes(){return this._changes||(this._changes=new Qt)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const a=this;a.dirty=!1;const l=so(e);(this._changesDetected=!function lR(r,e,t){if(r.length!==e.length)return!1;for(let a=0;a<r.length;a++){let l=r[a],u=e[a];if(t&&(l=t(l),u=t(u)),u!==l)return!1}return!0}(a._results,l,t))&&(a._results=l,a.length=l.length,a.last=l[this.length-1],a.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Ri=(()=>{class r{}return r.__NG_ELEMENT_ID__=q1,r})();const SA=Ri,CA=class extends SA{constructor(e,t,a){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=a}createEmbeddedView(e){const t=this._declarationTContainer.tViews,a=xp(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const u=this._declarationLView[19];return null!==u&&(a[19]=u.createEmbeddedView(t)),Fp(t,a,e),new $u(a)}};function q1(){return Us(Ki(),_e())}function Us(r,e){return 4&r.type?new CA(e,r,vi(r,e)):null}let uo=(()=>{class r{}return r.__NG_ELEMENT_ID__=bA,r})();function bA(){return HC(Ki(),_e())}const TA=uo,BC=class extends TA{constructor(e,t,a){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=a}get element(){return vi(this._hostTNode,this._hostLView)}get injector(){return new ru(this._hostTNode,this._hostLView)}get parentInjector(){const e=y_(this._hostTNode,this._hostLView);if(Q0(e)){const t=xl(e,this._hostLView),a=nu(e);return new ru(t[1].data[a+8],t)}return new ru(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=jC(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,a){const l=e.createEmbeddedView(t||{});return this.insert(l,a),l}createComponent(e,t,a,l,u){const f=e&&!function Ul(r){return"function"==typeof r}(e);let g;if(f)g=t;else{const x=t||{};g=x.index,a=x.injector,l=x.projectableNodes,u=x.ngModuleRef}const y=f?e:new AC(Zi(e)),R=a||this.parentInjector;if(!u&&null==y.ngModule){const j=(f?R:this.parentInjector).get(va,null);j&&(u=j)}const D=y.create(R,l,void 0,u);return this.insert(D.hostView,g),D}insert(e,t){const a=e._lView,l=a[1];if(function rP(r){return wo(r[3])}(a)){const D=this.indexOf(e);if(-1!==D)this.detach(D);else{const x=a[3],j=new BC(x,x[6],x[3]);j.detach(j.indexOf(e))}}const u=this._adjustIndex(t),f=this._lContainer;!function ao(r,e,t,a){const l=10+a,u=t.length;a>0&&(t[l-1][4]=e),a<u-10?(e[4]=t[l],Ly(t,10+a,e)):(t.push(e),e[4]=null),e[3]=t;const f=e[17];null!==f&&t!==f&&function U_(r,e){const t=r[9];e[16]!==e[3][3][16]&&(r[2]=!0),null===t?r[9]=[e]:t.push(e)}(f,e);const g=e[19];null!==g&&g.insertView(r),e[2]|=128}(l,a,f,u);const g=G_(u,f),y=a[11],R=Rp(y,f[7]);return null!==R&&function JP(r,e,t,a,l,u){a[0]=l,a[6]=e,Eu(r,a,t,1,l,u)}(l,f[6],y,a,R,g),e.attachToViewContainerRef(),Ly(Zg(f),u,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=jC(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),a=Yy(this._lContainer,t);a&&(Vl(Zg(this._lContainer),t),$y(a[1],a))}detach(e){const t=this._adjustIndex(e,-1),a=Yy(this._lContainer,t);return a&&null!=Vl(Zg(this._lContainer),t)?new $u(a):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function jC(r){return r[8]}function Zg(r){return r[8]||(r[8]=[])}function HC(r,e){let t;const a=e[r.index];if(wo(a))t=a;else{let l;if(8&r.type)l=ki(a);else{const u=e[11];l=u.createComment("");const f=wt(r,e);Bc(u,Rp(u,f),l,function Ka(r,e){return gi(r)?r.nextSibling(e):e.nextSibling}(u,f),!1)}e[r.index]=t=wu(a,e,l,r),Vp(e,t)}return new BC(t,r,e)}class GC{constructor(e){this.queryList=e,this.matches=null}clone(){return new GC(this.queryList)}setDirty(){this.queryList.setDirty()}}class eE{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const a=null!==e.contentQueries?e.contentQueries[0]:t.length,l=[];for(let u=0;u<a;u++){const f=t.getByIndex(u);l.push(this.queries[f.indexInDeclarationView].clone())}return new eE(l)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==tE(e,t).matches&&this.queries[t].setDirty()}}class WC{constructor(e,t,a=null){this.predicate=e,this.flags=t,this.read=a}}class Ju{constructor(e=[]){this.queries=e}elementStart(e,t){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let a=0;a<this.length;a++){const l=null!==t?t.length:0,u=this.getByIndex(a).embeddedTView(e,l);u&&(u.indexInDeclarationView=a,null!==t?t.push(u):t=[u])}return null!==t?new Ju(t):null}template(e,t){for(let a=0;a<this.queries.length;a++)this.queries[a].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class zC{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new zC(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let a=e.parent;for(;null!==a&&8&a.type&&a.index!==t;)a=a.parent;return t===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const a=this.metadata.predicate;if(Array.isArray(a))for(let l=0;l<a.length;l++){const u=a[l];this.matchTNodeWithReadOption(e,t,IA(t,u)),this.matchTNodeWithReadOption(e,t,iu(t,e,u,!1,!1))}else a===Ri?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,iu(t,e,a,!1,!1))}matchTNodeWithReadOption(e,t,a){if(null!==a){const l=this.metadata.read;if(null!==l)if(l===Rn||l===uo||l===Ri&&4&t.type)this.addMatch(t.index,-2);else{const u=iu(t,e,l,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,a)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function IA(r,e){const t=r.localNames;if(null!==t)for(let a=0;a<t.length;a+=2)if(t[a]===e)return t[a+1];return null}function Zu(r,e,t,a){return-1===t?function Qu(r,e){return 11&r.type?vi(r,e):4&r.type?Us(r,e):null}(e,r):-2===t?function wA(r,e,t){return t===Rn?vi(e,r):t===Ri?Us(e,r):t===uo?HC(e,r):void 0}(r,e,a):Mc(r,r[1],t,e)}function AA(r,e,t,a){const l=e[19].queries[a];if(null===l.matches){const u=r.data,f=t.matches,g=[];for(let y=0;y<f.length;y+=2){const R=f[y];g.push(R<0?null:Zu(e,u[R],f[y+1],t.metadata.read))}l.matches=g}return l.matches}function eh(r,e,t,a){const l=r.queries.getByIndex(t),u=l.matches;if(null!==u){const f=AA(r,e,l,t);for(let g=0;g<u.length;g+=2){const y=u[g];if(y>0)a.push(f[g/2]);else{const R=u[g+1],D=e[-y];for(let x=10;x<D.length;x++){const j=D[x];j[17]===j[3]&&eh(j[1],j,R,a)}if(null!==D[9]){const x=D[9];for(let j=0;j<x.length;j++){const G=x[j];eh(G[1],G,R,a)}}}}}return a}function Fi(r){const e=_e(),t=$t(),a=z0();Ty(a+1);const l=tE(t,a);if(r.dirty&&B0(e)===(2==(2&l.metadata.flags))){if(null===l.matches)r.reset([]);else{const u=l.crossesNgTemplate?eh(t,e,a,[]):AA(t,e,l,a);r.reset(u,nA),r.notifyOnChanges()}return!0}return!1}function yi(r,e,t){const a=$t();a.firstCreatePass&&(Sf(a,new WC(r,e,t),-1),2==(2&e)&&(a.staticViewQueries=!0)),yf(a,_e(),e)}function Hn(r,e,t,a){const l=$t();if(l.firstCreatePass){const u=Ki();Sf(l,new WC(e,t,a),u.index),function KC(r,e){const t=r.contentQueries||(r.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(r.queries.length-1,e)}(l,r),2==(2&t)&&(l.staticContentQueries=!0)}yf(l,_e(),t)}function Ii(){return function DA(r,e){return r[19].queries[e].queryList}(_e(),z0())}function yf(r,e,t){const a=new Qg(4==(4&t));RS(r,e,a,a.destroy),null===e[19]&&(e[19]=new eE),e[19].queries.push(new GC(a))}function Sf(r,e,t){null===r.queries&&(r.queries=new Ju),r.queries.track(new zC(e,t))}function tE(r,e){return r.queries.getByIndex(e)}function OA(r,e){return Us(r,e)}function we(...r){}const ya=new Le("Application Initializer");let ZC=(()=>{class r{constructor(t){this.appInits=t,this.resolve=we,this.reject=we,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,l)=>{this.resolve=a,this.reject=l})}runInitializers(){if(this.initialized)return;const t=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let l=0;l<this.appInits.length;l++){const u=this.appInits[l]();if(Yp(u))t.push(u);else if(aC(u)){const f=new Promise((g,y)=>{u.subscribe({complete:g,error:y})});t.push(f)}}Promise.all(t).then(()=>{a()}).catch(l=>{this.reject(l)}),0===t.length&&a(),this.initialized=!0}}return r.\u0275fac=function(t){return new(t||r)(he(ya,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const If=new Le("AppId",{providedIn:"root",factory:function xA(){return`${eb()}${eb()}${eb()}`}});function eb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const sE=new Le("Platform Initializer"),tb=new Le("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Vs=new Le("appBootstrapListener");let N=(()=>{class r{log(t){console.log(t)}warn(t){console.warn(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const Bs=new Le("LocaleId",{providedIn:"root",factory:()=>Uy(Bs,et.Optional|et.SkipSelf)||function W(){return"undefined"!=typeof $localize&&$localize.locale||nf}()});class eL{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let VA=(()=>{class r{compileModuleSync(t){return new kC(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const a=this.compileModuleSync(t),u=sa(Jo(t).declarations).reduce((f,g)=>{const y=Zi(g);return y&&f.push(new AC(y)),f},[]);return new eL(a,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const In=(()=>Promise.resolve(0))();function aE(r){"undefined"==typeof Zone?In.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class yt{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Qt(!1),this.onMicrotaskEmpty=new Qt(!1),this.onStable=new Qt(!1),this.onError=new Qt(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!a&&t,l.shouldCoalesceRunChangeDetection=a,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function Ui(){let r=Pn.requestAnimationFrame,e=Pn.cancelAnimationFrame;if("undefined"!=typeof Zone&&r&&e){const t=r[Zone.__symbol__("OriginalDelegate")];t&&(r=t);const a=e[Zone.__symbol__("OriginalDelegate")];a&&(e=a)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function ln(r){const e=()=>{!function bt(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(Pn,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,oc(r),r.isCheckStableRunning=!0,Sa(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),oc(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,a,l,u,f,g)=>{try{return Fn(r),t.invokeTask(l,u,f,g)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||r.shouldCoalesceRunChangeDetection)&&e(),Af(r)}},onInvoke:(t,a,l,u,f,g,y)=>{try{return Fn(r),t.invoke(l,u,f,g,y)}finally{r.shouldCoalesceRunChangeDetection&&e(),Af(r)}},onHasTask:(t,a,l,u)=>{t.hasTask(l,u),a===l&&("microTask"==u.change?(r._hasPendingMicrotasks=u.microTask,oc(r),Sa(r)):"macroTask"==u.change&&(r.hasPendingMacrotasks=u.macroTask))},onHandleError:(t,a,l,u)=>(t.handleError(l,u),r.runOutsideAngular(()=>r.onError.emit(u)),!1)})}(l)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!yt.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(yt.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,a){return this._inner.run(e,t,a)}runTask(e,t,a,l){const u=this._inner,f=u.scheduleEventTask("NgZoneEvent: "+l,e,cr,we,we);try{return u.runTask(f,t,a)}finally{u.cancelTask(f)}}runGuarded(e,t,a){return this._inner.runGuarded(e,t,a)}runOutsideAngular(e){return this._outer.run(e)}}const cr={};function Sa(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function oc(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function Fn(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function Af(r){r._nesting--,Sa(r)}class it{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Qt,this.onMicrotaskEmpty=new Qt,this.onStable=new Qt,this.onError=new Qt}run(e,t,a){return e.apply(t,a)}runGuarded(e,t,a){return e.apply(t,a)}runOutsideAngular(e){return e()}runTask(e,t,a,l){return e.apply(t,a)}}let cE=(()=>{class r{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{yt.assertNotInAngularZone(),aE(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())aE(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(t)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,a,l){let u=-1;a&&a>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(f=>f.timeoutId!==u),t(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:t,timeoutId:u,updateCb:l})}whenStable(t,a,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,a,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,a,l){return[]}}return r.\u0275fac=function(t){return new(t||r)(he(yt))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})(),BA=(()=>{class r{constructor(){this._applications=new Map,ud.addToWindow(this)}registerApplication(t,a){this._applications.set(t,a)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,a=!0){return ud.findTestabilityInTree(this,t,a)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();class fi{addToWindow(e){}findTestabilityInTree(e,t,a){return null}}let ud=new fi,el=null;const fe=new Le("AllowMultipleToken"),Si=new Le("PlatformOnDestroy");class Te{constructor(e,t){this.name=e,this.token=t}}function $r(r,e,t=[]){const a=`Platform: ${e}`,l=new Le(a);return(u=[])=>{let f=dn();if(!f||f.injector.get(fe,!1)){const g=[...t,...u,{provide:l,useValue:!0}];r?r(g):function jA(r){if(el&&!el.get(fe,!1))throw new Pe(400,"");el=r;const e=r.get(os),t=r.get(sE,null);t&&t.forEach(a=>a())}(function Wn(r=[],e){return ir.create({name:e,providers:[{provide:MS,useValue:"platform"},{provide:Si,useValue:()=>el=null},...r]})}(g,a))}return function po(r){const e=dn();if(!e)throw new Pe(401,"");return e}()}}function dn(){var r;return null!==(r=null==el?void 0:el.get(os))&&void 0!==r?r:null}let os=(()=>{class r{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,a){const g=function HA(r,e){let t;return t="noop"===r?new it:("zone.js"===r?void 0:r)||new yt({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),y=[{provide:yt,useValue:g}];return g.run(()=>{const R=ir.create({providers:y,parent:this.injector,name:t.moduleType.name}),D=t.create(R),x=D.injector.get(Op,null);if(!x)throw new Pe(402,"");return g.runOutsideAngular(()=>{const j=g.onError.subscribe({next:G=>{x.handleError(G)}});D.onDestroy(()=>{Pt(this._modules,D),j.unsubscribe()})}),function Xr(r,e,t){try{const a=t();return Yp(a)?a.catch(l=>{throw e.runOutsideAngular(()=>r.handleError(l)),l}):a}catch(a){throw e.runOutsideAngular(()=>r.handleError(a)),a}}(x,g,()=>{const j=D.injector.get(ZC);return j.runInitializers(),j.donePromise.then(()=>(function Jn(r){Br(r,"Expected localeId to be defined"),"string"==typeof r&&(Jc=r.toLowerCase().replace(/_/g,"-"))}(D.injector.get(Bs,nf)||nf),this._moduleDoBootstrap(D),D))})})}bootstrapModule(t,a=[]){const l=fo({},a);return function js(r,e,t){const a=new kC(t);return Promise.resolve(a)}(0,0,t).then(u=>this.bootstrapModuleFactory(u,l))}_moduleDoBootstrap(t){const a=t.injector.get(ss);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(l=>a.bootstrap(l));else{if(!t.instance.ngDoBootstrap)throw new Pe(403,"");t.instance.ngDoBootstrap(a)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Pe(404,"");this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a());const t=this._injector.get(Si,null);null==t||t(),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(t){return new(t||r)(he(ir))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();function fo(r,e){return Array.isArray(e)?e.reduce(fo,r):Object.assign(Object.assign({},r),e)}let ss=(()=>{class r{constructor(t,a,l,u){this._zone=t,this._injector=a,this._exceptionHandler=l,this._initStatus=u,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const f=new Cn(y=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{y.next(this._stable),y.complete()})}),g=new Cn(y=>{let R;this._zone.runOutsideAngular(()=>{R=this._zone.onStable.subscribe(()=>{yt.assertNotInAngularZone(),aE(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,y.next(!0))})})});const D=this._zone.onUnstable.subscribe(()=>{yt.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{y.next(!1)}))});return()=>{R.unsubscribe(),D.unsubscribe()}});this.isStable=$v(f,g.pipe(function O0(){return r=>Zn()(function Ym(r,e){return function(a){let l;if(l="function"==typeof r?r:function(){return r},"function"==typeof e)return a.lift(new Qi(l,e));const u=Object.create(a,Jv);return u.source=a,u.subjectFactory=l,u}}(MN)(r))}()))}bootstrap(t,a){if(!this._initStatus.done)throw new Pe(405,"");let l;l=t instanceof tA?t:this._injector.get(nc).resolveComponentFactory(t),this.componentTypes.push(l.componentType);const u=function rt(r){return r.isBoundToModule}(l)?void 0:this._injector.get(va),g=l.create(ir.NULL,[],a||l.selector,u),y=g.location.nativeElement,R=g.injector.get(cE,null),D=R&&g.injector.get(BA);return R&&D&&D.registerApplication(y,R),g.onDestroy(()=>{this.detachView(g.hostView),Pt(this.components,g),D&&D.unregisterApplication(y)}),this._loadComponent(g),g}tick(){if(this._runningTick)throw new Pe(101,"");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const a=t;this._views.push(a),a.attachToAppRef(this)}detachView(t){const a=t;Pt(this._views,a),a.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(Vs,[]).concat(this._bootstrapListeners).forEach(l=>l(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return r.\u0275fac=function(t){return new(t||r)(he(yt),he(ir),he(Op),he(ZC))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function Pt(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}let ib=!0,Fo=(()=>{class r{}return r.__NG_ELEMENT_ID__=WA,r})();function WA(r){return function zA(r,e,t){if(rp(r)&&!t){const a=Hr(r.index,e);return new $u(a,a)}return 47&r.type?new $u(e[16],e):null}(Ki(),_e(),16==(16&r))}class db{constructor(){}supports(e){return Pu(e)}create(e){return new ri(e)}}const nL=(r,e)=>e;class ri{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||nL}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,a=this._removalsHead,l=0,u=null;for(;t||a;){const f=!a||t&&t.currentIndex<$A(a,l,u)?t:a,g=$A(f,l,u),y=f.currentIndex;if(f===a)l--,a=a._nextRemoved;else if(t=t._next,null==f.previousIndex)l++;else{u||(u=[]);const R=g-l,D=y-l;if(R!=D){for(let j=0;j<R;j++){const G=j<u.length?u[j]:u[j]=0,q=G+j;D<=q&&q<R&&(u[j]=G+1)}u[f.previousIndex]=D-R}}g!==y&&e(f,g,y)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Pu(e))throw new Pe(900,"");return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let l,u,f,t=this._itHead,a=!1;if(Array.isArray(e)){this.length=e.length;for(let g=0;g<this.length;g++)u=e[g],f=this._trackByFn(g,u),null!==t&&Object.is(t.trackById,f)?(a&&(t=this._verifyReinsertion(t,u,f,g)),Object.is(t.item,u)||this._addIdentityChange(t,u)):(t=this._mismatch(t,u,f,g),a=!0),t=t._next}else l=0,function UM(r,e){if(Array.isArray(r))for(let t=0;t<r.length;t++)e(r[t]);else{const t=r[$l()]();let a;for(;!(a=t.next()).done;)e(a.value)}}(e,g=>{f=this._trackByFn(l,g),null!==t&&Object.is(t.trackById,f)?(a&&(t=this._verifyReinsertion(t,g,f,l)),Object.is(t.item,g)||this._addIdentityChange(t,g)):(t=this._mismatch(t,g,f,l),a=!0),t=t._next,l++}),this.length=l;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,a,l){let u;return null===e?u=this._itTail:(u=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,u,l)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(a,l))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,u,l)):e=this._addAfter(new oi(t,a),u,l),e}_verifyReinsertion(e,t,a,l){let u=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==u?e=this._reinsertAfter(u,e._prev,l):e.currentIndex!=l&&(e.currentIndex=l,this._addToMoves(e,l)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const l=e._prevRemoved,u=e._nextRemoved;return null===l?this._removalsHead=u:l._nextRemoved=u,null===u?this._removalsTail=l:u._prevRemoved=l,this._insertAfter(e,t,a),this._addToMoves(e,a),e}_moveAfter(e,t,a){return this._unlink(e),this._insertAfter(e,t,a),this._addToMoves(e,a),e}_addAfter(e,t,a){return this._insertAfter(e,t,a),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,a){const l=null===t?this._itHead:t._next;return e._next=l,e._prev=t,null===l?this._itTail=e:l._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new YA),this._linkedRecords.put(e),e.currentIndex=a,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,a=e._next;return null===t?this._itHead=a:t._next=a,null===a?this._itTail=t:a._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new YA),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class oi{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class iL{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===t||t<=a.currentIndex)&&Object.is(a.trackById,e))return a;return null}remove(e){const t=e._prevDup,a=e._nextDup;return null===t?this._head=a:t._nextDup=a,null===a?this._tail=t:a._prevDup=t,null===this._head}}class YA{constructor(){this.map=new Map}put(e){const t=e.trackById;let a=this.map.get(t);a||(a=new iL,this.map.set(t,a)),a.add(e)}get(e,t){const l=this.map.get(e);return l?l.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function $A(r,e,t){const a=r.previousIndex;if(null===a)return a;let l=0;return t&&a<t.length&&(l=t[a]),a+e+l}class pE{constructor(){}supports(e){return e instanceof Map||GS(e)}create(){return new ub}}class ub{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||GS(e)))throw new Pe(900,"")}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(a,l)=>{if(t&&t.key===l)this._maybeAddToChanges(t,a),this._appendAfter=t,t=t._next;else{const u=this._getOrCreateRecordForKey(l,a);t=this._insertBeforeOrAppend(t,u)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let a=t;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const a=e._prev;return t._next=e,t._prev=a,e._prev=t,a&&(a._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const l=this._records.get(e);this._maybeAddToChanges(l,t);const u=l._prev,f=l._next;return u&&(u._next=f),f&&(f._prev=u),l._next=null,l._prev=null,l}const a=new ah(e);return this._records.set(e,a),a.currentValue=t,this._addToAdditions(a),a}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(a=>t(e[a],a))}}class ah{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function tt(){return new Jr([new db])}let Jr=(()=>{class r{constructor(t){this.factories=t}static create(t,a){if(null!=a){const l=a.factories.slice();t=t.concat(l)}return new r(t)}static extend(t){return{provide:r,useFactory:a=>r.create(t,a||tt()),deps:[[r,new du,new Fc]]}}find(t){const a=this.factories.find(l=>l.supports(t));if(null!=a)return a;throw new Pe(901,"")}}return r.\u0275prov=Ue({token:r,providedIn:"root",factory:tt}),r})();function JA(){return new Pf([new pE])}let Pf=(()=>{class r{constructor(t){this.factories=t}static create(t,a){if(a){const l=a.factories.slice();t=t.concat(l)}return new r(t)}static extend(t){return{provide:r,useFactory:a=>r.create(t,a||JA()),deps:[[r,new du,new Fc]]}}find(t){const a=this.factories.find(u=>u.supports(t));if(a)return a;throw new Pe(901,"")}}return r.\u0275prov=Ue({token:r,providedIn:"root",factory:JA}),r})();const oL=$r(null,"core",[]);let fE=(()=>{class r{constructor(t){}}return r.\u0275fac=function(t){return new(t||r)(he(ss))},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})(),$i=null;function Uo(){return $i}const _n=new Le("DocumentToken");let nl=(()=>{class r{historyGo(t){throw new Error("Not implemented")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:function(){return function Vi(){return he(il)}()},providedIn:"platform"}),r})();const Nr=new Le("Location Initialized");let il=(()=>{class r extends nl{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Uo().getBaseHref(this._doc)}onPopState(t){const a=Uo().getGlobalEventTarget(this._doc,"window");return a.addEventListener("popstate",t,!1),()=>a.removeEventListener("popstate",t)}onHashChange(t){const a=Uo().getGlobalEventTarget(this._doc,"window");return a.addEventListener("hashchange",t,!1),()=>a.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,a,l){Ca()?this._history.pushState(t,a,l):this.location.hash=l}replaceState(t,a,l){Ca()?this._history.replaceState(t,a,l):this.location.hash=l}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return r.\u0275fac=function(t){return new(t||r)(he(_n))},r.\u0275prov=Ue({token:r,factory:function(){return function Bi(){return new il(he(_n))}()},providedIn:"platform"}),r})();function Ca(){return!!window.history.pushState}function Lf(r,e){if(0==r.length)return e;if(0==e.length)return r;let t=0;return r.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?r+e.substring(1):1==t?r+e:r+"/"+e}function fd(r){const e=r.match(/#|\?|$/),t=e&&e.index||r.length;return r.slice(0,t-("/"===r[t-1]?1:0))+r.slice(t)}function ba(r){return r&&"?"!==r[0]?"?"+r:r}let zn=(()=>{class r{historyGo(t){throw new Error("Not implemented")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:function(){return function nD(r){const e=he(_n).location;return new Qr(he(nl),e&&e.origin||"")}()},providedIn:"root"}),r})();const _E=new Le("appBaseHref");let Qr=(()=>{class r extends zn{constructor(t,a){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==a&&(a=this._platformLocation.getBaseHrefFromDOM()),null==a)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=a}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Lf(this._baseHref,t)}path(t=!1){const a=this._platformLocation.pathname+ba(this._platformLocation.search),l=this._platformLocation.hash;return l&&t?`${a}${l}`:a}pushState(t,a,l,u){const f=this.prepareExternalUrl(l+ba(u));this._platformLocation.pushState(t,a,f)}replaceState(t,a,l,u){const f=this.prepareExternalUrl(l+ba(u));this._platformLocation.replaceState(t,a,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var a,l;null===(l=(a=this._platformLocation).historyGo)||void 0===l||l.call(a,t)}}return r.\u0275fac=function(t){return new(t||r)(he(nl),he(_E,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})(),Tt=(()=>{class r extends zn{constructor(t,a){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=a&&(this._baseHref=a)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let a=this._platformLocation.hash;return null==a&&(a="#"),a.length>0?a.substring(1):a}prepareExternalUrl(t){const a=Lf(this._baseHref,t);return a.length>0?"#"+a:a}pushState(t,a,l,u){let f=this.prepareExternalUrl(l+ba(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.pushState(t,a,f)}replaceState(t,a,l,u){let f=this.prepareExternalUrl(l+ba(u));0==f.length&&(f=this._platformLocation.pathname),this._platformLocation.replaceState(t,a,f)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var a,l;null===(l=(a=this._platformLocation).historyGo)||void 0===l||l.call(a,t)}}return r.\u0275fac=function(t){return new(t||r)(he(nl),he(_E,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})(),gE=(()=>{class r{constructor(t,a){this._subject=new Qt,this._urlChangeListeners=[],this._platformStrategy=t;const l=this._platformStrategy.getBaseHref();this._platformLocation=a,this._baseHref=fd(rl(l)),this._platformStrategy.onPopState(u=>{this._subject.emit({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,a=""){return this.path()==this.normalize(t+ba(a))}normalize(t){return r.stripTrailingSlash(function iD(r,e){return r&&e.startsWith(r)?e.substring(r.length):e}(this._baseHref,rl(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,a="",l=null){this._platformStrategy.pushState(l,"",t,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ba(a)),l)}replaceState(t,a="",l=null){this._platformStrategy.replaceState(l,"",t,a),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+ba(a)),l)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var a,l;null===(l=(a=this._platformStrategy).historyGo)||void 0===l||l.call(a,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(a=>{this._notifyUrlChangeListeners(a.url,a.state)}))}_notifyUrlChangeListeners(t="",a){this._urlChangeListeners.forEach(l=>l(t,a))}subscribe(t,a,l){return this._subject.subscribe({next:t,error:a,complete:l})}}return r.normalizeQueryParams=ba,r.joinWithSlash=Lf,r.stripTrailingSlash=fd,r.\u0275fac=function(t){return new(t||r)(he(zn),he(nl))},r.\u0275prov=Ue({token:r,factory:function(){return function lh(){return new gE(he(zn),he(nl))}()},providedIn:"root"}),r})();function rl(r){return r.replace(/\/index.html$/,"")}let Gs=(()=>{class r{constructor(t,a,l,u){this._iterableDiffers=t,this._keyValueDiffers=a,this._ngEl=l,this._renderer=u,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Pu(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(a=>this._toggleClass(a.key,a.currentValue)),t.forEachChangedItem(a=>this._toggleClass(a.key,a.currentValue)),t.forEachRemovedItem(a=>{a.previousValue&&this._toggleClass(a.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(a=>{if("string"!=typeof a.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${pn(a.item)}`);this._toggleClass(a.item,!0)}),t.forEachRemovedItem(a=>this._toggleClass(a.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(a=>this._toggleClass(a,!0)):Object.keys(t).forEach(a=>this._toggleClass(a,!!t[a])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(a=>this._toggleClass(a,!1)):Object.keys(t).forEach(a=>this._toggleClass(a,!1)))}_toggleClass(t,a){(t=t.trim())&&t.split(/\s+/g).forEach(l=>{a?this._renderer.addClass(this._ngEl.nativeElement,l):this._renderer.removeClass(this._ngEl.nativeElement,l)})}}return r.\u0275fac=function(t){return new(t||r)(oe(Jr),oe(Pf),oe(Rn),oe(Lo))},r.\u0275dir=je({type:r,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),r})();class Gf{constructor(e,t,a,l){this.$implicit=e,this.ngForOf=t,this.index=a,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let fh=(()=>{class r{constructor(t,a,l){this._viewContainer=t,this._template=a,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const a=this._viewContainer;t.forEachOperation((l,u,f)=>{if(null==l.previousIndex)a.createEmbeddedView(this._template,new Gf(l.item,this._ngForOf,-1,-1),null===f?void 0:f);else if(null==f)a.remove(null===u?void 0:u);else if(null!==u){const g=a.get(u);a.move(g,f),wE(g,l)}});for(let l=0,u=a.length;l<u;l++){const g=a.get(l).context;g.index=l,g.count=u,g.ngForOf=this._ngForOf}t.forEachIdentityChange(l=>{wE(a.get(l.currentIndex),l)})}static ngTemplateContextGuard(t,a){return!0}}return r.\u0275fac=function(t){return new(t||r)(oe(uo),oe(Ri),oe(Jr))},r.\u0275dir=je({type:r,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),r})();function wE(r,e){r.context.$implicit=e.item}let al=(()=>{class r{constructor(t,a){this._viewContainer=t,this._context=new yD,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){Db("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){Db("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,a){return!0}}return r.\u0275fac=function(t){return new(t||r)(oe(uo),oe(Ri))},r.\u0275dir=je({type:r,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),r})();class yD{constructor(){this.$implicit=null,this.ngIf=null}}function Db(r,e){if(e&&!e.createEmbeddedView)throw new Error(`${r} must be a TemplateRef, but received '${pn(e)}'.`)}const Ob="browser";class xb{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}let ul=(()=>{class r{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const a=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||a,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),a}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let a=0;a<this._defaultViews.length;a++)this._defaultViews[a].enforceState(t)}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=je({type:r,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),r})(),MD=(()=>{class r{constructor(t,a,l){this.ngSwitch=l,l._addCase(),this._view=new xb(t,a)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return r.\u0275fac=function(t){return new(t||r)(oe(uo),oe(Ri),oe(ul,9))},r.\u0275dir=je({type:r,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),r})();class ML{createSubscription(e,t){return e.subscribe({next:t,error:a=>{throw a}})}dispose(e){e.unsubscribe()}onDestroy(e){e.unsubscribe()}}class LL{createSubscription(e,t){return e.then(t,a=>{throw a})}dispose(e){}onDestroy(e){}}const kE=new LL,xL=new ML;let ME=(()=>{class r{constructor(t){this._ref=t,this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,a=>this._updateLatestValue(t,a))}_selectStrategy(t){if(Yp(t))return kE;if(iw(t))return xL;throw function zs(r,e){return new Pe(2100,"")}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,a){t===this._obj&&(this._latestValue=a,this._ref.markForCheck())}}return r.\u0275fac=function(t){return new(t||r)(oe(Fo,16))},r.\u0275pipe=Ir({name:"async",type:r,pure:!1}),r})(),Qf=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})(),YL=(()=>{class r{}return r.\u0275prov=Ue({token:r,providedIn:"root",factory:()=>new UD(he(_n),window)}),r})();class UD{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function UE(r,e){const t=r.getElementById(e)||r.getElementsByName(e)[0];if(t)return t;if("function"==typeof r.createTreeWalker&&r.body&&(r.body.createShadowRoot||r.body.attachShadow)){const a=r.createTreeWalker(r.body,NodeFilter.SHOW_ELEMENT);let l=a.currentNode;for(;l;){const u=l.shadowRoot;if(u){const f=u.getElementById(e)||u.querySelector(`[name="${e}"]`);if(f)return f}l=a.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),a=t.left+this.window.pageXOffset,l=t.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(a-u[0],l-u[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=Zf(this.window.history)||Zf(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function Zf(r){return Object.getOwnPropertyDescriptor(r,"scrollRestoration")}class em extends class BE extends class tD{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function pb(r){$i||($i=r)}(new em)}onAndCancel(e,t,a){return e.addEventListener(t,a,!1),()=>{e.removeEventListener(t,a,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function BD(){return Vn=Vn||document.querySelector("base"),Vn?Vn.getAttribute("href"):null}();return null==t?null:function Cd(r){jE=jE||document.createElement("a"),jE.setAttribute("href",r);const e=jE.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Vn=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function vD(r,e){e=encodeURIComponent(e);for(const t of r.split(";")){const a=t.indexOf("="),[l,u]=-1==a?[t,""]:[t.slice(0,a),t.slice(a+1)];if(l.trim()===e)return decodeURIComponent(u)}return null}(document.cookie,e)}}let jE,Vn=null;const Bb=new Le("TRANSITION_ID"),HD=[{provide:ya,useFactory:function jD(r,e,t){return()=>{t.get(ZC).donePromise.then(()=>{const a=Uo(),l=e.querySelectorAll(`style[ng-transition="${r}"]`);for(let u=0;u<l.length;u++)a.remove(l[u])})}},deps:[Bb,_n,ir],multi:!0}];class HE{static init(){!function lE(r){ud=r}(new HE)}addToWindow(e){Pn.getAngularTestability=(a,l=!0)=>{const u=e.findTestabilityInTree(a,l);if(null==u)throw new Error("Could not find testability for element.");return u},Pn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Pn.getAllAngularRootElements=()=>e.getAllRootElements(),Pn.frameworkStabilizers||(Pn.frameworkStabilizers=[]),Pn.frameworkStabilizers.push(a=>{const l=Pn.getAllAngularTestabilities();let u=l.length,f=!1;const g=function(y){f=f||y,u--,0==u&&a(f)};l.forEach(function(y){y.whenStable(g)})})}findTestabilityInTree(e,t,a){if(null==t)return null;const l=e.getTestability(t);return null!=l?l:a?Uo().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let jb=(()=>{class r{build(){return new XMLHttpRequest}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();const Ch=new Le("EventManagerPlugins");let tm=(()=>{class r{constructor(t,a){this._zone=a,this._eventNameToPlugin=new Map,t.forEach(l=>l.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,a,l){return this._findPluginFor(a).addEventListener(t,a,l)}addGlobalEventListener(t,a,l){return this._findPluginFor(a).addGlobalEventListener(t,a,l)}getZone(){return this._zone}_findPluginFor(t){const a=this._eventNameToPlugin.get(t);if(a)return a;const l=this._plugins;for(let u=0;u<l.length;u++){const f=l[u];if(f.supports(t))return this._eventNameToPlugin.set(t,f),f}throw new Error(`No event manager plugin found for event ${t}`)}}return r.\u0275fac=function(t){return new(t||r)(he(Ch),he(yt))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();class GD{constructor(e){this._doc=e}addGlobalEventListener(e,t,a){const l=Uo().getGlobalEventTarget(this._doc,e);if(!l)throw new Error(`Unsupported event target ${l} for event ${t}`);return this.addEventListener(l,t,a)}}let Hb=(()=>{class r{constructor(){this._stylesSet=new Set}addStyles(t){const a=new Set;t.forEach(l=>{this._stylesSet.has(l)||(this._stylesSet.add(l),a.add(l))}),this.onStylesAdded(a)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})(),nm=(()=>{class r extends Hb{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,a,l){t.forEach(u=>{const f=this._doc.createElement("style");f.textContent=u,l.push(a.appendChild(f))})}addHost(t){const a=[];this._addStylesToHost(this._stylesSet,t,a),this._hostNodes.set(t,a)}removeHost(t){const a=this._hostNodes.get(t);a&&a.forEach(Ia),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((a,l)=>{this._addStylesToHost(t,l,a)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(Ia))}}return r.\u0275fac=function(t){return new(t||r)(he(_n))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();function Ia(r){Uo().remove(r)}const Gb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},GE=/%COMP%/g;function rm(r,e,t){for(let a=0;a<e.length;a++){let l=e[a];Array.isArray(l)?rm(r,l,t):(l=l.replace(GE,r),t.push(l))}return t}function KD(r){return e=>{if("__ngUnwrap__"===e)return r;!1===r(e)&&(e.preventDefault(),e.returnValue=!1)}}let bh=(()=>{class r{constructor(t,a,l){this.eventManager=t,this.sharedStylesHost=a,this.appId=l,this.rendererByCompId=new Map,this.defaultRenderer=new Kb(t)}createRenderer(t,a){if(!t||!a)return this.defaultRenderer;switch(a.encapsulation){case bs.Emulated:{let l=this.rendererByCompId.get(a.id);return l||(l=new kU(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,l)),l.applyToHost(t),l}case 1:case bs.ShadowDom:return new MU(this.eventManager,this.sharedStylesHost,t,a);default:if(!this.rendererByCompId.has(a.id)){const l=rm(a.id,a.styles,[]);this.sharedStylesHost.addStyles(l),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return r.\u0275fac=function(t){return new(t||r)(he(tm),he(nm),he(If))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();class Kb{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(Gb[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,a){e&&e.insertBefore(t,a)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let a="string"==typeof e?document.querySelector(e):e;if(!a)throw new Error(`The selector "${e}" did not match any elements`);return t||(a.textContent=""),a}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,a,l){if(l){t=l+":"+t;const u=Gb[l];u?e.setAttributeNS(u,t,a):e.setAttribute(t,a)}else e.setAttribute(t,a)}removeAttribute(e,t,a){if(a){const l=Gb[a];l?e.removeAttributeNS(l,t):e.removeAttribute(`${a}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,a,l){l&(Do.DashCase|Do.Important)?e.style.setProperty(t,a,l&Do.Important?"important":""):e.style[t]=a}removeStyle(e,t,a){a&Do.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,a){e[t]=a}setValue(e,t){e.nodeValue=t}listen(e,t,a){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,KD(a)):this.eventManager.addEventListener(e,t,KD(a))}}class kU extends Kb{constructor(e,t,a,l){super(e),this.component=a;const u=rm(l+"-"+a.id,a.styles,[]);t.addStyles(u),this.contentAttr=function zb(r){return"_ngcontent-%COMP%".replace(GE,r)}(l+"-"+a.id),this.hostAttr=function $L(r){return"_nghost-%COMP%".replace(GE,r)}(l+"-"+a.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const a=super.createElement(e,t);return super.setAttribute(a,this.contentAttr,""),a}}class MU extends Kb{constructor(e,t,a,l){super(e),this.sharedStylesHost=t,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const u=rm(l.id,l.styles,[]);for(let f=0;f<u.length;f++){const g=document.createElement("style");g.textContent=u[f],this.shadowRoot.appendChild(g)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,a){return super.insertBefore(this.nodeOrShadowRoot(e),t,a)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let LU=(()=>{class r extends GD{constructor(t){super(t)}supports(t){return!0}addEventListener(t,a,l){return t.addEventListener(a,l,!1),()=>this.removeEventListener(t,a,l)}removeEventListener(t,a,l){return t.removeEventListener(a,l)}}return r.\u0275fac=function(t){return new(t||r)(he(_n))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();const YD=["alt","control","meta","shift"],FU={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},zE={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},XL={alt:r=>r.altKey,control:r=>r.ctrlKey,meta:r=>r.metaKey,shift:r=>r.shiftKey};let JL=(()=>{class r extends GD{constructor(t){super(t)}supports(t){return null!=r.parseEventName(t)}addEventListener(t,a,l){const u=r.parseEventName(a),f=r.eventCallback(u.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Uo().onAndCancel(t,u.domEventName,f))}static parseEventName(t){const a=t.toLowerCase().split("."),l=a.shift();if(0===a.length||"keydown"!==l&&"keyup"!==l)return null;const u=r._normalizeKey(a.pop());let f="";if(YD.forEach(y=>{const R=a.indexOf(y);R>-1&&(a.splice(R,1),f+=y+".")}),f+=u,0!=a.length||0===u.length)return null;const g={};return g.domEventName=l,g.fullKey=f,g}static getEventFullKey(t){let a="",l=function QL(r){let e=r.key;if(null==e){if(e=r.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===r.location&&zE.hasOwnProperty(e)&&(e=zE[e]))}return FU[e]||e}(t);return l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),YD.forEach(u=>{u!=l&&XL[u](t)&&(a+=u+".")}),a+=l,a}static eventCallback(t,a,l){return u=>{r.getEventFullKey(u)===t&&l.runGuarded(()=>a(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return r.\u0275fac=function(t){return new(t||r)(he(_n))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();const JD=$r(oL,"browser",[{provide:tb,useValue:Ob},{provide:sE,useValue:function $D(){em.makeCurrent(),HE.init()},multi:!0},{provide:_n,useFactory:function XD(){return function tP(r){Xd=r}(document),document},deps:[]}]),Ai=[{provide:MS,useValue:"root"},{provide:Op,useFactory:function ZL(){return new Op},deps:[]},{provide:Ch,useClass:LU,multi:!0,deps:[_n,yt,tb]},{provide:Ch,useClass:JL,multi:!0,deps:[_n]},{provide:bh,useClass:bh,deps:[tm,nm,If]},{provide:pf,useExisting:bh},{provide:Hb,useExisting:nm},{provide:nm,useClass:nm,deps:[_n]},{provide:cE,useClass:cE,deps:[yt]},{provide:tm,useClass:tm,deps:[Ch,yt]},{provide:class Vb{},useClass:jb,deps:[]}];let qb=(()=>{class r{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:r,providers:[{provide:If,useValue:t.appId},{provide:Bb,useExisting:If},HD]}}}return r.\u0275fac=function(t){return new(t||r)(he(r,12))},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({providers:Ai,imports:[Qf,fE]}),r})();function qE(r,e){return new Cn(t=>{const a=r.length;if(0===a)return void t.complete();const l=new Array(a);let u=0,f=0;for(let g=0;g<a;g++){const y=mr(r[g]);let R=!1;t.add(y.subscribe({next:D=>{R||(R=!0,f++),l[g]=D},error:D=>t.error(D),complete:()=>{u++,(u===a||!R)&&(f===a&&t.next(e?e.reduce((D,x,j)=>(D[x]=l[j],D),{}):l),t.complete())}}))}})}"undefined"!=typeof window&&window;let iT=(()=>{class r{constructor(t,a){this._renderer=t,this._elementRef=a,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(t,a){this._renderer.setProperty(this._elementRef.nativeElement,t,a)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return r.\u0275fac=function(t){return new(t||r)(oe(Lo),oe(Rn))},r.\u0275dir=je({type:r}),r})(),gc=(()=>{class r extends iT{}return r.\u0275fac=function(){let e;return function(a){return(e||(e=function tr(r){return Ua(()=>{const e=r.prototype.constructor,t=e[Va]||S_(e),a=Object.prototype;let l=Object.getPrototypeOf(r.prototype).constructor;for(;l&&l!==a;){const u=l[Va]||S_(l);if(u&&u!==t)return u;l=Object.getPrototypeOf(l)}return u=>new u})}(r)))(a||r)}}(),r.\u0275dir=je({type:r,features:[Mt]}),r})();const hs=new Le("NgValueAccessor"),lx={provide:hs,useExisting:Nn(()=>am),multi:!0},tO=new Le("CompositionEventMode");let am=(()=>{class r extends iT{constructor(t,a,l){super(t,a),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function oT(){const r=Uo()?Uo().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}())}writeValue(t){this.setProperty("value",null==t?"":t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return r.\u0275fac=function(t){return new(t||r)(oe(Lo),oe(Rn),oe(tO,8))},r.\u0275dir=je({type:r,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,a){1&t&&zt("input",function(u){return a._handleInput(u.target.value)})("blur",function(){return a.onTouched()})("compositionstart",function(){return a._compositionStart()})("compositionend",function(u){return a._compositionEnd(u.target.value)})},features:[xn([lx]),Mt]}),r})();function Ec(r){return null==r||0===r.length}function sT(r){return null!=r&&"number"==typeof r.length}const br=new Le("NgValidators"),vc=new Le("NgAsyncValidators"),dx=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class bd{static min(e){return function Td(r){return e=>{if(Ec(e.value)||Ec(r))return null;const t=parseFloat(e.value);return!isNaN(t)&&t<r?{min:{min:r,actual:e.value}}:null}}(e)}static max(e){return function Ih(r){return e=>{if(Ec(e.value)||Ec(r))return null;const t=parseFloat(e.value);return!isNaN(t)&&t>r?{max:{max:r,actual:e.value}}:null}}(e)}static required(e){return function $E(r){return Ec(r.value)?{required:!0}:null}(e)}static requiredTrue(e){return function XE(r){return!0===r.value?null:{required:!0}}(e)}static email(e){return function aT(r){return Ec(r.value)||dx.test(r.value)?null:{email:!0}}(e)}static minLength(e){return function JE(r){return e=>Ec(e.value)||!sT(e.value)?null:e.value.length<r?{minlength:{requiredLength:r,actualLength:e.value.length}}:null}(e)}static maxLength(e){return function cT(r){return e=>sT(e.value)&&e.value.length>r?{maxlength:{requiredLength:r,actualLength:e.value.length}}:null}(e)}static pattern(e){return function QE(r){if(!r)return ZE;let e,t;return"string"==typeof r?(t="","^"!==r.charAt(0)&&(t+="^"),t+=r,"$"!==r.charAt(r.length-1)&&(t+="$"),e=new RegExp(t)):(t=r.toString(),e=r),a=>{if(Ec(a.value))return null;const l=a.value;return e.test(l)?null:{pattern:{requiredPattern:t,actualValue:l}}}}(e)}static nullValidator(e){return null}static compose(e){return nv(e)}static composeAsync(e){return iv(e)}}function ZE(r){return null}function ev(r){return null!=r}function lT(r){const e=Yp(r)?mr(r):r;return aC(e),e}function tv(r){let e={};return r.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function dT(r,e){return e.map(t=>t(r))}function nO(r){return r.map(e=>function uT(r){return!r.validate}(e)?e:t=>e.validate(t))}function nv(r){if(!r)return null;const e=r.filter(ev);return 0==e.length?null:function(t){return tv(dT(t,e))}}function hT(r){return null!=r?nv(nO(r)):null}function iv(r){if(!r)return null;const e=r.filter(ev);return 0==e.length?null:function(t){return function nT(...r){if(1===r.length){const e=r[0];if(pr(e))return qE(e,null);if(La(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return qE(t.map(a=>e[a]),t)}}if("function"==typeof r[r.length-1]){const e=r.pop();return qE(r=1===r.length&&pr(r[0])?r[0]:r,null).pipe(on(t=>e(...t)))}return qE(r,null)}(dT(t,e).map(lT)).pipe(on(tv))}}function rv(r){return null!=r?iv(nO(r)):null}function pT(r,e){return null===r?[e]:Array.isArray(r)?[...r,e]:[r,e]}function iO(r){return r._rawValidators}function fT(r){return r._rawAsyncValidators}function Rd(r){return r?Array.isArray(r)?r:[r]:[]}function ov(r,e){return Array.isArray(r)?r.includes(e):r===e}function mT(r,e){const t=Rd(e);return Rd(r).forEach(l=>{ov(t,l)||t.push(l)}),t}function ur(r,e){return Rd(e).filter(t=>!ov(r,t))}class rO{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=hT(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=rv(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class ps extends rO{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Mr extends rO{get formDirective(){return null}get path(){return null}}class oO{constructor(e){this._cd=e}is(e){var t,a,l;return"submitted"===e?!!(null===(t=this._cd)||void 0===t?void 0:t.submitted):!!(null===(l=null===(a=this._cd)||void 0===a?void 0:a.control)||void 0===l?void 0:l[e])}}let sO=(()=>{class r extends oO{constructor(t){super(t)}}return r.\u0275fac=function(t){return new(t||r)(oe(ps,2))},r.\u0275dir=je({type:r,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,a){2&t&&vn("ng-untouched",a.is("untouched"))("ng-touched",a.is("touched"))("ng-pristine",a.is("pristine"))("ng-dirty",a.is("dirty"))("ng-valid",a.is("valid"))("ng-invalid",a.is("invalid"))("ng-pending",a.is("pending"))},features:[Mt]}),r})(),aO=(()=>{class r extends oO{constructor(t){super(t)}}return r.\u0275fac=function(t){return new(t||r)(oe(Mr,10))},r.\u0275dir=je({type:r,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(t,a){2&t&&vn("ng-untouched",a.is("untouched"))("ng-touched",a.is("touched"))("ng-pristine",a.is("pristine"))("ng-dirty",a.is("dirty"))("ng-valid",a.is("valid"))("ng-invalid",a.is("invalid"))("ng-pending",a.is("pending"))("ng-submitted",a.is("submitted"))},features:[Mt]}),r})();function wh(r,e){lm(r,e),e.valueAccessor.writeValue(r.value),function hO(r,e){e.valueAccessor.registerOnChange(t=>{r._pendingValue=t,r._pendingChange=!0,r._pendingDirty=!0,"change"===r.updateOn&&dv(r,e)})}(r,e),function pO(r,e){const t=(a,l)=>{e.valueAccessor.writeValue(a),l&&e.viewToModelUpdate(a)};r.registerOnChange(t),e._registerOnDestroy(()=>{r._unregisterOnChange(t)})}(r,e),function lv(r,e){e.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,"blur"===r.updateOn&&r._pendingChange&&dv(r,e),"submit"!==r.updateOn&&r.markAsTouched()})}(r,e),function Id(r,e){if(e.valueAccessor.setDisabledState){const t=a=>{e.valueAccessor.setDisabledState(a)};r.registerOnDisabledChange(t),e._registerOnDestroy(()=>{r._unregisterOnDisabledChange(t)})}}(r,e)}function cm(r,e,t=!0){const a=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(a),e.valueAccessor.registerOnTouched(a)),Ah(r,e),r&&(e._invokeOnDestroyCallbacks(),r._registerOnCollectionChange(()=>{}))}function Lr(r,e){r.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function lm(r,e){const t=iO(r);null!==e.validator?r.setValidators(pT(t,e.validator)):"function"==typeof t&&r.setValidators([t]);const a=fT(r);null!==e.asyncValidator?r.setAsyncValidators(pT(a,e.asyncValidator)):"function"==typeof a&&r.setAsyncValidators([a]);const l=()=>r.updateValueAndValidity();Lr(e._rawValidators,l),Lr(e._rawAsyncValidators,l)}function Ah(r,e){let t=!1;if(null!==r){if(null!==e.validator){const l=iO(r);if(Array.isArray(l)&&l.length>0){const u=l.filter(f=>f!==e.validator);u.length!==l.length&&(t=!0,r.setValidators(u))}}if(null!==e.asyncValidator){const l=fT(r);if(Array.isArray(l)&&l.length>0){const u=l.filter(f=>f!==e.asyncValidator);u.length!==l.length&&(t=!0,r.setAsyncValidators(u))}}}const a=()=>{};return Lr(e._rawValidators,a),Lr(e._rawAsyncValidators,a),t}function dv(r,e){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function uv(r,e){lm(r,e)}function yT(r,e){r._syncPendingControls(),e.forEach(t=>{const a=t.control;"submit"===a.updateOn&&a._pendingChange&&(t.viewToModelUpdate(a._pendingValue),a._pendingChange=!1)})}function _s(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}const Dh="VALID",hm="INVALID",wd="PENDING",Oh="DISABLED";function pm(r){return(fm(r)?r.validators:r)||null}function ST(r){return Array.isArray(r)?hT(r):r||null}function CT(r,e){return(fm(e)?e.asyncValidators:r)||null}function _O(r){return Array.isArray(r)?rv(r):r||null}function fm(r){return null!=r&&!Array.isArray(r)&&"object"==typeof r}const yc=r=>r instanceof to,mm=r=>r instanceof gm,gO=r=>r instanceof Sc;function _m(r){return yc(r)?r.value:r.getRawValue()}function bT(r,e){const t=mm(r),a=r.controls;if(!(t?Object.keys(a):a).length)throw new Pe(1e3,"");if(!a[e])throw new Pe(1001,"")}function TT(r,e){mm(r),r._forEachChild((a,l)=>{if(void 0===e[l])throw new Pe(1002,"")})}class Kn{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=ST(this._rawValidators),this._composedAsyncValidatorFn=_O(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Dh}get invalid(){return this.status===hm}get pending(){return this.status==wd}get disabled(){return this.status===Oh}get enabled(){return this.status!==Oh}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=ST(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=_O(e)}addValidators(e){this.setValidators(mT(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(mT(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(ur(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(ur(e,this._rawAsyncValidators))}hasValidator(e){return ov(this._rawValidators,e)}hasAsyncValidator(e){return ov(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=wd,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Oh,this.errors=null,this._forEachChild(a=>{a.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(a=>a(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Dh,this._forEachChild(a=>{a.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(a=>a(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Dh||this.status===wd)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Oh:Dh}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=wd,this._hasOwnPendingAsyncValidator=!0;const t=lT(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(a=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(a,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function mO(r,e,t){if(null==e||(Array.isArray(e)||(e=e.split(t)),Array.isArray(e)&&0===e.length))return null;let a=r;return e.forEach(l=>{a=mm(a)?a.controls.hasOwnProperty(l)?a.controls[l]:null:gO(a)&&a.at(l)||null}),a}(this,e,".")}getError(e,t){const a=t?this.get(t):this;return a&&a.errors?a.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Qt,this.statusChanges=new Qt}_calculateStatus(){return this._allControlsDisabled()?Oh:this.errors?hm:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(wd)?wd:this._anyControlsHaveStatus(hm)?hm:Dh}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){fm(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class to extends Kn{constructor(e=null,t,a){super(pm(t),CT(a,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),fm(t)&&t.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(a=>a(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){_s(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){_s(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class gm extends Kn{constructor(e,t,a){super(pm(t),CT(a,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,a={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,a={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){TT(this,e),Object.keys(e).forEach(a=>{bT(this,a),this.controls[a].setValue(e[a],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(a=>{this.controls[a]&&this.controls[a].patchValue(e[a],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((a,l)=>{a.reset(e[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,a)=>(e[a]=_m(t),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,a)=>!!a._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const a=this.controls[t];a&&e(a,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const a=this.controls[t];if(this.contains(t)&&e(a))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,a)=>((t.enabled||this.disabled)&&(e[a]=t.value),e))}_reduceChildren(e,t){let a=e;return this._forEachChild((l,u)=>{a=t(a,l,u)}),a}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class Sc extends Kn{constructor(e,t,a){super(pm(t),CT(a,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,a={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:a.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,a={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:a.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){TT(this,e),e.forEach((a,l)=>{bT(this,l),this.at(l).setValue(a,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((a,l)=>{this.at(l)&&this.at(l).patchValue(a,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((a,l)=>{a.reset(e[l],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>_m(e))}clear(e={}){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((t,a)=>!!a._syncPendingControls()||t,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((t,a)=>{e(t,a)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const Em={provide:Mr,useExisting:Nn(()=>vm)},Nh=(()=>Promise.resolve(null))();let vm=(()=>{class r extends Mr{constructor(t,a){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new Qt,this.form=new gm({},hT(t),rv(a))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){Nh.then(()=>{const a=this._findContainer(t.path);t.control=a.registerControl(t.name,t.control),wh(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){Nh.then(()=>{const a=this._findContainer(t.path);a&&a.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){Nh.then(()=>{const a=this._findContainer(t.path),l=new gm({});uv(l,t),a.registerControl(t.name,l),l.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){Nh.then(()=>{const a=this._findContainer(t.path);a&&a.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,a){Nh.then(()=>{this.form.get(t.path).setValue(a)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,yT(this.form,this._directives),this.ngSubmit.emit(t),!1}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}return r.\u0275fac=function(t){return new(t||r)(oe(br,10),oe(vc,10))},r.\u0275dir=je({type:r,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(t,a){1&t&&zt("submit",function(u){return a.onSubmit(u)})("reset",function(){return a.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[xn([Em]),Mt]}),r})(),yO=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=je({type:r,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),r})(),IT=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})();const yv=new Le("NgModelWithFormControlWarning"),ml={provide:Mr,useExisting:Nn(()=>Ph)};let Ph=(()=>{class r extends Mr{constructor(t,a){super(),this.validators=t,this.asyncValidators=a,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Qt,this._setValidators(t),this._setAsyncValidators(a)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Ah(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const a=this.form.get(t.path);return wh(a,t),a.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),a}getControl(t){return this.form.get(t.path)}removeControl(t){cm(t.control||null,t,!1),_s(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,a){this.form.get(t.path).setValue(a)}onSubmit(t){return this.submitted=!0,yT(this.form,this.directives),this.ngSubmit.emit(t),!1}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const a=t.control,l=this.form.get(t.path);a!==l&&(cm(a||null,t),yc(l)&&(wh(l,t),t.control=l))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const a=this.form.get(t.path);uv(a,t),a.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const a=this.form.get(t.path);a&&function hv(r,e){return Ah(r,e)}(a,t)&&a.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){lm(this.form,this),this._oldForm&&Ah(this._oldForm,this)}_checkFormPresent(){}}return r.\u0275fac=function(t){return new(t||r)(oe(br,10),oe(vc,10))},r.\u0275dir=je({type:r,selectors:[["","formGroup",""]],hostBindings:function(t,a){1&t&&zt("submit",function(u){return a.onSubmit(u)})("reset",function(){return a.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[xn([ml]),Mt,li]}),r})();const mx={provide:ps,useExisting:Nn(()=>OT)};let OT=(()=>{class r extends ps{constructor(t,a,l,u,f){super(),this._ngModelWarningConfig=f,this._added=!1,this.update=new Qt,this._ngModelWarningSent=!1,this._parent=t,this._setValidators(a),this._setAsyncValidators(l),this.valueAccessor=function um(r,e){if(!e)return null;let t,a,l;return Array.isArray(e),e.forEach(u=>{u.constructor===am?t=u:function ms(r){return Object.getPrototypeOf(r.constructor)===gc}(u)?a=u:l=u}),l||a||t||null}(0,u)}set isDisabled(t){}ngOnChanges(t){this._added||this._setUpControl(),function pv(r,e){if(!r.hasOwnProperty("model"))return!1;const t=r.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}get path(){return function Aa(r,e){return[...e.path,r]}(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return r._ngModelWarningSentOnce=!1,r.\u0275fac=function(t){return new(t||r)(oe(Mr,13),oe(br,10),oe(vc,10),oe(hs,10),oe(yv,8))},r.\u0275dir=je({type:r,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[xn([mx]),Mt,li]}),r})(),kO=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[IT]]}),r})(),UT=(()=>{class r{static withConfig(t){return{ngModule:r,providers:[{provide:yv,useValue:t.warnOnNgModelWithFormControl}]}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[kO]}),r})(),gs=(()=>{class r{group(t,a=null){const l=this._reduceControls(t);let g,u=null,f=null;return null!=a&&(function Od(r){return void 0!==r.asyncValidators||void 0!==r.validators||void 0!==r.updateOn}(a)?(u=null!=a.validators?a.validators:null,f=null!=a.asyncValidators?a.asyncValidators:null,g=null!=a.updateOn?a.updateOn:void 0):(u=null!=a.validator?a.validator:null,f=null!=a.asyncValidator?a.asyncValidator:null)),new gm(l,{asyncValidators:f,updateOn:g,validators:u})}control(t,a,l){return new to(t,a,l)}array(t,a,l){const u=t.map(f=>this._createControl(f));return new Sc(u,a,l)}_reduceControls(t){const a={};return Object.keys(t).forEach(l=>{a[l]=this._createControl(t[l])}),a}_createControl(t){return yc(t)||mm(t)||gO(t)?t:Array.isArray(t)?this.control(t[0],t.length>1?t[1]:null,t.length>2?t[2]:null):this.control(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:UT}),r})();const bm=new Le("cdk-dir-doc",{providedIn:"root",factory:function Bn(){return Uy(_n)}}),Cx=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let Rv,Tv=(()=>{class r{constructor(t){if(this.value="ltr",this.change=new Qt,t){const l=t.documentElement?t.documentElement.dir:null;this.value=function _l(r){const e=(null==r?void 0:r.toLowerCase())||"";return"auto"===e&&"undefined"!=typeof navigator&&(null==navigator?void 0:navigator.language)?Cx.test(navigator.language)?"rtl":"ltr":"rtl"===e?"rtl":"ltr"}((t.body?t.body.dir:null)||l||"ltr")}}ngOnDestroy(){this.change.complete()}}return r.\u0275fac=function(t){return new(t||r)(he(bm,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),gl=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})();try{Rv="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(r){Rv=!1}let Lh,Tr=(()=>{class r{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function Eo(r){return r===Ob}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Rv)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return r.\u0275fac=function(t){return new(t||r)(he(tb))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const MO=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function LO(){if(Lh)return Lh;if("object"!=typeof document||!document)return Lh=new Set(MO),Lh;let r=document.createElement("input");return Lh=new Set(MO.filter(e=>(r.setAttribute("type",e),r.type===e))),Lh}let xh,Cc,Gi;function Tm(r){return function Fh(){if(null==xh&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>xh=!0}))}finally{xh=xh||!1}return xh}()?r:!!r.capture}function xO(){if(null==Cc){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Cc=!1,Cc;if("scrollBehavior"in document.documentElement.style)Cc=!0;else{const r=Element.prototype.scrollTo;Cc=!!r&&!/\{\s*\[native code\]\s*\}/.test(r.toString())}}return Cc}function So(r){return r.composedPath?r.composedPath()[0]:r.target}function Zt(){return"undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha}class Yn extends hn{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Rl;return this._value}next(e){super.next(this._value=e)}}function ut(...r){let e=r[r.length-1];return Il(e)?(r.pop(),zm(r,e)):Gd(r)}function JU(r){return e=>e.lift(new nj(r))}class nj{constructor(e){this.total=e}call(e,t){return t.subscribe(new ij(e,this.total))}}class ij extends Dn{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){++this.count>this.total&&this.destination.next(e)}}class oj{constructor(e,t){this.compare=e,this.keySelector=t}call(e,t){return t.subscribe(new sj(e,this.compare,this.keySelector))}}class sj extends Dn{constructor(e,t,a){super(e),this.keySelector=a,this.hasKey=!1,"function"==typeof t&&(this.compare=t)}compare(e,t){return e===t}_next(e){let t;try{const{keySelector:l}=this;t=l?l(e):e}catch(l){return this.destination.error(l)}let a=!1;if(this.hasKey)try{const{compare:l}=this;a=l(this.key,t)}catch(l){return this.destination.error(l)}else this.hasKey=!0;a||(this.key=t,this.destination.next(e))}}function ys(r){return e=>e.lift(new aj(r))}class aj{constructor(e){this.notifier=e}call(e,t){const a=new cj(e),l=wl(this.notifier,new Hd(a));return l&&!a.seenValue?(a.add(l),t.subscribe(a)):a}}class cj extends Jh{constructor(e){super(e),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}function vl(r){return null!=r&&"false"!=`${r}`}function jO(r,e=0){return function lj(r){return!isNaN(parseFloat(r))&&!isNaN(Number(r))}(r)?Number(r):e}function HO(r){return Array.isArray(r)?r:[r]}function hr(r){return null==r?"":"string"==typeof r?r:`${r}px`}function kd(r){return r instanceof Rn?r.nativeElement:r}class dj extends En{constructor(e,t){super()}schedule(e,t=0){return this}}class kx extends dj{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const a=this.id,l=this.scheduler;return null!=a&&(this.id=this.recycleAsyncId(l,a,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(l,this.id,t),this}requestAsyncId(e,t,a=0){return setInterval(e.flush.bind(e,this),a)}recycleAsyncId(e,t,a=0){if(null!==a&&this.delay===a&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const a=this._execute(e,t);if(a)return a;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let l,a=!1;try{this.work(e)}catch(u){a=!0,l=!!u&&u||new Error(u)}if(a)return this.unsubscribe(),l}_unsubscribe(){const e=this.id,t=this.scheduler,a=t.actions,l=a.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==l&&a.splice(l,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}let QU=(()=>{class r{constructor(t,a=r.now){this.SchedulerAction=t,this.now=a}schedule(t,a=0,l){return new this.SchedulerAction(this,t).schedule(l,a)}}return r.now=()=>Date.now(),r})();class yl extends QU{constructor(e,t=QU.now){super(e,()=>yl.delegate&&yl.delegate!==this?yl.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,a){return yl.delegate&&yl.delegate!==this?yl.delegate.schedule(e,t,a):super.schedule(e,t,a)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let a;this.active=!0;do{if(a=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,a){for(;e=t.shift();)e.unsubscribe();throw a}}}const wv=new yl(kx);function ZU(r,e=wv){return t=>t.lift(new uj(r,e))}class uj{constructor(e,t){this.dueTime=e,this.scheduler=t}call(e,t){return t.subscribe(new hj(e,this.dueTime,this.scheduler))}}class hj extends Dn{constructor(e,t,a){super(e),this.dueTime=t,this.scheduler=a,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(pj,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:e}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}clearDebounce(){const e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}function pj(r){r.debouncedNext()}let eV=(()=>{class r{create(t){return"undefined"==typeof MutationObserver?null:new MutationObserver(t)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),fj=(()=>{class r{constructor(t){this._mutationObserverFactory=t,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((t,a)=>this._cleanupObserver(a))}observe(t){const a=kd(t);return new Cn(l=>{const f=this._observeElement(a).subscribe(l);return()=>{f.unsubscribe(),this._unobserveElement(a)}})}_observeElement(t){if(this._observedElements.has(t))this._observedElements.get(t).count++;else{const a=new hn,l=this._mutationObserverFactory.create(u=>a.next(u));l&&l.observe(t,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(t,{observer:l,stream:a,count:1})}return this._observedElements.get(t).stream}_unobserveElement(t){this._observedElements.has(t)&&(this._observedElements.get(t).count--,this._observedElements.get(t).count||this._cleanupObserver(t))}_cleanupObserver(t){if(this._observedElements.has(t)){const{observer:a,stream:l}=this._observedElements.get(t);a&&a.disconnect(),l.complete(),this._observedElements.delete(t)}}}return r.\u0275fac=function(t){return new(t||r)(he(eV))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),tV=(()=>{class r{constructor(t,a,l){this._contentObserver=t,this._elementRef=a,this._ngZone=l,this.event=new Qt,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(t){this._disabled=vl(t),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(t){this._debounce=jO(t),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const t=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?t.pipe(ZU(this.debounce)):t).subscribe(this.event)})}_unsubscribe(){var t;null===(t=this._currentSubscription)||void 0===t||t.unsubscribe()}}return r.\u0275fac=function(t){return new(t||r)(oe(fj),oe(Rn),oe(yt))},r.\u0275dir=je({type:r,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),r})(),Mx=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({providers:[eV]}),r})();function GO(r,e){return(r.getAttribute(e)||"").match(/\S+/g)||[]}const iV="cdk-describedby-message",WO="cdk-describedby-host";let rV=0,gj=(()=>{class r{constructor(t,a){this._platform=a,this._messageRegistry=new Map,this._messagesContainer=null,this._id=""+rV++,this._document=t}describe(t,a,l){if(!this._canBeDescribed(t,a))return;const u=Lx(a,l);"string"!=typeof a?(oV(a),this._messageRegistry.set(u,{messageElement:a,referenceCount:0})):this._messageRegistry.has(u)||this._createMessageElement(a,l),this._isElementDescribedByMessage(t,u)||this._addMessageReference(t,u)}removeDescription(t,a,l){var u;if(!a||!this._isElementNode(t))return;const f=Lx(a,l);if(this._isElementDescribedByMessage(t,f)&&this._removeMessageReference(t,f),"string"==typeof a){const g=this._messageRegistry.get(f);g&&0===g.referenceCount&&this._deleteMessageElement(f)}0===(null===(u=this._messagesContainer)||void 0===u?void 0:u.childNodes.length)&&(this._messagesContainer.remove(),this._messagesContainer=null)}ngOnDestroy(){var t;const a=this._document.querySelectorAll(`[${WO}="${this._id}"]`);for(let l=0;l<a.length;l++)this._removeCdkDescribedByReferenceIds(a[l]),a[l].removeAttribute(WO);null===(t=this._messagesContainer)||void 0===t||t.remove(),this._messagesContainer=null,this._messageRegistry.clear()}_createMessageElement(t,a){const l=this._document.createElement("div");oV(l),l.textContent=t,a&&l.setAttribute("role",a),this._createMessagesContainer(),this._messagesContainer.appendChild(l),this._messageRegistry.set(Lx(t,a),{messageElement:l,referenceCount:0})}_deleteMessageElement(t){var a,l;null===(l=null===(a=this._messageRegistry.get(t))||void 0===a?void 0:a.messageElement)||void 0===l||l.remove(),this._messageRegistry.delete(t)}_createMessagesContainer(){if(this._messagesContainer)return;const t="cdk-describedby-message-container",a=this._document.querySelectorAll(`.${t}[platform="server"]`);for(let u=0;u<a.length;u++)a[u].remove();const l=this._document.createElement("div");l.style.visibility="hidden",l.classList.add(t),l.classList.add("cdk-visually-hidden"),this._platform&&!this._platform.isBrowser&&l.setAttribute("platform","server"),this._document.body.appendChild(l),this._messagesContainer=l}_removeCdkDescribedByReferenceIds(t){const a=GO(t,"aria-describedby").filter(l=>0!=l.indexOf(iV));t.setAttribute("aria-describedby",a.join(" "))}_addMessageReference(t,a){const l=this._messageRegistry.get(a);(function mj(r,e,t){const a=GO(r,e);a.some(l=>l.trim()==t.trim())||(a.push(t.trim()),r.setAttribute(e,a.join(" ")))})(t,"aria-describedby",l.messageElement.id),t.setAttribute(WO,this._id),l.referenceCount++}_removeMessageReference(t,a){const l=this._messageRegistry.get(a);l.referenceCount--,function _j(r,e,t){const l=GO(r,e).filter(u=>u!=t.trim());l.length?r.setAttribute(e,l.join(" ")):r.removeAttribute(e)}(t,"aria-describedby",l.messageElement.id),t.removeAttribute(WO)}_isElementDescribedByMessage(t,a){const l=GO(t,"aria-describedby"),u=this._messageRegistry.get(a),f=u&&u.messageElement.id;return!!f&&-1!=l.indexOf(f)}_canBeDescribed(t,a){if(!this._isElementNode(t))return!1;if(a&&"object"==typeof a)return!0;const l=null==a?"":`${a}`.trim(),u=t.getAttribute("aria-label");return!(!l||u&&u.trim()===l)}_isElementNode(t){return t.nodeType===this._document.ELEMENT_NODE}}return r.\u0275fac=function(t){return new(t||r)(he(_n),he(Tr))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function Lx(r,e){return"string"==typeof r?`${e||""}/${r}`:r}function oV(r){r.id||(r.id=`${iV}-${rV++}`)}function aV(r){return 0===r.buttons||0===r.offsetX&&0===r.offsetY}function cV(r){const e=r.touches&&r.touches[0]||r.changedTouches&&r.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}const bj=new Le("cdk-input-modality-detector-options"),Tj={ignoreKeys:[18,17,224,91,16]},Av=Tm({passive:!0,capture:!0});let Rj=(()=>{class r{constructor(t,a,l,u){this._platform=t,this._mostRecentTarget=null,this._modality=new Yn(null),this._lastTouchMs=0,this._onKeydown=f=>{var g,y;(null===(y=null===(g=this._options)||void 0===g?void 0:g.ignoreKeys)||void 0===y?void 0:y.some(R=>R===f.keyCode))||(this._modality.next("keyboard"),this._mostRecentTarget=So(f))},this._onMousedown=f=>{Date.now()-this._lastTouchMs<650||(this._modality.next(aV(f)?"keyboard":"mouse"),this._mostRecentTarget=So(f))},this._onTouchstart=f=>{cV(f)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=So(f))},this._options=Object.assign(Object.assign({},Tj),u),this.modalityDetected=this._modality.pipe(JU(1)),this.modalityChanged=this.modalityDetected.pipe(function rj(r,e){return t=>t.lift(new oj(r,e))}()),t.isBrowser&&a.runOutsideAngular(()=>{l.addEventListener("keydown",this._onKeydown,Av),l.addEventListener("mousedown",this._onMousedown,Av),l.addEventListener("touchstart",this._onTouchstart,Av)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,Av),document.removeEventListener("mousedown",this._onMousedown,Av),document.removeEventListener("touchstart",this._onTouchstart,Av))}}return r.\u0275fac=function(t){return new(t||r)(he(Tr),he(yt),he(_n),he(bj,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const wj=new Le("cdk-focus-monitor-default-options"),zO=Tm({passive:!0,capture:!0});let xx=(()=>{class r{constructor(t,a,l,u,f){this._ngZone=t,this._platform=a,this._inputModalityDetector=l,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new hn,this._rootNodeFocusAndBlurListener=g=>{const y=So(g),R="focus"===g.type?this._onFocus:this._onBlur;for(let D=y;D;D=D.parentElement)R.call(this,g,D)},this._document=u,this._detectionMode=(null==f?void 0:f.detectionMode)||0}monitor(t,a=!1){const l=kd(t);if(!this._platform.isBrowser||1!==l.nodeType)return ut(null);const u=function Ho(r){if(function Es(){if(null==Gi){const r="undefined"!=typeof document?document.head:null;Gi=!(!r||!r.createShadowRoot&&!r.attachShadow)}return Gi}()){const e=r.getRootNode?r.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}(l)||this._getDocument(),f=this._elementInfo.get(l);if(f)return a&&(f.checkChildren=!0),f.subject;const g={checkChildren:a,subject:new hn,rootNode:u};return this._elementInfo.set(l,g),this._registerGlobalListeners(g),g.subject}stopMonitoring(t){const a=kd(t),l=this._elementInfo.get(a);l&&(l.subject.complete(),this._setClasses(a),this._elementInfo.delete(a),this._removeGlobalListeners(l))}focusVia(t,a,l){const u=kd(t);u===this._getDocument().activeElement?this._getClosestElementsInfo(u).forEach(([g,y])=>this._originChanged(g,a,y)):(this._setOrigin(a),"function"==typeof u.focus&&u.focus(l))}ngOnDestroy(){this._elementInfo.forEach((t,a)=>this.stopMonitoring(a))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!(null==t?void 0:t.contains(this._inputModalityDetector._mostRecentTarget))}_setClasses(t,a){t.classList.toggle("cdk-focused",!!a),t.classList.toggle("cdk-touch-focused","touch"===a),t.classList.toggle("cdk-keyboard-focused","keyboard"===a),t.classList.toggle("cdk-mouse-focused","mouse"===a),t.classList.toggle("cdk-program-focused","program"===a)}_setOrigin(t,a=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&a,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,a){const l=this._elementInfo.get(a),u=So(t);!l||!l.checkChildren&&a!==u||this._originChanged(a,this._getFocusOrigin(u),l)}_onBlur(t,a){const l=this._elementInfo.get(a);!l||l.checkChildren&&t.relatedTarget instanceof Node&&a.contains(t.relatedTarget)||(this._setClasses(a),this._emitOrigin(l.subject,null))}_emitOrigin(t,a){this._ngZone.run(()=>t.next(a))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const a=t.rootNode,l=this._rootNodeFocusListenerCount.get(a)||0;l||this._ngZone.runOutsideAngular(()=>{a.addEventListener("focus",this._rootNodeFocusAndBlurListener,zO),a.addEventListener("blur",this._rootNodeFocusAndBlurListener,zO)}),this._rootNodeFocusListenerCount.set(a,l+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ys(this._stopInputModalityDetector)).subscribe(u=>{this._setOrigin(u,!0)}))}_removeGlobalListeners(t){const a=t.rootNode;if(this._rootNodeFocusListenerCount.has(a)){const l=this._rootNodeFocusListenerCount.get(a);l>1?this._rootNodeFocusListenerCount.set(a,l-1):(a.removeEventListener("focus",this._rootNodeFocusAndBlurListener,zO),a.removeEventListener("blur",this._rootNodeFocusAndBlurListener,zO),this._rootNodeFocusListenerCount.delete(a))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,a,l){this._setClasses(t,a),this._emitOrigin(l.subject,a),this._lastFocusOrigin=a}_getClosestElementsInfo(t){const a=[];return this._elementInfo.forEach((l,u)=>{(u===t||l.checkChildren&&u.contains(t))&&a.push([u,l])}),a}}return r.\u0275fac=function(t){return new(t||r)(he(yt),he(Tr),he(Rj),he(_n,8),he(wj,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const dV="cdk-high-contrast-black-on-white",uV="cdk-high-contrast-white-on-black",Fx="cdk-high-contrast-active";let hV=(()=>{class r{constructor(t,a){this._platform=t,this._document=a}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const a=this._document.defaultView||window,l=a&&a.getComputedStyle?a.getComputedStyle(t):null,u=(l&&l.backgroundColor||"").replace(/ /g,"");switch(t.remove(),u){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(Fx),t.remove(dV),t.remove(uV),this._hasCheckedHighContrastMode=!0;const a=this.getHighContrastMode();1===a?(t.add(Fx),t.add(dV)):2===a&&(t.add(Fx),t.add(uV))}}}return r.\u0275fac=function(t){return new(t||r)(he(Tr),he(_n))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),Aj=(()=>{class r{constructor(t){t._applyBodyHighContrastModeCssClasses()}}return r.\u0275fac=function(t){return new(t||r)(he(hV))},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[Mx]]}),r})();class pV{}const Md="*";function Ux(r,e){return{type:7,name:r,definitions:e,options:{}}}function zT(r,e=null){return{type:4,styles:e,timings:r}}function fV(r,e=null){return{type:2,steps:r,options:e}}function Ss(r){return{type:6,styles:r,offset:null}}function Vx(r,e,t){return{type:0,name:r,styles:e,options:t}}function KT(r,e,t=null){return{type:1,expr:r,animation:e,options:t}}function mV(r){Promise.resolve(null).then(r)}class qT{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){mV(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(a=>a()),t.length=0}}class _V{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,a=0,l=0;const u=this.players.length;0==u?mV(()=>this._onFinish()):this.players.forEach(f=>{f.onDone(()=>{++t==u&&this._onFinish()}),f.onDestroy(()=>{++a==u&&this._onDestroy()}),f.onStart(()=>{++l==u&&this._onStart()})}),this.totalTime=this.players.reduce((f,g)=>Math.max(f,g.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(a=>{const l=a.totalTime?Math.min(1,t/a.totalTime):1;a.setPosition(l)})}getPosition(){const e=this.players.reduce((t,a)=>null===t||a.totalTime>t.totalTime?a:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(a=>a()),t.length=0}}const en=!1;function gV(r){return new Pe(3e3,en)}function d4(){return"undefined"!=typeof window&&void 0!==window.document}function jx(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Uh(r){switch(r.length){case 0:return new qT;case 1:return r[0];default:return new _V(r)}}function EV(r,e,t,a,l={},u={}){const f=[],g=[];let y=-1,R=null;if(a.forEach(D=>{const x=D.offset,j=x==y,G=j&&R||{};Object.keys(D).forEach(q=>{let se=q,ue=D[q];if("offset"!==q)switch(se=e.normalizePropertyName(se,f),ue){case"!":ue=l[q];break;case Md:ue=u[q];break;default:ue=e.normalizeStyleValue(q,se,ue,f)}G[se]=ue}),j||g.push(G),R=G,y=x}),f.length)throw function Zj(r){return new Pe(3502,en)}();return g}function Hx(r,e,t,a){switch(e){case"start":r.onStart(()=>a(t&&Gx(t,"start",r)));break;case"done":r.onDone(()=>a(t&&Gx(t,"done",r)));break;case"destroy":r.onDestroy(()=>a(t&&Gx(t,"destroy",r)))}}function Gx(r,e,t){const a=t.totalTime,u=Wx(r.element,r.triggerName,r.fromState,r.toState,e||r.phaseName,null==a?r.totalTime:a,!!t.disabled),f=r._data;return null!=f&&(u._data=f),u}function Wx(r,e,t,a,l="",u=0,f){return{element:r,triggerName:e,fromState:t,toState:a,phaseName:l,totalTime:u,disabled:!!f}}function qs(r,e,t){let a;return r instanceof Map?(a=r.get(e),a||r.set(e,a=t)):(a=r[e],a||(a=r[e]=t)),a}function vV(r){const e=r.indexOf(":");return[r.substring(1,e),r.substr(e+1)]}let zx=(r,e)=>!1,yV=(r,e,t)=>[],SV=null;function Kx(r){const e=r.parentNode||r.host;return e===SV?null:e}(jx()||"undefined"!=typeof Element)&&(d4()?(SV=(()=>document.documentElement)(),zx=(r,e)=>{for(;e;){if(e===r)return!0;e=Kx(e)}return!1}):zx=(r,e)=>r.contains(e),yV=(r,e,t)=>{if(t)return Array.from(r.querySelectorAll(e));const a=r.querySelector(e);return a?[a]:[]});let Am=null,CV=!1;function bV(r){Am||(Am=function h4(){return"undefined"!=typeof document?document.body:null}()||{},CV=!!Am.style&&"WebkitAppearance"in Am.style);let e=!0;return Am.style&&!function u4(r){return"ebkit"==r.substring(1,6)}(r)&&(e=r in Am.style,!e&&CV&&(e="Webkit"+r.charAt(0).toUpperCase()+r.substr(1)in Am.style)),e}const TV=zx,RV=yV;let IV=(()=>{class r{validateStyleProperty(t){return bV(t)}matchesElement(t,a){return!1}containsElement(t,a){return TV(t,a)}getParentElement(t){return Kx(t)}query(t,a,l){return RV(t,a,l)}computeStyle(t,a,l){return l||""}animate(t,a,l,u,f,g=[],y){return new qT(l,u)}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})(),qx=(()=>{class r{}return r.NOOP=new IV,r})();const Yx="ng-enter",qO="ng-leave",YO="ng-trigger",$O=".ng-trigger",AV="ng-animating",$x=".ng-animating";function Dm(r){if("number"==typeof r)return r;const e=r.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Xx(parseFloat(e[1]),e[2])}function Xx(r,e){return"s"===e?1e3*r:r}function XO(r,e,t){return r.hasOwnProperty("duration")?r:function m4(r,e,t){let l,u=0,f="";if("string"==typeof r){const g=r.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===g)return e.push(gV()),{duration:0,delay:0,easing:""};l=Xx(parseFloat(g[1]),g[2]);const y=g[3];null!=y&&(u=Xx(parseFloat(y),g[4]));const R=g[5];R&&(f=R)}else l=r;if(!t){let g=!1,y=e.length;l<0&&(e.push(function Nj(){return new Pe(3100,en)}()),g=!0),u<0&&(e.push(function Pj(){return new Pe(3101,en)}()),g=!0),g&&e.splice(y,0,gV())}return{duration:l,delay:u,easing:f}}(r,e,t)}function Dv(r,e={}){return Object.keys(r).forEach(t=>{e[t]=r[t]}),e}function Vh(r,e,t={}){if(e)for(let a in r)t[a]=r[a];else Dv(r,t);return t}function OV(r,e,t){return t?e+":"+t+";":""}function NV(r){let e="";for(let t=0;t<r.style.length;t++){const a=r.style.item(t);e+=OV(0,a,r.style.getPropertyValue(a))}for(const t in r.style)r.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=OV(0,E4(t),r.style[t]));r.setAttribute("style",e)}function Sl(r,e,t){r.style&&(Object.keys(e).forEach(a=>{const l=Qx(a);t&&!t.hasOwnProperty(a)&&(t[a]=r.style[l]),r.style[l]=e[a]}),jx()&&NV(r))}function Om(r,e){r.style&&(Object.keys(e).forEach(t=>{const a=Qx(t);r.style[a]=""}),jx()&&NV(r))}function YT(r){return Array.isArray(r)?1==r.length?r[0]:fV(r):r}const Jx=new RegExp("{{\\s*(.+?)\\s*}}","g");function PV(r){let e=[];if("string"==typeof r){let t;for(;t=Jx.exec(r);)e.push(t[1]);Jx.lastIndex=0}return e}function JO(r,e,t){const a=r.toString(),l=a.replace(Jx,(u,f)=>{let g=e[f];return e.hasOwnProperty(f)||(t.push(function Mj(r){return new Pe(3003,en)}()),g=""),g.toString()});return l==a?r:l}function QO(r){const e=[];let t=r.next();for(;!t.done;)e.push(t.value),t=r.next();return e}const g4=/-+([a-z0-9])/g;function Qx(r){return r.replace(g4,(...e)=>e[1].toUpperCase())}function E4(r){return r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Ys(r,e,t){switch(e.type){case 7:return r.visitTrigger(e,t);case 0:return r.visitState(e,t);case 1:return r.visitTransition(e,t);case 2:return r.visitSequence(e,t);case 3:return r.visitGroup(e,t);case 4:return r.visitAnimate(e,t);case 5:return r.visitKeyframes(e,t);case 6:return r.visitStyle(e,t);case 8:return r.visitReference(e,t);case 9:return r.visitAnimateChild(e,t);case 10:return r.visitAnimateRef(e,t);case 11:return r.visitQuery(e,t);case 12:return r.visitStagger(e,t);default:throw function Lj(r){return new Pe(3004,en)}()}}function kV(r,e){return window.getComputedStyle(r)[e]}function T4(r,e){const t=[];return"string"==typeof r?r.split(/\s*,\s*/).forEach(a=>function R4(r,e,t){if(":"==r[0]){const y=function I4(r,e){switch(r){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,a)=>parseFloat(a)>parseFloat(t);case":decrement":return(t,a)=>parseFloat(a)<parseFloat(t);default:return e.push(function $j(r){return new Pe(3016,en)}()),"* => *"}}(r,t);if("function"==typeof y)return void e.push(y);r=y}const a=r.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==a||a.length<4)return t.push(function Yj(r){return new Pe(3015,en)}()),e;const l=a[1],u=a[2],f=a[3];e.push(MV(l,f));"<"==u[0]&&!("*"==l&&"*"==f)&&e.push(MV(f,l))}(a,t,e)):t.push(r),t}const nN=new Set(["true","1"]),iN=new Set(["false","0"]);function MV(r,e){const t=nN.has(r)||iN.has(r),a=nN.has(e)||iN.has(e);return(l,u)=>{let f="*"==r||r==l,g="*"==e||e==u;return!f&&t&&"boolean"==typeof l&&(f=l?nN.has(r):iN.has(r)),!g&&a&&"boolean"==typeof u&&(g=u?nN.has(e):iN.has(e)),f&&g}}const w4=new RegExp("s*:selfs*,?","g");function Zx(r,e,t,a){return new A4(r).build(e,t,a)}class A4{constructor(e){this._driver=e}build(e,t,a){const l=new N4(t);this._resetContextStyleTimingState(l);const u=Ys(this,YT(e),l);return l.unsupportedCSSPropertiesFound.size&&l.unsupportedCSSPropertiesFound.keys(),u}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let a=t.queryCount=0,l=t.depCount=0;const u=[],f=[];return"@"==e.name.charAt(0)&&t.errors.push(function Fj(){return new Pe(3006,en)}()),e.definitions.forEach(g=>{if(this._resetContextStyleTimingState(t),0==g.type){const y=g,R=y.name;R.toString().split(/\s*,\s*/).forEach(D=>{y.name=D,u.push(this.visitState(y,t))}),y.name=R}else if(1==g.type){const y=this.visitTransition(g,t);a+=y.queryCount,l+=y.depCount,f.push(y)}else t.errors.push(function Uj(){return new Pe(3007,en)}())}),{type:7,name:e.name,states:u,transitions:f,queryCount:a,depCount:l,options:null}}visitState(e,t){const a=this.visitStyle(e.styles,t),l=e.options&&e.options.params||null;if(a.containsDynamicStyles){const u=new Set,f=l||{};a.styles.forEach(g=>{if(rN(g)){const y=g;Object.keys(y).forEach(R=>{PV(y[R]).forEach(D=>{f.hasOwnProperty(D)||u.add(D)})})}}),u.size&&(QO(u.values()),t.errors.push(function Vj(r,e){return new Pe(3008,en)}()))}return{type:0,name:e.name,style:a,options:l?{params:l}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const a=Ys(this,YT(e.animation),t);return{type:1,matchers:T4(e.expr,t.errors),animation:a,queryCount:t.queryCount,depCount:t.depCount,options:Nm(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(a=>Ys(this,a,t)),options:Nm(e.options)}}visitGroup(e,t){const a=t.currentTime;let l=0;const u=e.steps.map(f=>{t.currentTime=a;const g=Ys(this,f,t);return l=Math.max(l,t.currentTime),g});return t.currentTime=l,{type:3,steps:u,options:Nm(e.options)}}visitAnimate(e,t){const a=function k4(r,e){if(r.hasOwnProperty("duration"))return r;if("number"==typeof r)return e2(XO(r,e).duration,0,"");const t=r;if(t.split(/\s+/).some(u=>"{"==u.charAt(0)&&"{"==u.charAt(1))){const u=e2(0,0,"");return u.dynamic=!0,u.strValue=t,u}const l=XO(t,e);return e2(l.duration,l.delay,l.easing)}(e.timings,t.errors);t.currentAnimateTimings=a;let l,u=e.styles?e.styles:Ss({});if(5==u.type)l=this.visitKeyframes(u,t);else{let f=e.styles,g=!1;if(!f){g=!0;const R={};a.easing&&(R.easing=a.easing),f=Ss(R)}t.currentTime+=a.duration+a.delay;const y=this.visitStyle(f,t);y.isEmptyStep=g,l=y}return t.currentAnimateTimings=null,{type:4,timings:a,style:l,options:null}}visitStyle(e,t){const a=this._makeStyleAst(e,t);return this._validateStyleAst(a,t),a}_makeStyleAst(e,t){const a=[];Array.isArray(e.styles)?e.styles.forEach(f=>{"string"==typeof f?f==Md?a.push(f):t.errors.push(function Bj(r){return new Pe(3002,en)}()):a.push(f)}):a.push(e.styles);let l=!1,u=null;return a.forEach(f=>{if(rN(f)){const g=f,y=g.easing;if(y&&(u=y,delete g.easing),!l)for(let R in g)if(g[R].toString().indexOf("{{")>=0){l=!0;break}}}),{type:6,styles:a,easing:u,offset:e.offset,containsDynamicStyles:l,options:null}}_validateStyleAst(e,t){const a=t.currentAnimateTimings;let l=t.currentTime,u=t.currentTime;a&&u>0&&(u-=a.duration+a.delay),e.styles.forEach(f=>{"string"!=typeof f&&Object.keys(f).forEach(g=>{if(!this._driver.validateStyleProperty(g))return delete f[g],void t.unsupportedCSSPropertiesFound.add(g);const y=t.collectedStyles[t.currentQuerySelector],R=y[g];let D=!0;R&&(u!=l&&u>=R.startTime&&l<=R.endTime&&(t.errors.push(function jj(r,e,t,a,l){return new Pe(3010,en)}()),D=!1),u=R.startTime),D&&(y[g]={startTime:u,endTime:l}),t.options&&function _4(r,e,t){const a=e.params||{},l=PV(r);l.length&&l.forEach(u=>{a.hasOwnProperty(u)||t.push(function kj(r){return new Pe(3001,en)}())})}(f[g],t.options,t.errors)})})}visitKeyframes(e,t){const a={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function Hj(){return new Pe(3011,en)}()),a;let u=0;const f=[];let g=!1,y=!1,R=0;const D=e.steps.map(Ce=>{const ce=this._makeStyleAst(Ce,t);let De=null!=ce.offset?ce.offset:function P4(r){if("string"==typeof r)return null;let e=null;if(Array.isArray(r))r.forEach(t=>{if(rN(t)&&t.hasOwnProperty("offset")){const a=t;e=parseFloat(a.offset),delete a.offset}});else if(rN(r)&&r.hasOwnProperty("offset")){const t=r;e=parseFloat(t.offset),delete t.offset}return e}(ce.styles),Xe=0;return null!=De&&(u++,Xe=ce.offset=De),y=y||Xe<0||Xe>1,g=g||Xe<R,R=Xe,f.push(Xe),ce});y&&t.errors.push(function Gj(){return new Pe(3012,en)}()),g&&t.errors.push(function Wj(){return new Pe(3200,en)}());const x=e.steps.length;let j=0;u>0&&u<x?t.errors.push(function zj(){return new Pe(3202,en)}()):0==u&&(j=1/(x-1));const G=x-1,q=t.currentTime,se=t.currentAnimateTimings,ue=se.duration;return D.forEach((Ce,ce)=>{const De=j>0?ce==G?1:j*ce:f[ce],Xe=De*ue;t.currentTime=q+se.delay+Xe,se.duration=Xe,this._validateStyleAst(Ce,t),Ce.offset=De,a.styles.push(Ce)}),a}visitReference(e,t){return{type:8,animation:Ys(this,YT(e.animation),t),options:Nm(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:Nm(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:Nm(e.options)}}visitQuery(e,t){const a=t.currentQuerySelector,l=e.options||{};t.queryCount++,t.currentQuery=e;const[u,f]=function D4(r){const e=!!r.split(/\s*,\s*/).find(t=>":self"==t);return e&&(r=r.replace(w4,"")),r=r.replace(/@\*/g,$O).replace(/@\w+/g,t=>$O+"-"+t.substr(1)).replace(/:animating/g,$x),[r,e]}(e.selector);t.currentQuerySelector=a.length?a+" "+u:u,qs(t.collectedStyles,t.currentQuerySelector,{});const g=Ys(this,YT(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=a,{type:11,selector:u,limit:l.limit||0,optional:!!l.optional,includeSelf:f,animation:g,originalSelector:e.selector,options:Nm(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function Kj(){return new Pe(3013,en)}());const a="full"===e.timings?{duration:0,delay:0,easing:"full"}:XO(e.timings,t.errors,!0);return{type:12,animation:Ys(this,YT(e.animation),t),timings:a,options:null}}}class N4{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function rN(r){return!Array.isArray(r)&&"object"==typeof r}function Nm(r){return r?(r=Dv(r)).params&&(r.params=function O4(r){return r?Dv(r):null}(r.params)):r={},r}function e2(r,e,t){return{duration:r,delay:e,easing:t}}function t2(r,e,t,a,l,u,f=null,g=!1){return{type:1,element:r,keyframes:e,preStyleProps:t,postStyleProps:a,duration:l,delay:u,totalTime:l+u,easing:f,subTimeline:g}}class oN{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let a=this._map.get(e);a||this._map.set(e,a=[]),a.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const x4=new RegExp(":enter","g"),U4=new RegExp(":leave","g");function n2(r,e,t,a,l,u={},f={},g,y,R=[]){return(new V4).buildKeyframes(r,e,t,a,l,u,f,g,y,R)}class V4{buildKeyframes(e,t,a,l,u,f,g,y,R,D=[]){R=R||new oN;const x=new r2(e,t,R,l,u,D,[]);x.options=y,x.currentTimeline.setStyles([f],null,x.errors,y),Ys(this,a,x);const j=x.timelines.filter(G=>G.containsAnimation());if(Object.keys(g).length){let G;for(let q=j.length-1;q>=0;q--){const se=j[q];if(se.element===t){G=se;break}}G&&!G.allowOnlyTimelineStyles()&&G.setStyles([g],null,x.errors,y)}return j.length?j.map(G=>G.buildKeyframes()):[t2(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const a=t.subInstructions.get(t.element);if(a){const l=t.createSubContext(e.options),u=t.currentTimeline.currentTime,f=this._visitSubInstructions(a,l,l.options);u!=f&&t.transformIntoNewTimeline(f)}t.previousNode=e}visitAnimateRef(e,t){const a=t.createSubContext(e.options);a.transformIntoNewTimeline(),this.visitReference(e.animation,a),t.transformIntoNewTimeline(a.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,a){let u=t.currentTimeline.currentTime;const f=null!=a.duration?Dm(a.duration):null,g=null!=a.delay?Dm(a.delay):null;return 0!==f&&e.forEach(y=>{const R=t.appendInstructionToTimeline(y,f,g);u=Math.max(u,R.duration+R.delay)}),u}visitReference(e,t){t.updateOptions(e.options,!0),Ys(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const a=t.subContextCount;let l=t;const u=e.options;if(u&&(u.params||u.delay)&&(l=t.createSubContext(u),l.transformIntoNewTimeline(),null!=u.delay)){6==l.previousNode.type&&(l.currentTimeline.snapshotCurrentStyles(),l.previousNode=sN);const f=Dm(u.delay);l.delayNextStep(f)}e.steps.length&&(e.steps.forEach(f=>Ys(this,f,l)),l.currentTimeline.applyStylesToKeyframe(),l.subContextCount>a&&l.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const a=[];let l=t.currentTimeline.currentTime;const u=e.options&&e.options.delay?Dm(e.options.delay):0;e.steps.forEach(f=>{const g=t.createSubContext(e.options);u&&g.delayNextStep(u),Ys(this,f,g),l=Math.max(l,g.currentTimeline.currentTime),a.push(g.currentTimeline)}),a.forEach(f=>t.currentTimeline.mergeTimelineCollectedStyles(f)),t.transformIntoNewTimeline(l),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const a=e.strValue;return XO(t.params?JO(a,t.params,t.errors):a,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const a=t.currentAnimateTimings=this._visitTiming(e.timings,t),l=t.currentTimeline;a.delay&&(t.incrementTime(a.delay),l.snapshotCurrentStyles());const u=e.style;5==u.type?this.visitKeyframes(u,t):(t.incrementTime(a.duration),this.visitStyle(u,t),l.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const a=t.currentTimeline,l=t.currentAnimateTimings;!l&&a.getCurrentStyleProperties().length&&a.forwardFrame();const u=l&&l.easing||e.easing;e.isEmptyStep?a.applyEmptyStep(u):a.setStyles(e.styles,u,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const a=t.currentAnimateTimings,l=t.currentTimeline.duration,u=a.duration,g=t.createSubContext().currentTimeline;g.easing=a.easing,e.styles.forEach(y=>{g.forwardTime((y.offset||0)*u),g.setStyles(y.styles,y.easing,t.errors,t.options),g.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(g),t.transformIntoNewTimeline(l+u),t.previousNode=e}visitQuery(e,t){const a=t.currentTimeline.currentTime,l=e.options||{},u=l.delay?Dm(l.delay):0;u&&(6===t.previousNode.type||0==a&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=sN);let f=a;const g=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!l.optional,t.errors);t.currentQueryTotal=g.length;let y=null;g.forEach((R,D)=>{t.currentQueryIndex=D;const x=t.createSubContext(e.options,R);u&&x.delayNextStep(u),R===t.element&&(y=x.currentTimeline),Ys(this,e.animation,x),x.currentTimeline.applyStylesToKeyframe(),f=Math.max(f,x.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(f),y&&(t.currentTimeline.mergeTimelineCollectedStyles(y),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const a=t.parentContext,l=t.currentTimeline,u=e.timings,f=Math.abs(u.duration),g=f*(t.currentQueryTotal-1);let y=f*t.currentQueryIndex;switch(u.duration<0?"reverse":u.easing){case"reverse":y=g-y;break;case"full":y=a.currentStaggerTime}const D=t.currentTimeline;y&&D.delayNextStep(y);const x=D.currentTime;Ys(this,e.animation,t),t.previousNode=e,a.currentStaggerTime=l.currentTime-x+(l.startTime-a.currentTimeline.startTime)}}const sN={};class r2{constructor(e,t,a,l,u,f,g,y){this._driver=e,this.element=t,this.subInstructions=a,this._enterClassName=l,this._leaveClassName=u,this.errors=f,this.timelines=g,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=sN,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=y||new aN(this._driver,t,0),g.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const a=e;let l=this.options;null!=a.duration&&(l.duration=Dm(a.duration)),null!=a.delay&&(l.delay=Dm(a.delay));const u=a.params;if(u){let f=l.params;f||(f=this.options.params={}),Object.keys(u).forEach(g=>{(!t||!f.hasOwnProperty(g))&&(f[g]=JO(u[g],f,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const a=e.params={};Object.keys(t).forEach(l=>{a[l]=t[l]})}}return e}createSubContext(e=null,t,a){const l=t||this.element,u=new r2(this._driver,l,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(l,a||0));return u.previousNode=this.previousNode,u.currentAnimateTimings=this.currentAnimateTimings,u.options=this._copyOptions(),u.updateOptions(e),u.currentQueryIndex=this.currentQueryIndex,u.currentQueryTotal=this.currentQueryTotal,u.parentContext=this,this.subContextCount++,u}transformIntoNewTimeline(e){return this.previousNode=sN,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,a){const l={duration:null!=t?t:e.duration,delay:this.currentTimeline.currentTime+(null!=a?a:0)+e.delay,easing:""},u=new B4(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,l,e.stretchStartingKeyframe);return this.timelines.push(u),l}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,a,l,u,f){let g=[];if(l&&g.push(this.element),e.length>0){e=(e=e.replace(x4,"."+this._enterClassName)).replace(U4,"."+this._leaveClassName);let R=this._driver.query(this.element,e,1!=a);0!==a&&(R=a<0?R.slice(R.length+a,R.length):R.slice(0,a)),g.push(...R)}return!u&&0==g.length&&f.push(function qj(r){return new Pe(3014,en)}()),g}}class aN{constructor(e,t,a,l){this._driver=e,this.element=t,this.startTime=a,this._elementTimelineStylesLookup=l,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new aN(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(t=>{this._backFill[t]=this._globalTimelineStyles[t]||Md,this._currentKeyframe[t]=Md}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,a,l){t&&(this._previousKeyframe.easing=t);const u=l&&l.params||{},f=function j4(r,e){const t={};let a;return r.forEach(l=>{"*"===l?(a=a||Object.keys(e),a.forEach(u=>{t[u]=Md})):Vh(l,!1,t)}),t}(e,this._globalTimelineStyles);Object.keys(f).forEach(g=>{const y=JO(f[g],u,a);this._pendingStyles[g]=y,this._localTimelineStyles.hasOwnProperty(g)||(this._backFill[g]=this._globalTimelineStyles.hasOwnProperty(g)?this._globalTimelineStyles[g]:Md),this._updateStyle(g,y)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(a=>{this._currentKeyframe[a]=e[a]}),Object.keys(this._localTimelineStyles).forEach(a=>{this._currentKeyframe.hasOwnProperty(a)||(this._currentKeyframe[a]=this._localTimelineStyles[a])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const a=this._styleSummary[t],l=e._styleSummary[t];(!a||l.time>a.time)&&this._updateStyle(t,l.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,a=1===this._keyframes.size&&0===this.duration;let l=[];this._keyframes.forEach((g,y)=>{const R=Vh(g,!0);Object.keys(R).forEach(D=>{const x=R[D];"!"==x?e.add(D):x==Md&&t.add(D)}),a||(R.offset=y/this.duration),l.push(R)});const u=e.size?QO(e.values()):[],f=t.size?QO(t.values()):[];if(a){const g=l[0],y=Dv(g);g.offset=0,y.offset=1,l=[g,y]}return t2(this.element,l,u,f,this.duration,this.startTime,this.easing,!1)}}class B4 extends aN{constructor(e,t,a,l,u,f,g=!1){super(e,t,f.delay),this.keyframes=a,this.preStyleProps=l,this.postStyleProps=u,this._stretchStartingKeyframe=g,this.timings={duration:f.duration,delay:f.delay,easing:f.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:a,easing:l}=this.timings;if(this._stretchStartingKeyframe&&t){const u=[],f=a+t,g=t/f,y=Vh(e[0],!1);y.offset=0,u.push(y);const R=Vh(e[0],!1);R.offset=FV(g),u.push(R);const D=e.length-1;for(let x=1;x<=D;x++){let j=Vh(e[x],!1);j.offset=FV((t+j.offset*a)/f),u.push(j)}a=f,t=0,l="",e=u}return t2(this.element,e,this.preStyleProps,this.postStyleProps,a,t,l,!0)}}function FV(r,e=3){const t=Math.pow(10,e-1);return Math.round(r*t)/t}class o2{}class H4 extends o2{normalizePropertyName(e,t){return Qx(e)}normalizeStyleValue(e,t,a,l){let u="";const f=a.toString().trim();if(G4[t]&&0!==a&&"0"!==a)if("number"==typeof a)u="px";else{const g=a.match(/^[+-]?[\d\.]+([a-z]*)$/);g&&0==g[1].length&&l.push(function xj(r,e){return new Pe(3005,en)}())}return f+u}}const G4=(()=>function W4(r){const e={};return r.forEach(t=>e[t]=!0),e}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function UV(r,e,t,a,l,u,f,g,y,R,D,x,j){return{type:0,element:r,triggerName:e,isRemovalTransition:l,fromState:t,fromStyles:u,toState:a,toStyles:f,timelines:g,queriedElements:y,preStyleProps:R,postStyleProps:D,totalTime:x,errors:j}}const s2={};class VV{constructor(e,t,a){this._triggerName=e,this.ast=t,this._stateStyles=a}match(e,t,a,l){return function z4(r,e,t,a,l){return r.some(u=>u(e,t,a,l))}(this.ast.matchers,e,t,a,l)}buildStyles(e,t,a){const l=this._stateStyles["*"],u=this._stateStyles[e],f=l?l.buildStyles(t,a):{};return u?u.buildStyles(t,a):f}build(e,t,a,l,u,f,g,y,R,D){const x=[],j=this.ast.options&&this.ast.options.params||s2,q=this.buildStyles(a,g&&g.params||s2,x),se=y&&y.params||s2,ue=this.buildStyles(l,se,x),Ce=new Set,ce=new Map,De=new Map,Xe="void"===l,Vt={params:Object.assign(Object.assign({},j),se)},Ti=D?[]:n2(e,t,this.ast.animation,u,f,q,ue,Vt,R,x);let Di=0;if(Ti.forEach(Xs=>{Di=Math.max(Xs.duration+Xs.delay,Di)}),x.length)return UV(t,this._triggerName,a,l,Xe,q,ue,[],[],ce,De,Di,x);Ti.forEach(Xs=>{const Js=Xs.element,xv=qs(ce,Js,{});Xs.preStyleProps.forEach(Ic=>xv[Ic]=!0);const Ud=qs(De,Js,{});Xs.postStyleProps.forEach(Ic=>Ud[Ic]=!0),Js!==t&&Ce.add(Js)});const $s=QO(Ce.values());return UV(t,this._triggerName,a,l,Xe,q,ue,Ti,$s,ce,De,Di)}}class K4{constructor(e,t,a){this.styles=e,this.defaultParams=t,this.normalizer=a}buildStyles(e,t){const a={},l=Dv(this.defaultParams);return Object.keys(e).forEach(u=>{const f=e[u];null!=f&&(l[u]=f)}),this.styles.styles.forEach(u=>{if("string"!=typeof u){const f=u;Object.keys(f).forEach(g=>{let y=f[g];y.length>1&&(y=JO(y,l,t));const R=this.normalizer.normalizePropertyName(g,t);y=this.normalizer.normalizeStyleValue(g,R,y,t),a[R]=y})}}),a}}class Y4{constructor(e,t,a){this.name=e,this.ast=t,this._normalizer=a,this.transitionFactories=[],this.states={},t.states.forEach(l=>{this.states[l.name]=new K4(l.style,l.options&&l.options.params||{},a)}),BV(this.states,"true","1"),BV(this.states,"false","0"),t.transitions.forEach(l=>{this.transitionFactories.push(new VV(e,l,this.states))}),this.fallbackTransition=function $4(r,e,t){return new VV(r,{type:1,animation:{type:2,steps:[],options:null},matchers:[(f,g)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,a,l){return this.transitionFactories.find(f=>f.match(e,t,a,l))||null}matchStyles(e,t,a){return this.fallbackTransition.buildStyles(e,t,a)}}function BV(r,e,t){r.hasOwnProperty(e)?r.hasOwnProperty(t)||(r[t]=r[e]):r.hasOwnProperty(t)&&(r[e]=r[t])}const X4=new oN;class J4{constructor(e,t,a){this.bodyNode=e,this._driver=t,this._normalizer=a,this._animations={},this._playersById={},this.players=[]}register(e,t){const a=[],u=Zx(this._driver,t,a,[]);if(a.length)throw function e4(r){return new Pe(3503,en)}();this._animations[e]=u}_buildPlayer(e,t,a){const l=e.element,u=EV(0,this._normalizer,0,e.keyframes,t,a);return this._driver.animate(l,u,e.duration,e.delay,e.easing,[],!0)}create(e,t,a={}){const l=[],u=this._animations[e];let f;const g=new Map;if(u?(f=n2(this._driver,t,u,Yx,qO,{},{},a,X4,l),f.forEach(D=>{const x=qs(g,D.element,{});D.postStyleProps.forEach(j=>x[j]=null)})):(l.push(function t4(){return new Pe(3300,en)}()),f=[]),l.length)throw function n4(r){return new Pe(3504,en)}();g.forEach((D,x)=>{Object.keys(D).forEach(j=>{D[j]=this._driver.computeStyle(x,j,Md)})});const R=Uh(f.map(D=>{const x=g.get(D.element);return this._buildPlayer(D,{},x)}));return this._playersById[e]=R,R.onDestroy(()=>this.destroy(e)),this.players.push(R),R}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const a=this.players.indexOf(t);a>=0&&this.players.splice(a,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw function i4(r){return new Pe(3301,en)}();return t}listen(e,t,a,l){const u=Wx(t,"","","");return Hx(this._getPlayer(e),a,u,l),()=>{}}command(e,t,a,l){if("register"==a)return void this.register(e,l[0]);if("create"==a)return void this.create(e,t,l[0]||{});const u=this._getPlayer(e);switch(a){case"play":u.play();break;case"pause":u.pause();break;case"reset":u.reset();break;case"restart":u.restart();break;case"finish":u.finish();break;case"init":u.init();break;case"setPosition":u.setPosition(parseFloat(l[0]));break;case"destroy":this.destroy(e)}}}const jV="ng-animate-queued",a2="ng-animate-disabled",n5=[],HV={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},r5={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Pa="__ng_removed";class c2{constructor(e,t=""){this.namespaceId=t;const a=e&&e.hasOwnProperty("value");if(this.value=function c5(r){return null!=r?r:null}(a?e.value:e),a){const u=Dv(e);delete u.value,this.options=u}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const a=this.options.params;Object.keys(t).forEach(l=>{null==a[l]&&(a[l]=t[l])})}}}const $T="void",l2=new c2($T);class o5{constructor(e,t,a){this.id=e,this.hostElement=t,this._engine=a,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,ka(t,this._hostClassName)}listen(e,t,a,l){if(!this._triggers.hasOwnProperty(t))throw function r4(r,e){return new Pe(3302,en)}();if(null==a||0==a.length)throw function o4(r){return new Pe(3303,en)}();if(!function l5(r){return"start"==r||"done"==r}(a))throw function s4(r,e){return new Pe(3400,en)}();const u=qs(this._elementListeners,e,[]),f={name:t,phase:a,callback:l};u.push(f);const g=qs(this._engine.statesByElement,e,{});return g.hasOwnProperty(t)||(ka(e,YO),ka(e,YO+"-"+t),g[t]=l2),()=>{this._engine.afterFlush(()=>{const y=u.indexOf(f);y>=0&&u.splice(y,1),this._triggers[t]||delete g[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw function a4(r){return new Pe(3401,en)}();return t}trigger(e,t,a,l=!0){const u=this._getTrigger(t),f=new d2(this.id,t,e);let g=this._engine.statesByElement.get(e);g||(ka(e,YO),ka(e,YO+"-"+t),this._engine.statesByElement.set(e,g={}));let y=g[t];const R=new c2(a,this.id);if(!(a&&a.hasOwnProperty("value"))&&y&&R.absorbOptions(y.options),g[t]=R,y||(y=l2),R.value!==$T&&y.value===R.value){if(!function h5(r,e){const t=Object.keys(r),a=Object.keys(e);if(t.length!=a.length)return!1;for(let l=0;l<t.length;l++){const u=t[l];if(!e.hasOwnProperty(u)||r[u]!==e[u])return!1}return!0}(y.params,R.params)){const se=[],ue=u.matchStyles(y.value,y.params,se),Ce=u.matchStyles(R.value,R.params,se);se.length?this._engine.reportError(se):this._engine.afterFlush(()=>{Om(e,ue),Sl(e,Ce)})}return}const j=qs(this._engine.playersByElement,e,[]);j.forEach(se=>{se.namespaceId==this.id&&se.triggerName==t&&se.queued&&se.destroy()});let G=u.matchTransition(y.value,R.value,e,R.params),q=!1;if(!G){if(!l)return;G=u.fallbackTransition,q=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:G,fromState:y,toState:R,player:f,isFallbackTransition:q}),q||(ka(e,jV),f.onStart(()=>{Ov(e,jV)})),f.onDone(()=>{let se=this.players.indexOf(f);se>=0&&this.players.splice(se,1);const ue=this._engine.playersByElement.get(e);if(ue){let Ce=ue.indexOf(f);Ce>=0&&ue.splice(Ce,1)}}),this.players.push(f),j.push(f),f}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,a)=>{delete t[e]}),this._elementListeners.forEach((t,a)=>{this._elementListeners.set(a,t.filter(l=>l.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(a=>a.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const a=this._engine.driver.query(e,$O,!0);a.forEach(l=>{if(l[Pa])return;const u=this._engine.fetchNamespacesByElement(l);u.size?u.forEach(f=>f.triggerLeaveAnimation(l,t,!1,!0)):this.clearElementCache(l)}),this._engine.afterFlushAnimationsDone(()=>a.forEach(l=>this.clearElementCache(l)))}triggerLeaveAnimation(e,t,a,l){const u=this._engine.statesByElement.get(e),f=new Map;if(u){const g=[];if(Object.keys(u).forEach(y=>{if(f.set(y,u[y].value),this._triggers[y]){const R=this.trigger(e,y,$T,l);R&&g.push(R)}}),g.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,f),a&&Uh(g).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),a=this._engine.statesByElement.get(e);if(t&&a){const l=new Set;t.forEach(u=>{const f=u.name;if(l.has(f))return;l.add(f);const y=this._triggers[f].fallbackTransition,R=a[f]||l2,D=new c2($T),x=new d2(this.id,f,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:f,transition:y,fromState:R,toState:D,player:x,isFallbackTransition:!0})})}}removeNode(e,t){const a=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let l=!1;if(a.totalAnimations){const u=a.players.length?a.playersByQueriedElement.get(e):[];if(u&&u.length)l=!0;else{let f=e;for(;f=f.parentNode;)if(a.statesByElement.get(f)){l=!0;break}}}if(this.prepareLeaveAnimationListeners(e),l)a.markElementAsRemoved(this.id,e,!1,t);else{const u=e[Pa];(!u||u===HV)&&(a.afterFlush(()=>this.clearElementCache(e)),a.destroyInnerAnimations(e),a._onRemovalComplete(e,t))}}insertNode(e,t){ka(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(a=>{const l=a.player;if(l.destroyed)return;const u=a.element,f=this._elementListeners.get(u);f&&f.forEach(g=>{if(g.name==a.triggerName){const y=Wx(u,a.triggerName,a.fromState.value,a.toState.value);y._data=e,Hx(a.player,g.phase,y,g.callback)}}),l.markedForDestroy?this._engine.afterFlush(()=>{l.destroy()}):t.push(a)}),this._queue=[],t.sort((a,l)=>{const u=a.transition.ast.depCount,f=l.transition.ast.depCount;return 0==u||0==f?u-f:this._engine.driver.containsElement(a.element,l.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(a=>a.element===e)||t,t}}class s5{constructor(e,t,a){this.bodyNode=e,this.driver=t,this._normalizer=a,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(l,u)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(a=>{a.queued&&e.push(a)})}),e}createNamespace(e,t){const a=new o5(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(a,t):(this.newHostElements.set(t,a),this.collectEnterElement(t)),this._namespaceLookup[e]=a}_balanceNamespaceList(e,t){const a=this._namespaceList,l=this.namespacesByHostElement,u=a.length-1;if(u>=0){let f=!1;if(void 0!==this.driver.getParentElement){let g=this.driver.getParentElement(t);for(;g;){const y=l.get(g);if(y){const R=a.indexOf(y);a.splice(R+1,0,e),f=!0;break}g=this.driver.getParentElement(g)}}else for(let g=u;g>=0;g--)if(this.driver.containsElement(a[g].hostElement,t)){a.splice(g+1,0,e),f=!0;break}f||a.unshift(e)}else a.push(e);return l.set(t,e),e}register(e,t){let a=this._namespaceLookup[e];return a||(a=this.createNamespace(e,t)),a}registerTrigger(e,t,a){let l=this._namespaceLookup[e];l&&l.register(t,a)&&this.totalAnimations++}destroy(e,t){if(!e)return;const a=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(a.hostElement),delete this._namespaceLookup[e];const l=this._namespaceList.indexOf(a);l>=0&&this._namespaceList.splice(l,1)}),this.afterFlushAnimationsDone(()=>a.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,a=this.statesByElement.get(e);if(a){const l=Object.keys(a);for(let u=0;u<l.length;u++){const f=a[l[u]].namespaceId;if(f){const g=this._fetchNamespace(f);g&&t.add(g)}}}return t}trigger(e,t,a,l){if(cN(t)){const u=this._fetchNamespace(e);if(u)return u.trigger(t,a,l),!0}return!1}insertNode(e,t,a,l){if(!cN(t))return;const u=t[Pa];if(u&&u.setForRemoval){u.setForRemoval=!1,u.setForMove=!0;const f=this.collectedLeaveElements.indexOf(t);f>=0&&this.collectedLeaveElements.splice(f,1)}if(e){const f=this._fetchNamespace(e);f&&f.insertNode(t,a)}l&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),ka(e,a2)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Ov(e,a2))}removeNode(e,t,a,l){if(cN(t)){const u=e?this._fetchNamespace(e):null;if(u?u.removeNode(t,l):this.markElementAsRemoved(e,t,!1,l),a){const f=this.namespacesByHostElement.get(t);f&&f.id!==e&&f.removeNode(t,l)}}else this._onRemovalComplete(t,l)}markElementAsRemoved(e,t,a,l,u){this.collectedLeaveElements.push(t),t[Pa]={namespaceId:e,setForRemoval:l,hasAnimation:a,removedBeforeQueried:!1,previousTriggersValues:u}}listen(e,t,a,l,u){return cN(t)?this._fetchNamespace(e).listen(t,a,l,u):()=>{}}_buildInstruction(e,t,a,l,u){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,a,l,e.fromState.options,e.toState.options,t,u)}destroyInnerAnimations(e){let t=this.driver.query(e,$O,!0);t.forEach(a=>this.destroyActiveAnimationsForElement(a)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,$x,!0),t.forEach(a=>this.finishActiveQueriedAnimationOnElement(a)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(a=>{a.queued?a.markedForDestroy=!0:a.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(a=>a.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Uh(this.players).onDone(()=>e());e()})}processLeaveNode(e){var t;const a=e[Pa];if(a&&a.setForRemoval){if(e[Pa]=HV,a.namespaceId){this.destroyInnerAnimations(e);const l=this._fetchNamespace(a.namespaceId);l&&l.clearElementCache(e)}this._onRemovalComplete(e,a.setForRemoval)}(null===(t=e.classList)||void 0===t?void 0:t.contains(a2))&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(l=>{this.markElementAsDisabled(l,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((a,l)=>this._balanceNamespaceList(a,l)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let a=0;a<this.collectedEnterElements.length;a++)ka(this.collectedEnterElements[a],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const a=[];try{t=this._flushAnimations(a,e)}finally{for(let l=0;l<a.length;l++)a[l]()}}else for(let a=0;a<this.collectedLeaveElements.length;a++)this.processLeaveNode(this.collectedLeaveElements[a]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(a=>a()),this._flushFns=[],this._whenQuietFns.length){const a=this._whenQuietFns;this._whenQuietFns=[],t.length?Uh(t).onDone(()=>{a.forEach(l=>l())}):a.forEach(l=>l())}}reportError(e){throw function c4(r){return new Pe(3402,en)}()}_flushAnimations(e,t){const a=new oN,l=[],u=new Map,f=[],g=new Map,y=new Map,R=new Map,D=new Set;this.disabledNodes.forEach(Ve=>{D.add(Ve);const nt=this.driver.query(Ve,".ng-animate-queued",!0);for(let gt=0;gt<nt.length;gt++)D.add(nt[gt])});const x=this.bodyNode,j=Array.from(this.statesByElement.keys()),G=zV(j,this.collectedEnterElements),q=new Map;let se=0;G.forEach((Ve,nt)=>{const gt=Yx+se++;q.set(nt,gt),Ve.forEach(gn=>ka(gn,gt))});const ue=[],Ce=new Set,ce=new Set;for(let Ve=0;Ve<this.collectedLeaveElements.length;Ve++){const nt=this.collectedLeaveElements[Ve],gt=nt[Pa];gt&&gt.setForRemoval&&(ue.push(nt),Ce.add(nt),gt.hasAnimation?this.driver.query(nt,".ng-star-inserted",!0).forEach(gn=>Ce.add(gn)):ce.add(nt))}const De=new Map,Xe=zV(j,Array.from(Ce));Xe.forEach((Ve,nt)=>{const gt=qO+se++;De.set(nt,gt),Ve.forEach(gn=>ka(gn,gt))}),e.push(()=>{G.forEach((Ve,nt)=>{const gt=q.get(nt);Ve.forEach(gn=>Ov(gn,gt))}),Xe.forEach((Ve,nt)=>{const gt=De.get(nt);Ve.forEach(gn=>Ov(gn,gt))}),ue.forEach(Ve=>{this.processLeaveNode(Ve)})});const Vt=[],Ti=[];for(let Ve=this._namespaceList.length-1;Ve>=0;Ve--)this._namespaceList[Ve].drainQueuedTransitions(t).forEach(gt=>{const gn=gt.player,Ur=gt.element;if(Vt.push(gn),this.collectedEnterElements.length){const Ko=Ur[Pa];if(Ko&&Ko.setForMove){if(Ko.previousTriggersValues&&Ko.previousTriggersValues.has(gt.triggerName)){const Bm=Ko.previousTriggersValues.get(gt.triggerName),zh=this.statesByElement.get(gt.element);zh&&zh[gt.triggerName]&&(zh[gt.triggerName].value=Bm)}return void gn.destroy()}}const Tl=!x||!this.driver.containsElement(x,Ur),Qs=De.get(Ur),Wh=q.get(Ur),Oi=this._buildInstruction(gt,a,Wh,Qs,Tl);if(Oi.errors&&Oi.errors.length)return void Ti.push(Oi);if(Tl)return gn.onStart(()=>Om(Ur,Oi.fromStyles)),gn.onDestroy(()=>Sl(Ur,Oi.toStyles)),void l.push(gn);if(gt.isFallbackTransition)return gn.onStart(()=>Om(Ur,Oi.fromStyles)),gn.onDestroy(()=>Sl(Ur,Oi.toStyles)),void l.push(gn);const ZB=[];Oi.timelines.forEach(Ko=>{Ko.stretchStartingKeyframe=!0,this.disabledNodes.has(Ko.element)||ZB.push(Ko)}),Oi.timelines=ZB,a.append(Ur,Oi.timelines),f.push({instruction:Oi,player:gn,element:Ur}),Oi.queriedElements.forEach(Ko=>qs(g,Ko,[]).push(gn)),Oi.preStyleProps.forEach((Ko,Bm)=>{const zh=Object.keys(Ko);if(zh.length){let jm=y.get(Bm);jm||y.set(Bm,jm=new Set),zh.forEach(K2=>jm.add(K2))}}),Oi.postStyleProps.forEach((Ko,Bm)=>{const zh=Object.keys(Ko);let jm=R.get(Bm);jm||R.set(Bm,jm=new Set),zh.forEach(K2=>jm.add(K2))})});if(Ti.length){const Ve=[];Ti.forEach(nt=>{Ve.push(function l4(r,e){return new Pe(3505,en)}())}),Vt.forEach(nt=>nt.destroy()),this.reportError(Ve)}const Di=new Map,$s=new Map;f.forEach(Ve=>{const nt=Ve.element;a.has(nt)&&($s.set(nt,nt),this._beforeAnimationBuild(Ve.player.namespaceId,Ve.instruction,Di))}),l.forEach(Ve=>{const nt=Ve.element;this._getPreviousPlayers(nt,!1,Ve.namespaceId,Ve.triggerName,null).forEach(gn=>{qs(Di,nt,[]).push(gn),gn.destroy()})});const Xs=ue.filter(Ve=>qV(Ve,y,R)),Js=new Map;WV(Js,this.driver,ce,R,Md).forEach(Ve=>{qV(Ve,y,R)&&Xs.push(Ve)});const Ud=new Map;G.forEach((Ve,nt)=>{WV(Ud,this.driver,new Set(Ve),y,"!")}),Xs.forEach(Ve=>{const nt=Js.get(Ve),gt=Ud.get(Ve);Js.set(Ve,Object.assign(Object.assign({},nt),gt))});const Ic=[],Fv=[],Uv={};f.forEach(Ve=>{const{element:nt,player:gt,instruction:gn}=Ve;if(a.has(nt)){if(D.has(nt))return gt.onDestroy(()=>Sl(nt,gn.toStyles)),gt.disabled=!0,gt.overrideTotalTime(gn.totalTime),void l.push(gt);let Ur=Uv;if($s.size>1){let Qs=nt;const Wh=[];for(;Qs=Qs.parentNode;){const Oi=$s.get(Qs);if(Oi){Ur=Oi;break}Wh.push(Qs)}Wh.forEach(Oi=>$s.set(Oi,Ur))}const Tl=this._buildAnimation(gt.namespaceId,gn,Di,u,Ud,Js);if(gt.setRealPlayer(Tl),Ur===Uv)Ic.push(gt);else{const Qs=this.playersByElement.get(Ur);Qs&&Qs.length&&(gt.parentPlayer=Uh(Qs)),l.push(gt)}}else Om(nt,gn.fromStyles),gt.onDestroy(()=>Sl(nt,gn.toStyles)),Fv.push(gt),D.has(nt)&&l.push(gt)}),Fv.forEach(Ve=>{const nt=u.get(Ve.element);if(nt&&nt.length){const gt=Uh(nt);Ve.setRealPlayer(gt)}}),l.forEach(Ve=>{Ve.parentPlayer?Ve.syncPlayerEvents(Ve.parentPlayer):Ve.destroy()});for(let Ve=0;Ve<ue.length;Ve++){const nt=ue[Ve],gt=nt[Pa];if(Ov(nt,qO),gt&&gt.hasAnimation)continue;let gn=[];if(g.size){let Tl=g.get(nt);Tl&&Tl.length&&gn.push(...Tl);let Qs=this.driver.query(nt,$x,!0);for(let Wh=0;Wh<Qs.length;Wh++){let Oi=g.get(Qs[Wh]);Oi&&Oi.length&&gn.push(...Oi)}}const Ur=gn.filter(Tl=>!Tl.destroyed);Ur.length?d5(this,nt,Ur):this.processLeaveNode(nt)}return ue.length=0,Ic.forEach(Ve=>{this.players.push(Ve),Ve.onDone(()=>{Ve.destroy();const nt=this.players.indexOf(Ve);this.players.splice(nt,1)}),Ve.play()}),Ic}elementContainsData(e,t){let a=!1;const l=t[Pa];return l&&l.setForRemoval&&(a=!0),this.playersByElement.has(t)&&(a=!0),this.playersByQueriedElement.has(t)&&(a=!0),this.statesByElement.has(t)&&(a=!0),this._fetchNamespace(e).elementContainsData(t)||a}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,a,l,u){let f=[];if(t){const g=this.playersByQueriedElement.get(e);g&&(f=g)}else{const g=this.playersByElement.get(e);if(g){const y=!u||u==$T;g.forEach(R=>{R.queued||!y&&R.triggerName!=l||f.push(R)})}}return(a||l)&&(f=f.filter(g=>!(a&&a!=g.namespaceId||l&&l!=g.triggerName))),f}_beforeAnimationBuild(e,t,a){const u=t.element,f=t.isRemovalTransition?void 0:e,g=t.isRemovalTransition?void 0:t.triggerName;for(const y of t.timelines){const R=y.element,D=R!==u,x=qs(a,R,[]);this._getPreviousPlayers(R,D,f,g,t.toState).forEach(G=>{const q=G.getRealPlayer();q.beforeDestroy&&q.beforeDestroy(),G.destroy(),x.push(G)})}Om(u,t.fromStyles)}_buildAnimation(e,t,a,l,u,f){const g=t.triggerName,y=t.element,R=[],D=new Set,x=new Set,j=t.timelines.map(q=>{const se=q.element;D.add(se);const ue=se[Pa];if(ue&&ue.removedBeforeQueried)return new qT(q.duration,q.delay);const Ce=se!==y,ce=function u5(r){const e=[];return KV(r,e),e}((a.get(se)||n5).map(Di=>Di.getRealPlayer())).filter(Di=>!!Di.element&&Di.element===se),De=u.get(se),Xe=f.get(se),Vt=EV(0,this._normalizer,0,q.keyframes,De,Xe),Ti=this._buildPlayer(q,Vt,ce);if(q.subTimeline&&l&&x.add(se),Ce){const Di=new d2(e,g,se);Di.setRealPlayer(Ti),R.push(Di)}return Ti});R.forEach(q=>{qs(this.playersByQueriedElement,q.element,[]).push(q),q.onDone(()=>function a5(r,e,t){let a;if(r instanceof Map){if(a=r.get(e),a){if(a.length){const l=a.indexOf(t);a.splice(l,1)}0==a.length&&r.delete(e)}}else if(a=r[e],a){if(a.length){const l=a.indexOf(t);a.splice(l,1)}0==a.length&&delete r[e]}return a}(this.playersByQueriedElement,q.element,q))}),D.forEach(q=>ka(q,AV));const G=Uh(j);return G.onDestroy(()=>{D.forEach(q=>Ov(q,AV)),Sl(y,t.toStyles)}),x.forEach(q=>{qs(l,q,[]).push(G)}),G}_buildPlayer(e,t,a){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,a):new qT(e.duration,e.delay)}}class d2{constructor(e,t,a){this.namespaceId=e,this.triggerName=t,this.element=a,this._player=new qT,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(a=>Hx(e,t,void 0,a))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){qs(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function cN(r){return r&&1===r.nodeType}function GV(r,e){const t=r.style.display;return r.style.display=null!=e?e:"none",t}function WV(r,e,t,a,l){const u=[];t.forEach(y=>u.push(GV(y)));const f=[];a.forEach((y,R)=>{const D={};y.forEach(x=>{const j=D[x]=e.computeStyle(R,x,l);(!j||0==j.length)&&(R[Pa]=r5,f.push(R))}),r.set(R,D)});let g=0;return t.forEach(y=>GV(y,u[g++])),f}function zV(r,e){const t=new Map;if(r.forEach(g=>t.set(g,[])),0==e.length)return t;const l=new Set(e),u=new Map;function f(g){if(!g)return 1;let y=u.get(g);if(y)return y;const R=g.parentNode;return y=t.has(R)?R:l.has(R)?1:f(R),u.set(g,y),y}return e.forEach(g=>{const y=f(g);1!==y&&t.get(y).push(g)}),t}function ka(r,e){var t;null===(t=r.classList)||void 0===t||t.add(e)}function Ov(r,e){var t;null===(t=r.classList)||void 0===t||t.remove(e)}function d5(r,e,t){Uh(t).onDone(()=>r.processLeaveNode(e))}function KV(r,e){for(let t=0;t<r.length;t++){const a=r[t];a instanceof _V?KV(a.players,e):e.push(a)}}function qV(r,e,t){const a=t.get(r);if(!a)return!1;let l=e.get(r);return l?a.forEach(u=>l.add(u)):e.set(r,a),t.delete(r),!0}class lN{constructor(e,t,a){this.bodyNode=e,this._driver=t,this._normalizer=a,this._triggerCache={},this.onRemovalComplete=(l,u)=>{},this._transitionEngine=new s5(e,t,a),this._timelineEngine=new J4(e,t,a),this._transitionEngine.onRemovalComplete=(l,u)=>this.onRemovalComplete(l,u)}registerTrigger(e,t,a,l,u){const f=e+"-"+l;let g=this._triggerCache[f];if(!g){const y=[],D=Zx(this._driver,u,y,[]);if(y.length)throw function Qj(r,e){return new Pe(3404,en)}();g=function q4(r,e,t){return new Y4(r,e,t)}(l,D,this._normalizer),this._triggerCache[f]=g}this._transitionEngine.registerTrigger(t,l,g)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,a,l){this._transitionEngine.insertNode(e,t,a,l)}onRemove(e,t,a,l){this._transitionEngine.removeNode(e,t,l||!1,a)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,a,l){if("@"==a.charAt(0)){const[u,f]=vV(a);this._timelineEngine.command(u,t,f,l)}else this._transitionEngine.trigger(e,t,a,l)}listen(e,t,a,l,u){if("@"==a.charAt(0)){const[f,g]=vV(a);return this._timelineEngine.listen(f,t,g,u)}return this._transitionEngine.listen(e,t,a,l,u)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let f5=(()=>{class r{constructor(t,a,l){this._element=t,this._startStyles=a,this._endStyles=l,this._state=0;let u=r.initialStylesByElement.get(t);u||r.initialStylesByElement.set(t,u={}),this._initialStyles=u}start(){this._state<1&&(this._startStyles&&Sl(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Sl(this._element,this._initialStyles),this._endStyles&&(Sl(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(r.initialStylesByElement.delete(this._element),this._startStyles&&(Om(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Om(this._element,this._endStyles),this._endStyles=null),Sl(this._element,this._initialStyles),this._state=3)}}return r.initialStylesByElement=new WeakMap,r})();function u2(r){let e=null;const t=Object.keys(r);for(let a=0;a<t.length;a++){const l=t[a];m5(l)&&(e=e||{},e[l]=r[l])}return e}function m5(r){return"display"===r||"position"===r}class YV{constructor(e,t,a,l){this.element=e,this.keyframes=t,this.options=a,this._specialStyles=l,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=a.duration,this._delay=a.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,a){return e.animate(t,a)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};if(this.hasStarted()){const t=this._finalKeyframe;Object.keys(t).forEach(a=>{"offset"!=a&&(e[a]=this._finished?t[a]:kV(this.element,a))})}this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(a=>a()),t.length=0}}class _5{validateStyleProperty(e){return bV(e)}matchesElement(e,t){return!1}containsElement(e,t){return TV(e,t)}getParentElement(e){return Kx(e)}query(e,t,a){return RV(e,t,a)}computeStyle(e,t,a){return window.getComputedStyle(e)[t]}animate(e,t,a,l,u,f=[]){const y={duration:a,delay:l,fill:0==l?"both":"forwards"};u&&(y.easing=u);const R={},D=f.filter(j=>j instanceof YV);(function v4(r,e){return 0===r||0===e})(a,l)&&D.forEach(j=>{let G=j.currentSnapshot;Object.keys(G).forEach(q=>R[q]=G[q])}),t=function y4(r,e,t){const a=Object.keys(t);if(a.length&&e.length){let u=e[0],f=[];if(a.forEach(g=>{u.hasOwnProperty(g)||f.push(g),u[g]=t[g]}),f.length)for(var l=1;l<e.length;l++){let g=e[l];f.forEach(function(y){g[y]=kV(r,y)})}}return e}(e,t=t.map(j=>Vh(j,!1)),R);const x=function p5(r,e){let t=null,a=null;return Array.isArray(e)&&e.length?(t=u2(e[0]),e.length>1&&(a=u2(e[e.length-1]))):e&&(t=u2(e)),t||a?new f5(r,t,a):null}(e,t);return new YV(e,t,y,x)}}let g5=(()=>{class r extends pV{constructor(t,a){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(a.body,{id:"0",encapsulation:bs.None,styles:[],data:{animation:[]}})}build(t){const a=this._nextAnimationId.toString();this._nextAnimationId++;const l=Array.isArray(t)?fV(t):t;return $V(this._renderer,null,a,"register",[l]),new E5(a,this._renderer)}}return r.\u0275fac=function(t){return new(t||r)(he(pf),he(_n))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();class E5 extends class Dj{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new v5(this._id,e,t||{},this._renderer)}}class v5{constructor(e,t,a,l){this.id=e,this.element=t,this._renderer=l,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",a)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return $V(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function $V(r,e,t,a,l){return r.setProperty(e,`@@${t}:${a}`,l)}const XV="@.disabled";let y5=(()=>{class r{constructor(t,a,l){this.delegate=t,this.engine=a,this._zone=l,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),a.onRemovalComplete=(u,f)=>{const g=null==f?void 0:f.parentNode(u);g&&f.removeChild(g,u)}}createRenderer(t,a){const u=this.delegate.createRenderer(t,a);if(!(t&&a&&a.data&&a.data.animation)){let D=this._rendererCache.get(u);return D||(D=new JV("",u,this.engine),this._rendererCache.set(u,D)),D}const f=a.id,g=a.id+"-"+this._currentId;this._currentId++,this.engine.register(g,t);const y=D=>{Array.isArray(D)?D.forEach(y):this.engine.registerTrigger(f,g,t,D.name,D)};return a.data.animation.forEach(y),new S5(this,g,u,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,a,l){t>=0&&t<this._microtaskId?this._zone.run(()=>a(l)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(u=>{const[f,g]=u;f(g)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([a,l]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return r.\u0275fac=function(t){return new(t||r)(he(pf),he(lN),he(yt))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();class JV{constructor(e,t,a){this.namespaceId=e,this.delegate=t,this.engine=a,this.destroyNode=this.delegate.destroyNode?l=>t.destroyNode(l):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,a,l=!0){this.delegate.insertBefore(e,t,a),this.engine.onInsert(this.namespaceId,t,e,l)}removeChild(e,t,a){this.engine.onRemove(this.namespaceId,t,this.delegate,a)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,a,l){this.delegate.setAttribute(e,t,a,l)}removeAttribute(e,t,a){this.delegate.removeAttribute(e,t,a)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,a,l){this.delegate.setStyle(e,t,a,l)}removeStyle(e,t,a){this.delegate.removeStyle(e,t,a)}setProperty(e,t,a){"@"==t.charAt(0)&&t==XV?this.disableAnimations(e,!!a):this.delegate.setProperty(e,t,a)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,a){return this.delegate.listen(e,t,a)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class S5 extends JV{constructor(e,t,a,l){super(t,a,l),this.factory=e,this.namespaceId=t}setProperty(e,t,a){"@"==t.charAt(0)?"."==t.charAt(1)&&t==XV?this.disableAnimations(e,a=void 0===a||!!a):this.engine.process(this.namespaceId,e,t.substr(1),a):this.delegate.setProperty(e,t,a)}listen(e,t,a){if("@"==t.charAt(0)){const l=function C5(r){switch(r){case"body":return document.body;case"document":return document;case"window":return window;default:return r}}(e);let u=t.substr(1),f="";return"@"!=u.charAt(0)&&([u,f]=function b5(r){const e=r.indexOf(".");return[r.substring(0,e),r.substr(e+1)]}(u)),this.engine.listen(this.namespaceId,l,u,f,g=>{this.factory.scheduleListenerCallback(g._data||-1,a,g)})}return this.delegate.listen(e,t,a)}}let T5=(()=>{class r extends lN{constructor(t,a,l){super(t.body,a,l)}ngOnDestroy(){this.flush()}}return r.\u0275fac=function(t){return new(t||r)(he(_n),he(qx),he(o2))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();const Bh=new Le("AnimationModuleType"),QV=[{provide:pV,useClass:g5},{provide:o2,useFactory:function R5(){return new H4}},{provide:lN,useClass:T5},{provide:pf,useFactory:function I5(r,e,t){return new y5(r,e,t)},deps:[bh,lN,yt]}],ZV=[{provide:qx,useFactory:()=>new _5},{provide:Bh,useValue:"BrowserAnimations"},...QV],w5=[{provide:qx,useClass:IV},{provide:Bh,useValue:"NoopAnimations"},...QV];let A5=(()=>{class r{static withConfig(t){return{ngModule:r,providers:t.disableAnimations?w5:ZV}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({providers:ZV,imports:[qb]}),r})();const O5=new Le("mat-sanity-checks",{providedIn:"root",factory:function D5(){return!0}});let Tc=(()=>{class r{constructor(t,a,l){this._sanityChecks=a,this._document=l,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!Zt()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return r.\u0275fac=function(t){return new(t||r)(he(hV),he(O5,8),he(_n))},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[gl],gl]}),r})();function t3(r){return class extends r{constructor(...e){super(...e),this._disabled=!1}get disabled(){return this._disabled}set disabled(e){this._disabled=vl(e)}}}function h2(r,e){return class extends r{constructor(...t){super(...t),this.defaultColor=e,this.color=e}get color(){return this._color}set color(t){const a=t||this.defaultColor;a!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),a&&this._elementRef.nativeElement.classList.add(`mat-${a}`),this._color=a)}}}function n3(r){return class extends r{constructor(...e){super(...e),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=vl(e)}}}function N5(r,e=0){return class extends r{constructor(...t){super(...t),this._tabIndex=e,this.defaultTabIndex=e}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(t){this._tabIndex=null!=t?jO(t):this.defaultTabIndex}}}function P5(r){return class extends r{constructor(...e){super(...e),this.stateChanges=new hn,this.errorState=!1}updateErrorState(){const e=this.errorState,u=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);u!==e&&(this.errorState=u,this.stateChanges.next())}}}let r3=(()=>{class r{isErrorState(t,a){return!!(t&&t.invalid&&(t.touched||a&&a.submitted))}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class M5{constructor(e,t,a){this._renderer=e,this.element=t,this.config=a,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const o3={enterDuration:225,exitDuration:150},p2=Tm({passive:!0}),s3=["mousedown","touchstart"],a3=["mouseup","mouseleave","touchend","touchcancel"];class x5{constructor(e,t,a,l){this._target=e,this._ngZone=t,this._isPointerDown=!1,this._activeRipples=new Set,this._pointerUpEventsRegistered=!1,l.isBrowser&&(this._containerElement=kd(a))}fadeInRipple(e,t,a={}){const l=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),u=Object.assign(Object.assign({},o3),a.animation);a.centered&&(e=l.left+l.width/2,t=l.top+l.height/2);const f=a.radius||function U5(r,e,t){const a=Math.max(Math.abs(r-t.left),Math.abs(r-t.right)),l=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(a*a+l*l)}(e,t,l),g=e-l.left,y=t-l.top,R=u.enterDuration,D=document.createElement("div");D.classList.add("mat-ripple-element"),D.style.left=g-f+"px",D.style.top=y-f+"px",D.style.height=2*f+"px",D.style.width=2*f+"px",null!=a.color&&(D.style.backgroundColor=a.color),D.style.transitionDuration=`${R}ms`,this._containerElement.appendChild(D),function F5(r){window.getComputedStyle(r).getPropertyValue("opacity")}(D),D.style.transform="scale(1)";const x=new M5(this,D,a);return x.state=0,this._activeRipples.add(x),a.persistent||(this._mostRecentTransientRipple=x),this._runTimeoutOutsideZone(()=>{const j=x===this._mostRecentTransientRipple;x.state=1,!a.persistent&&(!j||!this._isPointerDown)&&x.fadeOut()},R),x}fadeOutRipple(e){const t=this._activeRipples.delete(e);if(e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),!t)return;const a=e.element,l=Object.assign(Object.assign({},o3),e.config.animation);a.style.transitionDuration=`${l.exitDuration}ms`,a.style.opacity="0",e.state=2,this._runTimeoutOutsideZone(()=>{e.state=3,a.remove()},l.exitDuration)}fadeOutAll(){this._activeRipples.forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._activeRipples.forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=kd(e);!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,this._registerEvents(s3))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(a3),this._pointerUpEventsRegistered=!0)}_onMousedown(e){const t=aV(e),a=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!a&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!cV(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let a=0;a<t.length;a++)this.fadeInRipple(t[a].clientX,t[a].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._activeRipples.forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_runTimeoutOutsideZone(e,t=0){this._ngZone.runOutsideAngular(()=>setTimeout(e,t))}_registerEvents(e){this._ngZone.runOutsideAngular(()=>{e.forEach(t=>{this._triggerElement.addEventListener(t,this,p2)})})}_removeTriggerEvents(){this._triggerElement&&(s3.forEach(e=>{this._triggerElement.removeEventListener(e,this,p2)}),this._pointerUpEventsRegistered&&a3.forEach(e=>{this._triggerElement.removeEventListener(e,this,p2)}))}}const V5=new Le("mat-ripple-global-options");let f2=(()=>{class r{constructor(t,a,l,u,f){this._elementRef=t,this._animationMode=f,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=u||{},this._rippleRenderer=new x5(this,a,t,l)}get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign(Object.assign(Object.assign({},this._globalOptions.animation),"NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,a=0,l){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,a,Object.assign(Object.assign({},this.rippleConfig),l)):this._rippleRenderer.fadeInRipple(0,0,Object.assign(Object.assign({},this.rippleConfig),t))}}return r.\u0275fac=function(t){return new(t||r)(oe(Rn),oe(yt),oe(Tr),oe(V5,8),oe(Bh,8))},r.\u0275dir=je({type:r,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(t,a){2&t&&vn("mat-ripple-unbounded",a.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),r})(),c3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[Tc],Tc]}),r})();const B5=["mat-button",""],j5=["*"],G5=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],W5=h2(t3(n3(class{constructor(r){this._elementRef=r}})));let z5=(()=>{class r extends W5{constructor(t,a,l){super(t),this._focusMonitor=a,this._animationMode=l,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const u of G5)this._hasHostAttributes(u)&&this._getHostElement().classList.add(u);t.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t,a){t?this._focusMonitor.focusVia(this._getHostElement(),t,a):this._getHostElement().focus(a)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...t){return t.some(a=>this._getHostElement().hasAttribute(a))}}return r.\u0275fac=function(t){return new(t||r)(oe(Rn),oe(xx),oe(Bh,8))},r.\u0275cmp=Er({type:r,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(t,a){if(1&t&&yi(f2,5),2&t){let l;Fi(l=Ii())&&(a.ripple=l.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(t,a){2&t&&(rr("disabled",a.disabled||null),vn("_mat-animation-noopable","NoopAnimations"===a._animationMode)("mat-button-disabled",a.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[Mt],attrs:B5,ngContentSelectors:j5,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(t,a){1&t&&($p(),Ae(0,"span",0),co(1),Be(),At(2,"span",1)(3,"span",2)),2&t&&(Je(2),vn("mat-button-ripple-round",a.isRoundButton||a.isIconButton),ot("matRippleDisabled",a._isRippleDisabled())("matRippleCentered",a.isIconButton)("matRippleTrigger",a._getHostElement()))},directives:[f2],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}.cdk-high-contrast-active .mat-button-base.cdk-keyboard-focused,.cdk-high-contrast-active .mat-button-base.cdk-program-focused{outline:solid 3px}\n"],encapsulation:2,changeDetection:0}),r})(),K5=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[c3,Tc],Tc]}),r})();function m2(r,e,t,a){return L(t)&&(a=t,t=void 0),a?m2(r,e,t).pipe(on(l=>pr(l)?a(...l):a(l))):new Cn(l=>{l3(r,e,function u(f){l.next(arguments.length>1?Array.prototype.slice.call(arguments):f)},l,t)})}function l3(r,e,t,a,l){let u;if(function $5(r){return r&&"function"==typeof r.addEventListener&&"function"==typeof r.removeEventListener}(r)){const f=r;r.addEventListener(e,t,l),u=()=>f.removeEventListener(e,t,l)}else if(function Y5(r){return r&&"function"==typeof r.on&&"function"==typeof r.off}(r)){const f=r;r.on(e,t),u=()=>f.off(e,t)}else if(function q5(r){return r&&"function"==typeof r.addListener&&"function"==typeof r.removeListener}(r)){const f=r;r.addListener(e,t),u=()=>f.removeListener(e,t)}else{if(!r||!r.length)throw new TypeError("Invalid event target");for(let f=0,g=r.length;f<g;f++)l3(r[f],e,t,a,l)}a.add(u)}function uN(...r){return function X5(){return Dc(1)}()(ut(...r))}function JT(...r){const e=r[r.length-1];return Il(e)?(r.pop(),t=>uN(r,t,e)):t=>uN(r,t)}const d3=(()=>{function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return r.prototype=Object.create(Error.prototype),r})(),Pm=new Cn(r=>r.complete());function hN(r){return r?function J5(r){return new Cn(e=>r.schedule(()=>e.complete()))}(r):Pm}function Go(r){return e=>0===r?hN():e.lift(new Q5(r))}class Q5{constructor(e){if(this.total=e,this.total<0)throw new d3}call(e,t){return t.subscribe(new Z5(e,this.total))}}class Z5 extends Dn{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,a=++this.count;a<=t&&(this.destination.next(e),a===t&&(this.destination.complete(),this.unsubscribe()))}}const e6=["connectionContainer"],t6=["inputContainer"],n6=["label"];function i6(r,e){1&r&&(ed(0),Ae(1,"div",14),At(2,"div",15)(3,"div",16)(4,"div",17),Be(),Ae(5,"div",18),At(6,"div",15)(7,"div",16)(8,"div",17),Be(),td())}function r6(r,e){if(1&r){const t=ca();Ae(0,"div",19),zt("cdkObserveContent",function(){return es(t),Xt().updateOutlineGap()}),co(1,1),Be()}2&r&&ot("cdkObserveContentDisabled","outline"!=Xt().appearance)}function o6(r,e){if(1&r&&(ed(0),co(1,2),Ae(2,"span"),Yi(3),Be(),td()),2&r){const t=Xt(2);Je(3),Yc(t._control.placeholder)}}function s6(r,e){1&r&&co(0,3,["*ngSwitchCase","true"])}function a6(r,e){1&r&&(Ae(0,"span",23),Yi(1," *"),Be())}function c6(r,e){if(1&r){const t=ca();Ae(0,"label",20,21),zt("cdkObserveContent",function(){return es(t),Xt().updateOutlineGap()}),jn(2,o6,4,1,"ng-container",12),jn(3,s6,1,0,"ng-content",12),jn(4,a6,2,0,"span",22),Be()}if(2&r){const t=Xt();vn("mat-empty",t._control.empty&&!t._shouldAlwaysFloat())("mat-form-field-empty",t._control.empty&&!t._shouldAlwaysFloat())("mat-accent","accent"==t.color)("mat-warn","warn"==t.color),ot("cdkObserveContentDisabled","outline"!=t.appearance)("id",t._labelId)("ngSwitch",t._hasLabel()),rr("for",t._control.id)("aria-owns",t._control.id),Je(2),ot("ngSwitchCase",!1),Je(1),ot("ngSwitchCase",!0),Je(1),ot("ngIf",!t.hideRequiredMarker&&t._control.required&&!t._control.disabled)}}function l6(r,e){1&r&&(Ae(0,"div",24),co(1,4),Be())}function d6(r,e){if(1&r&&(Ae(0,"div",25),At(1,"span",26),Be()),2&r){const t=Xt();Je(1),vn("mat-accent","accent"==t.color)("mat-warn","warn"==t.color)}}function u6(r,e){1&r&&(Ae(0,"div"),co(1,5),Be()),2&r&&ot("@transitionMessages",Xt()._subscriptAnimationState)}function h6(r,e){if(1&r&&(Ae(0,"div",30),Yi(1),Be()),2&r){const t=Xt(2);ot("id",t._hintLabelId),Je(1),Yc(t.hintLabel)}}function p6(r,e){if(1&r&&(Ae(0,"div",27),jn(1,h6,2,2,"div",28),co(2,6),At(3,"div",29),co(4,7),Be()),2&r){const t=Xt();ot("@transitionMessages",t._subscriptAnimationState),Je(1),ot("ngIf",t.hintLabel)}}const f6=["*",[["","matPrefix",""]],[["mat-placeholder"]],[["mat-label"]],[["","matSuffix",""]],[["mat-error"]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],m6=["*","[matPrefix]","mat-placeholder","mat-label","[matSuffix]","mat-error","mat-hint:not([align='end'])","mat-hint[align='end']"],_6=new Le("MatError"),g6={transitionMessages:Ux("transitionMessages",[Vx("enter",Ss({opacity:1,transform:"translateY(0%)"})),KT("void => enter",[Ss({opacity:0,transform:"translateY(-5px)"}),zT("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let _2=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=je({type:r}),r})();const E6=new Le("MatHint");let g2=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=je({type:r,selectors:[["mat-label"]]}),r})(),v6=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275dir=je({type:r,selectors:[["mat-placeholder"]]}),r})();const y6=new Le("MatPrefix"),S6=new Le("MatSuffix");let u3=0;const b6=h2(class{constructor(r){this._elementRef=r}},"primary"),T6=new Le("MAT_FORM_FIELD_DEFAULT_OPTIONS"),p3=new Le("MatFormField");let R6=(()=>{class r extends b6{constructor(t,a,l,u,f,g,y){super(t),this._changeDetectorRef=a,this._dir=l,this._defaults=u,this._platform=f,this._ngZone=g,this._outlineGapCalculationNeededImmediately=!1,this._outlineGapCalculationNeededOnStable=!1,this._destroyed=new hn,this._showAlwaysAnimate=!1,this._subscriptAnimationState="",this._hintLabel="",this._hintLabelId="mat-hint-"+u3++,this._labelId="mat-form-field-label-"+u3++,this.floatLabel=this._getDefaultFloatLabelState(),this._animationsEnabled="NoopAnimations"!==y,this.appearance=u&&u.appearance?u.appearance:"legacy",this._hideRequiredMarker=!(!u||null==u.hideRequiredMarker)&&u.hideRequiredMarker}get appearance(){return this._appearance}set appearance(t){const a=this._appearance;this._appearance=t||this._defaults&&this._defaults.appearance||"legacy","outline"===this._appearance&&a!==t&&(this._outlineGapCalculationNeededOnStable=!0)}get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=vl(t)}_shouldAlwaysFloat(){return"always"===this.floatLabel&&!this._showAlwaysAnimate}_canLabelFloat(){return"never"!==this.floatLabel}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get floatLabel(){return"legacy"!==this.appearance&&"never"===this._floatLabel?"auto":this._floatLabel}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t||this._getDefaultFloatLabelState(),this._changeDetectorRef.markForCheck())}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(t){this._explicitFormFieldControl=t}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}ngAfterContentInit(){this._validateControlChild();const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`mat-form-field-type-${t.controlType}`),t.stateChanges.pipe(JT(null)).subscribe(()=>{this._validatePlaceholders(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(ys(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(ys(this._destroyed)).subscribe(()=>{this._outlineGapCalculationNeededOnStable&&this.updateOutlineGap()})}),$v(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._outlineGapCalculationNeededOnStable=!0,this._changeDetectorRef.markForCheck()}),this._hintChildren.changes.pipe(JT(null)).subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.pipe(JT(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._dir&&this._dir.change.pipe(ys(this._destroyed)).subscribe(()=>{"function"==typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this.updateOutlineGap())}):this.updateOutlineGap()})}ngAfterContentChecked(){this._validateControlChild(),this._outlineGapCalculationNeededImmediately&&this.updateOutlineGap()}ngAfterViewInit(){this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(t){const a=this._control?this._control.ngControl:null;return a&&a[t]}_hasPlaceholder(){return!!(this._control&&this._control.placeholder||this._placeholderChild)}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_shouldLabelFloat(){return this._canLabelFloat()&&(this._control&&this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_hideControlPlaceholder(){return"legacy"===this.appearance&&!this._hasLabel()||this._hasLabel()&&!this._shouldLabelFloat()}_hasFloatingLabel(){return this._hasLabel()||"legacy"===this.appearance&&this._hasPlaceholder()}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_animateAndLockLabel(){this._hasFloatingLabel()&&this._canLabelFloat()&&(this._animationsEnabled&&this._label&&(this._showAlwaysAnimate=!0,m2(this._label.nativeElement,"transitionend").pipe(Go(1)).subscribe(()=>{this._showAlwaysAnimate=!1})),this.floatLabel="always",this._changeDetectorRef.markForCheck())}_validatePlaceholders(){}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_getDefaultFloatLabelState(){return this._defaults&&this._defaults.floatLabel||"auto"}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const a=this._hintChildren?this._hintChildren.find(u=>"start"===u.align):null,l=this._hintChildren?this._hintChildren.find(u=>"end"===u.align):null;a?t.push(a.id):this._hintLabel&&t.push(this._hintLabelId),l&&t.push(l.id)}else this._errorChildren&&t.push(...this._errorChildren.map(a=>a.id));this._control.setDescribedByIds(t)}}_validateControlChild(){}updateOutlineGap(){const t=this._label?this._label.nativeElement:null,a=this._connectionContainerRef.nativeElement,l=".mat-form-field-outline-start",u=".mat-form-field-outline-gap";if("outline"!==this.appearance||!this._platform.isBrowser)return;if(!t||!t.children.length||!t.textContent.trim()){const D=a.querySelectorAll(`${l}, ${u}`);for(let x=0;x<D.length;x++)D[x].style.width="0";return}if(!this._isAttachedToDOM())return void(this._outlineGapCalculationNeededImmediately=!0);let f=0,g=0;const y=a.querySelectorAll(l),R=a.querySelectorAll(u);if(this._label&&this._label.nativeElement.children.length){const D=a.getBoundingClientRect();if(0===D.width&&0===D.height)return this._outlineGapCalculationNeededOnStable=!0,void(this._outlineGapCalculationNeededImmediately=!1);const x=this._getStartEnd(D),j=t.children,G=this._getStartEnd(j[0].getBoundingClientRect());let q=0;for(let se=0;se<j.length;se++)q+=j[se].offsetWidth;f=Math.abs(G-x)-5,g=q>0?.75*q+10:0}for(let D=0;D<y.length;D++)y[D].style.width=`${f}px`;for(let D=0;D<R.length;D++)R[D].style.width=`${g}px`;this._outlineGapCalculationNeededOnStable=this._outlineGapCalculationNeededImmediately=!1}_getStartEnd(t){return this._dir&&"rtl"===this._dir.value?t.right:t.left}_isAttachedToDOM(){const t=this._elementRef.nativeElement;if(t.getRootNode){const a=t.getRootNode();return a&&a!==t}return document.documentElement.contains(t)}}return r.\u0275fac=function(t){return new(t||r)(oe(Rn),oe(Fo),oe(Tv,8),oe(T6,8),oe(Tr),oe(yt),oe(Bh,8))},r.\u0275cmp=Er({type:r,selectors:[["mat-form-field"]],contentQueries:function(t,a,l){if(1&t&&(Hn(l,_2,5),Hn(l,_2,7),Hn(l,g2,5),Hn(l,g2,7),Hn(l,v6,5),Hn(l,_6,5),Hn(l,E6,5),Hn(l,y6,5),Hn(l,S6,5)),2&t){let u;Fi(u=Ii())&&(a._controlNonStatic=u.first),Fi(u=Ii())&&(a._controlStatic=u.first),Fi(u=Ii())&&(a._labelChildNonStatic=u.first),Fi(u=Ii())&&(a._labelChildStatic=u.first),Fi(u=Ii())&&(a._placeholderChild=u.first),Fi(u=Ii())&&(a._errorChildren=u),Fi(u=Ii())&&(a._hintChildren=u),Fi(u=Ii())&&(a._prefixChildren=u),Fi(u=Ii())&&(a._suffixChildren=u)}},viewQuery:function(t,a){if(1&t&&(yi(e6,7),yi(t6,5),yi(n6,5)),2&t){let l;Fi(l=Ii())&&(a._connectionContainerRef=l.first),Fi(l=Ii())&&(a._inputContainerRef=l.first),Fi(l=Ii())&&(a._label=l.first)}},hostAttrs:[1,"mat-form-field"],hostVars:40,hostBindings:function(t,a){2&t&&vn("mat-form-field-appearance-standard","standard"==a.appearance)("mat-form-field-appearance-fill","fill"==a.appearance)("mat-form-field-appearance-outline","outline"==a.appearance)("mat-form-field-appearance-legacy","legacy"==a.appearance)("mat-form-field-invalid",a._control.errorState)("mat-form-field-can-float",a._canLabelFloat())("mat-form-field-should-float",a._shouldLabelFloat())("mat-form-field-has-label",a._hasFloatingLabel())("mat-form-field-hide-placeholder",a._hideControlPlaceholder())("mat-form-field-disabled",a._control.disabled)("mat-form-field-autofilled",a._control.autofilled)("mat-focused",a._control.focused)("ng-untouched",a._shouldForward("untouched"))("ng-touched",a._shouldForward("touched"))("ng-pristine",a._shouldForward("pristine"))("ng-dirty",a._shouldForward("dirty"))("ng-valid",a._shouldForward("valid"))("ng-invalid",a._shouldForward("invalid"))("ng-pending",a._shouldForward("pending"))("_mat-animation-noopable",!a._animationsEnabled)},inputs:{color:"color",appearance:"appearance",hideRequiredMarker:"hideRequiredMarker",hintLabel:"hintLabel",floatLabel:"floatLabel"},exportAs:["matFormField"],features:[xn([{provide:p3,useExisting:r}]),Mt],ngContentSelectors:m6,decls:15,vars:8,consts:[[1,"mat-form-field-wrapper"],[1,"mat-form-field-flex",3,"click"],["connectionContainer",""],[4,"ngIf"],["class","mat-form-field-prefix",3,"cdkObserveContentDisabled","cdkObserveContent",4,"ngIf"],[1,"mat-form-field-infix"],["inputContainer",""],[1,"mat-form-field-label-wrapper"],["class","mat-form-field-label",3,"cdkObserveContentDisabled","id","mat-empty","mat-form-field-empty","mat-accent","mat-warn","ngSwitch","cdkObserveContent",4,"ngIf"],["class","mat-form-field-suffix",4,"ngIf"],["class","mat-form-field-underline",4,"ngIf"],[1,"mat-form-field-subscript-wrapper",3,"ngSwitch"],[4,"ngSwitchCase"],["class","mat-form-field-hint-wrapper",4,"ngSwitchCase"],[1,"mat-form-field-outline"],[1,"mat-form-field-outline-start"],[1,"mat-form-field-outline-gap"],[1,"mat-form-field-outline-end"],[1,"mat-form-field-outline","mat-form-field-outline-thick"],[1,"mat-form-field-prefix",3,"cdkObserveContentDisabled","cdkObserveContent"],[1,"mat-form-field-label",3,"cdkObserveContentDisabled","id","ngSwitch","cdkObserveContent"],["label",""],["class","mat-placeholder-required mat-form-field-required-marker","aria-hidden","true",4,"ngIf"],["aria-hidden","true",1,"mat-placeholder-required","mat-form-field-required-marker"],[1,"mat-form-field-suffix"],[1,"mat-form-field-underline"],[1,"mat-form-field-ripple"],[1,"mat-form-field-hint-wrapper"],["class","mat-hint",3,"id",4,"ngIf"],[1,"mat-form-field-hint-spacer"],[1,"mat-hint",3,"id"]],template:function(t,a){1&t&&($p(f6),Ae(0,"div",0)(1,"div",1,2),zt("click",function(u){return a._control.onContainerClick&&a._control.onContainerClick(u)}),jn(3,i6,9,0,"ng-container",3),jn(4,r6,2,1,"div",4),Ae(5,"div",5,6),co(7),Ae(8,"span",7),jn(9,c6,5,16,"label",8),Be()(),jn(10,l6,2,0,"div",9),Be(),jn(11,d6,2,4,"div",10),Ae(12,"div",11),jn(13,u6,2,1,"div",12),jn(14,p6,5,2,"div",13),Be()()),2&t&&(Je(3),ot("ngIf","outline"==a.appearance),Je(1),ot("ngIf",a._prefixChildren.length),Je(5),ot("ngIf",a._hasFloatingLabel()),Je(1),ot("ngIf",a._suffixChildren.length),Je(1),ot("ngIf","outline"!=a.appearance),Je(1),ot("ngSwitch",a._getDisplayedMessages()),Je(1),ot("ngSwitchCase","error"),Je(1),ot("ngSwitchCase","hint"))},directives:[al,tV,ul,MD],styles:[".mat-form-field{display:inline-block;position:relative;text-align:left}[dir=rtl] .mat-form-field{text-align:right}.mat-form-field-wrapper{position:relative}.mat-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-form-field-prefix,.mat-form-field-suffix{white-space:nowrap;flex:none;position:relative}.mat-form-field-infix{display:block;position:relative;flex:auto;min-width:0;width:180px}.cdk-high-contrast-active .mat-form-field-infix{border-image:linear-gradient(transparent, transparent)}.mat-form-field-label-wrapper{position:absolute;left:0;box-sizing:content-box;width:100%;height:100%;overflow:hidden;pointer-events:none}[dir=rtl] .mat-form-field-label-wrapper{left:auto;right:0}.mat-form-field-label{position:absolute;left:0;font:inherit;pointer-events:none;width:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),width 400ms cubic-bezier(0.25, 0.8, 0.25, 1);display:none}[dir=rtl] .mat-form-field-label{transform-origin:100% 0;left:auto;right:0}.cdk-high-contrast-active .mat-form-field-disabled .mat-form-field-label{color:GrayText}.mat-form-field-empty.mat-form-field-label,.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{display:block}.mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:block;transition:none}.mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-form-field-can-float .mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:block}.mat-form-field-label:not(.mat-form-field-empty){transition:none}.mat-form-field-underline{position:absolute;width:100%;pointer-events:none;transform:scale3d(1, 1.0001, 1)}.mat-form-field-ripple{position:absolute;left:0;width:100%;transform-origin:50%;transform:scaleX(0.5);opacity:0;transition:background-color 300ms cubic-bezier(0.55, 0, 0.55, 0.2)}.mat-form-field.mat-focused .mat-form-field-ripple,.mat-form-field.mat-form-field-invalid .mat-form-field-ripple{opacity:1;transform:none;transition:transform 300ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 300ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-subscript-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.mat-form-field-subscript-wrapper .mat-icon,.mat-form-field-label-wrapper .mat-icon{width:1em;height:1em;font-size:inherit;vertical-align:baseline}.mat-form-field-hint-wrapper{display:flex}.mat-form-field-hint-spacer{flex:1 0 1em}.mat-error{display:block}.mat-form-field-control-wrapper{position:relative}.mat-form-field-hint-end{order:1}.mat-form-field._mat-animation-noopable .mat-form-field-label,.mat-form-field._mat-animation-noopable .mat-form-field-ripple{transition:none}\n",'.mat-form-field-appearance-fill .mat-form-field-flex{border-radius:4px 4px 0 0;padding:.75em .75em 0 .75em}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-flex{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-form-field-flex{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-form-field-flex{outline:dashed 3px}.mat-form-field-appearance-fill .mat-form-field-underline::before{content:"";display:block;position:absolute;bottom:0;height:1px;width:100%}.mat-form-field-appearance-fill .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-ripple{height:0}.mat-form-field-appearance-fill:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-fill._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}.mat-form-field-appearance-fill .mat-form-field-subscript-wrapper{padding:0 1em}\n','.mat-input-element{font:inherit;background:transparent;color:currentColor;border:none;outline:none;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit;box-sizing:content-box}.mat-input-element:-moz-ui-invalid{box-shadow:none}.mat-input-element,.mat-input-element::-webkit-search-cancel-button,.mat-input-element::-webkit-search-decoration,.mat-input-element::-webkit-search-results-button,.mat-input-element::-webkit-search-results-decoration{-webkit-appearance:none}.mat-input-element::-webkit-contacts-auto-fill-button,.mat-input-element::-webkit-caps-lock-indicator,.mat-input-element:not([type=password])::-webkit-credentials-auto-fill-button{visibility:hidden}.mat-input-element[type=date],.mat-input-element[type=datetime],.mat-input-element[type=datetime-local],.mat-input-element[type=month],.mat-input-element[type=week],.mat-input-element[type=time]{line-height:1}.mat-input-element[type=date]::after,.mat-input-element[type=datetime]::after,.mat-input-element[type=datetime-local]::after,.mat-input-element[type=month]::after,.mat-input-element[type=week]::after,.mat-input-element[type=time]::after{content:" ";white-space:pre;width:1px}.mat-input-element::-webkit-inner-spin-button,.mat-input-element::-webkit-calendar-picker-indicator,.mat-input-element::-webkit-clear-button{font-size:.75em}.mat-input-element::placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-moz-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-webkit-input-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element:-ms-input-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-hide-placeholder .mat-input-element::placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{color:transparent !important;-webkit-text-fill-color:transparent;transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{opacity:0}textarea.mat-input-element{resize:vertical;overflow:auto}textarea.mat-input-element.cdk-textarea-autosize{resize:none}textarea.mat-input-element{padding:2px 0;margin:-2px 0}select.mat-input-element{-moz-appearance:none;-webkit-appearance:none;position:relative;background-color:transparent;display:inline-flex;box-sizing:border-box;padding-top:1em;top:-1em;margin-bottom:-1em}select.mat-input-element::-moz-focus-inner{border:0}select.mat-input-element:not(:disabled){cursor:pointer}.mat-form-field-type-mat-native-select .mat-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;position:absolute;top:50%;right:0;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-form-field-type-mat-native-select .mat-form-field-infix::after{right:auto;left:0}.mat-form-field-type-mat-native-select .mat-input-element{padding-right:15px}[dir=rtl] .mat-form-field-type-mat-native-select .mat-input-element{padding-right:0;padding-left:15px}.mat-form-field-type-mat-native-select .mat-form-field-label-wrapper{max-width:calc(100% - 10px)}.mat-form-field-type-mat-native-select.mat-form-field-appearance-outline .mat-form-field-infix::after{margin-top:-5px}.mat-form-field-type-mat-native-select.mat-form-field-appearance-fill .mat-form-field-infix::after{margin-top:-10px}\n',".mat-form-field-appearance-legacy .mat-form-field-label{transform:perspective(100px)}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon{width:1em}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button{font:inherit;vertical-align:baseline}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button .mat-icon{font-size:inherit}.mat-form-field-appearance-legacy .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-legacy .mat-form-field-ripple{top:0;height:2px;overflow:hidden}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}.cdk-high-contrast-active .mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px;border-top-color:GrayText}.mat-form-field-appearance-legacy.mat-form-field-invalid:not(.mat-focused) .mat-form-field-ripple{height:1px}\n",".mat-form-field-appearance-outline .mat-form-field-wrapper{margin:.25em 0}.mat-form-field-appearance-outline .mat-form-field-flex{padding:0 .75em 0 .75em;margin-top:-0.25em;position:relative}.mat-form-field-appearance-outline .mat-form-field-prefix,.mat-form-field-appearance-outline .mat-form-field-suffix{top:.25em}.mat-form-field-appearance-outline .mat-form-field-outline{display:flex;position:absolute;top:.25em;left:0;right:0;bottom:0;pointer-events:none}.mat-form-field-appearance-outline .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-end{border:1px solid currentColor;min-width:5px}.mat-form-field-appearance-outline .mat-form-field-outline-start{border-radius:5px 0 0 5px;border-right-style:none}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-start{border-right-style:solid;border-left-style:none;border-radius:0 5px 5px 0}.mat-form-field-appearance-outline .mat-form-field-outline-end{border-radius:0 5px 5px 0;border-left-style:none;flex-grow:1}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-end{border-left-style:solid;border-right-style:none;border-radius:5px 0 0 5px}.mat-form-field-appearance-outline .mat-form-field-outline-gap{border-radius:.000001px;border:1px solid currentColor;border-left-style:none;border-right-style:none}.mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-outline-gap{border-top-color:transparent}.mat-form-field-appearance-outline .mat-form-field-outline-thick{opacity:0}.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-end,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-gap{border-width:2px}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline{opacity:0;transition:opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline-thick{opacity:1}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick{border:3px dashed}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline{opacity:0;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline-thick{opacity:1}.mat-form-field-appearance-outline .mat-form-field-subscript-wrapper{padding:0 1em}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-form-field-disabled .mat-form-field-outline{color:GrayText}.mat-form-field-appearance-outline._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-start,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-end,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-gap{transition:none}\n",".mat-form-field-appearance-standard .mat-form-field-flex{padding-top:.75em}.mat-form-field-appearance-standard .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-standard .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}.cdk-high-contrast-active .mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-standard:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-standard._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}\n"],encapsulation:2,data:{animation:[g6.transitionMessages]},changeDetection:0}),r})(),f3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[Qf,Tc,Mx],Tc]}),r})();const m3=Tm({passive:!0});let I6=(()=>{class r{constructor(t,a){this._platform=t,this._ngZone=a,this._monitoredElements=new Map}monitor(t){if(!this._platform.isBrowser)return Pm;const a=kd(t),l=this._monitoredElements.get(a);if(l)return l.subject;const u=new hn,f="cdk-text-field-autofilled",g=y=>{"cdk-text-field-autofill-start"!==y.animationName||a.classList.contains(f)?"cdk-text-field-autofill-end"===y.animationName&&a.classList.contains(f)&&(a.classList.remove(f),this._ngZone.run(()=>u.next({target:y.target,isAutofilled:!1}))):(a.classList.add(f),this._ngZone.run(()=>u.next({target:y.target,isAutofilled:!0})))};return this._ngZone.runOutsideAngular(()=>{a.addEventListener("animationstart",g,m3),a.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(a,{subject:u,unlisten:()=>{a.removeEventListener("animationstart",g,m3)}}),u}stopMonitoring(t){const a=kd(t),l=this._monitoredElements.get(a);l&&(l.unlisten(),l.subject.complete(),a.classList.remove("cdk-text-field-autofill-monitored"),a.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(a))}ngOnDestroy(){this._monitoredElements.forEach((t,a)=>this.stopMonitoring(a))}}return r.\u0275fac=function(t){return new(t||r)(he(Tr),he(yt))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),_3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})();const w6=new Le("MAT_INPUT_VALUE_ACCESSOR"),A6=["button","checkbox","file","hidden","image","radio","range","reset","submit"];let D6=0;const O6=P5(class{constructor(r,e,t,a){this._defaultErrorStateMatcher=r,this._parentForm=e,this._parentFormGroup=t,this.ngControl=a}});let N6=(()=>{class r extends O6{constructor(t,a,l,u,f,g,y,R,D,x){super(g,u,f,l),this._elementRef=t,this._platform=a,this._autofillMonitor=R,this._formField=x,this._uid="mat-input-"+D6++,this.focused=!1,this.stateChanges=new hn,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(q=>LO().has(q)),this._iOSKeyupListener=q=>{const se=q.target;!se.value&&0===se.selectionStart&&0===se.selectionEnd&&(se.setSelectionRange(1,1),se.setSelectionRange(0,0))};const j=this._elementRef.nativeElement,G=j.nodeName.toLowerCase();this._inputValueAccessor=y||j,this._previousNativeValue=this.value,this.id=this.id,a.IOS&&D.runOutsideAngular(()=>{t.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._isServer=!this._platform.isBrowser,this._isNativeSelect="select"===G,this._isTextarea="textarea"===G,this._isInFormField=!!x,this._isNativeSelect&&(this.controlType=j.multiple?"mat-native-select-multiple":"mat-native-select")}get disabled(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled}set disabled(t){this._disabled=vl(t),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(t){this._id=t||this._uid}get required(){var t,a,l,u;return null!==(u=null!==(t=this._required)&&void 0!==t?t:null===(l=null===(a=this.ngControl)||void 0===a?void 0:a.control)||void 0===l?void 0:l.hasValidator(bd.required))&&void 0!==u&&u}set required(t){this._required=vl(t)}get type(){return this._type}set type(t){this._type=t||"text",this._validateType(),!this._isTextarea&&LO().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get value(){return this._inputValueAccessor.value}set value(t){t!==this.value&&(this._inputValueAccessor.value=t,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(t){this._readonly=vl(t)}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(t=>{this.autofilled=t.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(t){this._elementRef.nativeElement.focus(t)}_focusChanged(t){t!==this.focused&&(this.focused=t,this.stateChanges.next())}_onInput(){}_dirtyCheckPlaceholder(){var t,a;const l=(null===(a=null===(t=this._formField)||void 0===t?void 0:t._hideControlPlaceholder)||void 0===a?void 0:a.call(t))?null:this.placeholder;if(l!==this._previousPlaceholder){const u=this._elementRef.nativeElement;this._previousPlaceholder=l,l?u.setAttribute("placeholder",l):u.removeAttribute("placeholder")}}_dirtyCheckNativeValue(){const t=this._elementRef.nativeElement.value;this._previousNativeValue!==t&&(this._previousNativeValue=t,this.stateChanges.next())}_validateType(){A6.indexOf(this._type)}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let t=this._elementRef.nativeElement.validity;return t&&t.badInput}get empty(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}get shouldLabelFloat(){if(this._isNativeSelect){const t=this._elementRef.nativeElement,a=t.options[0];return this.focused||t.multiple||!this.empty||!!(t.selectedIndex>-1&&a&&a.label)}return this.focused||!this.empty}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){const t=this._elementRef.nativeElement;return this._isNativeSelect&&(t.multiple||t.size>1)}}return r.\u0275fac=function(t){return new(t||r)(oe(Rn),oe(Tr),oe(ps,10),oe(vm,8),oe(Ph,8),oe(r3),oe(w6,10),oe(I6),oe(yt),oe(p3,8))},r.\u0275dir=je({type:r,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-input-element","mat-form-field-autofill-control"],hostVars:12,hostBindings:function(t,a){1&t&&zt("focus",function(){return a._focusChanged(!0)})("blur",function(){return a._focusChanged(!1)})("input",function(){return a._onInput()}),2&t&&(xg("disabled",a.disabled)("required",a.required),rr("id",a.id)("data-placeholder",a.placeholder)("name",a.name||null)("readonly",a.readonly&&!a._isNativeSelect||null)("aria-invalid",a.empty&&a.required?null:a.errorState)("aria-required",a.required),vn("mat-input-server",a._isServer)("mat-native-select-inline",a._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],features:[xn([{provide:_2,useExisting:r}]),Mt,li]}),r})(),P6=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({providers:[r3],imports:[[_3,f3,Tc],_3,f3]}),r})();const k6=["thumbContainer"],M6=["toggleBar"],L6=["input"],x6=function(r){return{enterDuration:r}},F6=["*"],U6=new Le("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1})});let V6=0;const B6={provide:hs,useExisting:Nn(()=>g3),multi:!0};class j6{constructor(e,t){this.source=e,this.checked=t}}const H6=N5(h2(n3(t3(class{constructor(r){this._elementRef=r}}))));let g3=(()=>{class r extends H6{constructor(t,a,l,u,f,g){super(t),this._focusMonitor=a,this._changeDetectorRef=l,this.defaults=f,this._onChange=y=>{},this._onTouched=()=>{},this._uniqueId="mat-slide-toggle-"+ ++V6,this._required=!1,this._checked=!1,this.name=null,this.id=this._uniqueId,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new Qt,this.toggleChange=new Qt,this.tabIndex=parseInt(u)||0,this.color=this.defaultColor=f.color||"accent",this._noopAnimations="NoopAnimations"===g}get required(){return this._required}set required(t){this._required=vl(t)}get checked(){return this._checked}set checked(t){this._checked=vl(t),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{t||Promise.resolve().then(()=>this._onTouched())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}_onChangeEvent(t){t.stopPropagation(),this.toggleChange.emit(),this.defaults.disableToggleValue?this._inputElement.nativeElement.checked=this.checked:(this.checked=this._inputElement.nativeElement.checked,this._emitChangeEvent())}_onInputClick(t){t.stopPropagation()}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}focus(t,a){a?this._focusMonitor.focusVia(this._inputElement,a,t):this._inputElement.nativeElement.focus(t)}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(new j6(this,this.checked))}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}}return r.\u0275fac=function(t){return new(t||r)(oe(Rn),oe(xx),oe(Fo),Lc("tabindex"),oe(U6),oe(Bh,8))},r.\u0275cmp=Er({type:r,selectors:[["mat-slide-toggle"]],viewQuery:function(t,a){if(1&t&&(yi(k6,5),yi(M6,5),yi(L6,5)),2&t){let l;Fi(l=Ii())&&(a._thumbEl=l.first),Fi(l=Ii())&&(a._thumbBarEl=l.first),Fi(l=Ii())&&(a._inputElement=l.first)}},hostAttrs:[1,"mat-slide-toggle"],hostVars:13,hostBindings:function(t,a){2&t&&(xg("id",a.id),rr("tabindex",null)("aria-label",null)("aria-labelledby",null)("name",null),vn("mat-checked",a.checked)("mat-disabled",a.disabled)("mat-slide-toggle-label-before","before"==a.labelPosition)("_mat-animation-noopable",a._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex",name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],required:"required",checked:"checked"},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],features:[xn([B6]),Mt],ngContentSelectors:F6,decls:16,vars:20,consts:[[1,"mat-slide-toggle-label"],["label",""],[1,"mat-slide-toggle-bar"],["toggleBar",""],["type","checkbox","role","switch",1,"mat-slide-toggle-input","cdk-visually-hidden",3,"id","required","tabIndex","checked","disabled","change","click"],["input",""],[1,"mat-slide-toggle-thumb-container"],["thumbContainer",""],[1,"mat-slide-toggle-thumb"],["mat-ripple","",1,"mat-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered","matRippleRadius","matRippleAnimation"],[1,"mat-ripple-element","mat-slide-toggle-persistent-ripple"],[1,"mat-slide-toggle-content",3,"cdkObserveContent"],["labelContent",""],[2,"display","none"]],template:function(t,a){if(1&t&&($p(),Ae(0,"label",0,1)(2,"span",2,3)(4,"input",4,5),zt("change",function(u){return a._onChangeEvent(u)})("click",function(u){return a._onInputClick(u)}),Be(),Ae(6,"span",6,7),At(8,"span",8),Ae(9,"span",9),At(10,"span",10),Be()()(),Ae(11,"span",11,12),zt("cdkObserveContent",function(){return a._onLabelTextChange()}),Ae(13,"span",13),Yi(14,"\xa0"),Be(),co(15),Be()()),2&t){const l=Bu(1),u=Bu(12);rr("for",a.inputId),Je(2),vn("mat-slide-toggle-bar-no-side-margin",!u.textContent||!u.textContent.trim()),Je(2),ot("id",a.inputId)("required",a.required)("tabIndex",a.tabIndex)("checked",a.checked)("disabled",a.disabled),rr("name",a.name)("aria-checked",a.checked)("aria-label",a.ariaLabel)("aria-labelledby",a.ariaLabelledby)("aria-describedby",a.ariaDescribedby),Je(5),ot("matRippleTrigger",l)("matRippleDisabled",a.disableRipple||a.disabled)("matRippleCentered",!0)("matRippleRadius",20)("matRippleAnimation",function pA(r,e,t,a){return gA(_e(),Gr(),r,e,t,a)}(18,x6,a._noopAnimations?0:150))}},directives:[f2,tV],styles:[".mat-slide-toggle{display:inline-block;height:24px;max-width:100%;line-height:24px;white-space:nowrap;outline:none;-webkit-tap-highlight-color:transparent}.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(16px, 0, 0)}[dir=rtl] .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(-16px, 0, 0)}.mat-slide-toggle.mat-disabled{opacity:.38}.mat-slide-toggle.mat-disabled .mat-slide-toggle-label,.mat-slide-toggle.mat-disabled .mat-slide-toggle-thumb-container{cursor:default}.mat-slide-toggle-label{-webkit-user-select:none;user-select:none;display:flex;flex:1;flex-direction:row;align-items:center;height:inherit;cursor:pointer}.mat-slide-toggle-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-slide-toggle-label-before .mat-slide-toggle-label{order:1}.mat-slide-toggle-label-before .mat-slide-toggle-bar{order:2}[dir=rtl] .mat-slide-toggle-label-before .mat-slide-toggle-bar,.mat-slide-toggle-bar{margin-right:8px;margin-left:0}[dir=rtl] .mat-slide-toggle-bar,.mat-slide-toggle-label-before .mat-slide-toggle-bar{margin-left:8px;margin-right:0}.mat-slide-toggle-bar-no-side-margin{margin-left:0;margin-right:0}.mat-slide-toggle-thumb-container{position:absolute;z-index:1;width:20px;height:20px;top:-3px;left:0;transform:translate3d(0, 0, 0);transition:all 80ms linear;transition-property:transform}._mat-animation-noopable .mat-slide-toggle-thumb-container{transition:none}[dir=rtl] .mat-slide-toggle-thumb-container{left:auto;right:0}.mat-slide-toggle-thumb{height:20px;width:20px;border-radius:50%;display:block}.mat-slide-toggle-bar{position:relative;width:36px;height:14px;flex-shrink:0;border-radius:8px}.mat-slide-toggle-input{bottom:0;left:10px}[dir=rtl] .mat-slide-toggle-input{left:auto;right:10px}.mat-slide-toggle-bar,.mat-slide-toggle-thumb{transition:all 80ms linear;transition-property:background-color;transition-delay:50ms}._mat-animation-noopable .mat-slide-toggle-bar,._mat-animation-noopable .mat-slide-toggle-thumb{transition:none}.mat-slide-toggle .mat-slide-toggle-ripple{position:absolute;top:calc(50% - 20px);left:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-slide-toggle .mat-slide-toggle-ripple .mat-ripple-element:not(.mat-slide-toggle-persistent-ripple){opacity:.12}.mat-slide-toggle-persistent-ripple{width:100%;height:100%;transform:none}.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:.04}.mat-slide-toggle:not(.mat-disabled).cdk-keyboard-focused .mat-slide-toggle-persistent-ripple{opacity:.12}.mat-slide-toggle-persistent-ripple,.mat-slide-toggle.mat-disabled .mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:0}@media(hover: none){.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{display:none}}.cdk-high-contrast-active .mat-slide-toggle-thumb,.cdk-high-contrast-active .mat-slide-toggle-bar{border:1px solid}.cdk-high-contrast-active .mat-slide-toggle.cdk-keyboard-focused .mat-slide-toggle-bar{outline:2px dotted;outline-offset:5px}\n"],encapsulation:2,changeDetection:0}),r})(),E3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})(),z6=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[E3,c3,Tc,Mx],E3,Tc]}),r})();new class q6 extends yl{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let a,l=-1,u=t.length;e=e||t.shift();do{if(a=e.execute(e.state,e.delay))break}while(++l<u&&(e=t.shift()));if(this.active=!1,a){for(;++l<u&&(e=t.shift());)e.unsubscribe();throw a}}}(class K6 extends kx{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,a=0){return null!==a&&a>0?super.requestAsyncId(e,t,a):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame(()=>e.flush(null))))}recycleAsyncId(e,t,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(e,t,a);0===e.actions.length&&(cancelAnimationFrame(t),e.scheduled=void 0)}});let $6=1;const X6=Promise.resolve(),pN={};function v3(r){return r in pN&&(delete pN[r],!0)}const y3={setImmediate(r){const e=$6++;return pN[e]=!0,X6.then(()=>v3(e)&&r()),e},clearImmediate(r){v3(r)}};new class Q6 extends yl{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let a,l=-1,u=t.length;e=e||t.shift();do{if(a=e.execute(e.state,e.delay))break}while(++l<u&&(e=t.shift()));if(this.active=!1,a){for(;++l<u&&(e=t.shift());)e.unsubscribe();throw a}}}(class J6 extends kx{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,a=0){return null!==a&&a>0?super.requestAsyncId(e,t,a):(e.actions.push(this),e.scheduled||(e.scheduled=y3.setImmediate(e.flush.bind(e,null))))}recycleAsyncId(e,t,a=0){if(null!==a&&a>0||null===a&&this.delay>0)return super.recycleAsyncId(e,t,a);0===e.actions.length&&(y3.clearImmediate(t),e.scheduled=void 0)}});class tH{constructor(e){this.durationSelector=e}call(e,t){return t.subscribe(new nH(e,this.durationSelector))}}class nH extends Jh{constructor(e,t){super(e),this.durationSelector=t,this.hasValue=!1}_next(e){if(this.value=e,this.hasValue=!0,!this.throttled){let t;try{const{durationSelector:l}=this;t=l(e)}catch(l){return this.destination.error(l)}const a=wl(t,new Hd(this));!a||a.closed?this.clearThrottle():this.add(this.throttled=a)}}clearThrottle(){const{value:e,hasValue:t,throttled:a}=this;a&&(this.remove(a),this.throttled=void 0,a.unsubscribe()),t&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}function E2(r){return!pr(r)&&r-parseFloat(r)+1>=0}function S3(r=0,e,t){let a=-1;return E2(e)?a=Number(e)<1?1:Number(e):Il(e)&&(t=e),Il(t)||(t=wv),new Cn(l=>{const u=E2(r)?r:+r-t.now();return t.schedule(iH,u,{index:0,period:a,subscriber:l})})}function iH(r){const{index:e,period:t,subscriber:a}=r;if(a.next(e),!a.closed){if(-1===t)return a.complete();r.index=e+1,this.schedule(r,t)}}function C3(r,e=wv){return function eH(r){return function(t){return t.lift(new tH(r))}}(()=>S3(r,e))}function jh(r,e){return function(a){return a.lift(new rH(r,e))}}class rH{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new oH(e,this.predicate,this.thisArg))}}class oH extends Dn{constructor(e,t,a){super(e),this.predicate=t,this.thisArg=a,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(a){return void this.destination.error(a)}t&&this.destination.next(e)}}let b3=(()=>{class r{constructor(t,a,l){this._ngZone=t,this._platform=a,this._scrolled=new hn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=l}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const a=this.scrollContainers.get(t);a&&(a.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new Cn(a=>{this._globalSubscription||this._addGlobalListener();const l=t>0?this._scrolled.pipe(C3(t)).subscribe(a):this._scrolled.subscribe(a);return this._scrolledCount++,()=>{l.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):ut()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,a)=>this.deregister(a)),this._scrolled.complete()}ancestorScrolled(t,a){const l=this.getAncestorScrollContainers(t);return this.scrolled(a).pipe(jh(u=>!u||l.indexOf(u)>-1))}getAncestorScrollContainers(t){const a=[];return this.scrollContainers.forEach((l,u)=>{this._scrollableContainsElement(u,t)&&a.push(u)}),a}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,a){let l=kd(a),u=t.getElementRef().nativeElement;do{if(l==u)return!0}while(l=l.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>m2(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return r.\u0275fac=function(t){return new(t||r)(he(yt),he(Tr),he(_n,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),T3=(()=>{class r{constructor(t,a,l){this._platform=t,this._change=new hn,this._changeListener=u=>{this._change.next(u)},this._document=l,a.runOutsideAngular(()=>{if(t.isBrowser){const u=this._getWindow();u.addEventListener("resize",this._changeListener),u.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:a,height:l}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+l,right:t.left+a,height:l,width:a}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,a=this._getWindow(),l=t.documentElement,u=l.getBoundingClientRect();return{top:-u.top||t.body.scrollTop||a.scrollY||l.scrollTop||0,left:-u.left||t.body.scrollLeft||a.scrollX||l.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(C3(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}}return r.\u0275fac=function(t){return new(t||r)(he(Tr),he(yt),he(_n,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),v2=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})(),R3=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[gl,v2],gl,v2]}),r})();class y2{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class I3 extends y2{constructor(e,t,a,l){super(),this.component=e,this.viewContainerRef=t,this.injector=a,this.componentFactoryResolver=l}}class cH extends y2{constructor(e,t,a){super(),this.templateRef=e,this.viewContainerRef=t,this.context=a}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class lH extends y2{constructor(e){super(),this.element=e instanceof Rn?e.nativeElement:e}}class uH extends class dH{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof I3?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof cH?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof lH?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}{constructor(e,t,a,l,u){super(),this.outletElement=e,this._componentFactoryResolver=t,this._appRef=a,this._defaultInjector=l,this.attachDomPortal=f=>{const g=f.element,y=this._document.createComment("dom-portal");g.parentNode.insertBefore(y,g),this.outletElement.appendChild(g),this._attachedPortal=f,super.setDisposeFn(()=>{y.parentNode&&y.parentNode.replaceChild(g,y)})},this._document=u}attachComponentPortal(e){const a=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let l;return e.viewContainerRef?(l=e.viewContainerRef.createComponent(a,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector),this.setDisposeFn(()=>l.destroy())):(l=a.create(e.injector||this._defaultInjector||ir.NULL),this._appRef.attachView(l.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(l.hostView),l.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(l)),this._attachedPortal=e,l}attachTemplatePortal(e){let t=e.viewContainerRef,a=t.createEmbeddedView(e.templateRef,e.context);return a.rootNodes.forEach(l=>this.outletElement.appendChild(l)),a.detectChanges(),this.setDisposeFn(()=>{let l=t.indexOf(a);-1!==l&&t.remove(l)}),this._attachedPortal=e,a}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let hH=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})();const w3=xO();class pH{constructor(e,t){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=hr(-this._previousScrollPosition.left),e.style.top=hr(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,a=e.style,l=this._document.body.style,u=a.scrollBehavior||"",f=l.scrollBehavior||"";this._isEnabled=!1,a.left=this._previousHTMLStyles.left,a.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),w3&&(a.scrollBehavior=l.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),w3&&(a.scrollBehavior=u,l.scrollBehavior=f)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,a=this._viewportRuler.getViewportSize();return t.scrollHeight>a.height||t.scrollWidth>a.width}}class fH{constructor(e,t,a,l){this._scrollDispatcher=e,this._ngZone=t,this._viewportRuler=a,this._config=l,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class A3{enable(){}disable(){}attach(){}}function S2(r,e){return e.some(t=>r.bottom<t.top||r.top>t.bottom||r.right<t.left||r.left>t.right)}function D3(r,e){return e.some(t=>r.top<t.top||r.bottom>t.bottom||r.left<t.left||r.right>t.right)}class mH{constructor(e,t,a,l){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=a,this._config=l,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:a,height:l}=this._viewportRuler.getViewportSize();S2(t,[{width:a,height:l,bottom:l,right:a,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let _H=(()=>{class r{constructor(t,a,l,u){this._scrollDispatcher=t,this._viewportRuler=a,this._ngZone=l,this.noop=()=>new A3,this.close=f=>new fH(this._scrollDispatcher,this._ngZone,this._viewportRuler,f),this.block=()=>new pH(this._viewportRuler,this._document),this.reposition=f=>new mH(this._scrollDispatcher,this._viewportRuler,this._ngZone,f),this._document=u}}return r.\u0275fac=function(t){return new(t||r)(he(b3),he(T3),he(yt),he(_n))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();class gH{constructor(e){if(this.scrollStrategy=new A3,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const t=Object.keys(e);for(const a of t)void 0!==e[a]&&(this[a]=e[a])}}}class EH{constructor(e,t){this.connectionPair=e,this.scrollableViewProperties=t}}class vH{constructor(e,t,a,l,u,f,g,y,R){this._portalOutlet=e,this._host=t,this._pane=a,this._config=l,this._ngZone=u,this._keyboardDispatcher=f,this._document=g,this._location=y,this._outsideClickDispatcher=R,this._backdropElement=null,this._backdropClick=new hn,this._attachments=new hn,this._detachments=new hn,this._locationChanges=En.EMPTY,this._backdropClickHandler=D=>this._backdropClick.next(D),this._backdropTransitionendHandler=D=>{this._disposeBackdrop(D.target)},this._keydownEvents=new hn,this._outsidePointerEvents=new hn,l.scrollStrategy&&(this._scrollStrategy=l.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=l.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Go(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){var e;const t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),null===(e=this._host)||void 0===e||e.remove(),this._previousHostParent=this._pane=this._host=null,t&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config=Object.assign(Object.assign({},this._config),e),this._updateElementSize()}setDirection(e){this._config=Object.assign(Object.assign({},this._config),{direction:e}),this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=hr(this._config.width),e.height=hr(this._config.height),e.minWidth=hr(this._config.minWidth),e.minHeight=hr(this._config.minHeight),e.maxWidth=hr(this._config.maxWidth),e.maxHeight=hr(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),"undefined"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const e=this._backdropElement;!e||(e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",this._backdropTransitionendHandler)}),e.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(e)},500)))}_toggleClasses(e,t,a){const l=HO(t||[]).filter(u=>!!u);l.length&&(a?e.classList.add(...l):e.classList.remove(...l))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe(ys($v(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",this._backdropTransitionendHandler),e.remove(),this._backdropElement===e&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}let O3=(()=>{class r{constructor(t,a){this._platform=a,this._document=t}ngOnDestroy(){var t;null===(t=this._containerElement)||void 0===t||t.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||Zt()){const l=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let u=0;u<l.length;u++)l[u].remove()}const a=this._document.createElement("div");a.classList.add(t),Zt()?a.setAttribute("platform","test"):this._platform.isBrowser||a.setAttribute("platform","server"),this._document.body.appendChild(a),this._containerElement=a}}return r.\u0275fac=function(t){return new(t||r)(he(_n),he(Tr))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const N3="cdk-overlay-connected-position-bounding-box",yH=/([A-Za-z%]+)$/;class SH{constructor(e,t,a,l,u){this._viewportRuler=t,this._document=a,this._platform=l,this._overlayContainer=u,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new hn,this._resizeSubscription=En.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}get positions(){return this._preferredPositions}attach(e){this._validatePositions(),e.hostElement.classList.add(N3),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._originRect,t=this._overlayRect,a=this._viewportRect,l=this._containerRect,u=[];let f;for(let g of this._preferredPositions){let y=this._getOriginPoint(e,l,g),R=this._getOverlayPoint(y,t,g),D=this._getOverlayFit(R,t,a,g);if(D.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(g,y);this._canFitWithFlexibleDimensions(D,R,a)?u.push({position:g,origin:y,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(y,g)}):(!f||f.overlayFit.visibleArea<D.visibleArea)&&(f={overlayFit:D,overlayPoint:R,originPoint:y,position:g,overlayRect:t})}if(u.length){let g=null,y=-1;for(const R of u){const D=R.boundingBoxRect.width*R.boundingBoxRect.height*(R.position.weight||1);D>y&&(y=D,g=R)}return this._isPushed=!1,void this._applyPosition(g.position,g.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(f.position,f.originPoint);this._applyPosition(f.position,f.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&km(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(N3),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const e=this._lastPosition;if(e){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,e);this._applyPosition(e,t)}else this.apply()}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,t,a){let l,u;if("center"==a.originX)l=e.left+e.width/2;else{const f=this._isRtl()?e.right:e.left,g=this._isRtl()?e.left:e.right;l="start"==a.originX?f:g}return t.left<0&&(l-=t.left),u="center"==a.originY?e.top+e.height/2:"top"==a.originY?e.top:e.bottom,t.top<0&&(u-=t.top),{x:l,y:u}}_getOverlayPoint(e,t,a){let l,u;return l="center"==a.overlayX?-t.width/2:"start"===a.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,u="center"==a.overlayY?-t.height/2:"top"==a.overlayY?0:-t.height,{x:e.x+l,y:e.y+u}}_getOverlayFit(e,t,a,l){const u=k3(t);let{x:f,y:g}=e,y=this._getOffset(l,"x"),R=this._getOffset(l,"y");y&&(f+=y),R&&(g+=R);let j=0-g,G=g+u.height-a.height,q=this._subtractOverflows(u.width,0-f,f+u.width-a.width),se=this._subtractOverflows(u.height,j,G),ue=q*se;return{visibleArea:ue,isCompletelyWithinViewport:u.width*u.height===ue,fitsInViewportVertically:se===u.height,fitsInViewportHorizontally:q==u.width}}_canFitWithFlexibleDimensions(e,t,a){if(this._hasFlexibleDimensions){const l=a.bottom-t.y,u=a.right-t.x,f=P3(this._overlayRef.getConfig().minHeight),g=P3(this._overlayRef.getConfig().minWidth),R=e.fitsInViewportHorizontally||null!=g&&g<=u;return(e.fitsInViewportVertically||null!=f&&f<=l)&&R}return!1}_pushOverlayOnScreen(e,t,a){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const l=k3(t),u=this._viewportRect,f=Math.max(e.x+l.width-u.width,0),g=Math.max(e.y+l.height-u.height,0),y=Math.max(u.top-a.top-e.y,0),R=Math.max(u.left-a.left-e.x,0);let D=0,x=0;return D=l.width<=u.width?R||-f:e.x<this._viewportMargin?u.left-a.left-e.x:0,x=l.height<=u.height?y||-g:e.y<this._viewportMargin?u.top-a.top-e.y:0,this._previousPushAmount={x:D,y:x},{x:e.x+D,y:e.y+x}}_applyPosition(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const a=this._getScrollVisibility(),l=new EH(e,a);this._positionChanges.next(l)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let a,l=e.overlayY;a="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let u=0;u<t.length;u++)t[u].style.transformOrigin=`${a} ${l}`}_calculateBoundingBoxRect(e,t){const a=this._viewportRect,l=this._isRtl();let u,f,g,D,x,j;if("top"===t.overlayY)f=e.y,u=a.height-f+this._viewportMargin;else if("bottom"===t.overlayY)g=a.height-e.y+2*this._viewportMargin,u=a.height-g+this._viewportMargin;else{const G=Math.min(a.bottom-e.y+a.top,e.y),q=this._lastBoundingBoxSize.height;u=2*G,f=e.y-G,u>q&&!this._isInitialRender&&!this._growAfterOpen&&(f=e.y-q/2)}if("end"===t.overlayX&&!l||"start"===t.overlayX&&l)j=a.width-e.x+this._viewportMargin,D=e.x-this._viewportMargin;else if("start"===t.overlayX&&!l||"end"===t.overlayX&&l)x=e.x,D=a.right-e.x;else{const G=Math.min(a.right-e.x+a.left,e.x),q=this._lastBoundingBoxSize.width;D=2*G,x=e.x-G,D>q&&!this._isInitialRender&&!this._growAfterOpen&&(x=e.x-q/2)}return{top:f,left:x,bottom:g,right:j,width:D,height:u}}_setBoundingBoxStyles(e,t){const a=this._calculateBoundingBoxRect(e,t);!this._isInitialRender&&!this._growAfterOpen&&(a.height=Math.min(a.height,this._lastBoundingBoxSize.height),a.width=Math.min(a.width,this._lastBoundingBoxSize.width));const l={};if(this._hasExactPosition())l.top=l.left="0",l.bottom=l.right=l.maxHeight=l.maxWidth="",l.width=l.height="100%";else{const u=this._overlayRef.getConfig().maxHeight,f=this._overlayRef.getConfig().maxWidth;l.height=hr(a.height),l.top=hr(a.top),l.bottom=hr(a.bottom),l.width=hr(a.width),l.left=hr(a.left),l.right=hr(a.right),l.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",l.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",u&&(l.maxHeight=hr(u)),f&&(l.maxWidth=hr(f))}this._lastBoundingBoxSize=a,km(this._boundingBox.style,l)}_resetBoundingBoxStyles(){km(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){km(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,t){const a={},l=this._hasExactPosition(),u=this._hasFlexibleDimensions,f=this._overlayRef.getConfig();if(l){const D=this._viewportRuler.getViewportScrollPosition();km(a,this._getExactOverlayY(t,e,D)),km(a,this._getExactOverlayX(t,e,D))}else a.position="static";let g="",y=this._getOffset(t,"x"),R=this._getOffset(t,"y");y&&(g+=`translateX(${y}px) `),R&&(g+=`translateY(${R}px)`),a.transform=g.trim(),f.maxHeight&&(l?a.maxHeight=hr(f.maxHeight):u&&(a.maxHeight="")),f.maxWidth&&(l?a.maxWidth=hr(f.maxWidth):u&&(a.maxWidth="")),km(this._pane.style,a)}_getExactOverlayY(e,t,a){let l={top:"",bottom:""},u=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,a)),"bottom"===e.overlayY?l.bottom=this._document.documentElement.clientHeight-(u.y+this._overlayRect.height)+"px":l.top=hr(u.y),l}_getExactOverlayX(e,t,a){let f,l={left:"",right:""},u=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(u=this._pushOverlayOnScreen(u,this._overlayRect,a)),f=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===f?l.right=this._document.documentElement.clientWidth-(u.x+this._overlayRect.width)+"px":l.left=hr(u.x),l}_getScrollVisibility(){const e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),a=this._scrollables.map(l=>l.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:D3(e,a),isOriginOutsideView:S2(e,a),isOverlayClipped:D3(t,a),isOverlayOutsideView:S2(t,a)}}_subtractOverflows(e,...t){return t.reduce((a,l)=>a-Math.max(l,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,a=this._viewportRuler.getViewportScrollPosition();return{top:a.top+this._viewportMargin,left:a.left+this._viewportMargin,right:a.left+e-this._viewportMargin,bottom:a.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,t){return"x"===t?null==e.offsetX?this._offsetX:e.offsetX:null==e.offsetY?this._offsetY:e.offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&HO(e).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof Rn)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const t=e.width||0,a=e.height||0;return{top:e.y,bottom:e.y+a,left:e.x,right:e.x+t,height:a,width:t}}}function km(r,e){for(let t in e)e.hasOwnProperty(t)&&(r[t]=e[t]);return r}function P3(r){if("number"!=typeof r&&null!=r){const[e,t]=r.split(yH);return t&&"px"!==t?null:parseFloat(e)}return r||null}function k3(r){return{top:Math.floor(r.top),right:Math.floor(r.right),bottom:Math.floor(r.bottom),left:Math.floor(r.left),width:Math.floor(r.width),height:Math.floor(r.height)}}const M3="cdk-global-overlay-wrapper";class CH{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(e){const t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(M3),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._rightOffset="",this._leftOffset=e,this._justifyContent="flex-start",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._leftOffset="",this._rightOffset=e,this._justifyContent="flex-end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._justifyContent="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,a=this._overlayRef.getConfig(),{width:l,height:u,maxWidth:f,maxHeight:g}=a,y=!("100%"!==l&&"100vw"!==l||f&&"100%"!==f&&"100vw"!==f),R=!("100%"!==u&&"100vh"!==u||g&&"100%"!==g&&"100vh"!==g);e.position=this._cssPosition,e.marginLeft=y?"0":this._leftOffset,e.marginTop=R?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=this._rightOffset,y?t.justifyContent="flex-start":"center"===this._justifyContent?t.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?t.justifyContent="flex-end":"flex-end"===this._justifyContent&&(t.justifyContent="flex-start"):t.justifyContent=this._justifyContent,t.alignItems=R?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,a=t.style;t.classList.remove(M3),a.justifyContent=a.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let bH=(()=>{class r{constructor(t,a,l,u){this._viewportRuler=t,this._document=a,this._platform=l,this._overlayContainer=u}global(){return new CH}flexibleConnectedTo(t){return new SH(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return r.\u0275fac=function(t){return new(t||r)(he(T3),he(_n),he(Tr),he(O3))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),L3=(()=>{class r{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const a=this._attachedOverlays.indexOf(t);a>-1&&this._attachedOverlays.splice(a,1),0===this._attachedOverlays.length&&this.detach()}}return r.\u0275fac=function(t){return new(t||r)(he(_n))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),TH=(()=>{class r extends L3{constructor(t,a){super(t),this._ngZone=a,this._keydownListener=l=>{const u=this._attachedOverlays;for(let f=u.length-1;f>-1;f--)if(u[f]._keydownEvents.observers.length>0){const g=u[f]._keydownEvents;this._ngZone?this._ngZone.run(()=>g.next(l)):g.next(l);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return r.\u0275fac=function(t){return new(t||r)(he(_n),he(yt,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),RH=(()=>{class r extends L3{constructor(t,a,l){super(t),this._platform=a,this._ngZone=l,this._cursorStyleIsSet=!1,this._pointerDownListener=u=>{this._pointerDownEventTarget=So(u)},this._clickListener=u=>{const f=So(u),g="click"===u.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:f;this._pointerDownEventTarget=null;const y=this._attachedOverlays.slice();for(let R=y.length-1;R>-1;R--){const D=y[R];if(D._outsidePointerEvents.observers.length<1||!D.hasAttached())continue;if(D.overlayElement.contains(f)||D.overlayElement.contains(g))break;const x=D._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>x.next(u)):x.next(u)}}}add(t){if(super.add(t),!this._isAttached){const a=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(a)):this._addEventListeners(a),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=a.style.cursor,a.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}}return r.\u0275fac=function(t){return new(t||r)(he(_n),he(Tr),he(yt,8))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),IH=0,fN=(()=>{class r{constructor(t,a,l,u,f,g,y,R,D,x,j){this.scrollStrategies=t,this._overlayContainer=a,this._componentFactoryResolver=l,this._positionBuilder=u,this._keyboardDispatcher=f,this._injector=g,this._ngZone=y,this._document=R,this._directionality=D,this._location=x,this._outsideClickDispatcher=j}create(t){const a=this._createHostElement(),l=this._createPaneElement(a),u=this._createPortalOutlet(l),f=new gH(t);return f.direction=f.direction||this._directionality.value,new vH(u,a,l,f,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(t){const a=this._document.createElement("div");return a.id="cdk-overlay-"+IH++,a.classList.add("cdk-overlay-pane"),t.appendChild(a),a}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(ss)),new uH(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return r.\u0275fac=function(t){return new(t||r)(he(_H),he(O3),he(nc),he(bH),he(TH),he(ir),he(yt),he(_n),he(Tv),he(gE),he(RH))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();const DH={provide:new Le("cdk-connected-overlay-scroll-strategy"),deps:[fN],useFactory:function AH(r){return()=>r.scrollStrategies.reposition()}};let OH=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({providers:[fN,DH],imports:[[gl,hH,R3],R3]}),r})();class NH extends Dn{notifyNext(e,t,a,l,u){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class PH extends Dn{constructor(e,t,a){super(),this.parent=e,this.outerValue=t,this.outerIndex=a,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function kH(r,e,t,a,l=new PH(r,t,a)){if(!l.closed)return e instanceof Cn?e.subscribe(l):Wm(e)(l)}const x3={};function F3(...r){let e,t;return Il(r[r.length-1])&&(t=r.pop()),"function"==typeof r[r.length-1]&&(e=r.pop()),1===r.length&&pr(r[0])&&(r=r[0]),Gd(r,t).lift(new MH(e))}class MH{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new LH(e,this.resultSelector))}}class LH extends NH{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(x3),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let a=0;a<t;a++)this.add(kH(this,e[a],void 0,a))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,a){const l=this.values,f=this.toRespond?l[a]===x3?--this.toRespond:this.toRespond:0;l[a]=t,0===f&&(this.resultSelector?this._tryResultSelector(l):this.destination.next(l.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(a){return void this.destination.error(a)}this.destination.next(t)}}const U3=new Set;let Nv,xH=(()=>{class r{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):UH}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function FH(r){if(!U3.has(r))try{Nv||(Nv=document.createElement("style"),Nv.setAttribute("type","text/css"),document.head.appendChild(Nv)),Nv.sheet&&(Nv.sheet.insertRule(`@media ${r} {body{ }}`,0),U3.add(r))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return r.\u0275fac=function(t){return new(t||r)(he(Tr))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function UH(r){return{matches:"all"===r||""===r,media:r,addListener:()=>{},removeListener:()=>{}}}let VH=(()=>{class r{constructor(t,a){this._mediaMatcher=t,this._zone=a,this._queries=new Map,this._destroySubject=new hn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return V3(HO(t)).some(l=>this._registerQuery(l).mql.matches)}observe(t){let u=F3(V3(HO(t)).map(f=>this._registerQuery(f).observable));return u=uN(u.pipe(Go(1)),u.pipe(JU(1),ZU(0))),u.pipe(on(f=>{const g={matches:!1,breakpoints:{}};return f.forEach(({matches:y,query:R})=>{g.matches=g.matches||y,g.breakpoints[R]=y}),g}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const a=this._mediaMatcher.matchMedia(t),u={observable:new Cn(f=>{const g=y=>this._zone.run(()=>f.next(y));return a.addListener(g),()=>{a.removeListener(g)}}).pipe(JT(a),on(({matches:f})=>({query:t,matches:f})),ys(this._destroySubject)),mql:a};return this._queries.set(t,u),u}}return r.\u0275fac=function(t){return new(t||r)(he(xH),he(yt))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function V3(r){return r.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}const jH=["tooltip"],B3="tooltip-panel",j3=Tm({passive:!0}),H3=new Le("mat-tooltip-scroll-strategy"),zH={provide:H3,deps:[fN],useFactory:function WH(r){return()=>r.scrollStrategies.reposition({scrollThrottle:20})}},KH=new Le("mat-tooltip-default-options",{providedIn:"root",factory:function qH(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}});let YH=(()=>{class r{constructor(t,a,l,u,f,g,y,R,D,x,j,G){this._overlay=t,this._elementRef=a,this._scrollDispatcher=l,this._viewContainerRef=u,this._ngZone=f,this._platform=g,this._ariaDescriber=y,this._focusMonitor=R,this._dir=x,this._defaultOptions=j,this._position="below",this._disabled=!1,this._viewInitialized=!1,this._pointerExitEventsInitialized=!1,this._viewportMargin=8,this._cssClassPrefix="mat",this._showDelay=this._defaultOptions.showDelay,this._hideDelay=this._defaultOptions.hideDelay,this.touchGestures="auto",this._message="",this._passiveListeners=[],this._destroyed=new hn,this._scrollStrategy=D,this._document=G,j&&(j.position&&(this.position=j.position),j.touchGestures&&(this.touchGestures=j.touchGestures)),x.change.pipe(ys(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})}get position(){return this._position}set position(t){var a;t!==this._position&&(this._position=t,this._overlayRef&&(this._updatePosition(this._overlayRef),null===(a=this._tooltipInstance)||void 0===a||a.show(0),this._overlayRef.updatePosition()))}get disabled(){return this._disabled}set disabled(t){this._disabled=vl(t),this._disabled?this.hide(0):this._setupPointerEnterEventsIfNeeded()}get showDelay(){return this._showDelay}set showDelay(t){this._showDelay=jO(t)}get hideDelay(){return this._hideDelay}set hideDelay(t){this._hideDelay=jO(t),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}get message(){return this._message}set message(t){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message,"tooltip"),this._message=null!=t?String(t).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage(),this._ngZone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")})}))}get tooltipClass(){return this._tooltipClass}set tooltipClass(t){this._tooltipClass=t,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(ys(this._destroyed)).subscribe(t=>{t?"keyboard"===t&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){const t=this._elementRef.nativeElement;clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([a,l])=>{t.removeEventListener(a,l,j3)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(t,this.message,"tooltip"),this._focusMonitor.stopMonitoring(t)}show(t=this.showDelay){if(this.disabled||!this.message||this._isTooltipVisible()&&!this._tooltipInstance._showTimeoutId&&!this._tooltipInstance._hideTimeoutId)return;const a=this._createOverlay();this._detach(),this._portal=this._portal||new I3(this._tooltipComponent,this._viewContainerRef);const l=this._tooltipInstance=a.attach(this._portal).instance;l._triggerElement=this._elementRef.nativeElement,l._mouseLeaveHideDelay=this._hideDelay,l.afterHidden().pipe(ys(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),l.show(t)}hide(t=this.hideDelay){this._tooltipInstance&&this._tooltipInstance.hide(t)}toggle(){this._isTooltipVisible()?this.hide():this.show()}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(){var t;if(this._overlayRef)return this._overlayRef;const a=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),l=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(a);return l.positionChanges.pipe(ys(this._destroyed)).subscribe(u=>{this._updateCurrentPositionClass(u.connectionPair),this._tooltipInstance&&u.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:l,panelClass:`${this._cssClassPrefix}-${B3}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(ys(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(ys(this._destroyed)).subscribe(()=>{var u;return null===(u=this._tooltipInstance)||void 0===u?void 0:u._handleBodyInteraction()}),this._overlayRef.keydownEvents().pipe(ys(this._destroyed)).subscribe(u=>{this._isTooltipVisible()&&27===u.keyCode&&!function tj(r,...e){return e.length?e.some(t=>r[t]):r.altKey||r.shiftKey||r.ctrlKey||r.metaKey}(u)&&(u.preventDefault(),u.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),(null===(t=this._defaultOptions)||void 0===t?void 0:t.disableTooltipInteractivity)&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(t){const a=t.getConfig().positionStrategy,l=this._getOrigin(),u=this._getOverlayPosition();a.withPositions([this._addOffset(Object.assign(Object.assign({},l.main),u.main)),this._addOffset(Object.assign(Object.assign({},l.fallback),u.fallback))])}_addOffset(t){return t}_getOrigin(){const t=!this._dir||"ltr"==this._dir.value,a=this.position;let l;"above"==a||"below"==a?l={originX:"center",originY:"above"==a?"top":"bottom"}:"before"==a||"left"==a&&t||"right"==a&&!t?l={originX:"start",originY:"center"}:("after"==a||"right"==a&&t||"left"==a&&!t)&&(l={originX:"end",originY:"center"});const{x:u,y:f}=this._invertPosition(l.originX,l.originY);return{main:l,fallback:{originX:u,originY:f}}}_getOverlayPosition(){const t=!this._dir||"ltr"==this._dir.value,a=this.position;let l;"above"==a?l={overlayX:"center",overlayY:"bottom"}:"below"==a?l={overlayX:"center",overlayY:"top"}:"before"==a||"left"==a&&t||"right"==a&&!t?l={overlayX:"end",overlayY:"center"}:("after"==a||"right"==a&&t||"left"==a&&!t)&&(l={overlayX:"start",overlayY:"center"});const{x:u,y:f}=this._invertPosition(l.overlayX,l.overlayY);return{main:l,fallback:{overlayX:u,overlayY:f}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.pipe(Go(1),ys(this._destroyed)).subscribe(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()}))}_setTooltipClass(t){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=t,this._tooltipInstance._markForCheck())}_invertPosition(t,a){return"above"===this.position||"below"===this.position?"top"===a?a="bottom":"bottom"===a&&(a="top"):"end"===t?t="start":"start"===t&&(t="end"),{x:t,y:a}}_updateCurrentPositionClass(t){const{overlayY:a,originX:l,originY:u}=t;let f;if(f="center"===a?this._dir&&"rtl"===this._dir.value?"end"===l?"left":"right":"start"===l?"left":"right":"bottom"===a&&"top"===u?"above":"below",f!==this._currentPosition){const g=this._overlayRef;if(g){const y=`${this._cssClassPrefix}-${B3}-`;g.removePanelClass(y+this._currentPosition),g.addPanelClass(y+f)}this._currentPosition=f}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",()=>{this._setupPointerExitEventsIfNeeded(),this.show()}]):"off"!==this.touchGestures&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",()=>{this._setupPointerExitEventsIfNeeded(),clearTimeout(this._touchstartTimeout),this._touchstartTimeout=setTimeout(()=>this.show(),500)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;const t=[];if(this._platformSupportsMouseEvents())t.push(["mouseleave",a=>{var l;const u=a.relatedTarget;(!u||!(null===(l=this._overlayRef)||void 0===l?void 0:l.overlayElement.contains(u)))&&this.hide()}],["wheel",a=>this._wheelListener(a)]);else if("off"!==this.touchGestures){this._disableNativeGesturesIfNecessary();const a=()=>{clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions.touchendHideDelay)};t.push(["touchend",a],["touchcancel",a])}this._addListeners(t),this._passiveListeners.push(...t)}_addListeners(t){t.forEach(([a,l])=>{this._elementRef.nativeElement.addEventListener(a,l,j3)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(t){if(this._isTooltipVisible()){const a=this._document.elementFromPoint(t.clientX,t.clientY),l=this._elementRef.nativeElement;a!==l&&!l.contains(a)&&this.hide()}}_disableNativeGesturesIfNecessary(){const t=this.touchGestures;if("off"!==t){const a=this._elementRef.nativeElement,l=a.style;("on"===t||"INPUT"!==a.nodeName&&"TEXTAREA"!==a.nodeName)&&(l.userSelect=l.msUserSelect=l.webkitUserSelect=l.MozUserSelect="none"),("on"===t||!a.draggable)&&(l.webkitUserDrag="none"),l.touchAction="none",l.webkitTapHighlightColor="transparent"}}}return r.\u0275fac=function(t){Cg()},r.\u0275dir=je({type:r,inputs:{position:["matTooltipPosition","position"],disabled:["matTooltipDisabled","disabled"],showDelay:["matTooltipShowDelay","showDelay"],hideDelay:["matTooltipHideDelay","hideDelay"],touchGestures:["matTooltipTouchGestures","touchGestures"],message:["matTooltip","message"],tooltipClass:["matTooltipClass","tooltipClass"]}}),r})(),$H=(()=>{class r extends YH{constructor(t,a,l,u,f,g,y,R,D,x,j,G){super(t,a,l,u,f,g,y,R,D,x,j,G),this._tooltipComponent=JH}}return r.\u0275fac=function(t){return new(t||r)(oe(fN),oe(Rn),oe(b3),oe(uo),oe(yt),oe(Tr),oe(gj),oe(xx),oe(H3),oe(Tv,8),oe(KH,8),oe(_n))},r.\u0275dir=je({type:r,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-tooltip-trigger"],exportAs:["matTooltip"],features:[Mt]}),r})(),XH=(()=>{class r{constructor(t,a){this._changeDetectorRef=t,this._visibility="initial",this._closeOnInteraction=!1,this._isVisible=!1,this._onHide=new hn,this._animationsDisabled="NoopAnimations"===a}show(t){clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},t)}hide(t){clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},t)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){clearTimeout(this._showTimeoutId),clearTimeout(this._hideTimeoutId),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:t}){(!t||!this._triggerElement.contains(t))&&this.hide(this._mouseLeaveHideDelay)}_onShow(){}_handleAnimationEnd({animationName:t}){(t===this._showAnimation||t===this._hideAnimation)&&this._finalizeAnimation(t===this._showAnimation)}_finalizeAnimation(t){t?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(t){const a=this._tooltip.nativeElement,l=this._showAnimation,u=this._hideAnimation;if(a.classList.remove(t?u:l),a.classList.add(t?l:u),this._isVisible=t,t&&!this._animationsDisabled&&"function"==typeof getComputedStyle){const f=getComputedStyle(a);("0s"===f.getPropertyValue("animation-duration")||"none"===f.getPropertyValue("animation-name"))&&(this._animationsDisabled=!0)}t&&this._onShow(),this._animationsDisabled&&(a.classList.add("_mat-animation-noopable"),this._finalizeAnimation(t))}}return r.\u0275fac=function(t){return new(t||r)(oe(Fo),oe(Bh,8))},r.\u0275dir=je({type:r}),r})(),JH=(()=>{class r extends XH{constructor(t,a,l){super(t,l),this._breakpointObserver=a,this._isHandset=this._breakpointObserver.observe("(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)"),this._showAnimation="mat-tooltip-show",this._hideAnimation="mat-tooltip-hide"}}return r.\u0275fac=function(t){return new(t||r)(oe(Fo),oe(VH),oe(Bh,8))},r.\u0275cmp=Er({type:r,selectors:[["mat-tooltip-component"]],viewQuery:function(t,a){if(1&t&&yi(jH,7),2&t){let l;Fi(l=Ii())&&(a._tooltip=l.first)}},hostAttrs:["aria-hidden","true"],hostVars:2,hostBindings:function(t,a){1&t&&zt("mouseleave",function(u){return a._handleMouseLeave(u)}),2&t&&Gu("zoom",a.isVisible()?1:null)},features:[Mt],decls:4,vars:6,consts:[[1,"mat-tooltip",3,"ngClass","animationend"],["tooltip",""]],template:function(t,a){if(1&t&&(Ae(0,"div",0,1),zt("animationend",function(u){return a._handleAnimationEnd(u)}),Xu(2,"async"),Yi(3),Be()),2&t){let l;vn("mat-tooltip-handset",null==(l=Ef(2,4,a._isHandset))?null:l.matches),ot("ngClass",a.tooltipClass),Je(3),Yc(a.message)}},directives:[Gs],pipes:[ME],styles:[".mat-tooltip{color:#fff;border-radius:4px;margin:14px;max-width:250px;padding-left:8px;padding-right:8px;overflow:hidden;text-overflow:ellipsis;transform:scale(0)}.mat-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.cdk-high-contrast-active .mat-tooltip{outline:solid 1px}.mat-tooltip-handset{margin:24px;padding-left:16px;padding-right:16px}.mat-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-tooltip-show{0%{opacity:0;transform:scale(0)}50%{opacity:.5;transform:scale(0.99)}100%{opacity:1;transform:scale(1)}}@keyframes mat-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(1)}}.mat-tooltip-show{animation:mat-tooltip-show 200ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-tooltip-hide{animation:mat-tooltip-hide 100ms cubic-bezier(0, 0, 0.2, 1) forwards}\n"],encapsulation:2,changeDetection:0}),r})(),QH=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({providers:[zH],imports:[[Aj,Qf,OH,Tc],Tc,v2]}),r})();function QT(r,e){return new Cn(e?t=>e.schedule(ZH,0,{error:r,subscriber:t}):t=>t.error(r))}function ZH({error:r,subscriber:e}){e.error(r)}const mN=(()=>{function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return r.prototype=Object.create(Error.prototype),r})();function G3(r){return new Cn(e=>{let t;try{t=r()}catch(l){return void e.error(l)}return(t?mr(t):hN()).subscribe(e)})}function Ld(r,e){return"function"==typeof e?t=>t.pipe(Ld((a,l)=>mr(r(a,l)).pipe(on((u,f)=>e(a,u,l,f))))):t=>t.lift(new e8(r))}class e8{constructor(e){this.project=e}call(e,t){return t.subscribe(new t8(e,this.project))}}class t8 extends Jh{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const a=this.index++;try{t=this.project(e,a)}catch(l){return void this.destination.error(l)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const a=new Hd(this),l=this.destination;l.add(a),this.innerSubscription=wl(e,a),this.innerSubscription!==a&&l.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}function W3(r,e){let t=!1;return arguments.length>=2&&(t=!0),function(l){return l.lift(new n8(r,e,t))}}class n8{constructor(e,t,a=!1){this.accumulator=e,this.seed=t,this.hasSeed=a}call(e,t){return t.subscribe(new i8(e,this.accumulator,this.seed,this.hasSeed))}}class i8 extends Dn{constructor(e,t,a,l){super(e),this.accumulator=t,this._seed=a,this.hasSeed=l,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let a;try{a=this.accumulator(this.seed,e,t)}catch(l){this.destination.error(l)}this.seed=a,this.destination.next(a)}}function Mm(r){return function(t){const a=new r8(r),l=t.lift(a);return a.caught=l}}class r8{constructor(e){this.selector=e}call(e,t){return t.subscribe(new o8(e,this.selector,this.caught))}}class o8 extends Jh{constructor(e,t,a){super(e),this.selector=t,this.caught=a}error(e){if(!this.isStopped){let t;try{t=this.selector(e,this.caught)}catch(u){return void super.error(u)}this._unsubscribeAndRecycle();const a=new Hd(this);this.add(a);const l=wl(t,a);l!==a&&this.add(l)}}}function ZT(r,e){return Ni(r,e,1)}function C2(r){return function(t){return 0===r?hN():t.lift(new s8(r))}}class s8{constructor(e){if(this.total=e,this.total<0)throw new d3}call(e,t){return t.subscribe(new a8(e,this.total))}}class a8 extends Dn{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,a=this.total,l=this.count++;t.length<a?t.push(e):t[l%a]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const a=this.count>=this.total?this.total:this.count,l=this.ring;for(let u=0;u<a;u++){const f=t++%a;e.next(l[f])}}e.complete()}}function z3(r=d8){return e=>e.lift(new c8(r))}class c8{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new l8(e,this.errorFactory))}}class l8 extends Dn{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}}function d8(){return new mN}function K3(r=null){return e=>e.lift(new u8(r))}class u8{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new h8(e,this.defaultValue))}}class h8 extends Dn{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function Pv(r,e){const t=arguments.length>=2;return a=>a.pipe(r?jh((l,u)=>r(l,u,a)):Yh,Go(1),t?K3(e):z3(()=>new mN))}function Hh(){}function Wo(r,e,t){return function(l){return l.lift(new f8(r,e,t))}}class f8{constructor(e,t,a){this.nextOrObserver=e,this.error=t,this.complete=a}call(e,t){return t.subscribe(new m8(e,this.nextOrObserver,this.error,this.complete))}}class m8 extends Dn{constructor(e,t,a,l){super(e),this._tapNext=Hh,this._tapError=Hh,this._tapComplete=Hh,this._tapError=a||Hh,this._tapComplete=l||Hh,L(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||Hh,this._tapError=t.error||Hh,this._tapComplete=t.complete||Hh)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class g8{constructor(e){this.callback=e}call(e,t){return t.subscribe(new E8(e,this.callback))}}class E8 extends Dn{constructor(e,t){super(e),this.add(new En(t))}}class xd{constructor(e,t){this.id=e,this.url=t}}class b2 extends xd{constructor(e,t,a="imperative",l=null){super(e,t),this.navigationTrigger=a,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class e0 extends xd{constructor(e,t,a){super(e,t),this.urlAfterRedirects=a}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class q3 extends xd{constructor(e,t,a){super(e,t),this.reason=a}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class v8 extends xd{constructor(e,t,a){super(e,t),this.error=a}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class y8 extends xd{constructor(e,t,a,l){super(e,t),this.urlAfterRedirects=a,this.state=l}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class S8 extends xd{constructor(e,t,a,l){super(e,t),this.urlAfterRedirects=a,this.state=l}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class C8 extends xd{constructor(e,t,a,l,u){super(e,t),this.urlAfterRedirects=a,this.state=l,this.shouldActivate=u}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class b8 extends xd{constructor(e,t,a,l){super(e,t),this.urlAfterRedirects=a,this.state=l}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class T8 extends xd{constructor(e,t,a,l){super(e,t),this.urlAfterRedirects=a,this.state=l}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Y3{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class $3{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class R8{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class I8{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class w8{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class A8{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class X3{constructor(e,t,a){this.routerEvent=e,this.position=t,this.anchor=a}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Wt="primary";class D8{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function kv(r){return new D8(r)}const J3="ngNavigationCancelingError";function T2(r){const e=Error("NavigationCancelingError: "+r);return e[J3]=!0,e}function N8(r,e,t){const a=t.path.split("/");if(a.length>r.length||"full"===t.pathMatch&&(e.hasChildren()||a.length<r.length))return null;const l={};for(let u=0;u<a.length;u++){const f=a[u],g=r[u];if(f.startsWith(":"))l[f.substring(1)]=g;else if(f!==g.path)return null}return{consumed:r.slice(0,a.length),posParams:l}}function Cl(r,e){const t=r?Object.keys(r):void 0,a=e?Object.keys(e):void 0;if(!t||!a||t.length!=a.length)return!1;let l;for(let u=0;u<t.length;u++)if(l=t[u],!Q3(r[l],e[l]))return!1;return!0}function Q3(r,e){if(Array.isArray(r)&&Array.isArray(e)){if(r.length!==e.length)return!1;const t=[...r].sort(),a=[...e].sort();return t.every((l,u)=>a[u]===l)}return r===e}function Z3(r){return Array.prototype.concat.apply([],r)}function eB(r){return r.length>0?r[r.length-1]:null}function io(r,e){for(const t in r)r.hasOwnProperty(t)&&e(r[t],t)}function bl(r){return aC(r)?r:Yp(r)?mr(Promise.resolve(r)):ut(r)}const M8={exact:function iB(r,e,t){if(!xm(r.segments,e.segments)||!_N(r.segments,e.segments,t)||r.numberOfChildren!==e.numberOfChildren)return!1;for(const a in e.children)if(!r.children[a]||!iB(r.children[a],e.children[a],t))return!1;return!0},subset:rB},tB={exact:function L8(r,e){return Cl(r,e)},subset:function x8(r,e){return Object.keys(e).length<=Object.keys(r).length&&Object.keys(e).every(t=>Q3(r[t],e[t]))},ignored:()=>!0};function nB(r,e,t){return M8[t.paths](r.root,e.root,t.matrixParams)&&tB[t.queryParams](r.queryParams,e.queryParams)&&!("exact"===t.fragment&&r.fragment!==e.fragment)}function rB(r,e,t){return oB(r,e,e.segments,t)}function oB(r,e,t,a){if(r.segments.length>t.length){const l=r.segments.slice(0,t.length);return!(!xm(l,t)||e.hasChildren()||!_N(l,t,a))}if(r.segments.length===t.length){if(!xm(r.segments,t)||!_N(r.segments,t,a))return!1;for(const l in e.children)if(!r.children[l]||!rB(r.children[l],e.children[l],a))return!1;return!0}{const l=t.slice(0,r.segments.length),u=t.slice(r.segments.length);return!!(xm(r.segments,l)&&_N(r.segments,l,a)&&r.children[Wt])&&oB(r.children[Wt],e,u,a)}}function _N(r,e,t){return e.every((a,l)=>tB[t](r[l].parameters,a.parameters))}class Lm{constructor(e,t,a){this.root=e,this.queryParams=t,this.fragment=a}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=kv(this.queryParams)),this._queryParamMap}toString(){return V8.serialize(this)}}class tn{constructor(e,t){this.segments=e,this.children=t,this.parent=null,io(t,(a,l)=>a.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return gN(this)}}class t0{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=kv(this.parameters)),this._parameterMap}toString(){return dB(this)}}function xm(r,e){return r.length===e.length&&r.every((t,a)=>t.path===e[a].path)}class sB{}class aB{parse(e){const t=new Y8(e);return new Lm(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${n0(e.root,!0)}`,a=function H8(r){const e=Object.keys(r).map(t=>{const a=r[t];return Array.isArray(a)?a.map(l=>`${EN(t)}=${EN(l)}`).join("&"):`${EN(t)}=${EN(a)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams),l="string"==typeof e.fragment?`#${function B8(r){return encodeURI(r)}(e.fragment)}`:"";return`${t}${a}${l}`}}const V8=new aB;function gN(r){return r.segments.map(e=>dB(e)).join("/")}function n0(r,e){if(!r.hasChildren())return gN(r);if(e){const t=r.children[Wt]?n0(r.children[Wt],!1):"",a=[];return io(r.children,(l,u)=>{u!==Wt&&a.push(`${u}:${n0(l,!1)}`)}),a.length>0?`${t}(${a.join("//")})`:t}{const t=function U8(r,e){let t=[];return io(r.children,(a,l)=>{l===Wt&&(t=t.concat(e(a,l)))}),io(r.children,(a,l)=>{l!==Wt&&(t=t.concat(e(a,l)))}),t}(r,(a,l)=>l===Wt?[n0(r.children[Wt],!1)]:[`${l}:${n0(a,!1)}`]);return 1===Object.keys(r.children).length&&null!=r.children[Wt]?`${gN(r)}/${t[0]}`:`${gN(r)}/(${t.join("//")})`}}function cB(r){return encodeURIComponent(r).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function EN(r){return cB(r).replace(/%3B/gi,";")}function R2(r){return cB(r).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function vN(r){return decodeURIComponent(r)}function lB(r){return vN(r.replace(/\+/g,"%20"))}function dB(r){return`${R2(r.path)}${function j8(r){return Object.keys(r).map(e=>`;${R2(e)}=${R2(r[e])}`).join("")}(r.parameters)}`}const G8=/^[^\/()?;=#]+/;function yN(r){const e=r.match(G8);return e?e[0]:""}const W8=/^[^=?&#]+/,K8=/^[^&#]+/;class Y8{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new tn([],{}):new tn([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let a={};return this.peekStartsWith("(")&&(a=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(a[Wt]=new tn(e,t)),a}parseSegment(){const e=yN(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new t0(vN(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=yN(this.remaining);if(!t)return;this.capture(t);let a="";if(this.consumeOptional("=")){const l=yN(this.remaining);l&&(a=l,this.capture(a))}e[vN(t)]=vN(a)}parseQueryParam(e){const t=function z8(r){const e=r.match(W8);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let a="";if(this.consumeOptional("=")){const f=function q8(r){const e=r.match(K8);return e?e[0]:""}(this.remaining);f&&(a=f,this.capture(a))}const l=lB(t),u=lB(a);if(e.hasOwnProperty(l)){let f=e[l];Array.isArray(f)||(f=[f],e[l]=f),f.push(u)}else e[l]=u}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const a=yN(this.remaining),l=this.remaining[a.length];if("/"!==l&&")"!==l&&";"!==l)throw new Error(`Cannot parse url '${this.url}'`);let u;a.indexOf(":")>-1?(u=a.substr(0,a.indexOf(":")),this.capture(u),this.capture(":")):e&&(u=Wt);const f=this.parseChildren();t[u]=1===Object.keys(f).length?f[Wt]:new tn([],f),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class uB{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=I2(e,this._root);return t?t.children.map(a=>a.value):[]}firstChild(e){const t=I2(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=w2(e,this._root);return t.length<2?[]:t[t.length-2].children.map(l=>l.value).filter(l=>l!==e)}pathFromRoot(e){return w2(e,this._root).map(t=>t.value)}}function I2(r,e){if(r===e.value)return e;for(const t of e.children){const a=I2(r,t);if(a)return a}return null}function w2(r,e){if(r===e.value)return[e];for(const t of e.children){const a=w2(r,t);if(a.length)return a.unshift(e),a}return[]}class Fd{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Mv(r){const e={};return r&&r.children.forEach(t=>e[t.value.outlet]=t),e}class hB extends uB{constructor(e,t){super(e),this.snapshot=t,A2(this,e)}toString(){return this.snapshot.toString()}}function pB(r,e){const t=function $8(r,e){const f=new SN([],{},{},"",{},Wt,e,null,r.root,-1,{});return new mB("",new Fd(f,[]))}(r,e),a=new Yn([new t0("",{})]),l=new Yn({}),u=new Yn({}),f=new Yn({}),g=new Yn(""),y=new Fm(a,l,f,g,u,Wt,e,t.root);return y.snapshot=t.root,new hB(new Fd(y,[]),t)}class Fm{constructor(e,t,a,l,u,f,g,y){this.url=e,this.params=t,this.queryParams=a,this.fragment=l,this.data=u,this.outlet=f,this.component=g,this._futureSnapshot=y}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(on(e=>kv(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(on(e=>kv(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function fB(r,e="emptyOnly"){const t=r.pathFromRoot;let a=0;if("always"!==e)for(a=t.length-1;a>=1;){const l=t[a],u=t[a-1];if(l.routeConfig&&""===l.routeConfig.path)a--;else{if(u.component)break;a--}}return function X8(r){return r.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(t.slice(a))}class SN{constructor(e,t,a,l,u,f,g,y,R,D,x){this.url=e,this.params=t,this.queryParams=a,this.fragment=l,this.data=u,this.outlet=f,this.component=g,this.routeConfig=y,this._urlSegment=R,this._lastPathIndex=D,this._resolve=x}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=kv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=kv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(a=>a.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class mB extends uB{constructor(e,t){super(t),this.url=e,A2(this,t)}toString(){return _B(this._root)}}function A2(r,e){e.value._routerState=r,e.children.forEach(t=>A2(r,t))}function _B(r){const e=r.children.length>0?` { ${r.children.map(_B).join(", ")} } `:"";return`${r.value}${e}`}function D2(r){if(r.snapshot){const e=r.snapshot,t=r._futureSnapshot;r.snapshot=t,Cl(e.queryParams,t.queryParams)||r.queryParams.next(t.queryParams),e.fragment!==t.fragment&&r.fragment.next(t.fragment),Cl(e.params,t.params)||r.params.next(t.params),function P8(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(!Cl(r[t],e[t]))return!1;return!0}(e.url,t.url)||r.url.next(t.url),Cl(e.data,t.data)||r.data.next(t.data)}else r.snapshot=r._futureSnapshot,r.data.next(r._futureSnapshot.data)}function O2(r,e){const t=Cl(r.params,e.params)&&function F8(r,e){return xm(r,e)&&r.every((t,a)=>Cl(t.parameters,e[a].parameters))}(r.url,e.url);return t&&!(!r.parent!=!e.parent)&&(!r.parent||O2(r.parent,e.parent))}function r0(r,e,t){if(t&&r.shouldReuseRoute(e.value,t.value.snapshot)){const a=t.value;a._futureSnapshot=e.value;const l=function Q8(r,e,t){return e.children.map(a=>{for(const l of t.children)if(r.shouldReuseRoute(a.value,l.value.snapshot))return r0(r,a,l);return r0(r,a)})}(r,e,t);return new Fd(a,l)}{if(r.shouldAttach(e.value)){const u=r.retrieve(e.value);if(null!==u){const f=u.route;return f.value._futureSnapshot=e.value,f.children=e.children.map(g=>r0(r,g)),f}}const a=function Z8(r){return new Fm(new Yn(r.url),new Yn(r.params),new Yn(r.queryParams),new Yn(r.fragment),new Yn(r.data),r.outlet,r.component,r)}(e.value),l=e.children.map(u=>r0(r,u));return new Fd(a,l)}}function CN(r){return"object"==typeof r&&null!=r&&!r.outlets&&!r.segmentPath}function o0(r){return"object"==typeof r&&null!=r&&r.outlets}function N2(r,e,t,a,l){let u={};if(a&&io(a,(g,y)=>{u[y]=Array.isArray(g)?g.map(R=>`${R}`):`${g}`}),r===e)return new Lm(t,u,l);const f=gB(r,e,t);return new Lm(f,u,l)}function gB(r,e,t){const a={};return io(r.children,(l,u)=>{a[u]=l===e?t:gB(l,e,t)}),new tn(r.segments,a)}class EB{constructor(e,t,a){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=a,e&&a.length>0&&CN(a[0]))throw new Error("Root segment cannot have matrix parameters");const l=a.find(o0);if(l&&l!==eB(a))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class P2{constructor(e,t,a){this.segmentGroup=e,this.processChildren=t,this.index=a}}function vB(r,e,t){if(r||(r=new tn([],{})),0===r.segments.length&&r.hasChildren())return bN(r,e,t);const a=function oG(r,e,t){let a=0,l=e;const u={match:!1,pathIndex:0,commandIndex:0};for(;l<r.segments.length;){if(a>=t.length)return u;const f=r.segments[l],g=t[a];if(o0(g))break;const y=`${g}`,R=a<t.length-1?t[a+1]:null;if(l>0&&void 0===y)break;if(y&&R&&"object"==typeof R&&void 0===R.outlets){if(!SB(y,R,f))return u;a+=2}else{if(!SB(y,{},f))return u;a++}l++}return{match:!0,pathIndex:l,commandIndex:a}}(r,e,t),l=t.slice(a.commandIndex);if(a.match&&a.pathIndex<r.segments.length){const u=new tn(r.segments.slice(0,a.pathIndex),{});return u.children[Wt]=new tn(r.segments.slice(a.pathIndex),r.children),bN(u,0,l)}return a.match&&0===l.length?new tn(r.segments,{}):a.match&&!r.hasChildren()?k2(r,e,t):a.match?bN(r,0,l):k2(r,e,t)}function bN(r,e,t){if(0===t.length)return new tn(r.segments,{});{const a=function rG(r){return o0(r[0])?r[0].outlets:{[Wt]:r}}(t),l={};return io(a,(u,f)=>{"string"==typeof u&&(u=[u]),null!==u&&(l[f]=vB(r.children[f],e,u))}),io(r.children,(u,f)=>{void 0===a[f]&&(l[f]=u)}),new tn(r.segments,l)}}function k2(r,e,t){const a=r.segments.slice(0,e);let l=0;for(;l<t.length;){const u=t[l];if(o0(u)){const y=sG(u.outlets);return new tn(a,y)}if(0===l&&CN(t[0])){a.push(new t0(r.segments[e].path,yB(t[0]))),l++;continue}const f=o0(u)?u.outlets[Wt]:`${u}`,g=l<t.length-1?t[l+1]:null;f&&g&&CN(g)?(a.push(new t0(f,yB(g))),l+=2):(a.push(new t0(f,{})),l++)}return new tn(a,{})}function sG(r){const e={};return io(r,(t,a)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[a]=k2(new tn([],{}),0,t))}),e}function yB(r){const e={};return io(r,(t,a)=>e[a]=`${t}`),e}function SB(r,e,t){return r==t.path&&Cl(e,t.parameters)}class cG{constructor(e,t,a,l){this.routeReuseStrategy=e,this.futureState=t,this.currState=a,this.forwardEvent=l}activate(e){const t=this.futureState._root,a=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,a,e),D2(this.futureState.root),this.activateChildRoutes(t,a,e)}deactivateChildRoutes(e,t,a){const l=Mv(t);e.children.forEach(u=>{const f=u.value.outlet;this.deactivateRoutes(u,l[f],a),delete l[f]}),io(l,(u,f)=>{this.deactivateRouteAndItsChildren(u,a)})}deactivateRoutes(e,t,a){const l=e.value,u=t?t.value:null;if(l===u)if(l.component){const f=a.getContext(l.outlet);f&&this.deactivateChildRoutes(e,t,f.children)}else this.deactivateChildRoutes(e,t,a);else u&&this.deactivateRouteAndItsChildren(t,a)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const a=t.getContext(e.value.outlet),l=a&&e.value.component?a.children:t,u=Mv(e);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],l);if(a&&a.outlet){const f=a.outlet.detach(),g=a.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:f,route:e,contexts:g})}}deactivateRouteAndOutlet(e,t){const a=t.getContext(e.value.outlet),l=a&&e.value.component?a.children:t,u=Mv(e);for(const f of Object.keys(u))this.deactivateRouteAndItsChildren(u[f],l);a&&a.outlet&&(a.outlet.deactivate(),a.children.onOutletDeactivated(),a.attachRef=null,a.resolver=null,a.route=null)}activateChildRoutes(e,t,a){const l=Mv(t);e.children.forEach(u=>{this.activateRoutes(u,l[u.value.outlet],a),this.forwardEvent(new A8(u.value.snapshot))}),e.children.length&&this.forwardEvent(new I8(e.value.snapshot))}activateRoutes(e,t,a){const l=e.value,u=t?t.value:null;if(D2(l),l===u)if(l.component){const f=a.getOrCreateContext(l.outlet);this.activateChildRoutes(e,t,f.children)}else this.activateChildRoutes(e,t,a);else if(l.component){const f=a.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const g=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),f.children.onOutletReAttached(g.contexts),f.attachRef=g.componentRef,f.route=g.route.value,f.outlet&&f.outlet.attach(g.componentRef,g.route.value),D2(g.route.value),this.activateChildRoutes(e,null,f.children)}else{const g=function lG(r){for(let e=r.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(l.snapshot),y=g?g.module.componentFactoryResolver:null;f.attachRef=null,f.route=l,f.resolver=y,f.outlet&&f.outlet.activateWith(l,y),this.activateChildRoutes(e,null,f.children)}}else this.activateChildRoutes(e,null,a)}}class M2{constructor(e,t){this.routes=e,this.module=t}}function Gh(r){return"function"==typeof r}function Um(r){return r instanceof Lm}const s0=Symbol("INITIAL_VALUE");function a0(){return Ld(r=>F3(r.map(e=>e.pipe(Go(1),JT(s0)))).pipe(W3((e,t)=>{let a=!1;return t.reduce((l,u,f)=>l!==s0?l:(u===s0&&(a=!0),a||!1!==u&&f!==t.length-1&&!Um(u)?l:u),e)},s0),jh(e=>e!==s0),on(e=>Um(e)?e:!0===e),Go(1)))}class mG{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new c0,this.attachRef=null}}class c0{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const a=this.getOrCreateContext(e);a.outlet=t,this.contexts.set(e,a)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new mG,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}let L2=(()=>{class r{constructor(t,a,l,u,f){this.parentContexts=t,this.location=a,this.resolver=l,this.changeDetector=f,this.activated=null,this._activatedRoute=null,this.activateEvents=new Qt,this.deactivateEvents=new Qt,this.attachEvents=new Qt,this.detachEvents=new Qt,this.name=u||Wt,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,a){this.activated=t,this._activatedRoute=a,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,a){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const f=(a=a||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),g=this.parentContexts.getOrCreateContext(this.name).children,y=new _G(t,g,this.location.injector);this.activated=this.location.createComponent(f,this.location.length,y),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return r.\u0275fac=function(t){return new(t||r)(oe(c0),oe(uo),oe(nc),Lc("name"),oe(Fo))},r.\u0275dir=je({type:r,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),r})();class _G{constructor(e,t,a){this.route=e,this.childContexts=t,this.parent=a}get(e,t){return e===Fm?this.route:e===c0?this.childContexts:this.parent.get(e,t)}}let CB=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=Er({type:r,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,a){1&t&&At(0,"router-outlet")},directives:[L2],encapsulation:2}),r})();function bB(r,e=""){for(let t=0;t<r.length;t++){const a=r[t];gG(a,EG(e,a))}}function gG(r,e){r.children&&bB(r.children,e)}function EG(r,e){return e?r||e.path?r&&!e.path?`${r}/`:!r&&e.path?e.path:`${r}/${e.path}`:"":r}function x2(r){const e=r.children&&r.children.map(x2),t=e?Object.assign(Object.assign({},r),{children:e}):Object.assign({},r);return!t.component&&(e||t.loadChildren)&&t.outlet&&t.outlet!==Wt&&(t.component=CB),t}function Ma(r){return r.outlet||Wt}function TB(r,e){const t=r.filter(a=>Ma(a)===e);return t.push(...r.filter(a=>Ma(a)!==e)),t}const RB={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function TN(r,e,t){var a;if(""===e.path)return"full"===e.pathMatch&&(r.hasChildren()||t.length>0)?Object.assign({},RB):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const u=(e.matcher||N8)(t,r,e);if(!u)return Object.assign({},RB);const f={};io(u.posParams,(y,R)=>{f[R]=y.path});const g=u.consumed.length>0?Object.assign(Object.assign({},f),u.consumed[u.consumed.length-1].parameters):f;return{matched:!0,consumedSegments:u.consumed,remainingSegments:t.slice(u.consumed.length),parameters:g,positionalParamSegments:null!==(a=u.posParams)&&void 0!==a?a:{}}}function RN(r,e,t,a,l="corrected"){if(t.length>0&&function SG(r,e,t){return t.some(a=>IN(r,e,a)&&Ma(a)!==Wt)}(r,t,a)){const f=new tn(e,function yG(r,e,t,a){const l={};l[Wt]=a,a._sourceSegment=r,a._segmentIndexShift=e.length;for(const u of t)if(""===u.path&&Ma(u)!==Wt){const f=new tn([],{});f._sourceSegment=r,f._segmentIndexShift=e.length,l[Ma(u)]=f}return l}(r,e,a,new tn(t,r.children)));return f._sourceSegment=r,f._segmentIndexShift=e.length,{segmentGroup:f,slicedSegments:[]}}if(0===t.length&&function CG(r,e,t){return t.some(a=>IN(r,e,a))}(r,t,a)){const f=new tn(r.segments,function vG(r,e,t,a,l,u){const f={};for(const g of a)if(IN(r,t,g)&&!l[Ma(g)]){const y=new tn([],{});y._sourceSegment=r,y._segmentIndexShift="legacy"===u?r.segments.length:e.length,f[Ma(g)]=y}return Object.assign(Object.assign({},l),f)}(r,e,t,a,r.children,l));return f._sourceSegment=r,f._segmentIndexShift=e.length,{segmentGroup:f,slicedSegments:t}}const u=new tn(r.segments,r.children);return u._sourceSegment=r,u._segmentIndexShift=e.length,{segmentGroup:u,slicedSegments:t}}function IN(r,e,t){return(!(r.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function IB(r,e,t,a){return!!(Ma(r)===a||a!==Wt&&IN(e,t,r))&&("**"===r.path||TN(e,r,t).matched)}function wB(r,e,t){return 0===e.length&&!r.children[t]}class wN{constructor(e){this.segmentGroup=e||null}}class AB{constructor(e){this.urlTree=e}}function l0(r){return QT(new wN(r))}function DB(r){return QT(new AB(r))}function bG(r){return QT(new Error(`Only absolute redirects can have named outlets. redirectTo: '${r}'`))}class IG{constructor(e,t,a,l,u){this.configLoader=t,this.urlSerializer=a,this.urlTree=l,this.config=u,this.allowRedirects=!0,this.ngModule=e.get(va)}apply(){const e=RN(this.urlTree.root,[],[],this.config).segmentGroup,t=new tn(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,Wt).pipe(on(u=>this.createUrlTree(F2(u),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Mm(u=>{if(u instanceof AB)return this.allowRedirects=!1,this.match(u.urlTree);throw u instanceof wN?this.noMatchError(u):u}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,Wt).pipe(on(l=>this.createUrlTree(F2(l),e.queryParams,e.fragment))).pipe(Mm(l=>{throw l instanceof wN?this.noMatchError(l):l}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,a){const l=e.segments.length>0?new tn([],{[Wt]:e}):e;return new Lm(l,t,a)}expandSegmentGroup(e,t,a,l){return 0===a.segments.length&&a.hasChildren()?this.expandChildren(e,t,a).pipe(on(u=>new tn([],u))):this.expandSegment(e,a,t,a.segments,l,!0)}expandChildren(e,t,a){const l=[];for(const u of Object.keys(a.children))"primary"===u?l.unshift(u):l.push(u);return mr(l).pipe(ZT(u=>{const f=a.children[u],g=TB(t,u);return this.expandSegmentGroup(e,g,f,u).pipe(on(y=>({segment:y,outlet:u})))}),W3((u,f)=>(u[f.outlet]=f.segment,u),{}),function p8(r,e){const t=arguments.length>=2;return a=>a.pipe(r?jh((l,u)=>r(l,u,a)):Yh,C2(1),t?K3(e):z3(()=>new mN))}())}expandSegment(e,t,a,l,u,f){return mr(a).pipe(ZT(g=>this.expandSegmentAgainstRoute(e,t,a,g,l,u,f).pipe(Mm(R=>{if(R instanceof wN)return ut(null);throw R}))),Pv(g=>!!g),Mm((g,y)=>{if(g instanceof mN||"EmptyError"===g.name)return wB(t,l,u)?ut(new tn([],{})):l0(t);throw g}))}expandSegmentAgainstRoute(e,t,a,l,u,f,g){return IB(l,t,u,f)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(e,t,l,u,f):g&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,a,l,u,f):l0(t):l0(t)}expandSegmentAgainstRouteUsingRedirect(e,t,a,l,u,f){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,a,l,f):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,a,l,u,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,a,l){const u=this.applyRedirectCommands([],a.redirectTo,{});return a.redirectTo.startsWith("/")?DB(u):this.lineralizeSegments(a,u).pipe(Ni(f=>{const g=new tn(f,{});return this.expandSegment(e,g,t,f,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,a,l,u,f){const{matched:g,consumedSegments:y,remainingSegments:R,positionalParamSegments:D}=TN(t,l,u);if(!g)return l0(t);const x=this.applyRedirectCommands(y,l.redirectTo,D);return l.redirectTo.startsWith("/")?DB(x):this.lineralizeSegments(l,x).pipe(Ni(j=>this.expandSegment(e,t,a,j.concat(R),f,!1)))}matchSegmentAgainstRoute(e,t,a,l,u){if("**"===a.path)return a.loadChildren?(a._loadedConfig?ut(a._loadedConfig):this.configLoader.load(e.injector,a)).pipe(on(x=>(a._loadedConfig=x,new tn(l,{})))):ut(new tn(l,{}));const{matched:f,consumedSegments:g,remainingSegments:y}=TN(t,a,l);return f?this.getChildConfig(e,a,l).pipe(Ni(D=>{const x=D.module,j=D.routes,{segmentGroup:G,slicedSegments:q}=RN(t,g,y,j),se=new tn(G.segments,G.children);if(0===q.length&&se.hasChildren())return this.expandChildren(x,j,se).pipe(on(De=>new tn(g,De)));if(0===j.length&&0===q.length)return ut(new tn(g,{}));const ue=Ma(a)===u;return this.expandSegment(x,se,j,q,ue?Wt:u,!0).pipe(on(ce=>new tn(g.concat(ce.segments),ce.children)))})):l0(t)}getChildConfig(e,t,a){return t.children?ut(new M2(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?ut(t._loadedConfig):this.runCanLoadGuards(e.injector,t,a).pipe(Ni(l=>l?this.configLoader.load(e.injector,t).pipe(on(u=>(t._loadedConfig=u,u))):function TG(r){return QT(T2(`Cannot load children because the guard of the route "path: '${r.path}'" returned false`))}(t))):ut(new M2([],e))}runCanLoadGuards(e,t,a){const l=t.canLoad;if(!l||0===l.length)return ut(!0);const u=l.map(f=>{const g=e.get(f);let y;if(function uG(r){return r&&Gh(r.canLoad)}(g))y=g.canLoad(t,a);else{if(!Gh(g))throw new Error("Invalid CanLoad guard");y=g(t,a)}return bl(y)});return ut(u).pipe(a0(),Wo(f=>{if(!Um(f))return;const g=T2(`Redirecting to "${this.urlSerializer.serialize(f)}"`);throw g.url=f,g}),on(f=>!0===f))}lineralizeSegments(e,t){let a=[],l=t.root;for(;;){if(a=a.concat(l.segments),0===l.numberOfChildren)return ut(a);if(l.numberOfChildren>1||!l.children[Wt])return bG(e.redirectTo);l=l.children[Wt]}}applyRedirectCommands(e,t,a){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,a)}applyRedirectCreatreUrlTree(e,t,a,l){const u=this.createSegmentGroup(e,t.root,a,l);return new Lm(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const a={};return io(e,(l,u)=>{if("string"==typeof l&&l.startsWith(":")){const g=l.substring(1);a[u]=t[g]}else a[u]=l}),a}createSegmentGroup(e,t,a,l){const u=this.createSegments(e,t.segments,a,l);let f={};return io(t.children,(g,y)=>{f[y]=this.createSegmentGroup(e,g,a,l)}),new tn(u,f)}createSegments(e,t,a,l){return t.map(u=>u.path.startsWith(":")?this.findPosParam(e,u,l):this.findOrReturn(u,a))}findPosParam(e,t,a){const l=a[t.path.substring(1)];if(!l)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return l}findOrReturn(e,t){let a=0;for(const l of t){if(l.path===e.path)return t.splice(a),l;a++}return e}}function F2(r){const e={};for(const a of Object.keys(r.children)){const u=F2(r.children[a]);(u.segments.length>0||u.hasChildren())&&(e[a]=u)}return function wG(r){if(1===r.numberOfChildren&&r.children[Wt]){const e=r.children[Wt];return new tn(r.segments.concat(e.segments),e.children)}return r}(new tn(r.segments,e))}class OB{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class AN{constructor(e,t){this.component=e,this.route=t}}function DG(r,e,t){const a=r._root;return d0(a,e?e._root:null,t,[a.value])}function DN(r,e,t){const a=function NG(r){if(!r)return null;for(let e=r.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(a?a.module.injector:t).get(r)}function d0(r,e,t,a,l={canDeactivateChecks:[],canActivateChecks:[]}){const u=Mv(e);return r.children.forEach(f=>{(function PG(r,e,t,a,l={canDeactivateChecks:[],canActivateChecks:[]}){const u=r.value,f=e?e.value:null,g=t?t.getContext(r.value.outlet):null;if(f&&u.routeConfig===f.routeConfig){const y=function kG(r,e,t){if("function"==typeof t)return t(r,e);switch(t){case"pathParamsChange":return!xm(r.url,e.url);case"pathParamsOrQueryParamsChange":return!xm(r.url,e.url)||!Cl(r.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!O2(r,e)||!Cl(r.queryParams,e.queryParams);default:return!O2(r,e)}}(f,u,u.routeConfig.runGuardsAndResolvers);y?l.canActivateChecks.push(new OB(a)):(u.data=f.data,u._resolvedData=f._resolvedData),d0(r,e,u.component?g?g.children:null:t,a,l),y&&g&&g.outlet&&g.outlet.isActivated&&l.canDeactivateChecks.push(new AN(g.outlet.component,f))}else f&&u0(e,g,l),l.canActivateChecks.push(new OB(a)),d0(r,null,u.component?g?g.children:null:t,a,l)})(f,u[f.value.outlet],t,a.concat([f.value]),l),delete u[f.value.outlet]}),io(u,(f,g)=>u0(f,t.getContext(g),l)),l}function u0(r,e,t){const a=Mv(r),l=r.value;io(a,(u,f)=>{u0(u,l.component?e?e.children.getContext(f):null:e,t)}),t.canDeactivateChecks.push(new AN(l.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,l))}class HG{}function NB(r){return new Cn(e=>e.error(r))}class WG{constructor(e,t,a,l,u,f){this.rootComponentType=e,this.config=t,this.urlTree=a,this.url=l,this.paramsInheritanceStrategy=u,this.relativeLinkResolution=f}recognize(){const e=RN(this.urlTree.root,[],[],this.config.filter(f=>void 0===f.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,Wt);if(null===t)return null;const a=new SN([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Wt,this.rootComponentType,null,this.urlTree.root,-1,{}),l=new Fd(a,t),u=new mB(this.url,l);return this.inheritParamsAndData(u._root),u}inheritParamsAndData(e){const t=e.value,a=fB(t,this.paramsInheritanceStrategy);t.params=Object.freeze(a.params),t.data=Object.freeze(a.data),e.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(e,t,a){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,a)}processChildren(e,t){const a=[];for(const u of Object.keys(t.children)){const f=t.children[u],g=TB(e,u),y=this.processSegmentGroup(g,f,u);if(null===y)return null;a.push(...y)}const l=PB(a);return function zG(r){r.sort((e,t)=>e.value.outlet===Wt?-1:t.value.outlet===Wt?1:e.value.outlet.localeCompare(t.value.outlet))}(l),l}processSegment(e,t,a,l){for(const u of e){const f=this.processSegmentAgainstRoute(u,t,a,l);if(null!==f)return f}return wB(t,a,l)?[]:null}processSegmentAgainstRoute(e,t,a,l){if(e.redirectTo||!IB(e,t,a,l))return null;let u,f=[],g=[];if("**"===e.path){const G=a.length>0?eB(a).parameters:{};u=new SN(a,G,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,LB(e),Ma(e),e.component,e,kB(t),MB(t)+a.length,xB(e))}else{const G=TN(t,e,a);if(!G.matched)return null;f=G.consumedSegments,g=G.remainingSegments,u=new SN(f,G.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,LB(e),Ma(e),e.component,e,kB(t),MB(t)+f.length,xB(e))}const y=function KG(r){return r.children?r.children:r.loadChildren?r._loadedConfig.routes:[]}(e),{segmentGroup:R,slicedSegments:D}=RN(t,f,g,y.filter(G=>void 0===G.redirectTo),this.relativeLinkResolution);if(0===D.length&&R.hasChildren()){const G=this.processChildren(y,R);return null===G?null:[new Fd(u,G)]}if(0===y.length&&0===D.length)return[new Fd(u,[])];const x=Ma(e)===l,j=this.processSegment(y,R,D,x?Wt:l);return null===j?null:[new Fd(u,j)]}}function qG(r){const e=r.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function PB(r){const e=[],t=new Set;for(const a of r){if(!qG(a)){e.push(a);continue}const l=e.find(u=>a.value.routeConfig===u.value.routeConfig);void 0!==l?(l.children.push(...a.children),t.add(l)):e.push(a)}for(const a of t){const l=PB(a.children);e.push(new Fd(a.value,l))}return e.filter(a=>!t.has(a))}function kB(r){let e=r;for(;e._sourceSegment;)e=e._sourceSegment;return e}function MB(r){let e=r,t=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift?e._segmentIndexShift:0;return t-1}function LB(r){return r.data||{}}function xB(r){return r.resolve||{}}function FB(r){return[...Object.keys(r),...Object.getOwnPropertySymbols(r)]}function U2(r){return Ld(e=>{const t=r(e);return t?mr(t).pipe(on(()=>e)):ut(e)})}class tW extends class eW{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const V2=new Le("ROUTES");class UB{constructor(e,t,a,l){this.injector=e,this.compiler=t,this.onLoadStartListener=a,this.onLoadEndListener=l}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const l=this.loadModuleFactory(t.loadChildren).pipe(on(u=>{this.onLoadEndListener&&this.onLoadEndListener(t);const f=u.create(e);return new M2(Z3(f.injector.get(V2,void 0,et.Self|et.Optional)).map(x2),f)}),Mm(u=>{throw t._loader$=void 0,u}));return t._loader$=new Xv(l,()=>new hn).pipe(Zn()),t._loader$}loadModuleFactory(e){return bl(e()).pipe(Ni(t=>t instanceof DC?ut(t):mr(this.compiler.compileModuleAsync(t))))}}class iW{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function rW(r){throw r}function oW(r,e,t){return e.parse("/")}function VB(r,e){return ut(null)}const sW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},aW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let zo=(()=>{class r{constructor(t,a,l,u,f,g,y){this.rootComponentType=t,this.urlSerializer=a,this.rootContexts=l,this.location=u,this.config=y,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new hn,this.errorHandler=rW,this.malformedUriErrorHandler=oW,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:VB,afterPreactivation:VB},this.urlHandlingStrategy=new iW,this.routeReuseStrategy=new tW,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=f.get(va),this.console=f.get(N);const x=f.get(yt);this.isNgZoneEnabled=x instanceof yt&&yt.isInAngularZone(),this.resetConfig(y),this.currentUrlTree=function k8(){return new Lm(new tn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new UB(f,g,j=>this.triggerEvent(new Y3(j)),j=>this.triggerEvent(new $3(j))),this.routerState=pB(this.currentUrlTree,this.rootComponentType),this.transitions=new Yn({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const a=this.events;return t.pipe(jh(l=>0!==l.id),on(l=>Object.assign(Object.assign({},l),{extractedUrl:this.urlHandlingStrategy.extract(l.rawUrl)})),Ld(l=>{let u=!1,f=!1;return ut(l).pipe(Wo(g=>{this.currentNavigation={id:g.id,initialUrl:g.currentRawUrl,extractedUrl:g.extractedUrl,trigger:g.source,extras:g.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Ld(g=>{const y=this.browserUrlTree.toString(),R=!this.navigated||g.extractedUrl.toString()!==y||y!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||R)&&this.urlHandlingStrategy.shouldProcessUrl(g.rawUrl))return BB(g.source)&&(this.browserUrlTree=g.extractedUrl),ut(g).pipe(Ld(x=>{const j=this.transitions.getValue();return a.next(new b2(x.id,this.serializeUrl(x.extractedUrl),x.source,x.restoredState)),j!==this.transitions.getValue()?Pm:Promise.resolve(x)}),function AG(r,e,t,a){return Ld(l=>function RG(r,e,t,a,l){return new IG(r,e,t,a,l).apply()}(r,e,t,l.extractedUrl,a).pipe(on(u=>Object.assign(Object.assign({},l),{urlAfterRedirects:u}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Wo(x=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:x.urlAfterRedirects})}),function YG(r,e,t,a,l){return Ni(u=>function GG(r,e,t,a,l="emptyOnly",u="legacy"){try{const f=new WG(r,e,t,a,l,u).recognize();return null===f?NB(new HG):ut(f)}catch(f){return NB(f)}}(r,e,u.urlAfterRedirects,t(u.urlAfterRedirects),a,l).pipe(on(f=>Object.assign(Object.assign({},u),{targetSnapshot:f}))))}(this.rootComponentType,this.config,x=>this.serializeUrl(x),this.paramsInheritanceStrategy,this.relativeLinkResolution),Wo(x=>{if("eager"===this.urlUpdateStrategy){if(!x.extras.skipLocationChange){const G=this.urlHandlingStrategy.merge(x.urlAfterRedirects,x.rawUrl);this.setBrowserUrl(G,x)}this.browserUrlTree=x.urlAfterRedirects}const j=new y8(x.id,this.serializeUrl(x.extractedUrl),this.serializeUrl(x.urlAfterRedirects),x.targetSnapshot);a.next(j)}));if(R&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:j,extractedUrl:G,source:q,restoredState:se,extras:ue}=g,Ce=new b2(j,this.serializeUrl(G),q,se);a.next(Ce);const ce=pB(G,this.rootComponentType).snapshot;return ut(Object.assign(Object.assign({},g),{targetSnapshot:ce,urlAfterRedirects:G,extras:Object.assign(Object.assign({},ue),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=g.rawUrl,g.resolve(null),Pm}),U2(g=>{const{targetSnapshot:y,id:R,extractedUrl:D,rawUrl:x,extras:{skipLocationChange:j,replaceUrl:G}}=g;return this.hooks.beforePreactivation(y,{navigationId:R,appliedUrlTree:D,rawUrlTree:x,skipLocationChange:!!j,replaceUrl:!!G})}),Wo(g=>{const y=new S8(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot);this.triggerEvent(y)}),on(g=>Object.assign(Object.assign({},g),{guards:DG(g.targetSnapshot,g.currentSnapshot,this.rootContexts)})),function MG(r,e){return Ni(t=>{const{targetSnapshot:a,currentSnapshot:l,guards:{canActivateChecks:u,canDeactivateChecks:f}}=t;return 0===f.length&&0===u.length?ut(Object.assign(Object.assign({},t),{guardsResult:!0})):function LG(r,e,t,a){return mr(r).pipe(Ni(l=>function jG(r,e,t,a,l){const u=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return u&&0!==u.length?ut(u.map(g=>{const y=DN(g,e,l);let R;if(function fG(r){return r&&Gh(r.canDeactivate)}(y))R=bl(y.canDeactivate(r,e,t,a));else{if(!Gh(y))throw new Error("Invalid CanDeactivate guard");R=bl(y(r,e,t,a))}return R.pipe(Pv())})).pipe(a0()):ut(!0)}(l.component,l.route,t,e,a)),Pv(l=>!0!==l,!0))}(f,a,l,r).pipe(Ni(g=>g&&function dG(r){return"boolean"==typeof r}(g)?function xG(r,e,t,a){return mr(e).pipe(ZT(l=>uN(function UG(r,e){return null!==r&&e&&e(new R8(r)),ut(!0)}(l.route.parent,a),function FG(r,e){return null!==r&&e&&e(new w8(r)),ut(!0)}(l.route,a),function BG(r,e,t){const a=e[e.length-1],u=e.slice(0,e.length-1).reverse().map(f=>function OG(r){const e=r.routeConfig?r.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:r,guards:e}:null}(f)).filter(f=>null!==f).map(f=>G3(()=>ut(f.guards.map(y=>{const R=DN(y,f.node,t);let D;if(function pG(r){return r&&Gh(r.canActivateChild)}(R))D=bl(R.canActivateChild(a,r));else{if(!Gh(R))throw new Error("Invalid CanActivateChild guard");D=bl(R(a,r))}return D.pipe(Pv())})).pipe(a0())));return ut(u).pipe(a0())}(r,l.path,t),function VG(r,e,t){const a=e.routeConfig?e.routeConfig.canActivate:null;if(!a||0===a.length)return ut(!0);const l=a.map(u=>G3(()=>{const f=DN(u,e,t);let g;if(function hG(r){return r&&Gh(r.canActivate)}(f))g=bl(f.canActivate(e,r));else{if(!Gh(f))throw new Error("Invalid CanActivate guard");g=bl(f(e,r))}return g.pipe(Pv())}));return ut(l).pipe(a0())}(r,l.route,t))),Pv(l=>!0!==l,!0))}(a,u,r,e):ut(g)),on(g=>Object.assign(Object.assign({},t),{guardsResult:g})))})}(this.ngModule.injector,g=>this.triggerEvent(g)),Wo(g=>{if(Um(g.guardsResult)){const R=T2(`Redirecting to "${this.serializeUrl(g.guardsResult)}"`);throw R.url=g.guardsResult,R}const y=new C8(g.id,this.serializeUrl(g.extractedUrl),this.serializeUrl(g.urlAfterRedirects),g.targetSnapshot,!!g.guardsResult);this.triggerEvent(y)}),jh(g=>!!g.guardsResult||(this.restoreHistory(g),this.cancelNavigationTransition(g,""),!1)),U2(g=>{if(g.guards.canActivateChecks.length)return ut(g).pipe(Wo(y=>{const R=new b8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(R)}),Ld(y=>{let R=!1;return ut(y).pipe(function $G(r,e){return Ni(t=>{const{targetSnapshot:a,guards:{canActivateChecks:l}}=t;if(!l.length)return ut(t);let u=0;return mr(l).pipe(ZT(f=>function XG(r,e,t,a){return function JG(r,e,t,a){const l=FB(r);if(0===l.length)return ut({});const u={};return mr(l).pipe(Ni(f=>function QG(r,e,t,a){const l=DN(r,e,a);return bl(l.resolve?l.resolve(e,t):l(e,t))}(r[f],e,t,a).pipe(Wo(g=>{u[f]=g}))),C2(1),Ni(()=>FB(u).length===l.length?ut(u):Pm))}(r._resolve,r,e,a).pipe(on(u=>(r._resolvedData=u,r.data=Object.assign(Object.assign({},r.data),fB(r,t).resolve),null)))}(f.route,a,r,e)),Wo(()=>u++),C2(1),Ni(f=>u===l.length?ut(t):Pm))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Wo({next:()=>R=!0,complete:()=>{R||(this.restoreHistory(y),this.cancelNavigationTransition(y,"At least one route resolver didn't emit any value."))}}))}),Wo(y=>{const R=new T8(y.id,this.serializeUrl(y.extractedUrl),this.serializeUrl(y.urlAfterRedirects),y.targetSnapshot);this.triggerEvent(R)}))}),U2(g=>{const{targetSnapshot:y,id:R,extractedUrl:D,rawUrl:x,extras:{skipLocationChange:j,replaceUrl:G}}=g;return this.hooks.afterPreactivation(y,{navigationId:R,appliedUrlTree:D,rawUrlTree:x,skipLocationChange:!!j,replaceUrl:!!G})}),on(g=>{const y=function J8(r,e,t){const a=r0(r,e._root,t?t._root:void 0);return new hB(a,e)}(this.routeReuseStrategy,g.targetSnapshot,g.currentRouterState);return Object.assign(Object.assign({},g),{targetRouterState:y})}),Wo(g=>{this.currentUrlTree=g.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(g.urlAfterRedirects,g.rawUrl),this.routerState=g.targetRouterState,"deferred"===this.urlUpdateStrategy&&(g.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,g),this.browserUrlTree=g.urlAfterRedirects)}),((r,e,t)=>on(a=>(new cG(e,a.targetRouterState,a.currentRouterState,t).activate(r),a)))(this.rootContexts,this.routeReuseStrategy,g=>this.triggerEvent(g)),Wo({next(){u=!0},complete(){u=!0}}),function _8(r){return e=>e.lift(new g8(r))}(()=>{var g;u||f||this.cancelNavigationTransition(l,`Navigation ID ${l.id} is not equal to the current navigation id ${this.navigationId}`),(null===(g=this.currentNavigation)||void 0===g?void 0:g.id)===l.id&&(this.currentNavigation=null)}),Mm(g=>{if(f=!0,function O8(r){return r&&r[J3]}(g)){const y=Um(g.url);y||(this.navigated=!0,this.restoreHistory(l,!0));const R=new q3(l.id,this.serializeUrl(l.extractedUrl),g.message);a.next(R),y?setTimeout(()=>{const D=this.urlHandlingStrategy.merge(g.url,this.rawUrlTree),x={skipLocationChange:l.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||BB(l.source)};this.scheduleNavigation(D,"imperative",null,x,{resolve:l.resolve,reject:l.reject,promise:l.promise})},0):l.resolve(!1)}else{this.restoreHistory(l,!0);const y=new v8(l.id,this.serializeUrl(l.extractedUrl),g);a.next(y);try{l.resolve(this.errorHandler(g))}catch(R){l.reject(R)}}return Pm}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const a="popstate"===t.type?"popstate":"hashchange";"popstate"===a&&setTimeout(()=>{var l;const u={replaceUrl:!0},f=(null===(l=t.state)||void 0===l?void 0:l.navigationId)?t.state:null;if(f){const y=Object.assign({},f);delete y.navigationId,delete y.\u0275routerPageId,0!==Object.keys(y).length&&(u.state=y)}const g=this.parseUrl(t.url);this.scheduleNavigation(g,a,f,u)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){bB(t),this.config=t.map(x2),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,a={}){const{relativeTo:l,queryParams:u,fragment:f,queryParamsHandling:g,preserveFragment:y}=a,R=l||this.routerState.root,D=y?this.currentUrlTree.fragment:f;let x=null;switch(g){case"merge":x=Object.assign(Object.assign({},this.currentUrlTree.queryParams),u);break;case"preserve":x=this.currentUrlTree.queryParams;break;default:x=u||null}return null!==x&&(x=this.removeEmptyProps(x)),function eG(r,e,t,a,l){if(0===t.length)return N2(e.root,e.root,e.root,a,l);const u=function tG(r){if("string"==typeof r[0]&&1===r.length&&"/"===r[0])return new EB(!0,0,r);let e=0,t=!1;const a=r.reduce((l,u,f)=>{if("object"==typeof u&&null!=u){if(u.outlets){const g={};return io(u.outlets,(y,R)=>{g[R]="string"==typeof y?y.split("/"):y}),[...l,{outlets:g}]}if(u.segmentPath)return[...l,u.segmentPath]}return"string"!=typeof u?[...l,u]:0===f?(u.split("/").forEach((g,y)=>{0==y&&"."===g||(0==y&&""===g?t=!0:".."===g?e++:""!=g&&l.push(g))}),l):[...l,u]},[]);return new EB(t,e,a)}(t);if(u.toRoot())return N2(e.root,e.root,new tn([],{}),a,l);const f=function nG(r,e,t){if(r.isAbsolute)return new P2(e.root,!0,0);if(-1===t.snapshot._lastPathIndex){const u=t.snapshot._urlSegment;return new P2(u,u===e.root,0)}const a=CN(r.commands[0])?0:1;return function iG(r,e,t){let a=r,l=e,u=t;for(;u>l;){if(u-=l,a=a.parent,!a)throw new Error("Invalid number of '../'");l=a.segments.length}return new P2(a,!1,l-u)}(t.snapshot._urlSegment,t.snapshot._lastPathIndex+a,r.numberOfDoubleDots)}(u,e,r),g=f.processChildren?bN(f.segmentGroup,f.index,u.commands):vB(f.segmentGroup,f.index,u.commands);return N2(e.root,f.segmentGroup,g,a,l)}(R,this.currentUrlTree,t,x,null!=D?D:null)}navigateByUrl(t,a={skipLocationChange:!1}){const l=Um(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(u,"imperative",null,a)}navigate(t,a={skipLocationChange:!1}){return function cW(r){for(let e=0;e<r.length;e++){const t=r[e];if(null==t)throw new Error(`The requested path contains ${t} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,a),a)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let a;try{a=this.urlSerializer.parse(t)}catch(l){a=this.malformedUriErrorHandler(l,this.urlSerializer,t)}return a}isActive(t,a){let l;if(l=!0===a?Object.assign({},sW):!1===a?Object.assign({},aW):a,Um(t))return nB(this.currentUrlTree,t,l);const u=this.parseUrl(t);return nB(this.currentUrlTree,u,l)}removeEmptyProps(t){return Object.keys(t).reduce((a,l)=>{const u=t[l];return null!=u&&(a[l]=u),a},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new e0(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,a,l,u,f){var g,y;if(this.disposed)return Promise.resolve(!1);let R,D,x;f?(R=f.resolve,D=f.reject,x=f.promise):x=new Promise((q,se)=>{R=q,D=se});const j=++this.navigationId;let G;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(l=this.location.getState()),G=l&&l.\u0275routerPageId?l.\u0275routerPageId:u.replaceUrl||u.skipLocationChange?null!==(g=this.browserPageId)&&void 0!==g?g:0:(null!==(y=this.browserPageId)&&void 0!==y?y:0)+1):G=0,this.setTransition({id:j,targetPageId:G,source:a,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:u,resolve:R,reject:D,promise:x,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),x.catch(q=>Promise.reject(q))}setBrowserUrl(t,a){const l=this.urlSerializer.serialize(t),u=Object.assign(Object.assign({},a.extras.state),this.generateNgRouterState(a.id,a.targetPageId));this.location.isCurrentPathEqualTo(l)||a.extras.replaceUrl?this.location.replaceState(l,"",u):this.location.go(l,"",u)}restoreHistory(t,a=!1){var l,u;if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(l=this.currentNavigation)||void 0===l?void 0:l.finalUrl)||0===f?this.currentUrlTree===(null===(u=this.currentNavigation)||void 0===u?void 0:u.finalUrl)&&0===f&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(f)}else"replace"===this.canceledNavigationResolution&&(a&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,a){const l=new q3(t.id,this.serializeUrl(t.extractedUrl),a);this.triggerEvent(l),t.resolve(!1)}generateNgRouterState(t,a){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:a}:{navigationId:t}}}return r.\u0275fac=function(t){Cg()},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();function BB(r){return"imperative"!==r}class jB{}class HB{preload(e,t){return ut(null)}}let GB=(()=>{class r{constructor(t,a,l,u){this.router=t,this.injector=l,this.preloadingStrategy=u,this.loader=new UB(l,a,y=>t.triggerEvent(new Y3(y)),y=>t.triggerEvent(new $3(y)))}setUpPreloading(){this.subscription=this.router.events.pipe(jh(t=>t instanceof e0),ZT(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(va);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,a){const l=[];for(const u of a)if(u.loadChildren&&!u.canLoad&&u._loadedConfig){const f=u._loadedConfig;l.push(this.processRoutes(f.module,f.routes))}else u.loadChildren&&!u.canLoad?l.push(this.preloadConfig(t,u)):u.children&&l.push(this.processRoutes(t,u.children));return mr(l).pipe(Dc(),on(u=>{}))}preloadConfig(t,a){return this.preloadingStrategy.preload(a,()=>(a._loadedConfig?ut(a._loadedConfig):this.loader.load(t.injector,a)).pipe(Ni(u=>(a._loadedConfig=u,this.processRoutes(u.module,u.routes)))))}}return r.\u0275fac=function(t){return new(t||r)(he(zo),he(VA),he(ir),he(jB))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})(),H2=(()=>{class r{constructor(t,a,l={}){this.router=t,this.viewportScroller=a,this.options=l,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},l.scrollPositionRestoration=l.scrollPositionRestoration||"disabled",l.anchorScrolling=l.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof b2?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof e0&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof X3&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,a){this.router.triggerEvent(new X3(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,a))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return r.\u0275fac=function(t){Cg()},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();const Vm=new Le("ROUTER_CONFIGURATION"),WB=new Le("ROUTER_FORROOT_GUARD"),hW=[gE,{provide:sB,useClass:aB},{provide:zo,useFactory:function EW(r,e,t,a,l,u,f={},g,y){const R=new zo(null,r,e,t,a,l,Z3(u));return g&&(R.urlHandlingStrategy=g),y&&(R.routeReuseStrategy=y),function vW(r,e){r.errorHandler&&(e.errorHandler=r.errorHandler),r.malformedUriErrorHandler&&(e.malformedUriErrorHandler=r.malformedUriErrorHandler),r.onSameUrlNavigation&&(e.onSameUrlNavigation=r.onSameUrlNavigation),r.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=r.paramsInheritanceStrategy),r.relativeLinkResolution&&(e.relativeLinkResolution=r.relativeLinkResolution),r.urlUpdateStrategy&&(e.urlUpdateStrategy=r.urlUpdateStrategy),r.canceledNavigationResolution&&(e.canceledNavigationResolution=r.canceledNavigationResolution)}(f,R),f.enableTracing&&R.events.subscribe(D=>{var x,j;null===(x=console.group)||void 0===x||x.call(console,`Router Event: ${D.constructor.name}`),console.log(D.toString()),console.log(D),null===(j=console.groupEnd)||void 0===j||j.call(console)}),R},deps:[sB,c0,gE,ir,VA,V2,Vm,[class nW{},new Fc],[class ZG{},new Fc]]},c0,{provide:Fm,useFactory:function yW(r){return r.routerState.root},deps:[zo]},GB,HB,class uW{preload(e,t){return t().pipe(Mm(()=>ut(null)))}},{provide:Vm,useValue:{enableTracing:!1}}];function pW(){return new Te("Router",zo)}let fW=(()=>{class r{constructor(t,a){}static forRoot(t,a){return{ngModule:r,providers:[hW,zB(t),{provide:WB,useFactory:gW,deps:[[zo,new Fc,new du]]},{provide:Vm,useValue:a||{}},{provide:zn,useFactory:_W,deps:[nl,[new w_(_E),new Fc],Vm]},{provide:H2,useFactory:mW,deps:[zo,YL,Vm]},{provide:jB,useExisting:a&&a.preloadingStrategy?a.preloadingStrategy:HB},{provide:Te,multi:!0,useFactory:pW},[G2,{provide:ya,multi:!0,useFactory:SW,deps:[G2]},{provide:KB,useFactory:CW,deps:[G2]},{provide:Vs,multi:!0,useExisting:KB}]]}}static forChild(t){return{ngModule:r,providers:[zB(t)]}}}return r.\u0275fac=function(t){return new(t||r)(he(WB,8),he(zo,8))},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({}),r})();function mW(r,e,t){return t.scrollOffset&&e.setOffset(t.scrollOffset),new H2(r,e,t)}function _W(r,e,t={}){return t.useHash?new Tt(r,e):new Qr(r,e)}function gW(r){return"guarded"}function zB(r){return[{provide:C_,multi:!0,useValue:r},{provide:V2,multi:!0,useValue:r}]}let G2=(()=>{class r{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new hn}appInitializer(){return this.injector.get(Nr,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let a=null;const l=new Promise(g=>a=g),u=this.injector.get(zo),f=this.injector.get(Vm);return"disabled"===f.initialNavigation?(u.setUpLocationChangeListener(),a(!0)):"enabled"===f.initialNavigation||"enabledBlocking"===f.initialNavigation?(u.hooks.afterPreactivation=()=>this.initNavigation?ut(null):(this.initNavigation=!0,a(!0),this.resultOfPreactivationDone),u.initialNavigation()):a(!0),l})}bootstrapListener(t){const a=this.injector.get(Vm),l=this.injector.get(GB),u=this.injector.get(H2),f=this.injector.get(zo),g=this.injector.get(ss);t===g.components[0]&&(("enabledNonBlocking"===a.initialNavigation||void 0===a.initialNavigation)&&f.initialNavigation(),l.setUpPreloading(),u.init(),f.resetRootComponentType(g.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return r.\u0275fac=function(t){return new(t||r)(he(ir))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac}),r})();function SW(r){return r.appInitializer.bind(r)}function CW(r){return r.bootstrapListener.bind(r)}const KB=new Le("Router Initializer"),qB_configs={AppID:"fee9eb8f5bb44a6893ec96fd5e993a31"};let TW=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=Er({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(t,a){1&t&&At(0,"router-outlet")},directives:[L2],styles:[""],changeDetection:0}),r})();const ON_HIDDEN={opacity:0,"margin-top":"100%"},ON_SHOWN={opacity:1,"margin-top":0},YB=Ux("fade",[KT(":enter",[Ss(ON_HIDDEN),zT("250ms ease-in-out",Ss(ON_SHOWN))]),KT(":leave",[Ss(ON_SHOWN),zT("250ms ease-in-out",Ss(ON_HIDDEN))])]);class $B{constructor(e){this.cdr=e,this.afterClosed=new hn,this.shown=!0}closeDialog(e){this.onAfterClosed(e)}onAfterClosed(e){this.shown=!1,this.cdr.markForCheck(),this.afterClosed.next(e)}}var RW=Kh(537),IW=Kh.n(RW);function W2(r=0,e=wv){return(!E2(r)||r<0)&&(r=0),(!e||"function"!=typeof e.schedule)&&(e=wv),new Cn(t=>(t.add(e.schedule(wW,r,{subscriber:t,counter:0,period:r})),t))}function wW(r){const{subscriber:e,counter:t,period:a}=r;e.next(t),this.schedule({subscriber:e,counter:t+1,period:a},a)}const XB={connected:!1,loading:!0,statusText:"Initializing",started:null,ended:!1,error:!1},AW={mode:"rtc",codec:"h264"};let JB=(()=>{class r{constructor(t){this.config=t,this.agoraRTC=IW(),this.streamState=new Yn(XB),this.remoteStreamVideoToggle=new Yn(!0),this.callEnd=new hn,this.localContainerId="local-video",this.remoteCalls=[],this.remoteStreamVideoToggle$=this.remoteStreamVideoToggle.asObservable(),this.streamState$=this.streamState.asObservable(),this.agoraRTC.checkSystemRequirements()||this.handleError(new Error("Web RTC is not supported in this browser"))}init(t,a,l=!1){return this.uid=t,this.agoraRTC.setLogLevel(l?0:4),this.client=this.agoraRTC.createClient(AW),this.assignClientHandlers(),this.initLocalStream().then(()=>{this.client.join(this.config.AppID,a,null,this.uid).then(()=>{this.localTracks.videoTrack.play(this.localContainerId),this.client.publish(Object.values(this.localTracks)),this.streamState.next(Object.assign(Object.assign({},this.streamState.value),{connected:!0,statusText:"Waiting others to join"}))})}),this.callEnd.asObservable()}deinit(){this.streamState.next(XB)}endCall(){this.client.leave().then(()=>{Object.values(this.localTracks).forEach(t=>{t.stop(),t.close()}),this.streamState.next(Object.assign(Object.assign({},this.streamState.value),{started:null,loading:!0,statusText:"",ended:!0})),this.remoteCalls=[],W2(500).pipe(Go(1)).subscribe(()=>this.callEnd.next())})}toggleVideo(t){this.localTracks&&this.localTracks.videoTrack.setMuted(t)}toggleAudio(t){this.localTracks&&this.localTracks.audioTrack.setMuted(t)}toggleFullScreen(t){t?document.exitFullscreen():document.documentElement.requestFullscreen()}isVideoEnabled(){return!!this.localTracks&&!this.localTracks.videoTrack.muted}isAudioEnabled(){return!!this.localTracks&&!this.localTracks.audioTrack.muted}assignClientHandlers(){this.client.on("user-joined",t=>{this.streamState.next(Object.assign(Object.assign({},this.streamState.value),{started:Date.now(),loading:!1})),this.remoteCalls.length||this.remoteCalls.push(this.getRemoteId(t))}),this.client.on("user-published",(t,a)=>{const l=this.getRemoteId(t);this.client.subscribe(t,a).then(u=>{this.remoteCalls.includes(l)&&u.play(l)})}),this.client.on("user-info-updated",(t,a)=>{"mute-video"===a&&this.remoteStreamVideoToggle.next(!1),"unmute-video"===a&&this.remoteStreamVideoToggle.next(!0)}),this.client.on("user-left",()=>{this.endCall()})}initLocalStream(){return Promise.all([this.agoraRTC.createCameraVideoTrack(),this.agoraRTC.createMicrophoneAudioTrack()]).then(([t,a])=>{this.localTracks={audioTrack:a,videoTrack:t}}).catch(t=>{this.handleError(t)})}getRemoteId(t){return`remote_call-${t.uid}`}handleError(t){throw this.streamState.next(Object.assign(Object.assign({},this.streamState.value),{statusText:t.message,error:!0})),W2(5e3).pipe(Go(1)).subscribe(()=>this.callEnd.next()),new Error(t.message)}}return r.\u0275fac=function(t){return new(t||r)(he("AgoraConfig"))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function DW(r,e){if(1&r&&(Ae(0,"div",8),Yi(1),Be()),2&r){const t=Xt();Je(1),Yc(t.text)}}const OW=function(r,e,t,a){return{"spinner--connected":r,"spinner--ended":e,"spinner--small":t,"spinner--error":a}};let NW=(()=>{class r{constructor(){this.error=!1,this.connected=!0,this.ended=!1,this.small=!1}get color(){return this.ended?"#aaa":this.error?"#d73b3d":this.connected?"#37D425":"#1195E6"}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=Er({type:r,selectors:[["ngx-spinner"]],inputs:{text:"text",error:"error",connected:"connected",ended:"ended",small:"small"},decls:8,vars:9,consts:[[1,"spinner",3,"ngClass"],[1,"spinner__wrapper"],[1,"spinner__icon"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 32 32","fill","none"],["d","M5.25 5.5C3.45507 5.5 2 6.95508 2 8.75V19.25C2 21.0449 3.45507 22.5 5.25 22.5H14.75C16.5449 22.5 18 21.0449 18 19.25V8.75C18 6.95507 16.5449 5.5 14.75 5.5H5.25Z"],["d","M23.1232 20.6431L19.5 17.0935V10.9989L23.1121 7.3706C23.8988 6.58044 25.248 7.13753 25.248 8.25251V19.7502C25.248 20.8577 23.9143 21.4181 23.1232 20.6431Z"],[1,"spinner__cirle"],["class","spinner__text",4,"ngIf"],[1,"spinner__text"]],template:function(t,a){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2),ws(),Ae(3,"svg",3),At(4,"path",4)(5,"path",5),Be()(),As(),At(6,"div",6),jn(7,DW,2,1,"div",7),Be()()),2&t&&(ot("ngClass",fA(4,OW,a.connected,a.ended,a.small,a.error)),Je(4),rr("fill",a.color),Je(1),rr("fill",a.color),Je(2),ot("ngIf",!a.small))},directives:[Gs,al],styles:[".spinner[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;position:relative;transition:.3s}.spinner--connected[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#37d425}.spinner--ended[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:transparent}.spinner--error[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-color:#d73b3d}.spinner--small[_ngcontent-%COMP%]{border-radius:10px;height:200px}.spinner--small[_ngcontent-%COMP%]   .spinner__cirle[_ngcontent-%COMP%]{border-width:4px;height:80px;width:80px}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]{top:26px;transform:translate(-35%)}.spinner--small[_ngcontent-%COMP%]   .spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.spinner__wrapper[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.spinner__cirle[_ngcontent-%COMP%]{animation:spin 2s linear infinite;border:5px solid #1195E6;border-radius:50%;border-top-color:transparent;height:160px;margin:auto;width:160px;transition:.3s}.spinner__icon[_ngcontent-%COMP%]{left:50%;position:absolute;top:52px;transform:translate(-40%);transition:.3s}.spinner__icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px;transition:.3s}.spinner__text[_ngcontent-%COMP%]{color:#fff;font-size:1.3em;margin-top:25px;text-align:center}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0}),r})(),PW=(()=>{class r{constructor(){this.started=Date.now()}ngOnInit(){this.time$=S3(0,1e3).pipe(on(()=>this.format(Date.now()-this.started)))}format(t){const a=Math.floor(t/1e3%60).toString().padStart(2,"0"),l=Math.floor(t/6e4%60).toString().padStart(2,"0");return[Math.floor(t/36e5%24).toString().padStart(2,"0"),l,a].join(":")}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=Er({type:r,selectors:[["ngx-timer"]],inputs:{started:"started"},decls:4,vars:3,consts:[[1,"timer"]],template:function(t,a){1&t&&(Ae(0,"div",0)(1,"span"),Yi(2),Xu(3,"async"),Be()()),2&t&&(Je(2),Yc(Ef(3,1,a.time$)))},pipes:[ME],styles:[".timer[_ngcontent-%COMP%]{color:#fff;position:relative;text-align:center;z-index:1}.timer[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:5px;padding:5px 10px}"],changeDetection:0}),r})();function kW(r,e){if(1&r){const t=ca();Ae(0,"div",1)(1,"button",2),zt("click",function(){return es(t),Xt().onToggleFullScreen()}),Ae(2,"div",3),ws(),Ae(3,"svg",4)(4,"g",26)(5,"g",6)(6,"g",7)(7,"g",11),At(8,"path",27)(9,"path",28)(10,"path",29)(11,"path",30),Be()()()(),Ae(12,"g",31)(13,"g",6)(14,"g",32)(15,"g",7),At(16,"path",33)(17,"path",34)(18,"path",35)(19,"path",36),Be()()()()()(),As(),Ae(20,"p"),Yi(21),Be()()()}if(2&r){const t=Xt();Je(1),vn("controls__button--active",t.fullScreenEnabled),Je(3),vn("controls__icon--shown",!t.fullScreenEnabled),Je(8),vn("controls__icon--shown",t.fullScreenEnabled),Je(9),Yc(t.fullScreenEnabled?"Exit fullscreen":"Fullscreen")}}function MW(r,e){if(1&r){const t=ca();Ae(0,"div",1)(1,"button",37),zt("click",function(){return es(t),Xt().onToggleSmallScreen()}),Ae(2,"div",3),ws(),Ae(3,"svg",4)(4,"g",38),At(5,"path",39),Be(),Ae(6,"defs")(7,"filter",40),At(8,"feFlood",41)(9,"feColorMatrix",42)(10,"feOffset",43)(11,"feGaussianBlur",44)(12,"feComposite",45)(13,"feColorMatrix",46)(14,"feBlend",47)(15,"feBlend",48),Be()()()(),As(),Ae(16,"p"),Yi(17,"Minimize"),Be()()()}if(2&r){const t=Xt();Je(1),vn("controls__button--active",t.smallScreenEnabled)}}let LW=(()=>{class r{constructor(){this.cameraEnabled=!0,this.microphoneEnabled=!0,this.fullScreenEnabled=!1,this.smallScreenEnabled=!1,this.displaySmallScreen=!1,this.toggleCamera=new Qt,this.toggleMicrophone=new Qt,this.toggleFullScreen=new Qt,this.toggleSmallScreen=new Qt,this.endCall=new Qt}onToggleCamera(){this.toggleCamera.emit(this.cameraEnabled)}onToggleMicrophone(){this.toggleMicrophone.emit(this.microphoneEnabled)}onToggleFullScreen(){this.toggleFullScreen.emit(this.fullScreenEnabled)}onToggleSmallScreen(){this.toggleSmallScreen.emit(this.smallScreenEnabled)}onEndCall(){this.endCall.emit()}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=Er({type:r,selectors:[["ngx-controls"]],inputs:{cameraEnabled:"cameraEnabled",microphoneEnabled:"microphoneEnabled",fullScreenEnabled:"fullScreenEnabled",smallScreenEnabled:"smallScreenEnabled",displaySmallScreen:"displaySmallScreen"},outputs:{toggleCamera:"toggleCamera",toggleMicrophone:"toggleMicrophone",toggleFullScreen:"toggleFullScreen",toggleSmallScreen:"toggleSmallScreen",endCall:"endCall"},decls:43,vars:16,consts:[[1,"controls"],[1,"controls__item"],[1,"controls__button",3,"click"],[1,"controls__icon-wrapper"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","video-camera",1,"controls__icon"],["id","Group"],["id","Group_2"],["id","Vector","d","M63.4134 16.2294C63.0454 15.9814 62.5787 15.928 62.1707 16.096L50.6668 20.6986V20C50.6668 16.3226 47.6748 13.3334 44.0001 13.3334H6.66663C2.992 13.3334 0 16.3226 0 20V44C0 47.6774 2.992 50.6666 6.66663 50.6666H44C47.6746 50.6666 50.6666 47.6772 50.6666 44V43.3014L62.1706 47.904C62.5812 48.072 63.048 48.0186 63.4132 47.7706C63.7786 47.5226 63.9999 47.1093 63.9999 46.6666V17.3334C64 16.8906 63.7786 16.4774 63.4134 16.2294Z","fill","white"],["id","no-camera",1,"controls__icon"],["id","Vector","d","M44.0002 13.3325H6.66735C2.99276 13.3325 0.000793457 16.3218 0.000793457 19.999V43.9988C0.000793457 47.6761 2.99276 50.6654 6.66735 50.6654H7.67797L44.9176 13.4257C44.6162 13.3832 44.315 13.3325 44.0002 13.3325Z","fill","white"],["id","Group_3"],["id","Group_4"],["id","Vector_2","d","M63.4134 16.2285C63.0454 15.9805 62.5788 15.9271 62.1708 16.0951L50.6669 20.6977V19.9991C50.6669 18.6417 50.2535 17.3831 49.5549 16.3297L63.608 2.2766C64.128 1.75661 64.128 0.911242 63.608 0.391247C63.088 -0.128748 62.2426 -0.128748 61.7226 0.391247L0.389996 61.724C-0.129999 62.244 -0.129999 63.0894 0.389996 63.6094C0.651369 63.868 0.992615 63.9988 1.33399 63.9988C1.67536 63.9988 2.01661 63.8681 2.27798 63.6094L15.2192 50.6655H44.0003C47.6749 50.6655 50.6669 47.6762 50.6669 43.9989V43.3003L62.1708 47.9029C62.5814 48.0709 63.0481 48.0175 63.4134 47.7695C63.7788 47.5215 64 47.1082 64 46.6655V17.3325C64 16.8898 63.7788 16.4765 63.4134 16.2285Z","fill","white"],["id","microphone",1,"controls__icon"],["id","Vector"],["fill-rule","evenodd","clip-rule","evenodd","d","M44.3474 12.1407L44.3468 17.2309V33.8672C44.3468 40.6024 38.9004 46.0823 32.206 46.0823C27.8366 46.0787 23.8059 43.7286 21.6503 39.9279L20.4131 36.8161C20.1824 35.875 20.0659 34.9098 20.0659 33.941V12.1407C20.0659 5.43551 25.5014 0 32.2066 0C38.9118 0 44.3474 5.43551 44.3474 12.1407Z","fill","white"],["fill-rule","evenodd","clip-rule","evenodd","d","M15.0971 33.7512C15.0947 36.1345 15.5932 38.4912 16.5596 40.6697L18.1223 43.4553C22.3699 49.6259 30.1387 52.3143 37.292 50.089C44.4453 47.8638 49.318 41.2426 49.3156 33.7518C49.3156 32.9026 50.0039 32.2143 50.8532 32.2143C51.7018 32.2143 52.3907 32.9026 52.3907 33.7518C52.4051 44.4499 44.0585 53.2951 33.3778 53.9017V60.9246H39.8098C40.6584 60.9246 41.3473 61.6135 41.3473 62.4622C41.3473 63.3114 40.6584 63.9997 39.8098 63.9997H24.6029C23.7537 63.9997 23.0654 63.3114 23.0654 62.4622C23.0654 61.6135 23.7537 60.9246 24.6029 60.9246H30.3033V53.847C25.6228 53.4212 21.2413 51.3623 17.926 48.0313C17.1926 47.298 16.5163 46.51 15.9031 45.6739L14.2418 42.9874C12.7757 40.1297 12.0148 36.9633 12.022 33.7512C12.022 32.902 12.7103 32.2137 13.5595 32.2137C14.4088 32.2137 15.0971 32.902 15.0971 33.7512Z","fill","white"],["id","no-microphone",1,"controls__icon"],["id","Vector","d","M52.9733 4.25592L44.3474 12.8813V12.1407C44.3474 5.43551 38.9118 0 32.2066 0C25.5014 0 20.0659 5.43551 20.0659 12.1407V33.941C20.0659 34.9098 20.1824 35.875 20.4131 36.8161L16.5596 40.6697C15.5932 38.4912 15.0947 36.1345 15.0971 33.7512C15.0971 32.902 14.4088 32.2137 13.5595 32.2137C12.7103 32.2137 12.022 32.902 12.022 33.7512C12.0148 36.9633 12.7757 40.1297 14.2418 42.9874L8.81411 48.4151C8.4117 48.8007 8.24954 49.3731 8.39008 49.9124C8.53002 50.4518 8.95105 50.8728 9.4898 51.0133C10.0291 51.1539 10.6021 50.9917 10.9877 50.5899L15.9031 45.6739C16.5163 46.51 17.1926 47.298 17.926 48.0313C21.2413 51.3623 25.6228 53.4212 30.3033 53.847V60.9246H24.6029C23.7537 60.9246 23.0654 61.6135 23.0654 62.4622C23.0654 63.3114 23.7537 63.9997 24.6029 63.9997H39.8098C40.6584 63.9997 41.3473 63.3114 41.3473 62.4622C41.3473 61.6135 40.6584 60.9246 39.8098 60.9246H33.3778V53.9017C44.0585 53.2951 52.4051 44.4499 52.3907 33.7518C52.3907 32.9026 51.7018 32.2143 50.8532 32.2143C50.0039 32.2143 49.3156 32.9026 49.3156 33.7518C49.318 41.2426 44.4453 47.8638 37.292 50.089C30.1387 52.3143 22.3699 49.6259 18.1224 43.4553L21.6503 39.9279C23.8059 43.7286 27.8366 46.0787 32.206 46.0823C38.9004 46.0823 44.3468 40.6024 44.3468 33.8672V17.2309L55.1475 6.43072C55.7481 5.83071 55.7481 4.85713 55.1475 4.25652C54.5469 3.65591 53.5733 3.65591 52.9733 4.25652V4.25592Z","fill","white"],["class","controls__item",4,"ngIf"],[1,"controls__button","controls__button--danger",3,"click"],["id","phone"],["id","Vector","d","M51.7097 13.2478C51.2458 12.7839 50.4959 12.7839 50.032 13.2478L1.38351 61.8963C0.919568 62.3602 0.919568 63.1101 1.38351 63.574C1.61488 63.8054 1.91864 63.9217 2.2224 63.9217C2.52615 63.9217 2.82991 63.8054 3.06129 63.574L51.7097 14.9256C52.1737 14.4628 52.1737 13.7117 51.7097 13.2478Z","fill","white"],["id","Vector_2","d","M16.9605 42.9635L26.1159 33.8081L21.3365 29.0287C18.91 26.6022 18.6869 24.3679 20.5878 21.5629C20.8535 21.1951 22.5444 19.6941 23.992 18.4839C24.9151 17.9333 25.5487 17.1181 25.8264 16.1155C26.1954 14.783 25.9225 13.2156 25.0516 11.6885C24.8463 11.3373 19.9625 3.06229 15.4583 0.680892C14.6171 0.235937 13.6714 0.0010004 12.721 0.0010004C11.1571 0.0010004 9.68576 0.610886 8.58109 1.71556L5.57082 4.72702C-3.21082 13.5098 -1.58525 24.419 10.2719 36.2749L16.9605 42.9635Z","fill","white"],["id","Vector_3","d","M63.313 48.5357C60.9304 44.0328 52.6566 39.1478 52.2923 38.9342C51.2304 38.329 50.1209 38.0099 49.0839 38.0099C47.5402 38.0099 46.2753 38.717 45.51 40.0033C44.2986 41.452 42.7964 43.1429 42.4345 43.4051C39.6129 45.3154 37.4071 45.1007 34.9652 42.6588L31.148 38.8416L21.9926 47.997L27.7189 53.7233C34.5356 60.5412 41.0367 63.9976 47.0371 63.9976C47.0383 63.9976 47.0383 63.9976 47.0383 63.9976C51.4534 63.9976 55.5672 62.1217 59.2669 58.4232L62.2771 55.413C64.1068 53.5845 64.5233 50.821 63.313 48.5357Z","fill","white"],["id","fullscreen",1,"controls__icon"],["id","Vector","d","M57.8018 53.4382L44.3964 40.0328L40.0328 44.3964L53.4382 57.8018H43.0205V64H64V43.0205H57.8018V53.4382Z","fill","white"],["id","Vector_2","d","M44.3964 23.9803L57.8018 10.5618V20.9795H64V0H43.0205V6.1982H53.4382L40.0328 19.6036L44.3964 23.9803Z","fill","white"],["id","Vector_3","d","M19.6036 40.0328L6.1982 53.4382V43.0205H0V64H20.9795V57.8018H10.5618L23.9803 44.3964L19.6036 40.0328Z","fill","white"],["id","Vector_4","d","M20.9795 6.1982V0H0V20.9795H6.1982V10.5618L19.6036 23.9803L23.9803 19.6036L10.5618 6.1982H20.9795Z","fill","white"],["id","exit-full-screen",1,"controls__icon"],["id","fullscreen_x5F_exit"],["id","Vector","d","M49.172 54.828L58.344 64L64 58.344L54.828 49.172L64 40H40V64L49.172 54.828Z","fill","white"],["id","Vector_2","d","M0 24H24V0L14.828 9.172L5.75 0.086L0.094 5.742L9.172 14.828L0 24Z","fill","white"],["id","Vector_3","d","M0 58.344L5.656 64L14.828 54.828L24 64V40H0L9.172 49.172L0 58.344Z","fill","white"],["id","Vector_4","d","M40 24H64L54.828 14.828L63.922 5.742L58.266 0.086L49.172 9.172L40 0V24Z","fill","white"],[1,"controls__button","controls__button--rotate",3,"click"],["filter","url(#filter0_d_0_4)"],["d","M-4.81762e-07 34.7678V57.0215C-4.81762e-07 60.8696 3.13284 64 6.98275 64H57.016C60.8672 64 64 60.8696 64 57.0215V7.05508C64 3.20697 60.8672 0.0757321 57.016 0.0757321H34.6959C35.8972 1.3077 36.6961 2.93443 36.871 4.74067H57.0168C58.2942 4.74067 59.3335 5.77899 59.3335 7.05508V57.0216C59.3335 58.2969 58.2942 59.3352 57.0168 59.3352H6.98342C5.7062 59.3352 4.66761 58.2969 4.66761 57.0216V36.9389C2.90982 36.7703 1.27948 36.0149 -4.81762e-07 34.7678ZM10.7807 30.6654H26.0384L1.34093 5.97437C-0.02533 4.60686 -0.02533 2.39174 1.34093 1.02583C2.70813 -0.341677 4.92462 -0.341677 6.29089 1.02423L30.9883 25.7159V10.4614C30.9883 8.52907 32.5556 6.96139 34.4888 6.96139C35.4553 6.96139 36.3305 7.35214 36.9642 7.98612C37.5976 8.62116 37.9897 9.49543 37.9897 10.4613V34.1643C37.9897 36.0966 36.4228 37.6635 34.4896 37.6635H10.7807C8.84705 37.6635 7.28056 36.0974 7.28056 34.1643C7.28056 32.2312 8.84705 30.6654 10.7807 30.6654Z","fill","white"],["id","filter0_d_0_4","x","-4","y","0","width","72","height","72","filterUnits","userSpaceOnUse","color-interpolation-filters","sRGB"],["flood-opacity","0","result","BackgroundImageFix"],["in","SourceAlpha","type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0","result","hardAlpha"],["dy","4"],["stdDeviation","2"],["in2","hardAlpha","operator","out"],["type","matrix","values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"],["mode","normal","in2","BackgroundImageFix","result","effect1_dropShadow_0_4"],["mode","normal","in","SourceGraphic","in2","effect1_dropShadow_0_4","result","shape"]],template:function(t,a){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"button",2),zt("click",function(){return a.onToggleCamera()}),Ae(3,"div",3),ws(),Ae(4,"svg",4)(5,"g",5)(6,"g",6)(7,"g",7),At(8,"path",8),Be()()(),Ae(9,"g",9)(10,"g",6)(11,"g",7),At(12,"path",10),Be()(),Ae(13,"g",11)(14,"g",12),At(15,"path",13),Be()()()()(),As(),Ae(16,"p"),Yi(17,"Camera"),Be()()(),Ae(18,"div",1)(19,"button",2),zt("click",function(){return a.onToggleMicrophone()}),Ae(20,"div",3),ws(),Ae(21,"svg",4)(22,"g",14)(23,"g",15),At(24,"path",16)(25,"path",17),Be()(),Ae(26,"g",18),At(27,"path",19),Be()()(),As(),Ae(28,"p"),Yi(29,"Mic"),Be()()(),jn(30,kW,22,7,"div",20),jn(31,MW,18,2,"div",20),Ae(32,"div",1)(33,"button",21),zt("click",function(){return a.onEndCall()}),Ae(34,"div",3),ws(),Ae(35,"svg",4)(36,"g",22)(37,"g",6),At(38,"path",23)(39,"path",24)(40,"path",25),Be()()()(),As(),Ae(41,"p"),Yi(42,"End"),Be()()()()),2&t&&(vn("controls--small",a.smallScreenEnabled),Je(2),vn("controls__button--active",a.cameraEnabled),Je(3),vn("controls__icon--shown",a.cameraEnabled),Je(4),vn("controls__icon--shown",!a.cameraEnabled),Je(10),vn("controls__button--active",a.microphoneEnabled),Je(3),vn("controls__icon--shown",a.microphoneEnabled),Je(4),vn("controls__icon--shown",!a.microphoneEnabled),Je(4),ot("ngIf",!a.smallScreenEnabled),Je(1),ot("ngIf",a.displaySmallScreen))},directives:[al],styles:["[_nghost-%COMP%]{transition:.3s}.controls[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);bottom:0;display:flex;justify-content:center;padding:15px 0;position:absolute;left:0;width:100%}.controls--small[_ngcontent-%COMP%]{border-bottom-left-radius:10px;border-bottom-right-radius:10px;padding:5px 0}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{height:32px;width:32px}.controls--small[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:16px;width:16px}.controls--small[_ngcontent-%COMP%]   .controls__item[_ngcontent-%COMP%]{margin:0}.controls--small[_ngcontent-%COMP%]   .controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{display:none}.controls__item[_ngcontent-%COMP%]{margin:0 5px;text-align:center}.controls__button[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer}.controls__button[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#101316}.controls__button--active[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#0b73c9}.controls__button--active[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#158ef2}.controls__button--active.controls__button--rotate[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transform:translate(-50%,-50%) rotate(-180deg)}.controls__button--danger[_ngcontent-%COMP%]   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#d73b3d}.controls__button--danger[_ngcontent-%COMP%]:hover   .controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#e06567}.controls__button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;margin:8px 0 0}.controls__icon-wrapper[_ngcontent-%COMP%]{background-color:#313a42;border-radius:50%;box-shadow:0 3px 8px #00000080;margin:auto;position:relative;height:60px;width:60px;transition:.3s}.controls__icon-wrapper[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%) rotate(0);height:32px;width:32px;transition:.3s}.controls__icon[_ngcontent-%COMP%]{opacity:0;transition:.3s}.controls__icon--shown[_ngcontent-%COMP%]{opacity:1}"],changeDetection:0}),r})(),xW=(()=>{class r{constructor(t,a){this.renderer=t,this.el=a,this.subscription=new En,this.delay=5e3}onEnter(){this.subscription.unsubscribe(),this.setStyle(1)}onLeave(){this.hide()}ngOnInit(){this.hide()}hide(){this.subscription.unsubscribe(),this.subscription=W2(this.delay).pipe(Go(1)).subscribe(()=>this.setStyle(0))}setStyle(t){this.renderer.setStyle(this.el.nativeElement,"opacity",t)}}return r.\u0275fac=function(t){return new(t||r)(oe(Lo),oe(Rn))},r.\u0275dir=je({type:r,selectors:[["","ngxToggle",""]],hostBindings:function(t,a){1&t&&zt("mouseenter",function(){return a.onEnter()})("mouseleave",function(){return a.onLeave()})}}),r})();function FW(r,e){if(1&r&&At(0,"ngx-spinner",15),2&r){const t=Xt().ngIf,a=Xt(2);ot("error",t.error)("text",t.statusText)("connected",t.connected)("ended",t.ended)("small",a.smallScreenEnabled)}}function UW(r,e){1&r&&At(0,"ngx-timer",16),2&r&&ot("started",Xt().ngIf.started)}function VW(r,e){if(1&r&&(At(0,"div",17),Xu(1,"async")),2&r){const t=e.$implicit;vn("hidden",!1===Ef(1,3,Xt(3).remoteStreamVideoToggle$)),ot("id",t)}}function BW(r,e){if(1&r){const t=ca();ws(),As(),Ae(0,"ngx-controls",18),zt("toggleCamera",function(l){return es(t),Xt(3).onToggleCamera(l)})("toggleMicrophone",function(l){return es(t),Xt(3).onToggleMicrophone(l)})("toggleFullScreen",function(l){return es(t),Xt(3).onToggleFullScreen(l)})("toggleSmallScreen",function(l){return es(t),Xt(3).onToggleSmallScreen(l)})("endCall",function(){return es(t),Xt(3).onEndCall()}),Be()}if(2&r){const t=Xt(3);ot("cameraEnabled",t.cameraEnabled)("microphoneEnabled",t.microphoneEnabled)("fullScreenEnabled",t.fullScreenEnabled)("smallScreenEnabled",t.smallScreenEnabled)("displaySmallScreen",t.displaySmallScreen)}}function jW(r,e){if(1&r&&(Ae(0,"div",2),jn(1,FW,1,5,"ngx-spinner",3),jn(2,UW,1,1,"ngx-timer",4),At(3,"div",5),jn(4,VW,2,5,"div",6),Ae(5,"div",7),ws(),Ae(6,"svg",8)(7,"g",9),At(8,"path",10)(9,"path",11),Be(),Ae(10,"defs")(11,"clipPath",12),At(12,"rect",13),Be()()()(),jn(13,BW,1,5,"ngx-controls",14),Be()),2&r){const t=e.ngIf,a=Xt(2);Je(1),ot("ngIf",t.loading),Je(1),ot("ngIf",t.started),Je(1),vn("hidden",!a.cameraEnabled||a.smallScreenEnabled),ot("id",a.localContainerId),Je(1),ot("ngForOf",a.remoteCalls),Je(9),ot("ngIf",t.connected&&!t.ended)}}function HW(r,e){if(1&r&&(Ae(0,"div"),jn(1,jW,14,7,"div",1),Xu(2,"async"),Be()),2&r){const t=Xt();ot("@fade",void 0)("@.disabled",!t.animate),Je(1),ot("ngIf",Ef(2,3,t.streamState$))}}let QB=(()=>{class r extends $B{constructor(t,a){super(a),this.webRtcService=t,this.animate=!0,this.displaySmallScreen=!1,this.debug=!1,this.callEnd=new Qt,this.smallScreenEnabled=!1,this.active=!1,this.streamState$=this.webRtcService.streamState$,this.remoteStreamVideoToggle$=this.webRtcService.remoteStreamVideoToggle$}ngOnInit(){this.webRtcService.init(this.uid,this.channel,this.debug).pipe(Go(1)).subscribe(()=>{this.active=this.smallScreenEnabled,this.callEnd.emit(),this.closeDialog(!0)})}ngOnDestroy(){this.webRtcService.deinit()}get localContainerId(){return this.webRtcService.localContainerId}get remoteCalls(){return this.webRtcService.remoteCalls}get cameraEnabled(){return this.webRtcService.isVideoEnabled()}get microphoneEnabled(){return this.webRtcService.isAudioEnabled()}get fullScreenEnabled(){return!!document.fullscreenElement}onToggleCamera(t){this.webRtcService.toggleVideo(t)}onToggleMicrophone(t){this.webRtcService.toggleAudio(t)}onToggleFullScreen(t){this.webRtcService.toggleFullScreen(t)}onToggleSmallScreen(t){this.smallScreenEnabled=!t,this.active=!0}onEndCall(){this.webRtcService.endCall()}}return r.\u0275fac=function(t){return new(t||r)(oe(JB),oe(Fo))},r.\u0275cmp=Er({type:r,selectors:[["ngx-webrtc"]],hostVars:4,hostBindings:function(t,a){2&t&&vn("small-screen",a.smallScreenEnabled)("active",a.active)},inputs:{uid:"uid",channel:"channel",animate:"animate",displaySmallScreen:"displaySmallScreen",debug:"debug"},outputs:{callEnd:"callEnd"},features:[Mt],decls:1,vars:1,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[3,"error","text","connected","ended","small",4,"ngIf"],[3,"started",4,"ngIf"],[1,"container__local",3,"id"],["class","container__remote",3,"id","hidden",4,"ngFor","ngForOf"],[1,"container__user-icon"],["viewBox","0 0 64 64","fill","none","xmlns","http://www.w3.org/2000/svg"],["id","user","clip-path","url(#clip0)"],["id","Vector","d","M31.5439 30.829C35.7793 30.829 39.4468 29.3099 42.4434 26.3129C45.4399 23.3163 46.959 19.6498 46.959 15.414C46.959 11.1796 45.4399 7.51267 42.4429 4.51512C39.4458 1.51904 35.7788 0 31.5439 0C27.3081 0 23.6416 1.51904 20.645 4.51561C17.6484 7.51218 16.1289 11.1792 16.1289 15.414C16.1289 19.6498 17.6484 23.3168 20.6455 26.3134C23.6426 29.3095 27.3096 30.829 31.5439 30.829V30.829Z","fill","#0B73C9"],["id","Vector_2","d","M58.5161 49.2127C58.4297 47.9656 58.2549 46.6053 57.9976 45.1688C57.7378 43.7215 57.4033 42.3533 57.0029 41.1029C56.5894 39.8104 56.0269 38.534 55.3315 37.3109C54.6099 36.0414 53.7622 34.9359 52.811 34.0262C51.8164 33.0746 50.5986 32.3094 49.1904 31.7513C47.7871 31.1962 46.2319 30.9149 44.5684 30.9149C43.915 30.9149 43.2832 31.183 42.063 31.9774C41.312 32.4672 40.4336 33.0336 39.4531 33.66C38.6147 34.1942 37.479 34.6947 36.0762 35.1478C34.7075 35.5907 33.3179 35.8153 31.9463 35.8153C30.5747 35.8153 29.1855 35.5907 27.8154 35.1478C26.4141 34.6952 25.2783 34.1947 24.4409 33.6605C23.4697 33.0399 22.5908 32.4735 21.8286 31.9769C20.6099 31.1825 19.9775 30.9144 19.3242 30.9144C17.6602 30.9144 16.1055 31.1962 14.7026 31.7518C13.2954 32.309 12.0771 33.0741 11.0815 34.0267C10.1309 34.9369 9.28271 36.0419 8.56201 37.3109C7.86719 38.534 7.30469 39.8099 6.89062 41.1034C6.49072 42.3538 6.15625 43.7215 5.89648 45.1688C5.63916 46.6033 5.46436 47.9642 5.37793 49.2142C5.29297 50.4388 5.25 51.7098 5.25 52.9934C5.25 56.3343 6.31201 59.0388 8.40625 61.0335C10.4746 63.0017 13.2114 64.0002 16.5396 64.0002H47.356C50.6841 64.0002 53.4199 63.0022 55.4888 61.0335C57.5835 59.0403 58.6455 56.3352 58.6455 52.993C58.645 51.7034 58.6016 50.4314 58.5161 49.2127V49.2127Z","fill","#0B73C9"],["id","clip0"],["width","64","height","64","fill","#0B73C9"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall",4,"ngIf"],[3,"error","text","connected","ended","small"],[3,"started"],[1,"container__remote",3,"id"],["ngxToggle","",3,"cameraEnabled","microphoneEnabled","fullScreenEnabled","smallScreenEnabled","displaySmallScreen","toggleCamera","toggleMicrophone","toggleFullScreen","toggleSmallScreen","endCall"]],template:function(t,a){1&t&&jn(0,HW,3,5,"div",0),2&t&&ot("ngIf",a.shown)},directives:[al,NW,PW,fh,LW,xW],pipes:[ME],styles:["ngx-timer[_ngcontent-%COMP%]{display:block;padding-top:25px}[_nghost-%COMP%]{bottom:0;max-width:100%;right:0;width:100%;transition:.3s}.active[_nghost-%COMP%]{position:fixed}.small-screen[_nghost-%COMP%]{max-width:210px}.small-screen[_nghost-%COMP%]   ngx-timer[_ngcontent-%COMP%]{padding-top:10px}.small-screen[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{border-radius:10px;box-shadow:#00000059 0 5px 15px;height:200px;max-width:200px;margin-right:10px;margin-bottom:10px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]{border-radius:10px;height:200px;width:200px}.small-screen[_nghost-%COMP%]   .container__remote[_ngcontent-%COMP%]    >div{border-radius:10px}.small-screen[_nghost-%COMP%]   .container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:32px;width:32px}.container[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;max-width:100%;margin-left:auto;overflow:hidden;position:relative;transition:.3s}.container__local[_ngcontent-%COMP%]{border-radius:5px;height:20vh;opacity:1;overflow:hidden;position:absolute;right:1rem;top:1rem;width:20vw;z-index:1;transition:.3s}.container__local.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden}.container__local[_ngcontent-%COMP%]:not(:empty){box-shadow:0 3px 8px #00000080}.container__remote[_ngcontent-%COMP%]{background-color:#22292f;height:100vh;left:0;position:absolute;top:0;width:100vw;transition:.3s}.container__remote[_ngcontent-%COMP%]    >div{transition:.3s}.container__remote.hidden[_ngcontent-%COMP%]{display:none}.container__remote.hidden[_ngcontent-%COMP%] + .container__user-icon[_ngcontent-%COMP%]{display:block}.container__remote[_ngcontent-%COMP%]:empty{display:none}.container__user-icon[_ngcontent-%COMP%]{background:rgba(0,0,0,.3);border-radius:50%;box-shadow:0 3px 8px #00000080;display:none;left:50%;padding:20px;position:absolute;top:50%;transform:translate(-50%,-50%)}.container__user-icon[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:64px;width:64px}@media screen and (max-width: 769px){ngx-controls[_ngcontent-%COMP%]{opacity:1!important}}"],data:{animation:[YB]},changeDetection:0}),r})();function GW(r,e){if(1&r&&(ed(0),Yi(1),td()),2&r){const t=Xt(2);Je(1),Jp(" Calling to ",t.data.user.name," ")}}function WW(r,e){1&r&&Yi(0),2&r&&Jp(" ",Xt(2).data.user.name," is calling ")}function zW(r,e){if(1&r){const t=ca();ed(0),Ae(1,"button",11),zt("click",function(){return es(t),Xt(2).onAcceptCall()}),Be(),td()}}function KW(r,e){if(1&r){const t=ca();Ae(0,"div",1)(1,"div",2)(2,"div",3),At(3,"img",4),Be(),Ae(4,"p",5),jn(5,GW,2,1,"ng-container",6),jn(6,WW,1,1,"ng-template",null,7,OA),Be()(),Ae(8,"div",8),jn(9,zW,2,0,"ng-container",9),Ae(10,"span")(11,"button",10),zt("click",function(){return es(t),Xt().onDeclineCall()}),Be()()()()}if(2&r){const t=Bu(7),a=Xt();vn("video-call--full-screen",a.fullScreen),ot("@fade",void 0),Je(3),ot("src",a.data.user.photoURL,Cu),Je(2),ot("ngIf",a.data.outcome)("ngIfElse",t),Je(4),ot("ngIf",!a.data.outcome)}}let qW=(()=>{class r extends $B{constructor(t){super(t),this.fullScreen=!1}ngOnInit(){this.play(`assets/${this.data.outcome?"outcome":"income"}.mp3`)}ngOnDestroy(){this.stop()}onAcceptCall(){this.fullScreen=!0,this.cdr.markForCheck(),this.afterClosed.next(this.data)}onDeclineCall(){this.play("assets/cancel.mp3"),setTimeout(()=>this.closeDialog(null),200)}play(t,a=!0){this.audio&&this.stop(),this.audio=new Audio(t),this.audio.loop=a,this.audio.load(),this.audio.play()}stop(){this.audio.pause(),this.audio.remove()}}return r.\u0275fac=function(t){return new(t||r)(oe(Fo))},r.\u0275cmp=Er({type:r,selectors:[["ngx-video-call"]],inputs:{data:"data"},features:[Mt],decls:1,vars:1,consts:[["class","video-call",3,"video-call--full-screen",4,"ngIf"],[1,"video-call"],[1,"video-call-user"],[1,"video-call-user__block","video-call-user__block--animated"],["alt","",1,"video-call-user__img",3,"src"],[1,"video-call-user__title"],[4,"ngIf","ngIfElse"],["income",""],[1,"video-call__actions"],[4,"ngIf"],["aria-label","Decline",1,"video-call__button","video-call__button--decline",3,"click"],["aria-label","Accept",1,"video-call__button","video-call__button--accept",3,"click"]],template:function(t,a){1&t&&jn(0,KW,12,7,"div",0),2&t&&ot("ngIf",a.shown&&a.data)},directives:[al],styles:['[_nghost-%COMP%]{display:block;height:100vh;position:relative}.video-call[_ngcontent-%COMP%]{background-image:linear-gradient(#3F51B5,#313A42);background-size:cover;border-radius:10px;box-shadow:0 5px 10px #0000001a;display:flex;flex-direction:column;height:100%;justify-content:flex-end;left:50%;max-height:400px;max-width:400px;position:absolute;top:50%;transform:translate(-50%,-50%);width:100%;z-index:5;transition:.3s}.video-call--full-screen[_ngcontent-%COMP%]{background-image:linear-gradient(#22292F);border-radius:0;max-height:100%;max-width:100%}.video-call-user[_ngcontent-%COMP%]{left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-55%);z-index:1}.video-call-user__block[_ngcontent-%COMP%]{background:#fff;border-radius:50%;border:solid 5px #fff;height:180px;margin:0 auto;transform:scale(1);width:180px}.video-call-user__block--animated[_ngcontent-%COMP%]{animation:play 2s ease infinite;backface-visibility:hidden}.video-call-user__img[_ngcontent-%COMP%]{border-radius:50%;height:100%;left:0;object-fit:cover;position:absolute;top:0;width:100%}.video-call-user__title[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;font-weight:700;margin:15px 0 0}.video-call__actions[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:10px 0}.video-call__button[_ngcontent-%COMP%]{border-radius:50%;box-shadow:0 0 #3f51b500,0 .05em .1em #0003;border:0;cursor:pointer;display:block;font-size:40px;height:1em;margin:0 5px;position:relative;transform:translate(0) scale(1);width:1em;transition:.3s}.video-call__button[_ngcontent-%COMP%]:before, .video-call__button[_ngcontent-%COMP%]:after{content:"";position:absolute}.video-call__button[_ngcontent-%COMP%]:before{background-color:#ffffff1a;border-radius:50%;height:1em;left:0;opacity:1;top:0;transform:translate(0) scale(0);width:1em}.video-call__button[_ngcontent-%COMP%]:after{background-position:50% 50%;background-repeat:no-repeat;background-size:cover;background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTYuNiAxMC44YzEuNCAyLjggMy44IDUuMSA2LjYgNi42bDIuMi0yLjJjLjMtLjMuNy0uNCAxLS4yIDEuMS40IDIuMy42IDMuNi42LjUgMCAxIC40IDEgMVYyMGMwIC41LS41IDEtMSAxLTkuNCAwLTE3LTcuNi0xNy0xNyAwLS42LjQtMSAxLTFoMy41Yy41IDAgMSAuNCAxIDEgMCAxLjIuMiAyLjUuNiAzLjYuMS40IDAgLjctLjIgMWwtMi4zIDIuMnoiIGZpbGw9IiNmZmZmZmYiLz48L3N2Zz4=);height:.5em;left:.25em;top:.25em;transform:translate(0);width:.5em;transition:.3s}.video-call__button--accept[_ngcontent-%COMP%]{animation:phone-outer 3s infinite;background-color:#3f51b5}.video-call__button--accept[_ngcontent-%COMP%]:before{animation:phone-inner 3s infinite}.video-call__button--accept[_ngcontent-%COMP%]:after{animation:phone-icon 3s infinite}.video-call__button--decline[_ngcontent-%COMP%]{background-color:#d73b3d}.video-call__button--decline[_ngcontent-%COMP%]:hover{background-color:#ce2a2c}.video-call__button--decline[_ngcontent-%COMP%]:after{top:.28em;transform:translate(0) rotate(135deg)}@keyframes play{0%{transform:scale(1)}15%{box-shadow:0 0 0 5px #9b9da466}25%{box-shadow:0 0 0 10px #9b9da466,0 0 0 20px #9b9da433}25%{box-shadow:0 0 0 15px #9b9da466,0 0 0 30px #9b9da433}}@keyframes phone-outer{0%{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translate(0) scale(1)}33.3333%{box-shadow:0 0 #3f51b51a,0 .05em .1em #00000080;transform:translate(0) scale(1.1)}66.6666%{box-shadow:0 0 0 .5em #3f51b500,0 .05em .1em #0003;transform:translate(0) scale(1)}to{box-shadow:0 0 #3f51b500,0 .05em .1em #0003;transform:translate(0) scale(1)}}@keyframes phone-inner{0%{opacity:1;transform:translate(0) scale(0)}33.3333%{opacity:1;transform:translate(0) scale(.9)}66.6666%{opacity:0;transform:translate(0) scale(0)}to{opacity:0;transform:translate(0) scale(0)}}@keyframes phone-icon{0%{transform:translate(0)}2%{transform:translate(.01em)}4%{transform:translate(-.01em)}6%{transform:translate(.01em)}8%{transform:translate(-.01em)}10%{transform:translate(.01em)}12%{transform:translate(-.01em)}14%{transform:translate(.01em)}16%{transform:translate(-.01em)}18%{transform:translate(.01em)}20%{transform:translate(-.01em)}22%{transform:translate(.01em)}24%{transform:translate(-.01em)}26%{transform:translate(.01em)}28%{transform:translate(-.01em)}30%{transform:translate(.01em)}32%{transform:translate(-.01em)}34%{transform:translate(.01em)}36%{transform:translate(-.01em)}38%{transform:translate(.01em)}40%{transform:translate(-.01em)}42%{transform:translate(.01em)}44%{transform:translate(-.01em)}46%{transform:translate(0)}}'],data:{animation:[YB]},changeDetection:0}),r})();class Rc{constructor(e,t,a){this.kind=e,this.value=t,this.error=a,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,a){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return a&&a()}}accept(e,t,a){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,a)}toObservable(){switch(this.kind){case"N":return ut(this.value);case"E":return QT(this.error);case"C":return hN()}throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new Rc("N",e):Rc.undefinedValueNotification}static createError(e){return new Rc("E",void 0,e)}static createComplete(){return Rc.completeNotification}}Rc.completeNotification=new Rc("C"),Rc.undefinedValueNotification=new Rc("N",void 0);class XW{constructor(e,t){this.delay=e,this.scheduler=t}call(e,t){return t.subscribe(new z2(e,this.delay,this.scheduler))}}class z2 extends Dn{constructor(e,t,a){super(e),this.delay=t,this.scheduler=a,this.queue=[],this.active=!1,this.errored=!1}static dispatch(e){const t=e.source,a=t.queue,l=e.scheduler,u=e.destination;for(;a.length>0&&a[0].time-l.now()<=0;)a.shift().notification.observe(u);if(a.length>0){const f=Math.max(0,a[0].time-l.now());this.schedule(e,f)}else this.unsubscribe(),t.active=!1}_schedule(e){this.active=!0,this.destination.add(e.schedule(z2.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}scheduleNotification(e){if(!0===this.errored)return;const t=this.scheduler,a=new JW(t.now()+this.delay,e);this.queue.push(a),!1===this.active&&this._schedule(t)}_next(e){this.scheduleNotification(Rc.createNext(e))}_error(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}_complete(){this.scheduleNotification(Rc.createComplete()),this.unsubscribe()}}class JW{constructor(e,t){this.time=e,this.notification=t}}let QW=(()=>{class r{constructor(t,a,l,u){this.document=t,this.componentFactoryResolver=a,this.appRef=l,this.injector=u,this.wrapperSelector="ngx-webrtc-wrapper"}open(t,a={}){return this.appendComponent(t,a)}appendComponent(t,a){const l=this.componentFactoryResolver.resolveComponentFactory(t).create(this.injector),{instance:u}=l;Object.keys(a).forEach(g=>u[g]=a[g]),this.appRef.attachView(l.hostView);const f=l.hostView.rootNodes[0];return this.getContainer().append(f),u.afterClosed.pipe(Go(1),function $W(r,e=wv){const a=function YW(r){return r instanceof Date&&!isNaN(+r)}(r)?+r-e.now():Math.abs(r);return l=>l.lift(new XW(a,e))}(250)).subscribe(()=>{this.appRef.detachView(l.hostView),l.destroy()}),u}getContainer(){let t=this.document.querySelector(`.${this.wrapperSelector}`);return t||(t=this.document.createElement("div"),t.setAttribute("class",this.wrapperSelector),t.setAttribute("style","position: fixed; top: 0; width: 100%;"),this.document.body.appendChild(t)),t}}return r.\u0275fac=function(t){return new(t||r)(he(_n),he(nc),he(ss),he(ir))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),ZW=(()=>{class r{constructor(t){this.dialog=t}open(t){const a=new hn,l=this.dialog.open(qW,{data:t});return l.afterClosed.asObservable().pipe(Ld(u=>(null==u?void 0:u.channel)?this.dialog.open(QB,{uid:u.uid,channel:u.channel,debug:!!u.debug,displaySmallScreen:!0}).afterClosed.asObservable():ut(!1)),Go(1),Wo(()=>a.next(!0))).subscribe(),{acceptCall:l.onAcceptCall.bind(l),close:l.closeDialog.bind(l),afterConfirmation:()=>l.afterClosed.asObservable().pipe(Go(1)),afterCallEnd:()=>a.asObservable().pipe(Go(1))}}}return r.\u0275fac=function(t){return new(t||r)(he(QW))},r.\u0275prov=Ue({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),e9=(()=>{class r{constructor(t,a,l,u,f){this.formBuilder=t,this.router=a,this.localStorage=l,this.videoCallDialogService=u,this.cdr=f,this.sessionKey="ngx-webrtc:channelId",this.outcome=!1}get channelId(){return this.localStorage.getItem(this.sessionKey)||"test-channel-ngx-webrtc"}get tooltipText(){return this.outcome?"Outcome":"Income"}ngOnInit(){this.form=this.formBuilder.group({channelId:[this.channelId,bd.required]})}onSubmit(){this.saveChannel(),this.router.navigate(["conference"],{queryParams:Object.assign({},this.form.value)})}onModalOpen(){this.saveChannel(),this.dialog=this.videoCallDialogService.open({uid:String(Math.floor(100*Math.random())),channel:this.channelId,outcome:this.outcome,user:{name:"Test User",photoURL:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTvDtoEwuV9E2kHqNDi6MnBzXlefn8TfyrwgQ&usqp=CAU"},debug:!0});const t=setTimeout(()=>{var a;return null===(a=this.dialog)||void 0===a?void 0:a.close()},7e3);this.dialog.afterConfirmation().pipe(jh(a=>!!a),Wo(()=>clearTimeout(t))).subscribe(),this.dialog.afterCallEnd().subscribe(()=>{clearTimeout(t),this.dialog=null,this.cdr.markForCheck()})}saveChannel(){const{channelId:t}=this.form.value;this.localStorage.setItem(this.sessionKey,t)}}return r.\u0275fac=function(t){return new(t||r)(oe(gs),oe(zo),oe(Storage),oe(ZW),oe(Fo))},r.\u0275cmp=Er({type:r,selectors:[["app-home"]],decls:25,vars:8,consts:[[1,"home"],[1,"home__welcome"],[1,"home__form",3,"formGroup","ngSubmit"],[1,"home__wrapper","home__wrapper--center"],["src","assets/user.svg","alt","User",1,"user"],[1,"home__title"],[1,"home__wrapper"],["matInput","","placeholder","Channel id","formControlName","channelId"],[1,"home__wrapper","home__wrapper--center","home__wrapper--buttons"],["mat-flat-button","","color","primary",1,"home__btn",3,"disabled"],["mat-raised-button","","type","button",1,"home__btn",3,"disabled","click"],[3,"checked","disabled","matTooltip","change","click"],[1,"home__footer"],["href","https://www.npmjs.com/package/ngx-webrtc-lib","target","_blank"],["viewBox","0 0 27.23 27.23"],["width","27.23","height","27.23","rx","2"],["fill","#fff","points","5.8 21.75 13.66 21.75 13.67 9.98 17.59 9.98 17.58 21.76 21.51 21.76 21.52 6.06 5.82 6.04 5.8 21.75"],["href","https://github.com/TarasMoskovych/ngx-webrtc","target","_blank"],["aria-hidden","true","role","img","viewBox","0 0 16 16","width","50","height","50",1,""],["fill-rule","evenodd","d","M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"]],template:function(t,a){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"form",2),zt("ngSubmit",function(){return!a.dialog&&a.onSubmit()}),Ae(3,"div",3),At(4,"img",4),Be(),Ae(5,"h1",5),Yi(6," Welcome "),Be(),Ae(7,"mat-form-field",6)(8,"mat-label"),Yi(9,"Channel Id"),Be(),At(10,"input",7),Be(),Ae(11,"div",8)(12,"button",9),Yi(13,"Start / Join call"),Be(),Ae(14,"button",10),zt("click",function(){return!a.dialog&&a.onModalOpen()}),Yi(15,"Open Call Dialog "),Ae(16,"mat-slide-toggle",11),zt("change",function(u){return a.outcome=u.checked})("click",function(u){return u.stopPropagation()}),Be()()()(),Ae(17,"div",12)(18,"a",13),ws(),Ae(19,"svg",14),At(20,"rect",15)(21,"polygon",16),Be()(),As(),Ae(22,"a",17),ws(),Ae(23,"svg",18),At(24,"path",19),Be()()()()()),2&t&&(Je(2),ot("formGroup",a.form),Je(5),vn("mat-focused",a.form.valid),Je(5),ot("disabled",a.form.invalid||!!a.dialog),Je(2),ot("disabled",a.form.invalid||!!a.dialog),Je(2),ot("checked",a.outcome)("disabled",!!a.dialog)("matTooltip",a.tooltipText))},directives:[yO,aO,Ph,R6,g2,N6,am,sO,OT,z5,g3,$H],styles:[".home[_ngcontent-%COMP%]{align-items:center;background-color:#f2f2f2;display:flex;flex-wrap:wrap;justify-content:center;min-height:100vh;width:100%}.home__welcome[_ngcontent-%COMP%]{background:#fff;border-radius:10px;box-shadow:0 5px 10px #0000001a;overflow:hidden;padding:10px 40px;width:390px}.home__welcome[_ngcontent-%COMP%]   .user[_ngcontent-%COMP%]{height:150px}.home__title[_ngcontent-%COMP%]{color:#333;display:block;font-size:30px;font-weight:500;margin:10px 0 60px;text-align:center}.home__wrapper[_ngcontent-%COMP%]{width:100%}.home__wrapper--center[_ngcontent-%COMP%]{text-align:center}.home__wrapper--buttons[_ngcontent-%COMP%]{align-items:center;display:flex}.home__btn[_ngcontent-%COMP%]{margin:0 5px}.home__footer[_ngcontent-%COMP%]{margin-top:30px;text-align:center}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:#333;cursor:pointer;height:24px;margin:0 5px;width:24px;transition:.3s}.home__footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]:hover{fill:#aaa}"],changeDetection:0}),r})(),t9=(()=>{class r{constructor(t,a){this.route=t,this.router=a,this.uid=String(Math.floor(100*Math.random()))}ngOnInit(){this.channel=this.route.snapshot.queryParams.channelId||"test-channel"}onCallEnd(){this.router.navigateByUrl("/")}}return r.\u0275fac=function(t){return new(t||r)(oe(Fm),oe(zo))},r.\u0275cmp=Er({type:r,selectors:[["app-conference"]],decls:1,vars:4,consts:[[3,"animate","channel","debug","uid","callEnd"]],template:function(t,a){1&t&&(Ae(0,"ngx-webrtc",0),zt("callEnd",function(){return a.onCallEnd()}),Be()),2&t&&ot("animate",!1)("channel",a.channel)("debug",!0)("uid",a.uid)},directives:[QB],styles:[""],changeDetection:0}),r})(),n9=(()=>{class r{static forRoot(t){return{ngModule:r,providers:[JB,{provide:"AgoraConfig",useValue:t}]}}}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r}),r.\u0275inj=Yt({imports:[[Qf]]}),r})();const i9=[{path:"",component:e9},{path:"conference",component:t9},{path:"**",redirectTo:""}];let r9=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=kn({type:r,bootstrap:[TW]}),r.\u0275inj=Yt({providers:[{provide:Storage,useValue:window.localStorage}],imports:[[qb,A5,n9.forRoot(qB_configs),UT,fW.forRoot(i9),P6,K5,QH,z6]]}),r})();(function dE(){ib=!1})(),JD().bootstrapModule(r9).catch(r=>console.error(r))},537:function(wc,Hm,Kh){var L=Kh(926).default;wc.exports=function(){"use strict";let Ji=!0,qo=!0;function Yo(o,n,i){const s=o.match(n);return s&&s.length>=i&&parseInt(s[i],10)}function pr(o,n,i){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype,c=s.addEventListener;s.addEventListener=function(h,p){if(h!==n)return c.apply(this,arguments);const m=_=>{const E=i(_);E&&(p.handleEvent?p.handleEvent(E):p(E))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(p,m),c.apply(this,[h,m])};const d=s.removeEventListener;s.removeEventListener=function(h,p){if(h!==n||!this._eventMap||!this._eventMap[n])return d.apply(this,arguments);if(!this._eventMap[n].has(p))return d.apply(this,arguments);const m=this._eventMap[n].get(p);return this._eventMap[n].delete(p),0===this._eventMap[n].size&&delete this._eventMap[n],0===Object.keys(this._eventMap).length&&delete this._eventMap,d.apply(this,[h,m])},Object.defineProperty(s,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function La(o){return"boolean"!=typeof o?new Error("Argument type: "+typeof o+". Please use a boolean."):(Ji=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function Vd(o){return"boolean"!=typeof o?new Error("Argument type: "+typeof o+". Please use a boolean."):(qo=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function $o(){if("object"==typeof window){if(Ji)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function En(o,n){qo&&console.warn(o+" is deprecated, please use "+n+" instead.")}function Vv(o){return"[object Object]"===Object.prototype.toString.call(o)}function qh(o){return Vv(o)?Object.keys(o).reduce(function(n,i){const s=Vv(o[i]),c=s?qh(o[i]):o[i],d=s&&!Object.keys(c).length;return void 0===c||d?n:Object.assign(n,{[i]:c})},{}):o}function p0(o,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(s=>{s.endsWith("Id")?p0(o,o.get(n[s]),i):s.endsWith("Ids")&&n[s].forEach(c=>{p0(o,o.get(c),i)})}))}function Dn(o,n,i){const s=i?"outbound-rtp":"inbound-rtp",c=new Map;if(null===n)return c;const d=[];return o.forEach(h=>{"track"===h.type&&h.trackIdentifier===n.id&&d.push(h)}),d.forEach(h=>{o.forEach(p=>{p.type===s&&p.trackId===h.id&&p0(o,p,c)})}),c}const Bv=$o;function f0(o,n){const i=o&&o.navigator;if(!i.mediaDevices)return;const s=function(h){if("object"!=typeof h||h.mandatory||h.optional)return h;const p={};return Object.keys(h).forEach(m=>{if("require"===m||"advanced"===m||"mediaSource"===m)return;const _="object"==typeof h[m]?h[m]:{ideal:h[m]};void 0!==_.exact&&"number"==typeof _.exact&&(_.min=_.max=_.exact);const E=function(v,S){return v?v+S.charAt(0).toUpperCase()+S.slice(1):"deviceId"===S?"sourceId":S};if(void 0!==_.ideal){p.optional=p.optional||[];let v={};"number"==typeof _.ideal?(v[E("min",m)]=_.ideal,p.optional.push(v),v={},v[E("max",m)]=_.ideal,p.optional.push(v)):(v[E("",m)]=_.ideal,p.optional.push(v))}void 0!==_.exact&&"number"!=typeof _.exact?(p.mandatory=p.mandatory||{},p.mandatory[E("",m)]=_.exact):["min","max"].forEach(v=>{void 0!==_[v]&&(p.mandatory=p.mandatory||{},p.mandatory[E(v,m)]=_[v])})}),h.advanced&&(p.optional=(p.optional||[]).concat(h.advanced)),p},c=function(h,p){if(n.version>=61)return p(h);if((h=JSON.parse(JSON.stringify(h)))&&"object"==typeof h.audio){const m=function(_,E,v){E in _&&!(v in _)&&(_[v]=_[E],delete _[E])};m((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),m(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=s(h.audio)}if(h&&"object"==typeof h.video){let m=h.video.facingMode;m=m&&("object"==typeof m?m:{ideal:m});const _=n.version<66;if(m&&("user"===m.exact||"environment"===m.exact||"user"===m.ideal||"environment"===m.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||_)){let E;if(delete h.video.facingMode,"environment"===m.exact||"environment"===m.ideal?E=["back","rear"]:"user"!==m.exact&&"user"!==m.ideal||(E=["front"]),E)return i.mediaDevices.enumerateDevices().then(v=>{let S=(v=v.filter(b=>"videoinput"===b.kind)).find(b=>E.some(O=>b.label.toLowerCase().includes(O)));return!S&&v.length&&E.includes("back")&&(S=v[v.length-1]),S&&(h.video.deviceId=m.exact?{exact:S.deviceId}:{ideal:S.deviceId}),h.video=s(h.video),Bv("chrome: "+JSON.stringify(h)),p(h)})}h.video=s(h.video)}return Bv("chrome: "+JSON.stringify(h)),p(h)},d=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(h,p,m){c(h,_=>{i.webkitGetUserMedia(_,p,E=>{m&&m(d(E))})})}.bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(p){return c(p,m=>h(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(E=>{E.stop()}),new DOMException("","NotFoundError");return _},_=>Promise.reject(d(_))))}}}function m0(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function Bd(o){if("object"==typeof o&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",s=>{let c;c=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.track.id):{track:s.track};const d=new Event("track");d.track=s.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[i.stream],this.dispatchEvent(d)}),i.stream.getTracks().forEach(s=>{let c;c=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===s.id):{track:s};const d=new Event("track");d.track=s,d.receiver=c,d.transceiver={receiver:c},d.streams=[i.stream],this.dispatchEvent(d)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else pr(o,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function Yh(o){if("object"==typeof o&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const n=function(c,d){return{track:d,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===d.kind?c.createDTMFSender(d):null),this._dtmf},_pc:c}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(h,p){let m=c.apply(this,arguments);return m||(m=n(this,h),this._senders.push(m)),m};const d=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const p=this._senders.indexOf(h);-1!==p&&this._senders.splice(p,1)}}const i=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(d=>{this._senders.push(n(this,d))})};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(d=>{const h=this._senders.find(p=>p.track===d);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if("object"==typeof o&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const n=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function NN(o){if(!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[i,s,c]=arguments;if(arguments.length>0&&"function"==typeof i)return n.apply(this,arguments);if(0===n.length&&(0===arguments.length||"function"!=typeof i))return n.apply(this,[]);const d=function(p){const m={};return p.result().forEach(_=>{const E={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(v=>{E[v]=_.stat(v)}),m[E.id]=E}),m},h=function(p){return new Map(Object.keys(p).map(m=>[m,p[m]]))};return arguments.length>=2?n.apply(this,[function(m){s(h(d(m)))},i]):new Promise((p,m)=>{n.apply(this,[function(_){p(h(d(_)))},m])}).then(s,c)}}function jv(o){if(!("object"==typeof o&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const i=o.RTCPeerConnection.prototype.getSenders;i&&(o.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(d=>d._pc=this),c});const s=o.RTCPeerConnection.prototype.addTrack;s&&(o.RTCPeerConnection.prototype.addTrack=function(){const c=s.apply(this,arguments);return c._pc=this,c}),o.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(d=>Dn(d,c.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const i=o.RTCPeerConnection.prototype.getReceivers;i&&(o.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(c=>c._pc=this),s}),pr(o,"track",s=>(s.receiver._pc=s.srcElement,s)),o.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(c=>Dn(c,s.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype)||!("getStats"in o.RTCRtpReceiver.prototype))return;const n=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const i=arguments[0];let s,c,d;return this.getSenders().forEach(h=>{h.track===i&&(s?d=!0:s=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?d=!0:c=h),h.track===i)),d||s&&c?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():c?c.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function Cn(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(d=>this._shimmedLocalStreams[d][0])};const n=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const p=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?-1===this._shimmedLocalStreams[h.id].indexOf(p)&&this._shimmedLocalStreams[h.id].push(p):this._shimmedLocalStreams[h.id]=[h,p],p};const i=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const p=this.getSenders().filter(m=>-1===h.indexOf(m));this._shimmedLocalStreams[d.id]=[d].concat(p)};const s=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],s.apply(this,arguments)};const c=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const p=this._shimmedLocalStreams[h].indexOf(d);-1!==p&&this._shimmedLocalStreams[h].splice(p,1),1===this._shimmedLocalStreams[h].length&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function Hv(o,n){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&n.version>=65)return Cn(o);const i=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const m=i.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};const s=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(E=>E.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const _=new o.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}s.apply(this,[m])};const c=o.RTCPeerConnection.prototype.removeStream;function d(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const S=m._reverseStreams[v];E=E.replace(new RegExp(m._streams[S.id].id,"g"),S.id)}),new RTCSessionDescription({type:_.type,sdp:E})}o.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},o.RTCPeerConnection.prototype.addTrack=function(m,_){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(1!==E.length||!E[0].getTracks().find(S=>S===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(S=>S.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[_.id];if(v)v.addTrack(m),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const S=new o.MediaStream([m]);this._streams[_.id]=S,this._reverseStreams[S.id]=_,this.addStream(S)}return this.getSenders().find(S=>S.track===m)},["createOffer","createAnswer"].forEach(function(m){const _=o.RTCPeerConnection.prototype[m],E={[m](){const v=arguments;return arguments.length&&"function"==typeof arguments[0]?_.apply(this,[S=>{const b=d(this,S);v[0].apply(null,[b])},S=>{v[1]&&v[1].apply(null,S)},arguments[2]]):_.apply(this,arguments).then(S=>d(this,S))}};o.RTCPeerConnection.prototype[m]=E[m]});const h=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,_){let E=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(v=>{const S=m._reverseStreams[v],b=m._streams[S.id];E=E.replace(new RegExp(S.id,"g"),b.id)}),new RTCSessionDescription({type:_.type,sdp:E})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const p=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const m=p.get.apply(this);return""===m.type?m:d(this,m)}}),o.RTCPeerConnection.prototype.removeTrack=function(m){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(v=>m.track===v)&&(_=this._streams[E])}),_&&(1===_.getTracks().length?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function _0(o,n){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=o.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new("addIceCandidate"===i?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};o.RTCPeerConnection.prototype[i]=c[i]})}function Rl(o,n){pr(o,"negotiationneeded",i=>{const s=i.target;if(!(n.version<72||s.getConfiguration&&"plan-b"===s.getConfiguration().sdpSemantics)||"stable"===s.signalingState)return i})}var g0=Object.freeze({__proto__:null,fixNegotiationNeeded:Rl,shimAddTrackRemoveTrack:Hv,shimAddTrackRemoveTrackWithNative:Cn,shimGetDisplayMedia:function(o,n){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&("function"==typeof n?o.navigator.mediaDevices.getDisplayMedia=function(i){return n(i).then(s=>{const c=i.video&&i.video.width,d=i.video&&i.video.height;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:i.video&&i.video.frameRate||3}},c&&(i.video.mandatory.maxWidth=c),d&&(i.video.mandatory.maxHeight=d),o.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Yh,shimGetStats:NN,shimGetUserMedia:f0,shimMediaStream:m0,shimOnTrack:Bd,shimPeerConnection:_0,shimSenderReceiverGetStats:jv});function Gv(o,n){const i=o&&o.navigator,s=o&&o.MediaStreamTrack;if(i.getUserMedia=function(c,d,h){En("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(d,h)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,p,m){p in h&&!(m in h)&&(h[m]=h[p],delete h[p])},d=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return"object"==typeof h&&"object"==typeof h.audio&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},s&&s.prototype.getSettings){const h=s.prototype.getSettings;s.prototype.getSettings=function(){const p=h.apply(this,arguments);return c(p,"mozAutoGainControl","autoGainControl"),c(p,"mozNoiseSuppression","noiseSuppression"),p}}if(s&&s.prototype.applyConstraints){const h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(p){return"audio"===this.kind&&"object"==typeof p&&(p=JSON.parse(JSON.stringify(p)),c(p,"autoGainControl","mozAutoGainControl"),c(p,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[p])}}}}function hn(o){"object"==typeof o&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Gm(o,n){if("object"!=typeof o||!o.RTCPeerConnection&&!o.mozRTCPeerConnection)return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const d=o.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new("addIceCandidate"===c?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};o.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return s.apply(this,[c||null]).then(p=>{if(n.version<53&&!d)try{p.forEach(m=>{m.type=i[m.type]||m.type})}catch(m){if("TypeError"!==m.name)throw m;p.forEach((_,E)=>{p.set(E,Object.assign({},_,{type:i[_.type]||_.type}))})}return p}).then(d,h)}}function Il(o){if("object"!=typeof o||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const n=o.RTCPeerConnection.prototype.getSenders;n&&(o.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(c=>c._pc=this),s});const i=o.RTCPeerConnection.prototype.addTrack;i&&(o.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function on(o){if("object"!=typeof o||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const n=o.RTCPeerConnection.prototype.getReceivers;n&&(o.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),pr(o,"track",i=>(i.receiver._pc=i.srcElement,i)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function E0(o){o.RTCPeerConnection&&!("removeStream"in o.RTCPeerConnection.prototype)&&(o.RTCPeerConnection.prototype.removeStream=function(n){En("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function v0(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function Wv(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.addTransceiver;n&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;void 0===i&&(i=[]),i=[...i];const s=i.length>0;s&&i.forEach(d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(s){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||1===h.encodings.length&&0===Object.keys(h.encodings[0]).length)&&(h.encodings=i,d.sendEncodings=i,this.setParametersPromises.push(d.setParameters(h).then(()=>{delete d.sendEncodings}).catch(()=>{delete d.sendEncodings})))}return c})}function y0(o){if("object"!=typeof o||!o.RTCRtpSender)return;const n=o.RTCRtpSender.prototype.getParameters;n&&(o.RTCRtpSender.prototype.getParameters=function(){const i=n.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function S0(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function $h(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var PN=Object.freeze({__proto__:null,shimAddTransceiver:Wv,shimCreateAnswer:$h,shimCreateOffer:S0,shimGetDisplayMedia:function(o,n){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return!0===i.video?i.video={mediaSource:n}:i.video.mediaSource=n,o.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:y0,shimGetUserMedia:Gv,shimOnTrack:hn,shimPeerConnection:Gm,shimRTCDataChannel:v0,shimReceiverGetStats:on,shimRemoveStream:E0,shimSenderGetStats:Il});function C0(o){if("object"==typeof o&&o.RTCPeerConnection){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const n=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>n.call(this,s,i)),i.getVideoTracks().forEach(s=>n.call(this,s,i))},o.RTCPeerConnection.prototype.addTrack=function(i,...s){return s&&s.forEach(c=>{this._localStreams?this._localStreams.includes(c)||this._localStreams.push(c):this._localStreams=[c]}),n.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(-1===i)return;this._localStreams.splice(i,1);const s=n.getTracks();this.getSenders().forEach(c=>{s.includes(c.track)&&this.removeTrack(c)})})}}function b0(o){if("object"==typeof o&&o.RTCPeerConnection&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=s=>{s.streams.forEach(c=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(c))return;this._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,this.dispatchEvent(d)})})}});const n=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,i.dispatchEvent(d)})}),n.apply(i,arguments)}}}function zv(o){if("object"!=typeof o||!o.RTCPeerConnection)return;const n=o.RTCPeerConnection.prototype,i=n.createOffer,s=n.createAnswer,c=n.setLocalDescription,d=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(m,_){const v=i.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(v.then(m,_),Promise.resolve()):v},n.createAnswer=function(m,_){const v=s.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return _?(v.then(m,_),Promise.resolve()):v};let p=function(m,_,E){const v=c.apply(this,[m]);return E?(v.then(_,E),Promise.resolve()):v};n.setLocalDescription=p,p=function(m,_,E){const v=d.apply(this,[m]);return E?(v.then(_,E),Promise.resolve()):v},n.setRemoteDescription=p,p=function(m,_,E){const v=h.apply(this,[m]);return E?(v.then(_,E),Promise.resolve()):v},n.addIceCandidate=p}function Kv(o){const n=o&&o.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const i=n.mediaDevices,s=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=c=>s(Wm(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(i,s,c){n.mediaDevices.getUserMedia(i).then(s,c)}.bind(n))}function Wm(o){return o&&void 0!==o.video?Object.assign({},o,{video:qh(o.video)}):o}function T0(o){if(!o.RTCPeerConnection)return;const n=o.RTCPeerConnection;o.RTCPeerConnection=function(i,s){if(i&&i.iceServers){const c=[];for(let d=0;d<i.iceServers.length;d++){let h=i.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(En("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[d])}i.iceServers=c}return new n(i,s)},o.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function R0(o){"object"==typeof o&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zm(o){const n=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(i){if(i){void 0!==i.offerToReceiveAudio&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const s=this.getTransceivers().find(d=>"audio"===d.receiver.track.kind);!1===i.offerToReceiveAudio&&s?"sendrecv"===s.direction?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":"recvonly"===s.direction&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):!0!==i.offerToReceiveAudio||s||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==i.offerToReceiveVideo&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(d=>"video"===d.receiver.track.kind);!1===i.offerToReceiveVideo&&c?"sendrecv"===c.direction?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":"recvonly"===c.direction&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):!0!==i.offerToReceiveVideo||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function I0(o){"object"!=typeof o||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}var w0=Object.freeze({__proto__:null,shimAudioContext:I0,shimCallbacksAPI:zv,shimConstraints:Wm,shimCreateOfferLegacy:zm,shimGetUserMedia:Kv,shimLocalStreamsAPI:C0,shimRTCIceServerUrls:T0,shimRemoteStreamsAPI:b0,shimTrackEventTransceiver:R0}),jd="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function fr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var mr={exports:{}};!function(o){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split("\n").map(s=>s.trim())},n.splitSections=function(i){return i.split("\nm=").map((s,c)=>(c>0?"m="+s:s).trim()+"\r\n")},n.getDescription=function(i){const s=n.splitSections(i);return s&&s[0]},n.getMediaSections=function(i){const s=n.splitSections(i);return s.shift(),s},n.matchPrefix=function(i,s){return n.splitLines(i).filter(c=>0===c.indexOf(s))},n.parseCandidate=function(i){let s;s=0===i.indexOf("a=candidate:")?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:s[0],component:{1:"rtp",2:"rtcp"}[s[1]]||s[1],protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]};for(let d=8;d<s.length;d+=2)switch(s[d]){case"raddr":c.relatedAddress=s[d+1];break;case"rport":c.relatedPort=parseInt(s[d+1],10);break;case"tcptype":c.tcpType=s[d+1];break;case"ufrag":c.ufrag=s[d+1],c.usernameFragment=s[d+1];break;default:void 0===c[s[d]]&&(c[s[d]]=s[d+1])}return c},n.writeCandidate=function(i){const s=[];s.push(i.foundation);const c=i.component;s.push("rtp"===c?1:"rtcp"===c?2:c),s.push(i.protocol.toUpperCase()),s.push(i.priority),s.push(i.address||i.ip),s.push(i.port);const d=i.type;return s.push("typ"),s.push(d),"host"!==d&&i.relatedAddress&&i.relatedPort&&(s.push("raddr"),s.push(i.relatedAddress),s.push("rport"),s.push(i.relatedPort)),i.tcpType&&"tcp"===i.protocol.toLowerCase()&&(s.push("tcptype"),s.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(s.push("ufrag"),s.push(i.usernameFragment||i.ufrag)),"candidate:"+s.join(" ")},n.parseIceOptions=function(i){return i.substring(14).split(" ")},n.parseRtpMap=function(i){let s=i.substring(9).split(" ");const c={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),c.name=s[0],c.clockRate=parseInt(s[1],10),c.channels=3===s.length?parseInt(s[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(i){let s=i.payloadType;void 0!==i.preferredPayloadType&&(s=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+s+" "+i.name+"/"+i.clockRate+(1!==c?"/"+c:"")+"\r\n"},n.parseExtmap=function(i){const s=i.substring(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1],attributes:s.slice(2).join(" ")}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&"sendrecv"!==i.direction?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+"\r\n"},n.parseFmtp=function(i){const s={};let c;const d=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),s[c[0].trim()]=c[1];return s},n.writeFmtp=function(i){let s="",c=i.payloadType;if(void 0!==i.preferredPayloadType&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const d=[];Object.keys(i.parameters).forEach(h=>{d.push(void 0!==i.parameters[h]?h+"="+i.parameters[h]:h)}),s+="a=fmtp:"+c+" "+d.join(";")+"\r\n"}return s},n.parseRtcpFb=function(i){const s=i.substring(i.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},n.writeRtcpFb=function(i){let s="",c=i.payloadType;return void 0!==i.preferredPayloadType&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(d=>{s+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+"\r\n"}),s},n.parseSsrcMedia=function(i){const s=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,s),10)},d=i.indexOf(":",s);return d>-1?(c.attribute=i.substring(s+1,d),c.value=i.substring(d+1)):c.attribute=i.substring(s+1),c},n.parseSsrcGroup=function(i){const s=i.substring(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(c=>parseInt(c,10))}},n.getMid=function(i){const s=n.matchPrefix(i,"a=mid:")[0];if(s)return s.substring(6)},n.parseFingerprint=function(i){const s=i.substring(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1].toUpperCase()}},n.getDtlsParameters=function(i,s){return{role:"auto",fingerprints:n.matchPrefix(i+s,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,s){let c="a=setup:"+s+"\r\n";return i.fingerprints.forEach(d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+"\r\n"}),c},n.parseCryptoLine=function(i){const s=i.substring(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+("object"==typeof i.keyParams?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(i){if(0!==i.indexOf("inline:"))return null;const s=i.substring(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,s){return n.matchPrefix(i+s,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,s){const c=n.matchPrefix(i+s,"a=ice-ufrag:")[0],d=n.matchPrefix(i+s,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},n.writeIceParameters=function(i){let s="a=ice-ufrag:"+i.usernameFragment+"\r\na=ice-pwd:"+i.password+"\r\n";return i.iceLite&&(s+="a=ice-lite\r\n"),s},n.parseRtpParameters=function(i){const s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(i)[0].split(" ");s.profile=c[2];for(let h=3;h<c.length;h++){const p=c[h],m=n.matchPrefix(i,"a=rtpmap:"+p+" ")[0];if(m){const _=n.parseRtpMap(m),E=n.matchPrefix(i,"a=fmtp:"+p+" ");switch(_.parameters=E.length?n.parseFmtp(E[0]):{},_.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+p+" ").map(n.parseRtcpFb),s.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(_.name.toUpperCase())}}}n.matchPrefix(i,"a=extmap:").forEach(h=>{s.headerExtensions.push(n.parseExtmap(h))});const d=n.matchPrefix(i,"a=rtcp-fb:* ").map(n.parseRtcpFb);return s.codecs.forEach(h=>{d.forEach(p=>{h.rtcpFeedback.find(m=>m.type===p.type&&m.parameter===p.parameter)||h.rtcpFeedback.push(p)})}),s},n.writeRtpDescription=function(i,s){let c="";c+="m="+i+" ",c+=s.codecs.length>0?"9":"0",c+=" "+(s.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=s.codecs.map(h=>void 0!==h.preferredPayloadType?h.preferredPayloadType:h.payloadType).join(" ")+"\r\n",c+="c=IN IP4 0.0.0.0\r\n",c+="a=rtcp:9 IN IP4 0.0.0.0\r\n",s.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let d=0;return s.codecs.forEach(h=>{h.maxptime>d&&(d=h.maxptime)}),d>0&&(c+="a=maxptime:"+d+"\r\n"),s.headerExtensions&&s.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(i){const s=[],c=n.parseRtpParameters(i),d=-1!==c.fecMechanisms.indexOf("RED"),h=-1!==c.fecMechanisms.indexOf("ULPFEC"),p=n.matchPrefix(i,"a=ssrc:").map(S=>n.parseSsrcMedia(S)).filter(S=>"cname"===S.attribute),m=p.length>0&&p[0].ssrc;let _;const E=n.matchPrefix(i,"a=ssrc-group:FID").map(S=>S.substring(17).split(" ").map(b=>parseInt(b,10)));E.length>0&&E[0].length>1&&E[0][0]===m&&(_=E[0][1]),c.codecs.forEach(S=>{if("RTX"===S.name.toUpperCase()&&S.parameters.apt){let b={ssrc:m,codecPayloadType:parseInt(S.parameters.apt,10)};m&&_&&(b.rtx={ssrc:_}),s.push(b),d&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:m,mechanism:h?"red+ulpfec":"red"},s.push(b))}}),0===s.length&&m&&s.push({ssrc:m});let v=n.matchPrefix(i,"b=");return v.length&&(v=0===v[0].indexOf("b=TIAS:")?parseInt(v[0].substring(7),10):0===v[0].indexOf("b=AS:")?1e3*parseInt(v[0].substring(5),10)*.95-16e3:void 0,s.forEach(S=>{S.maxBitrate=v})),s},n.parseRtcpParameters=function(i){const s={},c=n.matchPrefix(i,"a=ssrc:").map(p=>n.parseSsrcMedia(p)).filter(p=>"cname"===p.attribute)[0];c&&(s.cname=c.value,s.ssrc=c.ssrc);const d=n.matchPrefix(i,"a=rtcp-rsize");s.reducedSize=d.length>0,s.compound=0===d.length;const h=n.matchPrefix(i,"a=rtcp-mux");return s.mux=h.length>0,s},n.writeRtcpParameters=function(i){let s="";return i.reducedSize&&(s+="a=rtcp-rsize\r\n"),i.mux&&(s+="a=rtcp-mux\r\n"),void 0!==i.ssrc&&i.cname&&(s+="a=ssrc:"+i.ssrc+" cname:"+i.cname+"\r\n"),s},n.parseMsid=function(i){let s;const c=n.matchPrefix(i,"a=msid:");if(1===c.length)return s=c[0].substring(7).split(" "),{stream:s[0],track:s[1]};const d=n.matchPrefix(i,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>"msid"===h.attribute);return d.length>0?(s=d[0].value.split(" "),{stream:s[0],track:s[1]}):void 0},n.parseSctpDescription=function(i){const s=n.parseMLine(i),c=n.matchPrefix(i,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=n.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:s.fmt,maxMessageSize:d};const p=n.matchPrefix(i,"a=sctpmap:");if(p.length>0){const m=p[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:d}}},n.writeSctpDescription=function(i,s){let c=[];return c="DTLS/SCTP"!==i.protocol?["m="+i.kind+" 9 "+i.protocol+" "+s.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+s.port+"\r\n"]:["m="+i.kind+" 9 "+i.protocol+" "+s.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+s.port+" "+s.protocol+" 65535\r\n"],void 0!==s.maxMessageSize&&c.push("a=max-message-size:"+s.maxMessageSize+"\r\n"),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(i,s,c){let d;const h=void 0!==s?s:2;return d=i||n.generateSessionId(),"v=0\r\no="+(c||"thisisadapterortc")+" "+d+" "+h+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.getDirection=function(i,s){const c=n.splitLines(i);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return s?n.getDirection(s):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substring(2)},n.isRejected=function(i){return"0"===i.split(" ",2)[1]},n.parseMLine=function(i){const s=n.splitLines(i)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},n.parseOLine=function(i){const s=n.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},n.isValidSDP=function(i){if("string"!=typeof i||0===i.length)return!1;const s=n.splitLines(i);for(let c=0;c<s.length;c++)if(s[c].length<2||"="!==s[c].charAt(1))return!1;return!0},o.exports=n}(mr);var Hd=mr.exports,Xh=fr(Hd),Jh=function Ac(o,n){return n.forEach(function(i){i&&"string"!=typeof i&&!Array.isArray(i)&&Object.keys(i).forEach(function(s){if("default"!==s&&!(s in o)){var c=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(o,s,c.get?c:{enumerable:!0,get:function(){return i[s]}})}})}),Object.freeze(o)}({__proto__:null,default:Xh},[Hd]);function qv(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const n=o.RTCIceCandidate;o.RTCIceCandidate=function(i){if("object"==typeof i&&i.candidate&&0===i.candidate.indexOf("a=")&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const s=new n(i),c=Xh.parseCandidate(i.candidate),d=Object.assign(s,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new n(i)},o.RTCIceCandidate.prototype=n.prototype,pr(o,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new o.RTCIceCandidate(i.candidate),writable:"false"}),i))}function wl(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||pr(o,"icecandidate",n=>{if(n.candidate){const i=Xh.parseCandidate(n.candidate.candidate);"relay"===i.type&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function Ni(o,n){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const i=function(p){if(!p||!p.sdp)return!1;const m=Xh.splitSections(p.sdp);return m.shift(),m.some(_=>{const E=Xh.parseMLine(_);return E&&"application"===E.kind&&-1!==E.protocol.indexOf("SCTP")})},s=function(p){const m=p.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===m||m.length<2)return-1;const _=parseInt(m[1],10);return _!=_?-1:_},c=function(p){let m=65536;return"firefox"===n.browser&&(m=n.version<57?-1===p?16384:2147483637:n.version<60?57===n.version?65535:65536:2147483637),m},d=function(p,m){let _=65536;"firefox"===n.browser&&57===n.version&&(_=65535);const E=Xh.matchPrefix(p.sdp,"a=max-message-size:");return E.length>0?_=parseInt(E[0].substr(19),10):"firefox"===n.browser&&-1!==m&&(_=2147483637),_},h=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===n.browser&&n.version>=76){const{sdpSemantics:p}=this.getConfiguration();"plan-b"===p&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const p=s(arguments[0]),m=c(p),_=d(arguments[0],p);let E;E=0===m&&0===_?Number.POSITIVE_INFINITY:0===m||0===_?Math.max(m,_):Math.min(m,_);const v={};Object.defineProperty(v,"maxMessageSize",{get:()=>E}),this._sctp=v}return h.apply(this,arguments)}}function Km(o){if(!o.RTCPeerConnection||!("createDataChannel"in o.RTCPeerConnection.prototype))return;function n(s,c){const d=s.send;s.send=function(){const h=arguments[0];if("open"===s.readyState&&c.sctp&&(h.length||h.size||h.byteLength)>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(s,arguments)}}const i=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const s=i.apply(this,arguments);return n(s,this),s},pr(o,"datachannel",s=>(n(s.channel,s.target),s))}function Yv(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const n=o.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const s=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),s.apply(this,arguments)}})}function A0(o,n){if(!o.RTCPeerConnection||"chrome"===n.browser&&n.version>=71||"safari"===n.browser&&n.version>=605)return;const i=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&-1!==s.sdp.indexOf("\na=extmap-allow-mixed")){const c=s.sdp.split("\n").filter(d=>"a=extmap-allow-mixed"!==d.trim()).join("\n");o.RTCSessionDescription&&s instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:s.type,sdp:c}):s.sdp=c}return i.apply(this,arguments)}}function Dc(o,n){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const i=o.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===n.browser&&n.version<78||"firefox"===n.browser&&n.version<68||"safari"===n.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Gd(o,n){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const i=o.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(o.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if("object"!=typeof s||s.type&&s.sdp)return i.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer"}return s.sdp||"offer"!==s.type&&"answer"!==s.type?i.apply(this,[s]):("offer"===s.type?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var $v=Object.freeze({__proto__:null,removeExtmapAllowMixed:A0,shimAddIceCandidateNullOrEmpty:Dc,shimConnectionState:Yv,shimMaxMessageSize:Ni,shimParameterlessSetLocalDescription:Gd,shimRTCIceCandidate:qv,shimRTCIceCandidateRelayProtocol:wl,shimSendThrowTypeError:Km});!function({window:o}={},n={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=$o,s=function(d){const h={browser:null,version:null};if(void 0===d||!d.navigator)return h.browser="Not a browser.",h;const{navigator:p}=d;if(p.mozGetUserMedia)h.browser="firefox",h.version=Yo(p.userAgent,/Firefox\/(\d+)\./,1);else if(p.webkitGetUserMedia||!1===d.isSecureContext&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=Yo(p.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!p.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=Yo(p.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h}(o),c={browserDetails:s,commonShim:$v,extractVersion:Yo,disableLog:La,disableWarnings:Vd,sdp:Jh};switch(s.browser){case"chrome":if(!g0||!_0||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(null===s.version)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=g0,Dc(o,s),Gd(o),f0(o,s),m0(o),_0(o,s),Bd(o),Hv(o,s),Yh(o),NN(o),jv(o),Rl(o,s),qv(o),wl(o),Yv(o),Ni(o,s),Km(o),A0(o,s);break;case"firefox":if(!PN||!Gm||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=PN,Dc(o,s),Gd(o),Gv(o,s),Gm(o,s),hn(o),E0(o),Il(o),on(o),v0(o),Wv(o),y0(o),S0(o),$h(o),qv(o),Yv(o),Ni(o,s),Km(o);break;case"safari":if(!w0||!n.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=w0,Dc(o,s),Gd(o),T0(o),zm(o),zv(o),C0(o),b0(o),R0(o),Kv(o),I0(o),qv(o),wl(o),Ni(o,s),Km(o),A0(o,s);break;default:i("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var Zn=function(o){try{return!!o()}catch(n){return!0}},qm=!Zn(function(){var o=function(){}.bind();return"function"!=typeof o||o.hasOwnProperty("prototype")}),D0=qm,Xv=Function.prototype,Jv=Xv.call,kN=D0&&Xv.bind.bind(Jv,Jv),_i=D0?kN:function(o){return function(){return Jv.apply(o,arguments)}},Cs=_i({}.isPrototypeOf),Ym=function(o){return o&&o.Math==Math&&o},Qi=Ym("object"==typeof globalThis&&globalThis)||Ym("object"==typeof window&&window)||Ym("object"==typeof self&&self)||Ym("object"==typeof jd&&jd)||function(){return this}()||jd||Function("return this")(),O0=Function.prototype,On=O0.apply,$m=O0.call,pn="object"==typeof Reflect&&Reflect.apply||(qm?$m.bind(On):function(){return $m.apply(On,arguments)}),Xm=_i,LN=Xm({}.toString),Nn=Xm("".slice),at=function(o){return Nn(LN(o),8,-1)},N0=at,q2=_i,Pe=function(o){if("Function"===N0(o))return q2(o)},Qh="object"==typeof document&&document.all,ct={all:Qh,IS_HTMLDDA:void 0===Qh&&void 0!==Qh},_r=ct.all,Pi=ct.IS_HTMLDDA?function(o){return"function"==typeof o||o===_r}:function(o){return"function"==typeof o},Jm={},xa=!Zn(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),Rr=Function.prototype.call,Vr=qm?Rr.bind(Rr):function(){return Rr.apply(Rr,arguments)},Qv={},xN={}.propertyIsEnumerable,Zs=Object.getOwnPropertyDescriptor,Y2=Zs&&!xN.call({1:2},1);Qv.f=Y2?function(o){var n=Zs(this,o);return!!n&&n.enumerable}:xN;var Al,Zv,Wd=function(o,n){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:n}},FN=Zn,$2=at,ey=Object,X2=_i("".split),Br=FN(function(){return!ey("z").propertyIsEnumerable(0)})?function(o){return"String"==$2(o)?X2(o,""):ey(o)}:ey,sn=function(o){return null==o},J2=sn,Q2=TypeError,Zm=function(o){if(J2(o))throw Q2("Can't call method on "+o);return o},Ue=Br,Z2=Zm,Yt=function(o){return Ue(Z2(o))},e_=Pi,P0=ct.all,Xo=ct.IS_HTMLDDA?function(o){return"object"==typeof o?null!==o:e_(o)||o===P0}:function(o){return"object"==typeof o?null!==o:e_(o)},Dl={},t_=Dl,zd=Qi,ty=Pi,ny=function(o){return ty(o)?o:void 0},ro=function(o,n){return arguments.length<2?ny(t_[o])||ny(zd[o]):t_[o]&&t_[o][n]||zd[o]&&zd[o][n]},et="undefined"!=typeof navigator&&String(navigator.userAgent)||"",iy=et,Fa=Qi.process,ry=Qi.Deno,UN=Fa&&Fa.versions||ry&&ry.version,Ua=UN&&UN.v8;Ua&&(Zv=(Al=Ua.split("."))[0]>0&&Al[0]<4?1:+(Al[0]+Al[1])),!Zv&&iy&&(!(Al=iy.match(/Edge\/(\d+)/))||Al[1]>=74)&&(Al=iy.match(/Chrome\/(\d+)/))&&(Zv=+Al[1]);var gr=Zv,VN=gr,bs=Qi.String,Kd=!!Object.getOwnPropertySymbols&&!Zn(function(){var o=Symbol();return!bs(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&VN&&VN<41}),k0=Kd&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,BN=ro,tF=Pi,Pn=Cs,nF=Object,i_=k0?function(o){return"symbol"==typeof o}:function(o){var n=BN("Symbol");return tF(n)&&Pn(n.prototype,nF(o))},qd=String,an=function(o){try{return qd(o)}catch(n){return"Object"}},r_=Pi,oy=an,sy=TypeError,To=function(o){if(r_(o))return o;throw sy(oy(o)+" is not a function")},Va=To,Zh=sn,ay=function(o,n){var i=o[n];return Zh(i)?void 0:Va(i)},Er=Vr,cy=Pi,o_=Xo,M0=TypeError,ly={exports:{}},kn=Qi,jN=Object.defineProperty,je="__core-js_shared__",Ir=Qi[je]||function(o,n){try{jN(kn,o,{value:n,configurable:!0,writable:!0})}catch(i){kn[o]=n}return n}(je,{}),Zi=Ir;(ly.exports=function(o,n){return Zi[o]||(Zi[o]=void 0!==n?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xa9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ro=ly.exports,Ol=Zm,Jo=Object,ea=function(o){return Jo(Ol(o))},dy=ea,ep=_i({}.hasOwnProperty),zi=Object.hasOwn||function(o,n){return ep(dy(o),n)},Nl=_i,wr=0,HN=Math.random(),Qo=Nl(1..toString),Oe=function(o){return"Symbol("+(void 0===o?"":o)+")_"+Qo(++wr+HN,36)},Xn=zi,Io=Oe,Pl=Kd,er=k0,Zo=Qi.Symbol,ei=Ro("wks"),tp=er?Zo.for||Zo:Zo&&Zo.withoutSetter||Io,bn=function(o){return Xn(ei,o)||(ei[o]=Pl&&Xn(Zo,o)?Zo[o]:tp("Symbol."+o)),ei[o]},It=Vr,np=Xo,kl=i_,uy=ay,jr=TypeError,ip=bn("toPrimitive"),$d=function(o,n){if(!np(o)||kl(o))return o;var i,s=uy(o,ip);if(s){if(void 0===n&&(n="default"),i=It(s,o,n),!np(i)||kl(i))return i;throw jr("Can't convert object to primitive value")}return void 0===n&&(n="number"),function(o,n){var i,s;if("string"===n&&cy(i=o.toString)&&!o_(s=Er(i,o))||cy(i=o.valueOf)&&!o_(s=Er(i,o))||"string"!==n&&cy(i=o.toString)&&!o_(s=Er(i,o)))return s;throw M0("Can't convert object to primitive value")}(o,n)},Ts=i_,Tn=function(o){var n=$d(o,"string");return Ts(n)?n:n+""},x0=Xo,hy=Qi.document,ta=x0(hy)&&x0(hy.createElement),wo=function(o){return ta?hy.createElement(o):{}},py=wo,rp=!xa&&!Zn(function(){return 7!=Object.defineProperty(py("div"),"a",{get:function(){return 7}}).a}),Rs=Vr,GN=Qv,iF=Wd,WN=Yt,zN=Tn,rF=zi,oF=rp,KN=Object.getOwnPropertyDescriptor;Jm.f=xa?KN:function(o,n){if(o=WN(o),n=zN(n),oF)try{return KN(o,n)}catch(i){}if(rF(o,n))return iF(!Rs(GN.f,o,n),o[n])};var sF=Zn,aF=Pi,cF=/#|\.prototype\./,a_=function(o,n){var i=dF[lF(o)];return i==hF||i!=uF&&(aF(n)?sF(n):!!n)},lF=a_.normalize=function(o){return String(o).replace(cF,".").toLowerCase()},dF=a_.data={},uF=a_.NATIVE="N",hF=a_.POLYFILL="P",qN=a_,pF=To,fF=qm,F0=Pe(Pe.bind),Ml=function(o,n){return pF(o),void 0===n?o:fF?F0(o,n):function(){return o.apply(n,arguments)}},Is={},YN=xa&&Zn(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),mF=Xo,Ll=String,$N=TypeError,li=function(o){if(mF(o))return o;throw $N(Ll(o)+" is not an object")},XN=rp,op=li,fy=Tn,QN=TypeError,sp=Object.defineProperty,ZN=Object.getOwnPropertyDescriptor,oo="enumerable",ap="configurable",my="writable";Is.f=xa?YN?function(o,n,i){if(op(o),n=fy(n),op(i),"function"==typeof o&&"prototype"===n&&"value"in i&&my in i&&!i[my]){var s=ZN(o,n);s&&s[my]&&(o[n]=i.value,i={configurable:ap in i?i[ap]:s[ap],enumerable:oo in i?i[oo]:s[oo],writable:!1})}return sp(o,n,i)}:sp:function(o,n,i){if(op(o),n=fy(n),op(i),XN)try{return sp(o,n,i)}catch(s){}if("get"in i||"set"in i)throw QN("Accessors not supported");return"value"in i&&(o[n]=i.value),o};var _y=Is,eP=Wd,Oc=xa?function(o,n,i){return _y.f(o,n,eP(1,i))}:function(o,n,i){return o[n]=i,o},Xd=Qi,tP=pn,gy=Pe,_F=Pi,gi=Jm.f,V0=qN,Jd=Dl,ki=Ml,Qd=Oc,nP=zi,c_=function(o){var n=function(i,s,c){if(this instanceof n){switch(arguments.length){case 0:return new o;case 1:return new o(i);case 2:return new o(i,s)}return new o(i,s,c)}return tP(o,this,arguments)};return n.prototype=o.prototype,n},wt=function(o,n){var i,s,c,d,h,p,m,_,E,v=o.target,S=o.global,b=o.stat,O=o.proto,P=S?Xd:b?Xd[v]:(Xd[v]||{}).prototype,w=S?Jd:Jd[v]||Qd(Jd,v,{})[v],M=w.prototype;for(d in n)s=!(i=V0(S?d:v+(b?".":"#")+d,o.forced))&&P&&nP(P,d),p=w[d],s&&(m=o.dontCallGetSet?(E=gi(P,d))&&E.value:P[d]),h=s&&m?m:n[d],s&&typeof p==typeof h||(_=o.bind&&s?ki(h,Xd):o.wrap&&s?c_(h):O&&_F(h)?gy(h):h,(o.sham||h&&h.sham||p&&p.sham)&&Qd(_,"sham",!0),Qd(w,d,_),O&&(nP(Jd,c=v+"Prototype")||Qd(Jd,c,{}),Qd(Jd[c],d,h),o.real&&M&&(i||!M[d])&&Qd(M,d,h)))},iP=Math.ceil,Ey=Math.floor,Zd=Math.trunc||function(o){var n=+o;return(n>0?Ey:iP)(n)},Hr=function(o){var n=+o;return n!=n||0===n?0:Zd(n)},B0=Hr,vy=Math.max,rP=Math.min,Ba=function(o,n){var i=B0(o);return i<0?vy(i+n,0):rP(i,n)},j0=Hr,yy=Math.min,Nc=function(o){return function(o){return o>0?yy(j0(o),9007199254740991):0}(o.length)},gF=Yt,oP=Ba,sP=Nc,H0=function(o){return function(n,i,s){var c,d=gF(n),h=sP(d),p=oP(s,h);if(o&&i!=i){for(;h>p;)if((c=d[p++])!=c)return!0}else for(;h>p;p++)if((o||p in d)&&d[p]===i)return o||p||0;return!o&&-1}},Sy={includes:H0(!0),indexOf:H0(!1)},aP=Sy.includes;wt({target:"Array",proto:!0,forced:Zn(function(){return!Array(1).includes()})},{includes:function(o){return aP(this,o,arguments.length>1?arguments[1]:void 0)}});var cP=Dl,_e=function(o){return cP[o+"Prototype"]},$t=_e("Array").includes,es=Xo,Ki=at,G0=bn("match"),na=TypeError,l_={};l_[bn("toStringTag")]="z";var lp="[object z]"===String(l_),EF=lp,lP=Pi,Cy=at,d_=bn("toStringTag"),Gr=Object,ja="Arguments"==Cy(function(){return arguments}()),Pc=EF?Cy:function(o){var n,i,s;return void 0===o?"Undefined":null===o?"Null":"string"==typeof(i=function(c,d){try{return c[d]}catch(h){}}(n=Gr(o),d_))?i:ja?Cy(n):"Object"==(s=Cy(n))&&lP(n.callee)?"Arguments":s},eu=Pc,Ha=String,Ga=function(o){if("Symbol"===eu(o))throw TypeError("Cannot convert a Symbol value to a string");return Ha(o)},W0=bn("match"),dP=wt,uP=function(o){if(function(o){var n;return es(o)&&(void 0!==(n=o[G0])?!!n:"RegExp"==Ki(o))}(o))throw na("The method doesn't accept regular expressions");return o},by=Zm,u_=Ga,Ty=_i("".indexOf);dP({target:"String",proto:!0,forced:!function(o){var n=/./;try{"/./"[o](n)}catch(i){try{return n[W0]=!1,"/./"[o](n)}catch(s){}}return!1}("includes")},{includes:function(o){return!!~Ty(u_(by(this)),u_(uP(o)),arguments.length>1?arguments[1]:void 0)}});var hP=_e("String").includes,Ry=Cs,h_=$t,K0=hP,p_=Array.prototype,f_=String.prototype,Re=fr(function(o){var n=o.includes;return o===p_||Ry(p_,o)&&n===p_.includes?h_:"string"==typeof o||o===f_||Ry(f_,o)&&n===f_.includes?K0:n}),dp={exports:{}},Ar=Is.f;wt({target:"Object",stat:!0,forced:Object.defineProperty!==Ar,sham:!xa},{defineProperty:Ar});var Wa=Dl.Object,di=dp.exports=function(o,n,i){return Wa.defineProperty(o,n,i)};Wa.defineProperty.sham&&(di.sham=!0);var ws=fr(dp.exports),mP=at,As=Array.isArray||function(o){return"Array"==mP(o)},_P=TypeError,gP=Tn,EP=Is,m_=Wd,up=function(o,n,i){var s=gP(n);s in o?EP.f(o,s,m_(0,i)):o[s]=i},__=Pi,hp=Ir,q0=_i(Function.toString);__(hp.inspectSource)||(hp.inspectSource=function(o){return q0(o)});var Y0=hp.inspectSource,kc=_i,pp=Zn,$0=Pi,vP=Pc,fp=Y0,g_=function(){},yP=[],X0=ro("Reflect","construct"),J0=/^\s*(?:class|function)\b/,vF=kc(J0.exec),E_=!J0.exec(g_),tu=function(o){if(!$0(o))return!1;try{return X0(g_,yP,o),!0}catch(n){return!1}},v_=function(o){if(!$0(o))return!1;switch(vP(o)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return E_||!!vF(J0,fp(o))}catch(n){return!0}};v_.sham=!0;var mp=!X0||pp(function(){var o;return tu(tu.call)||!tu(Object)||!tu(function(){o=!0})||o})?v_:tu,Iy=As,Q0=mp,nu=Xo,SP=bn("species"),xl=Array,_p=function(o,n){return new(function(o){var n;return Iy(o)&&(Q0(n=o.constructor)&&(n===xl||Iy(n.prototype))||nu(n)&&null===(n=n[SP]))&&(n=void 0),void 0===n?xl:n}(o))(0===n?0:n)},yF=Zn,Z0=gr,eR=bn("species"),CP=wt,bP=Zn,gp=As,Ay=Xo,Dy=ea,y_=Nc,Ep=function(o){if(o>9007199254740991)throw _P("Maximum allowed index exceeded");return o},tR=up,nR=_p,rR=gr,Oy=bn("isConcatSpreadable"),TP=rR>=51||!bP(function(){var o=[];return o[Oy]=!1,o.concat()[0]!==o}),RP=function(o){if(!Ay(o))return!1;var n=o[Oy];return void 0!==n?!!n:gp(o)};CP({target:"Array",proto:!0,arity:1,forced:!TP||!function(o){return Z0>=51||!yF(function(){var n=[];return(n.constructor={})[eR]=function(){return{foo:1}},1!==n[o](Boolean).foo})}("concat")},{concat:function(o){var n,i,s,c,d,h=Dy(this),p=nR(h,0),m=0;for(n=-1,s=arguments.length;n<s;n++)if(RP(d=-1===n?h:arguments[n]))for(c=y_(d),Ep(m+c),i=0;i<c;i++,m++)i in d&&tR(p,m,d[i]);else Ep(m+1),tR(p,m++,d);return p.length=m,p}});var iu={},Mc={},Ny=zi,oR=Yt,sR=Sy.indexOf,ru=Mc,tr=_i([].push),S_=function(o,n){var i,s=oR(o),c=0,d=[];for(i in s)!Ny(ru,i)&&Ny(s,i)&&tr(d,i);for(;n.length>c;)Ny(s,i=n[c++])&&(~sR(d,i)||tr(d,i));return d},Lc=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ou=S_,su=Lc,Fl=Object.keys||function(o){return ou(o,su)},au=Is,SF=li,IP=Yt,Le=Fl;iu.f=xa&&!YN?Object.defineProperties:function(o,n){SF(o);for(var i,s=IP(n),c=Le(n),d=c.length,h=0;d>h;)au.f(o,i=c[h++],s[i]);return o};var C_,wP=ro("document","documentElement"),CF=Oe,AP=Ro("keys"),ky=function(o){return AP[o]||(AP[o]=CF(o))},bF=li,TF=iu,cu=Lc,RF=Mc,qi=wP,My=wo,Ul="prototype",cR="script",lR=ky("IE_PROTO"),so=function(){},Ds=function(o){return"<script>"+o+"</"+cR+">"},Ly=function(o){o.write(Ds("")),o.close();var n=o.parentWindow.Object;return o=null,n},Vl=function(){try{C_=new ActiveXObject("htmlfile")}catch(c){}var o,n;Vl="undefined"!=typeof document?document.domain&&C_?Ly(C_):("javascript:",(n=My("iframe")).style.display="none",qi.appendChild(n),n.src=String("javascript:"),(o=n.contentWindow.document).open(),o.write(Ds("document.F=Object")),o.close(),o.F):Ly(C_);for(var s=cu.length;s--;)delete Vl[Ul][cu[s]];return Vl()};RF[lR]=!0;var xc=Object.create||function(o,n){var i;return null!==o?(so[Ul]=bF(o),i=new so,so[Ul]=null,i[lR]=o):i=Vl(),void 0===n?i:TF.f(i,n)},vp={},DP=S_,OP=Lc.concat("length","prototype");vp.f=Object.getOwnPropertyNames||function(o){return DP(o,OP)};var NP={},PP=Ba,dR=Nc,Ao=up,xy=Array,lu=Math.max,kP=function(o,n,i){for(var s=dR(o),c=PP(n,s),d=PP(void 0===i?s:i,s),h=xy(lu(d-c,0)),p=0;c<d;c++,p++)Ao(h,p,o[c]);return h.length=p,h},uR=at,MP=Yt,hR=vp.f,LP=kP,pR="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];NP.f=function(o){return pR&&"Window"==uR(o)?function(n){try{return hR(n)}catch(i){return LP(pR)}}(o):hR(MP(o))};var b_={};b_.f=Object.getOwnPropertySymbols;var fR=Oc,Bl=function(o,n,i,s){return s&&s.enumerable?o[n]=i:fR(o,n,i),o},T_=Is,xP=function(o,n,i){return T_.f(o,n,i)},ia={};ia.f=bn;var jl,yp,R_,mR=Dl,_R=zi,FP=ia,Sp=Is.f,ui=function(o){var n=mR.Symbol||(mR.Symbol={});_R(n,o)||Sp(n,o,{value:FP.f(o)})},UP=Vr,he=ro,gR=bn,Uy=Bl,I_=function(){var o=he("Symbol"),n=o&&o.prototype,i=n&&n.valueOf,s=gR("toPrimitive");n&&!n[s]&&Uy(n,s,function(c){return UP(i,this)},{arity:1})},Cp=Pc,BP=lp,jP=Is.f,w_=Oc,Fc=zi,ER=lp?{}.toString:function(){return"[object "+Cp(this)+"]"},du=bn("toStringTag"),uu=function(o,n,i,s){if(o){var c=i?o:o.prototype;Fc(c,du)||jP(c,du,{configurable:!0,value:n}),s&&!BP&&w_(c,"toString",ER)}},A_=Qi.WeakMap,D_=Pi(A_)&&/native code/.test(String(A_)),HP=Xo,GP=Oc,Uc=zi,WP=ky,IF=Mc,By="Object already initialized",jy=Qi.TypeError;if(D_||Ir.state){var ra=Ir.state||(Ir.state=new(0,Qi.WeakMap));ra.get=ra.get,ra.has=ra.has,ra.set=ra.set,jl=function(o,n){if(ra.has(o))throw jy(By);return n.facade=o,ra.set(o,n),n},yp=function(o){return ra.get(o)||{}},R_=function(o){return ra.has(o)}}else{var hu=WP("state");IF[hu]=!0,jl=function(o,n){if(Uc(o,hu))throw jy(By);return n.facade=o,GP(o,hu,n),n},yp=function(o){return Uc(o,hu)?o[hu]:{}},R_=function(o){return Uc(o,hu)}}var O_={set:jl,get:yp,has:R_,enforce:function(o){return R_(o)?yp(o):jl(o,{})},getterFor:function(o){return function(n){var i;if(!HP(n)||(i=yp(n)).type!==o)throw jy("Incompatible receiver, "+o+" required");return i}}},zP=Ml,AF=Br,Do=ea,KP=Nc,qP=_p,yR=_i([].push),za=function(o){var n=1==o,i=2==o,s=3==o,c=4==o,d=6==o,h=7==o,p=5==o||d;return function(m,_,E,v){for(var S,b,O=Do(m),P=AF(O),w=zP(_,E),M=KP(P),V=0,U=v||qP,Y=n?U(m,M):i||h?U(m,0):void 0;M>V;V++)if((p||V in P)&&(b=w(S=P[V],V,O),o))if(n)Y[V]=b;else if(b)switch(o){case 3:return!0;case 5:return S;case 6:return V;case 2:yR(Y,S)}else switch(o){case 4:return!1;case 7:yR(Y,S)}return d?-1:s||c?c:Y}},Wr={forEach:za(0),map:za(1),filter:za(2),some:za(3),every:za(4),find:za(5),findIndex:za(6),filterReject:za(7)},pu=wt,N_=Qi,P_=Vr,Dr=_i,oa=xa,Vc=Kd,YP=Zn,nr=zi,SR=Cs,Hy=li,bp=Yt,Gy=Tn,CR=Ga,Wy=Wd,Tp=xc,k_=Fl,zy=vp,bR=NP,TR=b_,fu=Jm,Ky=Is,RR=iu,M_=Qv,L_=Bl,IR=xP,wR=Ro,Gl=Mc,x_=Oe,AR=bn,$P=ia,qy=ui,XP=I_,JP=uu,DR=O_,F_=Wr.forEach,ao=ky("hidden"),U_="Symbol",mu="prototype",Yy=DR.set,$y=DR.getterFor(U_),Oo=Object[mu],Wl=N_.Symbol,V_=Wl&&Wl[mu],OR=N_.TypeError,B_=N_.QObject,Bc=fu.f,jc=Ky.f,Xy=bR.f,QP=M_.f,Rp=Dr([].push),Ka=wR("symbols"),_u=wR("op-symbols"),NR=wR("wks"),j_=!B_||!B_[mu]||!B_[mu].findChild,Ip=oa&&YP(function(){return 7!=Tp(jc({},"a",{get:function(){return jc(this,"a",{value:7}).a}})).a})?function(o,n,i){var s=Bc(Oo,n);s&&delete Oo[n],jc(o,n,i),s&&o!==Oo&&jc(Oo,n,s)}:jc,H_=function(o,n){var i=Ka[o]=Tp(V_);return Yy(i,{type:U_,tag:o,description:n}),oa||(i.description=n),i},zl=function(o,n,i){o===Oo&&zl(_u,n,i),Hy(o);var s=Gy(n);return Hy(i),nr(Ka,s)?(i.enumerable?(nr(o,ao)&&o[ao][s]&&(o[ao][s]=!1),i=Tp(i,{enumerable:Wy(0,!1)})):(nr(o,ao)||jc(o,ao,Wy(1,{})),o[ao][s]=!0),Ip(o,s,i)):jc(o,s,i)},gu=function(o,n){Hy(o);var i=bp(n),s=k_(i).concat(z_(i));return F_(s,function(c){oa&&!P_(Jy,i,c)||zl(o,c,i[c])}),o},Jy=function(o){var n=Gy(o),i=P_(QP,this,n);return!(this===Oo&&nr(Ka,n)&&!nr(_u,n))&&(!(i||!nr(this,n)||!nr(Ka,n)||nr(this,ao)&&this[ao][n])||i)},G_=function(o,n){var i=bp(o),s=Gy(n);if(i!==Oo||!nr(Ka,s)||nr(_u,s)){var c=Bc(i,s);return!c||!nr(Ka,s)||nr(i,ao)&&i[ao][s]||(c.enumerable=!0),c}},W_=function(o){var n=Xy(bp(o)),i=[];return F_(n,function(s){nr(Ka,s)||nr(Gl,s)||Rp(i,s)}),i},z_=function(o){var n=o===Oo,i=Xy(n?_u:bp(o)),s=[];return F_(i,function(c){!nr(Ka,c)||n&&!nr(Oo,c)||Rp(s,Ka[c])}),s};Vc||(Wl=function(){if(SR(V_,this))throw OR("Symbol is not a constructor");var o=arguments.length&&void 0!==arguments[0]?CR(arguments[0]):void 0,n=x_(o),i=function(s){this===Oo&&P_(i,_u,s),nr(this,ao)&&nr(this[ao],n)&&(this[ao][n]=!1),Ip(this,n,Wy(1,s))};return oa&&j_&&Ip(Oo,n,{configurable:!0,set:i}),H_(n,o)},L_(V_=Wl[mu],"toString",function(){return $y(this).tag}),L_(Wl,"withoutSetter",function(o){return H_(x_(o),o)}),M_.f=Jy,Ky.f=zl,RR.f=gu,fu.f=G_,zy.f=bR.f=W_,TR.f=z_,$P.f=function(o){return H_(AR(o),o)},oa&&IR(V_,"description",{configurable:!0,get:function(){return $y(this).description}})),pu({global:!0,constructor:!0,wrap:!0,forced:!Vc,sham:!Vc},{Symbol:Wl}),F_(k_(NR),function(o){qy(o)}),pu({target:U_,stat:!0,forced:!Vc},{useSetter:function(){j_=!0},useSimple:function(){j_=!1}}),pu({target:"Object",stat:!0,forced:!Vc,sham:!oa},{create:function(o,n){return void 0===n?Tp(o):gu(Tp(o),n)},defineProperty:zl,defineProperties:gu,getOwnPropertyDescriptor:G_}),pu({target:"Object",stat:!0,forced:!Vc},{getOwnPropertyNames:W_}),XP(),JP(Wl,U_),Gl[ao]=!0;var Eu=Kd&&!!Symbol.for&&!!Symbol.keyFor,ZP=wt,PR=ro,ek=zi,tk=Ga,Qy=Ro,Zy=Eu,vu=Qy("string-to-symbol-registry"),eS=Qy("symbol-to-string-registry");ZP({target:"Symbol",stat:!0,forced:!Zy},{for:function(o){var n=tk(o);if(ek(vu,n))return vu[n];var i=PR("Symbol")(n);return vu[n]=i,eS[i]=n,i}});var Kl=wt,nk=zi,ik=i_,DF=an,rk=Eu,wp=Ro("symbol-to-string-registry");Kl({target:"Symbol",stat:!0,forced:!rk},{keyFor:function(o){if(!ik(o))throw TypeError(DF(o)+" is not a symbol");if(nk(wp,o))return wp[o]}});var K_=_i([].slice),tS=As,kR=Pi,nS=at,MR=Ga,LR=_i([].push),ok=wt,xR=ro,FR=pn,sk=Vr,ts=_i,yu=Zn,UR=Pi,ak=i_,ck=K_,OF=function(o){if(kR(o))return o;if(tS(o)){for(var n=o.length,i=[],s=0;s<n;s++){var c=o[s];"string"==typeof c?LR(i,c):"number"!=typeof c&&"Number"!=nS(c)&&"String"!=nS(c)||LR(i,MR(c))}var d=i.length,h=!0;return function(p,m){if(h)return h=!1,m;if(tS(this))return m;for(var _=0;_<d;_++)if(i[_]===p)return m}}},NF=Kd,PF=String,qa=xR("JSON","stringify"),q_=ts(/./.exec),VR=ts("".charAt),lk=ts("".charCodeAt),dk=ts("".replace),kF=ts(1..toString),uk=/[\uD800-\uDFFF]/g,Ap=/^[\uD800-\uDBFF]$/,iS=/^[\uDC00-\uDFFF]$/,Os=!NF||yu(function(){var o=xR("Symbol")();return"[null]"!=qa([o])||"{}"!=qa({a:o})||"{}"!=qa(Object(o))}),Su=yu(function(){return'"\\udf06\\ud834"'!==qa("\udf06\ud834")||'"\\udead"'!==qa("\udead")}),BR=function(o,n){var i=ck(arguments),s=OF(n);if(UR(s)||void 0!==o&&!ak(o))return i[1]=function(c,d){if(UR(s)&&(d=sk(s,this,PF(c),d)),!ak(d))return d},FR(qa,null,i)},jR=function(o,n,i){var s=VR(i,n-1),c=VR(i,n+1);return q_(Ap,o)&&!q_(iS,c)||q_(iS,o)&&!q_(Ap,s)?"\\u"+kF(lk(o,0),16):o};qa&&ok({target:"JSON",stat:!0,arity:3,forced:Os||Su},{stringify:function(o,n,i){var s=ck(arguments),c=FR(Os?BR:qa,null,s);return Su&&"string"==typeof c?dk(c,uk,jR):c}});var rS=b_,MF=ea;wt({target:"Object",stat:!0,forced:!Kd||Zn(function(){rS.f(1)})},{getOwnPropertySymbols:function(o){var n=rS.f;return n?n(MF(o)):[]}}),ui("asyncIterator"),ui("hasInstance"),ui("isConcatSpreadable"),ui("iterator"),ui("match"),ui("matchAll"),ui("replace"),ui("search"),ui("species"),ui("split");var LF=I_;ui("toPrimitive"),LF();var xF=ro,oS=uu;ui("toStringTag"),oS(xF("Symbol"),"Symbol"),ui("unscopables"),uu(Qi.JSON,"JSON",!0);var Ya,Y_,hk,FF=Dl.Symbol,ql={},sS=xa,HR=Function.prototype,fk=sS&&Object.getOwnPropertyDescriptor,$_=zi(HR,"name"),Dp={EXISTS:$_,PROPER:$_&&"something"===function(){}.name,CONFIGURABLE:$_&&(!sS||sS&&fk(HR,"name").configurable)},mk=!Zn(function(){function o(){}return o.prototype.constructor=null,Object.getPrototypeOf(new o)!==o.prototype}),aS=zi,_k=Pi,Mi=ea,gk=mk,GR=ky("IE_PROTO"),Cu=Object,WR=Cu.prototype,cS=gk?Cu.getPrototypeOf:function(o){var n=Mi(o);if(aS(n,GR))return n[GR];var i=n.constructor;return _k(i)&&n instanceof i?i.prototype:n instanceof Cu?WR:null},Ek=Zn,vk=Pi,yk=Xo,Sk=xc,Ck=cS,UF=Bl,Yl=bn("iterator"),X_=!1;[].keys&&("next"in(hk=[].keys())?(Y_=Ck(Ck(hk)))!==Object.prototype&&(Ya=Y_):X_=!0);var bk=!yk(Ya)||Ek(function(){var o={};return Ya[Yl].call(o)!==o});vk((Ya=bk?{}:Sk(Ya))[Yl])||UF(Ya,Yl,function(){return this});var zR={IteratorPrototype:Ya,BUGGY_SAFARI_ITERATORS:X_},lS=zR.IteratorPrototype,Tk=xc,Rk=Wd,Op=uu,Ik=ql,wk=function(){return this},Ak=_i,Dk=To,Ok=Pi,Nk=String,Pk=TypeError,Mk=li,bu=Object.setPrototypeOf||("__proto__"in{}?function(){var o,n=!1,i={};try{(o=function(o,n,i){try{return Ak(Dk(Object.getOwnPropertyDescriptor(o,n)[i]))}catch(s){}}(Object.prototype,"__proto__","set"))(i,[]),n=i instanceof Array}catch(s){}return function(s,c){return Mk(s),function(o){if("object"==typeof o||Ok(o))return o;throw Pk("Can't set "+Nk(o)+" as a prototype")}(c),n?o(s,c):s.__proto__=c,s}}():void 0),sa=wt,VF=Vr,jF=cS,qR=uu,xk=Bl,dS=ql,YR=Dp.PROPER,J_=zR.BUGGY_SAFARI_ITERATORS,uS=bn("iterator"),Q_="values",hS="entries",Uk=function(){return this},$R=function(o,n,i,s,c,d,h){!function(o,n,i,s){var c=n+" Iterator";o.prototype=Tk(lS,{next:Rk(+!s,i)}),Op(o,c,!1,!0),Ik[c]=wk}(i,n,s);var p,m,_,E=function(M){if(M===c&&P)return P;if(!J_&&M in b)return b[M];switch(M){case"keys":case Q_:case hS:return function(){return new i(this,M)}}return function(){return new i(this)}},v=n+" Iterator",S=!1,b=o.prototype,O=b[uS]||b["@@iterator"]||c&&b[c],P=!J_&&O||E(c),w="Array"==n&&b.entries||O;if(w&&(p=jF(w.call(new o)))!==Object.prototype&&p.next&&(qR(p,v,!0,!0),dS[v]=Uk),YR&&c==Q_&&O&&O.name!==Q_&&(S=!0,P=function(){return VF(O,this)}),c)if(m={values:E(Q_),keys:d?P:E("keys"),entries:E(hS)},h)for(_ in m)(J_||S||!(_ in b))&&xk(b,_,m[_]);else sa({target:n,proto:!0,forced:J_||S},m);return h&&b[uS]!==P&&xk(b,uS,P,{name:c}),dS[n]=P,m},XR=function(o,n){return{value:o,done:n}},Vk=Yt,pS=ql,Bk=$R,QR=XR,Et="Array Iterator",Je=O_.set,ZR=O_.getterFor(Et);Bk(Array,"Array",function(o,n){Je(this,{type:Et,target:Vk(o),index:0,kind:n})},function(){var o=ZR(this),n=o.target,i=o.kind,s=o.index++;return!n||s>=n.length?(o.target=void 0,QR(void 0,!0)):QR("keys"==i?s:"values"==i?n[s]:[s,n[s]],!1)},"values"),pS.Arguments=pS.Array;var Z_=Qi,Ns=Pc,tI=Oc,nI=ql,eg=bn("toStringTag");for(var Ps in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var tg=Z_[Ps],ng=tg&&tg.prototype;ng&&Ns(ng)!==eg&&tI(ng,eg,Ps),nI[Ps]=nI.Array}var fS=FF,iI=Is.f,jk=bn("metadata"),Np=Function.prototype;void 0===Np[jk]&&iI(Np,jk,{value:null}),ui("dispose"),ui("metadata");var ig=fS;ui("asyncDispose");var mS=_i,Pp=ro("Symbol"),_S=Pp.keyFor,GF=mS(Pp.prototype.valueOf),rI=Pp.isRegisteredSymbol||function(o){try{return void 0!==_S(GF(o))}catch(n){return!1}};wt({target:"Symbol",stat:!0},{isRegisteredSymbol:rI});for(var Hk=Ro,oI=ro,Gk=_i,sI=i_,WF=bn,rg=oI("Symbol"),Wk=rg.isWellKnownSymbol,gS=oI("Object","getOwnPropertyNames"),aI=Gk(rg.prototype.valueOf),cI=Hk("wks"),kp=0,zk=gS(rg),zF=zk.length;kp<zF;kp++)try{var Kk=zk[kp];sI(rg[Kk])&&WF(Kk)}catch(o){}var qk=function(o){if(Wk&&Wk(o))return!0;try{for(var n=aI(o),i=0,s=gS(cI),c=s.length;i<c;i++)if(cI[s[i]]==n)return!0}catch(d){}return!1};wt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:qk}),ui("matcher"),ui("observable"),wt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:rI}),wt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:qk}),ui("metadataKey"),ui("patternMatch"),ui("replaceAll");var Mp=fr(ig),lI=_i,KF=Hr,qF=Ga,YF=Zm,$F=lI("".charAt),$a=lI("".charCodeAt),ES=lI("".slice),dI=function(o){return function(n,i){var s,c,d=qF(YF(n)),h=KF(i),p=d.length;return h<0||h>=p?o?"":void 0:(s=$a(d,h))<55296||s>56319||h+1===p||(c=$a(d,h+1))<56320||c>57343?o?$F(d,h):s:o?ES(d,h,h+2):c-56320+(s-55296<<10)+65536}},uI=(dI(!1),dI(!0)),vS=Ga,SS=$R,hI=XR,Xa="String Iterator",pI=O_.set,Yk=O_.getterFor(Xa);SS(String,"String",function(o){pI(this,{type:Xa,string:vS(o),index:0})},function(){var o,n=Yk(this),i=n.string,s=n.index;return s>=i.length?hI(void 0,!0):(o=uI(i,s),n.index+=o.length,hI(o,!1))});var og=fr(ia.f("iterator"));function Lp(o){return(Lp="function"==typeof Mp&&"symbol"==typeof og?function(n){return typeof n}:function(n){return n&&"function"==typeof Mp&&n.constructor===Mp&&n!==Mp.prototype?"symbol":typeof n})(o)}var fI=fr(ia.f("toPrimitive"));function C(o,n,i){return(n=function $k(o){var n=function(i,s){if("object"!==Lp(i)||null===i)return i;var c=i[fI];if(void 0!==c){var d=c.call(i,s);if("object"!==Lp(d))return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}(o,"string");return"symbol"===Lp(n)?n:String(n)}(n))in o?ws(o,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[n]=i,o}var xp=_e("Array").keys,Tu=Pc,CS=zi,Ru=Cs,Fp=xp,Hc=Array.prototype,Xk={DOMTokenList:!0,NodeList:!0},zr=fr(function(o){var n=o.keys;return o===Hc||Ru(Hc,o)&&n===Hc.keys||CS(Xk,Tu(o))?Fp:n}),bS=an,TS=TypeError,sg=kP,mI=Math.floor,Iu=function(o,n){var i=o.length,s=mI(i/2);return i<8?Jk(o,n):_I(o,Iu(sg(o,0,s),n),Iu(sg(o,s),n),n)},Jk=function(o,n){for(var i,s,c=o.length,d=1;d<c;){for(s=d,i=o[d];s&&n(o[s-1],i)>0;)o[s]=o[--s];s!==d++&&(o[s]=i)}return o},_I=function(o,n,i,s){for(var c=n.length,d=i.length,h=0,p=0;h<c||p<d;)o[h+p]=h<c&&p<d?s(n[h],i[p])<=0?n[h++]:i[p++]:h<c?n[h++]:i[p++];return o},XF=Iu,gI=Zn,RS=function(o,n){var i=[][o];return!!i&&gI(function(){i.call(null,n||function(){return 1},1)})},EI=et.match(/firefox\/(\d+)/i),vI=!!EI&&+EI[1],Qk=/MSIE|Trident/.test(et),yI=et.match(/AppleWebKit\/(\d+)\./),Zk=wt,SI=_i,JF=To,QF=ea,IS=Nc,ZF=function(o,n){if(!delete o[n])throw TS("Cannot delete property "+bS(n)+" of "+bS(o))},CI=Ga,Up=Zn,bI=XF,eM=RS,TI=vI,tM=Qk,wS=gr,RI=!!yI&&+yI[1],Ja=[],II=SI(Ja.sort),nM=SI(Ja.push),wI=Up(function(){Ja.sort(void 0)}),AI=Up(function(){Ja.sort(null)}),iM=eM("sort"),ks=!Up(function(){if(wS)return wS<70;if(!(TI&&TI>3)){if(tM)return!0;if(RI)return RI<603;var o,n,i,s,c="";for(o=65;o<76;o++){switch(n=String.fromCharCode(o),o){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(s=0;s<47;s++)Ja.push({k:n+s,v:i})}for(Ja.sort(function(d,h){return h.v-d.v}),s=0;s<Ja.length;s++)n=Ja[s].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return"DGBEFHACIJK"!==c}});Zk({target:"Array",proto:!0,forced:wI||!AI||!iM||!ks},{sort:function(o){void 0!==o&&JF(o);var n=QF(this);if(ks)return void 0===o?II(n):II(n,o);var i,s,c=[],d=IS(n);for(s=0;s<d;s++)s in n&&nM(c,n[s]);for(bI(c,function(h){return function(p,m){return void 0===m?-1:void 0===p?1:void 0!==h?+h(p,m)||0:CI(p)>CI(m)?1:-1}}(o)),i=IS(c),s=0;s<i;)n[s]=c[s++];for(;s<d;)ZF(n,s++);return n}});var AS=_e("Array").sort,rM=Cs,oM=AS,DI=Array.prototype,wu=fr(function(o){var n=o.sort;return o===DI||rM(DI,o)&&n===DI.sort?oM:n}),sM=ro,aM=vp,cM=b_,DS=li,lM=_i([].concat),dM=sM("Reflect","ownKeys")||function(o){var n=aM.f(DS(o)),i=cM.f;return i?lM(n,i(o)):n},Vp=zi,OS=dM,uM=Jm,NS=Is,PS=Xo,OI=Oc,hM=Error,eU=_i("".replace),kS=String(hM("zxcasd").stack),pM=/\n\s*at [^:]*:[^\n]*/,fM=pM.test(kS),NI=Wd,PI=!Zn(function(){var o=Error("a");return!("stack"in o)||(Object.defineProperty(o,"stack",NI(1,7)),7!==o.stack)}),kI=Oc,LI=PI,aa=Error.captureStackTrace,ag=ql,mM=bn("iterator"),_M=Array.prototype,tU=Pc,cg=ay,xI=sn,MS=ql,Bp=bn("iterator"),FI=function(o){if(!xI(o))return cg(o,Bp)||cg(o,"@@iterator")||MS[tU(o)]},LS=Vr,UI=To,VI=li,BI=an,gM=FI,xS=TypeError,EM=Vr,jI=li,HI=ay,Au=Ml,GI=Vr,vM=li,yM=an,SM=Nc,WI=Cs,bM=FI,ir=function(o,n,i){var s,c;jI(o);try{if(!(s=HI(o,"return"))){if("throw"===n)throw i;return i}s=EM(s,o)}catch(d){c=!0,s=d}if("throw"===n)throw i;if(c)throw s;return jI(s),i},FS=TypeError,jp=function(o,n){this.stopped=o,this.result=n},US=jp.prototype,Ou=function(o,n,i){var s,c,d,h,p,m,_,v=!(!i||!i.AS_ENTRIES),S=!(!i||!i.IS_RECORD),b=!(!i||!i.IS_ITERATOR),O=!(!i||!i.INTERRUPTED),P=Au(n,i&&i.that),w=function(V){return s&&ir(s,"normal",V),new jp(!0,V)},M=function(V){return v?(vM(V),O?P(V[0],V[1],w):P(V[0],V[1])):O?P(V,w):P(V)};if(S)s=o.iterator;else if(b)s=o;else{if(!(c=bM(o)))throw FS(yM(o)+" is not iterable");if(function(o){return void 0!==o&&(ag.Array===o||_M[mM]===o)}(c)){for(d=0,h=SM(o);h>d;d++)if((p=M(o[d]))&&WI(US,p))return p;return new jp(!1)}s=function(o,n){var i=arguments.length<2?gM(o):n;if(UI(i))return VI(LS(i,o));throw xS(BI(o)+" is not iterable")}(o,c)}for(m=S?o.next:s.next;!(_=GI(m,s)).done;){try{p=M(_.value)}catch(V){ir(s,"throw",V)}if("object"==typeof p&&p&&WI(US,p))return p}return new jp(!1)},zI=Ga,TM=wt,RM=Cs,IM=cS,lg=bu,wM=xc,dg=Oc,VS=Wd,AM=function(o,n){PS(n)&&"cause"in n&&OI(o,"cause",n.cause)},nU=function(o,n,i,s){LI&&(aa?aa(o,n):kI(o,"stack",function(o,n){if(fM&&"string"==typeof o&&!hM.prepareStackTrace)for(;n--;)o=eU(o,pM,"");return o}(i,s)))},iU=Ou,BS=function(o,n){return void 0===o?arguments.length<2?"":n:zI(o)},DM=bn("toStringTag"),Hp=Error,qI=[].push,Gp=function(o,n){var i,s=RM(Po,this);lg?i=lg(Hp(),s?IM(this):Po):(i=s?this:wM(Po),dg(i,DM,"Error")),void 0!==n&&dg(i,"message",BS(n)),nU(i,Gp,i.stack,1),arguments.length>2&&AM(i,arguments[2]);var c=[];return iU(o,qI,{that:c}),dg(i,"errors",c),i};lg?lg(Gp,Hp):function(o,n,i){for(var s=OS(n),c=NS.f,d=uM.f,h=0;h<s.length;h++){var p=s[h];Vp(o,p)||i&&Vp(i,p)||c(o,p,d(n,p))}}(Gp,Hp,{name:!0});var Po=Gp.prototype=wM(Hp.prototype,{constructor:VS(1,Gp),message:VS(1,""),name:VS(1,"AggregateError")});TM({global:!0,constructor:!0,arity:2},{AggregateError:Gp});var ug,Wp,jS,hg,Nu="undefined"!=typeof process&&"process"==at(process),OM=ro,rU=xP,YI=xa,Mt=bn("species"),NM=Cs,HS=TypeError,PM=mp,kM=an,MM=TypeError,$I=li,xM=sn,pg=bn("species"),$l=function(o,n){var i,s=$I(o).constructor;return void 0===s||xM(i=$I(s)[pg])?n:function(o){if(PM(o))return o;throw MM(kM(o)+" is not a constructor")}(i)},FM=TypeError,Pu=/(?:ipad|iphone|ipod).*applewebkit/i.test(et),ko=Qi,UM=pn,GS=Ml,Ms=Pi,zp=zi,vr=Zn,Gc=wP,fg=K_,Mo=wo,rr=function(o,n){if(o<n)throw FM("Not enough arguments");return o},ku=Pu,Mu=Nu,Wc=ko.setImmediate,zc=ko.clearImmediate,Lu=ko.process,Kc=ko.Dispatch,xu=ko.Function,Xl=ko.MessageChannel,Fu=ko.String,mg=0,Uu={},WS="onreadystatechange";vr(function(){ug=ko.location});var _g=function(o){if(zp(Uu,o)){var n=Uu[o];delete Uu[o],n()}},gg=function(o){return function(){_g(o)}},zS=function(o){_g(o.data)},KS=function(o){ko.postMessage(Fu(o),ug.protocol+"//"+ug.host)};Wc&&zc||(Wc=function(o){rr(arguments.length,1);var n=Ms(o)?o:xu(o),i=fg(arguments,1);return Uu[++mg]=function(){UM(n,void 0,i)},Wp(mg),mg},zc=function(o){delete Uu[o]},Mu?Wp=function(o){Lu.nextTick(gg(o))}:Kc&&Kc.now?Wp=function(o){Kc.now(gg(o))}:Xl&&!ku?(hg=(jS=new Xl).port2,jS.port1.onmessage=zS,Wp=GS(hg.postMessage,hg)):ko.addEventListener&&Ms(ko.postMessage)&&!ko.importScripts&&ug&&"file:"!==ug.protocol&&!vr(KS)?(Wp=KS,ko.addEventListener("message",zS,!1)):Wp=WS in Mo("script")?function(o){Gc.appendChild(Mo("script"))[WS]=function(){Gc.removeChild(this),_g(o)}}:function(o){setTimeout(gg(o),0)});var qS={set:Wc,clear:zc},YS=function(){this.head=null,this.tail=null};YS.prototype={add:function(o){var n={item:o,next:null},i=this.tail;i?i.next=n:this.head=n,this.tail=n},get:function(){var o=this.head;if(o)return null===(this.head=o.next)&&(this.tail=null),o.item}};var Vu,jn,$S,Bu,XS,XI=YS,VM=/ipad|iphone|ipod/i.test(et)&&"undefined"!=typeof Pebble,JI=/web0s(?!.*chrome)/i.test(et),Jl=Qi,JS=Ml,QS=qS.set,oU=XI,jM=Pu,ZS=VM,eC=JI,tC=Nu,HM=Jl.MutationObserver||Jl.WebKitMutationObserver,GM=Jl.document,WM=Jl.process,Eg=Jl.Promise,nC=(0,Jm.f)(Jl,"queueMicrotask"),QI=nC&&nC.value;if(!QI){var vg=new oU,Qa=function(){var o,n;for(tC&&(o=WM.domain)&&o.exit();n=vg.get();)try{n()}catch(i){throw vg.head&&Vu(),i}o&&o.enter()};jM||tC||eC||!HM||!GM?!ZS&&Eg&&Eg.resolve?((Bu=Eg.resolve(void 0)).constructor=Eg,XS=JS(Bu.then,Bu),Vu=function(){XS(Qa)}):tC?Vu=function(){WM.nextTick(Qa)}:(QS=JS(QS,Jl),Vu=function(){QS(Qa)}):(jn=!0,$S=GM.createTextNode(""),new HM(Qa).observe($S,{characterData:!0}),Vu=function(){$S.data=jn=!jn}),QI=function(o){vg.head||Vu(),vg.add(o)}}var zM=QI,Ql=function(o){try{return{error:!1,value:o()}}catch(n){return{error:!0,value:n}}},Zl=Qi.Promise,iC="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,yg=!iC&&!Nu&&"object"==typeof window&&"object"==typeof document,KM=Qi,ju=Zl,qM=Pi,YM=qN,$M=Y0,JM=yg,ZI=iC,rC=gr,oC=ju&&ju.prototype,ew=bn("species"),Sg=!1,QM=qM(KM.PromiseRejectionEvent),Kp={CONSTRUCTOR:YM("Promise",function(){var o=$M(ju),n=o!==String(ju);if(!n&&66===rC||!oC.catch||!oC.finally)return!0;if(!rC||rC<51||!/native code/.test(o)){var i=new ju(function(c){c(1)}),s=function(c){c(function(){},function(){})};if((i.constructor={})[ew]=s,!(Sg=i.then(function(){})instanceof s))return!0}return!n&&(JM||ZI)&&!QM}),REJECTION_EVENT:QM,SUBCLASSING:Sg},Za={},oe=To,Cg=TypeError,ot=function(o){var n,i;this.promise=new o(function(s,c){if(void 0!==n||void 0!==i)throw Cg("Bad Promise constructor");n=s,i=c}),this.resolve=oe(n),this.reject=oe(i)};Za.f=function(o){return new ot(o)};var qp,tw,Ae=wt,Be=Nu,At=Qi,bg=Vr,ZM=Bl,ed=uu,nw=To,ca=Pi,Yp=Xo,aC=$l,zt=qS.set,Tg=zM,rw=Ql,ow=XI,Rg=O_,Xt=Zl,$p=Za,co="Promise",cC=Kp.CONSTRUCTOR,lC=Kp.REJECTION_EVENT,Ig=Rg.getterFor(co),aw=Rg.set,Hu=Xt,wg=Xt&&Xt.prototype,dC=At.TypeError,Ag=At.document,Dg=At.process,lw=$p.f,t1=lw,n1=!!(Ag&&Ag.createEvent&&At.dispatchEvent),uC="unhandledrejection",dw=function(o){var n;return!(!Yp(o)||!ca(n=o.then))&&n},Li=function(o,n){var i,s,c,d=n.value,h=1==n.state,p=h?o.ok:o.fail,m=o.resolve,_=o.reject,E=o.domain;try{p?(h||(2===n.rejection&&o1(n),n.rejection=1),!0===p?i=d:(E&&E.enter(),i=p(d),E&&(E.exit(),c=!0)),i===o.promise?_(dC("Promise-chain cycle")):(s=dw(i))?bg(s,i,m,_):m(i)):_(d)}catch(v){E&&!c&&E.exit(),_(v)}},hC=function(o,n){o.notified||(o.notified=!0,Tg(function(){for(var i,s=o.reactions;i=s.get();)Li(i,o);o.notified=!1,n&&!o.rejection&&r1(o)}))},uw=function(o,n,i){var s,c;n1?((s=Ag.createEvent("Event")).promise=n,s.reason=i,s.initEvent(o,!1,!0),At.dispatchEvent(s)):s={promise:n,reason:i},!lC&&(c=At["on"+o])?c(s):o===uC&&function(o,n){try{1==arguments.length?console.error(o):console.error(o,n)}catch(i){}}("Unhandled promise rejection",i)},r1=function(o){bg(zt,At,function(){var n,i=o.facade,s=o.value;if(pC(o)&&(n=rw(function(){Be?Dg.emit("unhandledRejection",s,i):uw(uC,i,s)}),o.rejection=Be||pC(o)?2:1,n.error))throw n.value})},pC=function(o){return 1!==o.rejection&&!o.parent},o1=function(o){bg(zt,At,function(){var n=o.facade;Be?Dg.emit("rejectionHandled",n):uw("rejectionhandled",n,o.value)})},nd=function(o,n,i){return function(s){o(n,s,i)}},id=function(o,n,i){o.done||(o.done=!0,i&&(o=i),o.value=n,o.state=2,hC(o,!0))},qc=function(o,n,i){if(!o.done){o.done=!0,i&&(o=i);try{if(o.facade===n)throw dC("Promise can't be resolved itself");var s=dw(n);s?Tg(function(){var c={done:!1};try{bg(s,n,nd(qc,c,o),nd(id,c,o))}catch(d){id(c,d,o)}}):(o.value=n,o.state=1,hC(o,!1))}catch(c){id({done:!1},c,o)}}};cC&&(wg=(Hu=function(o){(function(o,n){if(NM(n,o))return o;throw HS("Incorrect invocation")})(this,wg),nw(o),bg(qp,this);var n=Ig(this);try{o(nd(qc,n),nd(id,n))}catch(i){id(n,i)}}).prototype,(qp=function(o){aw(this,{type:co,done:!1,notified:!1,parent:!1,reactions:new ow,rejection:!1,state:0,value:void 0})}).prototype=ZM(wg,"then",function(o,n){var i=Ig(this),s=lw(aC(this,Hu));return i.parent=!0,s.ok=!ca(o)||o,s.fail=ca(n)&&n,s.domain=Be?Dg.domain:void 0,0==i.state?i.reactions.add(s):Tg(function(){Li(s,i)}),s.promise}),tw=function(){var o=new qp,n=Ig(o);this.promise=o,this.resolve=nd(qc,n),this.reject=nd(id,n)},$p.f=lw=function(o){return o===Hu||void 0===o?new tw(o):t1(o)}),Ae({global:!0,constructor:!0,wrap:!0,forced:cC},{Promise:Hu}),ed(Hu,co,!1,!0),function(o){var n=OM(o);YI&&n&&!n[Mt]&&rU(n,Mt,{configurable:!0,get:function(){return this}})}(co);var hw=bn("iterator"),pw=!1;try{var fw=0,mw={next:function(){return{done:!!fw++}},return:function(){pw=!0}};mw[hw]=function(){return this},Array.from(mw,function(){throw 2})}catch(o){}var _w=Zl,Gu=Kp.CONSTRUCTOR||!function(o,n){if(!n&&!pw)return!1;var i=!1;try{var s={};s[hw]=function(){return{next:function(){return{done:i=!0}}}},o(s)}catch(c){}return i}(function(o){_w.all(o).then(void 0,function(){})}),vn=Vr,la=To,s1=Za,a1=Ql,da=Ou;wt({target:"Promise",stat:!0,forced:Gu},{all:function(o){var n=this,i=s1.f(n),s=i.resolve,c=i.reject,d=a1(function(){var h=la(n.resolve),p=[],m=0,_=1;da(o,function(E){var v=m++,S=!1;_++,vn(h,n,E).then(function(b){S||(S=!0,p[v]=b,--_||s(p))},c)}),--_||s(p)});return d.error&&c(d.value),i.promise}}),wt({target:"Promise",proto:!0,forced:Kp.CONSTRUCTOR,real:!0},{catch:function(o){return this.then(void 0,o)}});var gw=Vr,Ew=To,c1=Za,l1=Ql,d1=Ou;wt({target:"Promise",stat:!0,forced:Gu},{race:function(o){var n=this,i=c1.f(n),s=i.reject,c=l1(function(){var d=Ew(n.resolve);d1(o,function(h){gw(d,n,h).then(i.resolve,s)})});return c.error&&s(c.value),i.promise}});var u1=Vr,fC=Za;wt({target:"Promise",stat:!0,forced:Kp.CONSTRUCTOR},{reject:function(o){var n=fC.f(this);return u1(n.reject,void 0,o),n.promise}});var Xp=li,h1=Xo,vw=Za,yw=function(o,n){if(Xp(o),h1(n)&&n.constructor===o)return n;var i=vw.f(o);return(0,i.resolve)(n),i.promise},Sw=wt,Cw=Zl,Og=Kp.CONSTRUCTOR,p1=yw,bw=ro("Promise"),Yi=!Og;Sw({target:"Promise",stat:!0,forced:!0},{resolve:function(o){return p1(Yi&&this===bw?Cw:this,o)}});var Yc=Vr,Jp=To,Tw=Za,Rw=Ql,Iw=Ou;wt({target:"Promise",stat:!0,forced:Gu},{allSettled:function(o){var n=this,i=Tw.f(n),s=i.resolve,c=i.reject,d=Rw(function(){var h=Jp(n.resolve),p=[],m=0,_=1;Iw(o,function(E){var v=m++,S=!1;_++,Yc(h,n,E).then(function(b){S||(S=!0,p[v]={status:"fulfilled",value:b},--_||s(p))},function(b){S||(S=!0,p[v]={status:"rejected",reason:b},--_||s(p))})}),--_||s(p)});return d.error&&c(d.value),i.promise}});var ww=Vr,Aw=To,Dw=ro,Ow=Za,Nw=Ql,f1=Ou,Pw="No one promise resolved";wt({target:"Promise",stat:!0,forced:Gu},{any:function(o){var n=this,i=Dw("AggregateError"),s=Ow.f(n),c=s.resolve,d=s.reject,h=Nw(function(){var p=Aw(n.resolve),m=[],_=0,E=1,v=!1;f1(o,function(S){var b=_++,O=!1;E++,ww(p,n,S).then(function(P){O||v||(v=!0,c(P))},function(P){O||v||(O=!0,m[b]=P,--E||d(new i(m,Pw)))})}),--E||d(new i(m,Pw))});return h.error&&d(h.value),s.promise}});var g1=ro,E1=Pi,v1=$l,kw=yw,y1=Zl&&Zl.prototype;wt({target:"Promise",proto:!0,real:!0,forced:!!Zl&&Zn(function(){y1.finally.call({then:function(){}},function(){})})},{finally:function(o){var n=v1(this,g1("Promise")),i=E1(o);return this.then(i?function(s){return kw(n,o()).then(function(){return s})}:o,i?function(s){return kw(n,o()).then(function(){throw s})}:o)}});var Mw=Dl.Promise,z=fr(Mw);const S1=()=>{};function Qp(){const o={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:S1};return o.promise=new z((n,i)=>{o.resolve=s=>{o.isFinished||(o.isResolved=!0,o.isFinished=!0,n(s),o.value=s)},o.reject=s=>{o.isFinished||(o.isRejected=!0,o.isFinished=!0,i(s))}}),o}const Ng=new Map,Pg=new Map,ua=new Map;var ti,mt,o;(o=ti||(ti={})).WIN_10="Windows 10",o.WIN_81="Windows 8.1",o.WIN_8="Windows 8",o.WIN_7="Windows 7",o.WIN_VISTA="Windows Vista",o.WIN_SERVER_2003="Windows Server 2003",o.WIN_XP="Windows XP",o.WIN_2000="Windows 2000",o.ANDROID="Android",o.HARMONY_OS="HarmonyOS",o.OPEN_BSD="Open BSD",o.SUN_OS="Sun OS",o.LINUX="Linux",o.IOS="iOS",o.MAC_OS="Mac OS",o.QNX="QNX",o.UNIX="UNIX",o.BEOS="BeOS",o.OS_2="OS/2",o.SEARCH_BOT="Search Bot",function(o){o.CHROME="Chrome",o.SAFARI="Safari",o.EDGE="Edge",o.FIREFOX="Firefox",o.OPERA="OPR",o.QQ="QQBrowser",o.WECHAT="MicroMessenger"}(mt||(mt={}));var kg={exports:{}};!function(o,n){!function(i,s){var c="function",d="undefined",h="object",p="string",m="major",_="model",E="name",v="type",S="vendor",b="version",O="architecture",P="console",w="mobile",M="tablet",V="smarttv",U="wearable",Y="embedded",ie="Amazon",K="Apple",X="ASUS",$="BlackBerry",J="Browser",ge="Chrome",Ee="Firefox",ze="Google",st="Microsoft",Ct="Motorola",ee="Opera",ae="Samsung",ke="Sony",pt="Xiaomi",le="Zebra",I="Facebook",F="Chromium OS",H="Mac OS",re=function(wn){for(var $n={},qt=0;qt<wn.length;qt++)$n[wn[qt].toUpperCase()]=wn[qt];return $n},Fe=function(wn,$n){return typeof wn===p&&-1!==Gt($n).indexOf(Gt(wn))},Gt=function(wn){return wn.toLowerCase()},Wi=function(wn,$n){if(typeof wn===p)return wn=wn.replace(/^\s\s*/,""),typeof $n===d?wn:wn.substring(0,350)},Co=function(wn,$n){for(var qt,bo,bc,An,ft,no,Pd=0;Pd<$n.length&&!ft;){var Na=$n[Pd],Px=$n[Pd+1];for(qt=bo=0;qt<Na.length&&!ft&&Na[qt];)if(ft=Na[qt++].exec(wn))for(bc=0;bc<Px.length;bc++)no=ft[++bo],typeof(An=Px[bc])===h&&An.length>0?2===An.length?this[An[0]]=typeof An[1]==c?An[1].call(this,no):An[1]:3===An.length?this[An[0]]=typeof An[1]!==c||An[1].exec&&An[1].test?no?no.replace(An[1],An[2]):s:no?An[1].call(this,no,An[2]):s:4===An.length&&(this[An[0]]=no?An[3].call(this,no.replace(An[1],An[2])):s):this[An]=no||s;Pd+=2}},El=function(wn,$n){for(var qt in $n)if(typeof $n[qt]===h&&$n[qt].length>0){for(var bo=0;bo<$n[qt].length;bo++)if(Fe($n[qt][bo],wn))return"?"===qt?s:qt}else if(Fe($n[qt],wn))return"?"===qt?s:qt;return wn},GT={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},WT={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[E,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[E,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[E,b],[/opios[\/ ]+([\w\.]+)/i],[b,[E,ee+" Mini"]],[/\bopr\/([\w\.]+)/i],[b,[E,ee]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[E,b],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[E,"UC"+J]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[b,[E,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[b,[E,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[E,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[E,"IE"]],[/yabrowser\/([\w\.]+)/i],[b,[E,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[E,/(.+)/,"$1 Secure "+J],b],[/\bfocus\/([\w\.]+)/i],[b,[E,Ee+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[E,ee+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[E,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[E,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[E,ee+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[E,"MIUI "+J]],[/fxios\/([-\w\.]+)/i],[b,[E,Ee]],[/\bqihu|(qi?ho?o?|360)browser/i],[[E,"360 "+J]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[E,/(.+)/,"$1 "+J],b],[/(comodo_dragon)\/([\w\.]+)/i],[[E,/_/g," "],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[E,b],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[E],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[E,I],b],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[E,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[E,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[E,ge+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[E,ge+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[E,"Android "+J]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[E,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[E,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,E],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[E,[b,El,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[E,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[E,"Netscape"],b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[E,Ee+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[E,b],[/(cobalt)\/([\w\.]+)/i],[E,[b,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[O,"amd64"]],[/(ia32(?=;))/i],[[O,Gt]],[/((?:i[346]|x)86)[;\)]/i],[[O,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[O,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[O,"armhf"]],[/windows (ce|mobile); ppc;/i],[[O,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[O,/ower/,"",Gt]],[/(sun4\w)[;\)]/i],[[O,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[O,Gt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[S,ae],[v,M]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_,[S,ae],[v,w]],[/\((ip(?:hone|od)[\w ]*);/i],[_,[S,K],[v,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[S,K],[v,M]],[/(macintosh);/i],[_,[S,K]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[S,"Sharp"],[v,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[S,"Huawei"],[v,M]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[S,"Huawei"],[v,w]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_,/_/g," "],[S,pt],[v,w]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[S,pt],[v,M]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[S,"OPPO"],[v,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[S,"Vivo"],[v,w]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_,[S,"Realme"],[v,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[S,Ct],[v,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[S,Ct],[v,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[S,"LG"],[v,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[S,"LG"],[v,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[S,"Lenovo"],[v,M]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[S,"Nokia"],[v,w]],[/(pixel c)\b/i],[_,[S,ze],[v,M]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[S,ze],[v,w]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[S,ke],[v,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[S,ke],[v,M]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[S,"OnePlus"],[v,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[S,ie],[v,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[S,ie],[v,w]],[/(playbook);[-\w\),; ]+(rim)/i],[_,S,[v,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[S,$],[v,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[S,X],[v,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[S,X],[v,w]],[/(nexus 9)/i],[_,[S,"HTC"],[v,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[S,[_,/_/g," "],[v,w]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[S,"Acer"],[v,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[S,"Meizu"],[v,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[S,_,[v,w]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[S,_,[v,M]],[/(surface duo)/i],[_,[S,st],[v,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[S,"Fairphone"],[v,w]],[/(u304aa)/i],[_,[S,"AT&T"],[v,w]],[/\bsie-(\w*)/i],[_,[S,"Siemens"],[v,w]],[/\b(rct\w+) b/i],[_,[S,"RCA"],[v,M]],[/\b(venue[\d ]{2,7}) b/i],[_,[S,"Dell"],[v,M]],[/\b(q(?:mv|ta)\w+) b/i],[_,[S,"Verizon"],[v,M]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[S,"Barnes & Noble"],[v,M]],[/\b(tm\d{3}\w+) b/i],[_,[S,"NuVision"],[v,M]],[/\b(k88) b/i],[_,[S,"ZTE"],[v,M]],[/\b(nx\d{3}j) b/i],[_,[S,"ZTE"],[v,w]],[/\b(gen\d{3}) b.+49h/i],[_,[S,"Swiss"],[v,w]],[/\b(zur\d{3}) b/i],[_,[S,"Swiss"],[v,M]],[/\b((zeki)?tb.*\b) b/i],[_,[S,"Zeki"],[v,M]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[S,"Dragon Touch"],_,[v,M]],[/\b(ns-?\w{0,9}) b/i],[_,[S,"Insignia"],[v,M]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[S,"NextBook"],[v,M]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[S,"Voice"],_,[v,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[S,"LvTel"],_,[v,w]],[/\b(ph-1) /i],[_,[S,"Essential"],[v,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[S,"Envizen"],[v,M]],[/\b(trio[-\w\. ]+) b/i],[_,[S,"MachSpeed"],[v,M]],[/\btu_(1491) b/i],[_,[S,"Rotor"],[v,M]],[/(shield[\w ]+) b/i],[_,[S,"Nvidia"],[v,M]],[/(sprint) (\w+)/i],[S,_,[v,w]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[S,st],[v,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[S,le],[v,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[S,le],[v,w]],[/smart-tv.+(samsung)/i],[S,[v,V]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[S,ae],[v,V]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[S,"LG"],[v,V]],[/(apple) ?tv/i],[S,[_,K+" TV"],[v,V]],[/crkey/i],[[_,ge+"cast"],[S,ze],[v,V]],[/droid.+aft(\w)( bui|\))/i],[_,[S,ie],[v,V]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[S,"Sharp"],[v,V]],[/(bravia[\w ]+)( bui|\))/i],[_,[S,ke],[v,V]],[/(mitv-\w{5}) bui/i],[_,[S,pt],[v,V]],[/Hbbtv.*(technisat) (.*);/i],[S,_,[v,V]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[S,Wi],[_,Wi],[v,V]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,V]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[S,_,[v,P]],[/droid.+; (shield) bui/i],[_,[S,"Nvidia"],[v,P]],[/(playstation [345portablevi]+)/i],[_,[S,ke],[v,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[S,st],[v,P]],[/((pebble))app/i],[S,_,[v,U]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[S,K],[v,U]],[/droid.+; (glass) \d/i],[_,[S,ze],[v,U]],[/droid.+; (wt63?0{2,3})\)/i],[_,[S,le],[v,U]],[/(quest( 2| pro)?)/i],[_,[S,I],[v,U]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[S,[v,Y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_,[v,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[v,M]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,w]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[S,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[E,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[E,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[E,b],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,E]],os:[[/microsoft (windows) (vista|xp)/i],[E,b],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[E,[b,El,GT]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[E,"Windows"],[b,El,GT]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[E,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[E,H],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,E],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[E,b],[/\(bb(10);/i],[b,[E,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[b,[E,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[E,Ee+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[E,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[E,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[E,ge+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[E,F],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[E,b],[/(sunos) ?([\w\.\d]*)/i],[[E,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[E,b]]},vs=function(wn,$n){if(typeof wn===h&&($n=wn,wn=s),!(this instanceof vs))return new vs(wn,$n).getResult();var qt=typeof i!==d&&i.navigator?i.navigator:s,bo=wn||(qt&&qt.userAgent?qt.userAgent:""),bc=qt&&qt.userAgentData?qt.userAgentData:s,An=$n?function(ft,no){var Pd={};for(var Na in ft)Pd[Na]=no[Na]&&no[Na].length%2==0?no[Na].concat(ft[Na]):ft[Na];return Pd}(WT,$n):WT;return this.getBrowser=function(){var no,ft={};return ft[E]=s,ft[b]=s,Co.call(ft,bo,An.browser),ft[m]=typeof(no=ft[b])===p?no.replace(/[^\d\.]/g,"").split(".")[0]:s,qt&&qt.brave&&typeof qt.brave.isBrave==c&&(ft[E]="Brave"),ft},this.getCPU=function(){var ft={};return ft[O]=s,Co.call(ft,bo,An.cpu),ft},this.getDevice=function(){var ft={};return ft[S]=s,ft[_]=s,ft[v]=s,Co.call(ft,bo,An.device),!ft[v]&&bc&&bc.mobile&&(ft[v]=w),"Macintosh"==ft[_]&&qt&&typeof qt.standalone!==d&&qt.maxTouchPoints&&qt.maxTouchPoints>2&&(ft[_]="iPad",ft[v]=M),ft},this.getEngine=function(){var ft={};return ft[E]=s,ft[b]=s,Co.call(ft,bo,An.engine),ft},this.getOS=function(){var ft={};return ft[E]=s,ft[b]=s,Co.call(ft,bo,An.os),!ft[E]&&bc&&"Unknown"!=bc.platform&&(ft[E]=bc.platform.replace(/chrome os/i,F).replace(/macos/i,H)),ft},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return bo},this.setUA=function(ft){return bo=typeof ft===p&&ft.length>350?Wi(ft,350):ft,this},this.setUA(bo),this};vs.VERSION="0.7.34",vs.BROWSER=re([E,b,m]),vs.CPU=re([O]),vs.DEVICE=re([_,S,v,P,w,V,M,U,Y]),vs.ENGINE=vs.OS=re([E,b]),o.exports&&(n=o.exports=vs),n.UAParser=vs;var Nd=typeof i!==d&&(i.jQuery||i.Zepto);if(Nd&&!Nd.ua){var wm=new vs;Nd.ua=wm.getResult(),Nd.ua.get=function(){return wm.getUA()},Nd.ua.set=function(wn){wm.setUA(wn);var $n=wm.getResult();for(var qt in $n)Nd.ua[qt]=$n[qt]}}}("object"==typeof window?window:jd)}(kg,kg.exports);const Mg=new(fr(kg.exports));let ha=Mg.getResult(),Lg=null;function lt(o){if(!Lg){o&&Mg.setUA(o),ha=Mg.getResult();const n=function(d){if("Blink"===d.engine.name&&"WeChat"!==d.browser.name)return mt.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return mt.CHROME;case"Safari":case"Mobile Safari":return mt.SAFARI;case"Edge":return mt.EDGE;case"Firefox":return mt.FIREFOX;case"QQBrowser":return mt.QQ;case"Opera":return mt.OPERA;case"WeChat":return mt.WECHAT;default:return d.browser.name||""}}(ha),i=function(d){let h;return h="Blink"===d.engine.name?d.engine.version||"":d.browser.version||"",h.split(".")[0]}(ha),s="Windows"===(d=ha).os.name?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||"",c=ha.os.version;if(!(n&&i&&s&&c))return{name:n,version:i,os:s,osVersion:c};Lg={name:n,version:i,os:s,osVersion:c}}var d;return Lg}function Zp(){return lt().os}function _C(){const o=lt();return"".concat(o.os," ").concat(o.osVersion)}function ef(){const o=lt();return!!("WebKit"===ha.engine.name&&o.os===ti.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&o.name!==mt.SAFARI||hi()&&o.name!==mt.SAFARI)}function ec(){return lt().name===mt.CHROME}function or(){return lt().name===mt.SAFARI}function Bt(){return lt().name===mt.FIREFOX}function hi(){return lt().os===ti.IOS}function xw(o){const n=lt();return!(n.name!==mt.CHROME||!n.osVersion)&&Number(n.version)>=o}function Or(o){const n=lt();return!(n.name!==mt.EDGE||!n.osVersion)&&Number(n.version)>=o}function C1(o){const n=lt();return!(n.name!==mt.OPERA||!n.osVersion)&&Number(n.version)>=o}function gC(){const o=lt();return!(o.name!==mt.CHROME||!o.osVersion)&&Number(o.version)<=90}function EC(){const o=lt();if(o.os!==ti.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return Number(n[0])<14||14===Number(n[0])&&Number(n[1])<=6}function tf(){const o=lt();if(o.os!==ti.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 15===Number(n[0])}function Ne(){const o=lt();if(o.os!==ti.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 16===Number(n[0])}function Fw(){const o=lt();if(o.os!==ti.IOS||!o.osVersion)return!1;const n=o.osVersion.split(".");return 15===Number(n[0])&&Number(n[1])>=1}function pa(){return or()&&navigator.maxTouchPoints>0}function Uw(){return lt().name===mt.WECHAT}function nf(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function $c(){const o=lt();return o.name!==mt.EDGE&&o.name!==mt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function rd(){return Zp()===ti.ANDROID}function Xc(){const o=lt();return rd()&&(o.name===mt.CHROME||o.name===mt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var k;!function(o){o.UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_READABLE="NOT_READABLE",o.NOT_SUPPORTED="NOT_SUPPORTED",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORTED="OPERATION_ABORTED",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",o.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",o.DATACHANNEL_FAILED="DATACHANNEL_FAILED",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",o.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",o.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",o.UID_CONFLICT="UID_CONFLICT",o.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",o.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",o.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",o.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",o.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",o.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",o.INVALID_PLUGIN="INVALID_PLUGIN",o.DISCONNECT_P2P="DISCONNECT_P2P",o.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",o.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",o.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",o.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",o.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",o.PROHIBITED_OPERATION="PROHIBITED_OPERATION",o.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(k||(k={}));let Q=class extends Error{constructor(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),C(this,"code",void 0),C(this,"message",void 0),C(this,"data",void 0),C(this,"name","AgoraRTCException"),this.code=o,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return"error"===o&&(n||console).error(this.toString()),"warning"===o&&(n||console).warn(this.toString()),this}throw(o){throw this.print("error",o),this}};function Jc(o,n){if("boolean"!=typeof o)throw new Q(k.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function Jn(o,n,i){if(!Re(i).call(i,o))throw new Q(k.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(i)))}function Dt(o,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(o<i||o>s||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&("number"!=typeof(c=o)||c%1!=0))throw new Q(k.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(i,", ").concat(s,"]. integer only"));var c}function Fg(o,n){if("number"!=typeof o){if(!(o.min||o.max||o.ideal||o.exact))throw new Q(k.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));void 0!==o.min&&Dt(o.min,"".concat(n,".min"),0,1/0),void 0!==o.max&&Dt(o.max,"".concat(n,".max"),1,1/0),void 0!==o.exact&&Dt(o.exact,"".concat(n,".exact"),1,1/0),void 0!==o.ideal&&Dt(o.ideal,"".concat(n,".ideal"),1,1/0)}else Dt(o,n,1,1/0)}function Ei(o,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==o)throw new Q(k.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!Vw(o,i,s,c))throw new Q(k.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(s,"].").concat(c?" ASCII characters only.":""))}function fa(o,n){if(!Array.isArray(o))throw new Q(k.INVALID_PARAMS,"".concat(n," should be an array"))}function Jt(o){return null==o}function Vw(o){return"string"==typeof o&&o.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&o.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(c){if("string"!=typeof c)return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0}(o))}function Bw(o,n,i){if("getBigUint64"in DataView.prototype)return o.getBigUint64(n,i);const s=o.getUint32(n,i),c=o.getUint32(n+4,i),d=Number(!!i),h=Number(!i);return BigInt(s*h+c*d)<<BigInt(32)|BigInt(s*d+c*h)}function jw(o,n,i,s){if("setBigUint64"in DataView.prototype)return o.setBigUint64(n,i,s);const c=Number(i>>BigInt(32)),d=Number(i&BigInt(4294967295));s?(o.setUint32(n+4,c,s),o.setUint32(n,d,s)):(o.setUint32(n,c,s),o.setUint32(n+4,d,s))}var ma,Ug;(function(o){o.COVERED="COVERED",o.POSITION="POSITION",o.SIZE="SIZE",o.STYLE="STYLE"})(ma||(ma={})),function(o){o.UNMOUNTED="UNMOUNTED",o.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Ug||(Ug={}));const Hw=new class{constructor(){C(this,"_clientSize",null),C(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),C(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),C(this,"getStyle",o=>window.getComputedStyle(o,null)),C(this,"checkCssVisibleProperty",o=>{var n;let i=!0;const s=this.getStyle(o),{display:c,visibility:d,opacity:h,filter:p}=s;return("none"===c||Re(n=["hidden","collapse"]).call(n,d)||Number(h)<.1)&&(i=!1),!!i&&(p&&p.split(" ").filter(m=>{var _;const E=m.split("(")[0];return Re(_=["brightness","blur","opacity"]).call(_,E)}).map(m=>{const[_,E]=m.split(/\(|\)/);return[_,Number(E.match(/^[0-9\.]+/))]}).forEach(m=>{const[_,E]=m;switch(_){case"brightness":(E<.1||E>3)&&(i=!1);break;case"blur":E>3&&(i=!1);break;case"opacity":E<.1&&(i=!1)}}),i)}),C(this,"checkPropertyUpToAllParentNodes",(o,n)=>{let i=!0,s=!0;let d=o;for(;d&&s;)n(d)||(i=!1,s=!1),d=d.parentElement,d||(s=!1);return i}),C(this,"checkActualCssVisibleIncludeInherit",o=>this.checkPropertyUpToAllParentNodes(o,this.checkCssVisibleProperty)),C(this,"getSizeAboutClient",o=>{const{width:n,height:i,left:s,right:c,top:d,bottom:h}=o.getBoundingClientRect(),p=this.getClientWidth(),m=this.getClientHeight();return{width:n,height:i,left:s,right:c,top:d,bottom:h,clientWidth:p,clientHeight:m,clientMin:Math.min(p,m)}}),C(this,"checkActualSize",()=>{const{width:o,height:n,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(o,n,i)}),C(this,"elementFromPoint",(o,n)=>document.elementFromPoint?document.elementFromPoint(o,n):null),C(this,"checkCoverForAPoint",(o,n,i)=>{const s=this.elementFromPoint(o,n);return null!==s&&s!==i}),C(this,"getPointPositionList",()=>{const{width:o,height:n,left:i,top:s}=this._clientSize,c=o/6,d=n/6,h=[],p=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++)h.push({x:(i*p+(0===m?.1:4===m?(c*m*p-1e5)/p:c*m)*p)/p,y:(s*p+(0===_?.1:4===_?(d*_*p-1e5)/p:d*_)*p)/p});return[...h]}),C(this,"checkElementCover",o=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,o)).filter(n=>!!n).length>6),C(this,"checkSizeIsVisible",(o,n,i)=>(o>50||i/o<=10)&&(n>50||i/n<=10)),C(this,"checkSizeOfPartInClient",()=>{const{left:o,right:n,top:i,bottom:s,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let p,m,_,E;if(o<0)p=0;else{if(!(o<d))return!1;p=o}if(n<0)return!1;if(m=n<d?n:d,i<0)_=0;else{if(!(i<c))return!1;_=i}return!(s<0)&&(E=s<c?s:c,this.checkSizeIsVisible(m-p,E-_,h))}),C(this,"returnHiddenResult",o=>(this._clientSize=null,{visible:!1,reason:o})),C(this,"checkOneElementVisible",o=>{if(o instanceof HTMLElement){if(this.checkElementIsMountedOnDom(o)){if(this.checkActualCssVisibleIncludeInherit(o)){if(this._clientSize=this.getSizeAboutClient(o),this.checkElementCover(o))return this.returnHiddenResult(ma.COVERED);{const n=this.checkActualSize(),i=this.checkSizeOfPartInClient();return n&&!i?this.returnHiddenResult(ma.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(ma.SIZE)}}return this.returnHiddenResult(ma.STYLE)}return this.returnHiddenResult(Ug.UNMOUNTED)}return this.returnHiddenResult(Ug.INVALID_HTML_ELEMENT)}),C(this,"checkElementIsMountedOnDom",o=>this.checkPropertyUpToAllParentNodes(o,n=>"HTML"!==n.nodeName.toUpperCase()?null!==n.parentElement:!!document.documentElement))}};function vC(o){return(new TextEncoder).encode(o)}const rf=function(o,n){const i=new Uint8Array(o.byteLength+n.byteLength);return i.set(new Uint8Array(o),0),i.set(new Uint8Array(n),o.byteLength),i},Gw=function(){var o=L(function*(n){const i=function(h){const p=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),m=new Uint8Array(new ArrayBuffer(p.length));for(let _=0;_<p.length;_+=1)m[_]=p.charCodeAt(_);return m}(),s=yield window.crypto.subtle.importKey("spki",i,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),c=vC(n),d=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},s,c);return function(h){let p="";for(let m=0;m<h.length;m+=1)p+=String.fromCharCode(h[m]);return window.btoa(p)}(new Uint8Array(d))});return function(i){return o.apply(this,arguments)}}(),Ww=function(){var o=L(function*(n){return function(i,s){let c="";return new Uint8Array(i).forEach(d=>{c+=d.toString(16).padStart(2,"0")}),c}(yield crypto.subtle.digest("SHA-256",vC(n)))});return function(i){return o.apply(this,arguments)}}();class jt{constructor(){C(this,"_events",{}),C(this,"addListener",this.on)}getListeners(n){return this._events[n]?this._events[n].map(i=>i.listener):[]}on(n,i){this._events[n]||(this._events[n]=[]);const s=this._events[n];-1===this._indexOfListener(s,i)&&s.push({listener:i,once:!1})}once(n,i){this._events[n]||(this._events[n]=[]);const s=this._events[n];-1===this._indexOfListener(s,i)&&s.push({listener:i,once:!0})}off(n,i){if(!this._events[n])return;const s=this._events[n],c=this._indexOfListener(s,i);-1!==c&&s.splice(c,1),0===this._events[n].length&&delete this._events[n]}removeAllListeners(n){n?delete this._events[n]:this._events={}}emit(n){this._events[n]||(this._events[n]=[]);const i=this._events[n].map(h=>h);for(var s=arguments.length,c=new Array(s>1?s-1:0),d=1;d<s;d++)c[d-1]=arguments[d];for(let h=0;h<i.length;h+=1){const p=i[h];p.once&&this.off(n,p.listener),p.listener.apply(this,c||[])}}safeEmit(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),c=1;c<i;c++)s[c-1]=arguments[c];[...this._events[n]||[]].forEach(d=>{d.once&&this.off(n,d.listener);try{d.listener.apply(this,s)}catch(h){console.error("safeEmit event:".concat(n," error ").concat(null==h?void 0:h.toString()))}})}_indexOfListener(n,i){let s=n.length;for(;s--;)if(n[s].listener===i)return s;return-1}}let sf=null;function Wu(){if(sf)return sf;if(window.electron)return sf=window.electron;if(!window.require)return null;try{return sf=window.require("electron"),sf}catch(o){return null}}var fn,nn,yC,Ye,$e,Gn,xi,tc;function SC(o){return Dt(o.timeout,"config.timeout",0,1e5),Dt(o.timeoutFactor,"config.timeoutFactor",0,100,!1),Dt(o.maxRetryCount,"config.maxRetryConfig",0,1/0),Dt(o.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function zu(o){if(!Array.isArray(o)||o.length<1)return!1;try{o.forEach(n=>{if(!n.urls)throw Error()})}catch(n){return!1}return!0}function zw(o){return Ei(o.turnServerURL,"turnServerURL"),Ei(o.username,"username"),Ei(o.password,"password"),o.udpport&&Dt(o.udpport,"udpport",1,99999,!0),o.forceturn&&Jc(o.forceturn,"forceturn"),o.security&&Jc(o.security,"security"),o.tcpport&&Dt(o.tcpport,"tcpport",1,99999,!0),!0}function b1(o){return void 0!==o.level&&Jn(o.level,"level",[1,2,3]),void 0!==o.delay&&Dt(o.delay,"delay",0,3e3,!0),!0}function cn(o,n){for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return 0===o.getListeners(n).length?z.reject(new Q(k.UNEXPECTED_ERROR,"can not emit promise")):new z((d,h)=>{o.emit(n,...s,d,h)})}function Lt(o,n){if(0===o.getListeners(n).length)return z.resolve();for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return cn(o,n,...s)}function lo(o,n){if(0===o.getListeners(n).length)return null;for(var i=arguments.length,s=new Array(i>2?i-2:0),c=2;c<i;c++)s[c-2]=arguments[c];return _a(o,n,...s)}function _a(o,n){let i=null,s=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(o.emit(n,...d,p=>{i=p},p=>{s=p}),null!==s)throw s;if(null===i)throw new Q(k.UNEXPECTED_ERROR,"handler is not sync");return i}(function(o){o.CREATE_CLIENT="createClient",o.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",o.SET_AREA="setArea",o.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",o.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",o.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",o.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",o.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",o.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",o.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",o.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",o.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",o.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",o.START_PROXY_SERVER="Client.startProxyServer",o.STOP_PROXY_SERVER="Client.stopProxyServer",o.SET_PROXY_SERVER="Client.setProxyServer",o.SET_TURN_SERVER="Client.setTurnServer",o.SET_CLIENT_ROLE="Client.setClientRole",o.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",o.ENABLE_DUAL_STREAM="Client.enableDualStream",o.DISABLE_DUAL_STREAM="Client.disableDualStream",o.JOIN="Client.join",o.LEAVE="Client.leave",o.PUBLISH="Client.publish",o.UNPUBLISH="Client.unpublish",o.SUBSCRIBE="Client.subscribe",o.MASS_SUBSCRIBE="Client.massSubscribe",o.MASS_UNSUBSCRIBE="Client.massUnsubscribe",o.UNSUBSCRIBE="Client.unsubscribe",o.RENEW_TOKEN="Client.renewToken",o.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",o.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",o.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",o.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",o.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",o.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",o.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",o.DATACHANNEL_FAILBACK="Client._datachannelFailback",o.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",o.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",o.START_LIVE_STREAMING="Client.startLiveStreaming",o.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",o.STOP_LIVE_STREAMING="Client.stopLiveStreaming",o.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",o.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",o.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",o.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",o.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",o.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",o.SET_CONFIG_DISTRIBUTE="_configDistribute",o.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",o.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",o.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",o.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",o.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",o.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",o.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",o.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",o.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",o.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",o.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",o.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",o.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",o.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",o.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",o.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",o.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",o.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",o.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",o.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",o.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",o.STREAM_TYPE_CHANGE="streamTypeChange",o.CONNECTION_STATE_CHANGE="connectionStateChange",o.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",o.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(fn||(fn={})),function(o){o.TRACER="tracer"}(nn||(nn={})),function(o){o[o.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",o[o.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",o[o.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(yC||(yC={})),function(o){o.LEAVE="LEAVE",o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.UID_BANNED="UID_BANNED",o.IP_BANNED="IP_BANNED",o.CHANNEL_BANNED="CHANNEL_BANNED",o.FALLBACK="FALLBACK",o.LICENSE_MISSING="LICENSE_MISSING",o.LICENSE_EXPIRED="LICENSE_EXPIRED",o.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",o.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",o.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",o.LICENSE_ILLEGAL="LICENSE_ILLEGAL",o.TOKEN_EXPIRE="TOKEN_EXPIRE"}(Ye||(Ye={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.MEDIA_RECONNECT_START="media-reconnect-start",o.MEDIA_RECONNECT_END="media-reconnect-end",o.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",o.USER_JOINED="user-joined",o.USER_LEAVED="user-left",o.USER_PUBLISHED="user-published",o.USER_UNPUBLISHED="user-unpublished",o.USER_INFO_UPDATED="user-info-updated",o.CLIENT_BANNED="client-banned",o.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",o.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",o.VOLUME_INDICATOR="volume-indicator",o.CRYPT_ERROR="crypt-error",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGED="stream-type-changed",o.STREAM_FALLBACK="stream-fallback",o.RECEIVE_METADATA="receive-metadata",o.STREAM_MESSAGE="stream-message",o.LIVE_STREAMING_ERROR="live-streaming-error",o.LIVE_STREAMING_WARNING="live-streaming-warning",o.INJECT_STREAM_STATUS="stream-inject-status",o.EXCEPTION="exception",o.ERROR="error",o.P2P_LOST="p2p_lost",o.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",o.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",o.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",o.PUBLISHED_USER_LIST="published-user-list",o.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",o.CONTENT_INSPECT_ERROR="content-inspect-error",o.CONTENT_INSPECT_RESULT="content-inspect-result",o.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}($e||($e={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(Gn||(Gn={})),function(o){o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(xi||(xi={})),function(o){o.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(tc||(tc={}));const mn=new class extends jt{set networkState(o){this.emit(tc.NETWORK_STATE_CHANGE,o,this._networkState),o===xi.ONLINE?this.emit(tc.ONLINE):o===xi.OFFLINE&&(this.onlineWaiter=new z(n=>{this.once(tc.ONLINE,()=>{this.onlineWaiter=void 0,n(xi.ONLINE)})}),this.emit(tc.OFFLINE)),this._networkState=o}get networkState(){return this._networkState}get isOnline(){return this._networkState===xi.ONLINE}constructor(){super(),C(this,"_moduleName","network-indicator"),C(this,"_networkState",xi.ONLINE),C(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=xi.ONLINE}),window.addEventListener("offline",()=>{this.networkState=xi.OFFLINE})}};function Kw(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function od(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Kw(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Kw(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Vg(o,n){const i=o.indexOf(n);-1!==i&&o.splice(i,1)}function ga(o){const n=[];return o.forEach(i=>{-1===n.indexOf(i)&&n.push(i)}),n}function is(o){void 0!==z?z.resolve().then(o):setTimeout(o,0)}function Mn(o){return JSON.parse(JSON.stringify(o))}function sd(o){try{return Mn(o)}catch(n){return o}}const qw={};function af(o,n){qw[n]||(qw[n]=!0,o())}function cf(o){const n=window.atob(o),i=new Uint8Array(new ArrayBuffer(n.length));for(let s=0;s<n.length;s+=1)i[s]=n.charCodeAt(s);return i}function Bg(o){let n="";for(let i=0;i<o.length;i+=1)n+=String.fromCharCode(o[i]);return window.btoa(n)}function Ea(o){return window.TextEncoder?(new TextEncoder).encode(o).length:o.length}function ad(o){let n=0;return/DingTalk/i.test(navigator.userAgent)&&o.realFormData&&(o=o.realFormData),o.forEach(i=>{n+="string"==typeof i?Ea(i):i.size}),n+138}function T1(o){const n=new Q(k.TIMEOUT,"timeout");return new z((i,s)=>{window.setTimeout(()=>s(n),o)})}function pi(o){return new z(n=>{window.setTimeout(n,o)})}function Ot(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,o).toLowerCase();return i.length===o?"".concat(n).concat(i):"".concat(n).concat(i)+Ot(o-i.length,"")}function jg(){return Ot(32,"").toUpperCase()}const Hg=()=>{},CC=new class{constructor(){C(this,"fnMap",new Map)}throttleByKey(o,n,i,s){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(n)){const p=this.fnMap.get(n);if(p.threshold!==i){p.fn(...p.args),clearTimeout(p.timer);const m=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:o,threshold:i,timer:m,args:d,skipFn:s})}else p.skipFn&&p.skipFn(...p.args),this.fnMap.set(n,od(od({},p),{},{fn:o,args:d,skipFn:s}))}else{const p=window.setTimeout(()=>{const m=this.fnMap.get(n);m&&m.fn(...m.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:o,threshold:i,timer:p,args:d,skipFn:s})}}},Yw=CC.throttleByKey.bind(CC);function Gg(o){return"object"==typeof o&&null!==o&&!(o instanceof RegExp)}function bC(o,n){if(!Gg(o)||!Gg(n)||Array.isArray(o)&&!Array.isArray(n)||!Array.isArray(o)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(o)){const i=[...o];for(let s=0;s<n.length;s++)i[s]=bC(o[s],n[s]);return i}{const i=od({},o);for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=Object.prototype.hasOwnProperty.call(o,s)?bC(o[s],n[s]):n[s]);return i}}let $w=1,lf=console;class ni{static setLogger(n){lf=n}constructor(n){C(this,"lockingPromise",z.resolve()),C(this,"locks",0),C(this,"name",""),C(this,"lockId",void 0),this.lockId=$w++,n&&(this.name=n),lf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(n){let i;this.locks+=1,lf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof n?n:""));const s=new z(d=>{i=()=>{this.locks-=1,lf.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof n?n:"")),d()}}),c=this.lockingPromise.then(()=>i);return this.lockingPromise=this.lockingPromise.then(()=>s),c}}function Ku(o,n){return function(i,s,c){const d=c.value;if("function"!=typeof d)throw new Error("Cannot use mutex on object property.");return c.value=L(function*(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(o));const p=yield h.lock("From ".concat(o,".").concat(s));try{for(var m=arguments.length,_=new Array(m),E=0;E<m;E++)_[E]=arguments[E];return yield d.apply(this,_)}finally{p()}}),c}}const Ln={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function qu(o,n){const i=Math.floor(n.timeout*Math.pow(n.timeoutFactor,o));return Math.min(n.maxRetryTimeout,i)}function Fs(o,n,i,s){const c=Object.assign({},Ln,s);let d=c.timeout;const h=function(){var _=L(function*(){var E;yield(E=d,new z(v=>{window.setTimeout(v,E)})),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)});return function(){return _.apply(this,arguments)}}();let p=!1;const m=new z(function(){var _=L(function*(E,v){n=n||(()=>!1),i=i||(()=>!0);for(let S=0;S<c.maxRetryCount;S+=1){if(p)return v(new Q(k.OPERATION_ABORTED));try{const b=yield o();if(!n(b,S)||S+1===c.maxRetryCount)return E(b);yield h()}catch(b){if(!i(b,S)||S+1===c.maxRetryCount)return v(b);yield h()}}});return function(E,v){return _.apply(this,arguments)}}());return m.cancel=()=>p=!0,m}var Xw=To,R1=ea,I1=Br,w1=Nc,A1=TypeError,Jw=function(o){return function(n,i,s,c){Xw(i);var d=R1(n),h=I1(d),p=w1(d),m=o?p-1:0,_=o?-1:1;if(s<2)for(;;){if(m in h){c=h[m],m+=_;break}if(m+=_,o?m<0:p<=m)throw A1("Reduce of empty array with no initial value")}for(;o?m>=0:p>m;m+=_)m in h&&(c=i(c,h[m],m,d));return c}},D1=[Jw(!1),Jw(!0)][0];wt({target:"Array",proto:!0,forced:!Nu&&gr>79&&gr<83||!RS("reduce")},{reduce:function(o){var n=arguments.length;return D1(this,o,n,n>1?arguments[1]:void 0)}});var O1=_e("Array").reduce,N1=Cs,Qw=O1,Wg=Array.prototype,cd=fr(function(o){var n=o.reduce;return o===Wg||N1(Wg,o)&&n===Wg.reduce?Qw:n});let TC=class{constructor(o){C(this,"input",[]),C(this,"size",void 0),this.size=o}add(o){this.input.push(o),this.input.length>this.size&&this.input.splice(0,1)}mean(){var o;return 0===this.input.length?0:cd(o=this.input).call(o,(n,i)=>n+i)/this.input.length}};var zg,RC={exports:{}},Zw=function(o,n){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return o.apply(n,i)}},P1=Zw,df=Object.prototype.toString,uf=(zg=Object.create(null),function(o){var n=df.call(o);return zg[n]||(zg[n]=n.slice(8,-1).toLowerCase())});function Qc(o){return o=o.toLowerCase(),function(n){return uf(n)===o}}function hf(o){return Array.isArray(o)}function Kg(o){return void 0===o}var eA=Qc("ArrayBuffer");function qg(o){return null!==o&&"object"==typeof o}function Yg(o){if("object"!==uf(o))return!1;var n=Object.getPrototypeOf(o);return null===n||n===Object.prototype}var xn=Qc("Date"),k1=Qc("File"),tA=Qc("Blob"),M1=Qc("FileList");function $g(o){return"[object Function]"===df.call(o)}var aU=Qc("URLSearchParams");function IC(o,n){if(null!=o)if("object"!=typeof o&&(o=[o]),hf(o))for(var i=0,s=o.length;i<s;i++)n.call(null,o[i],i,o);else for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&n.call(null,o[c],c,o)}var nc,L1=(nc="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(o){return nc&&o instanceof nc}),vi={isArray:hf,isArrayBuffer:eA,isBuffer:function(o){return null!==o&&!Kg(o)&&null!==o.constructor&&!Kg(o.constructor)&&"function"==typeof o.constructor.isBuffer&&o.constructor.isBuffer(o)},isFormData:function(o){var n="[object FormData]";return o&&("function"==typeof FormData&&o instanceof FormData||df.call(o)===n||$g(o.toString)&&o.toString()===n)},isArrayBufferView:function(o){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer&&eA(o.buffer)},isString:function(o){return"string"==typeof o},isNumber:function(o){return"number"==typeof o},isObject:qg,isPlainObject:Yg,isUndefined:Kg,isDate:xn,isFile:k1,isBlob:tA,isFunction:$g,isStream:function(o){return qg(o)&&$g(o.pipe)},isURLSearchParams:aU,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:IC,merge:function o(){var n={};function i(d,h){n[h]=Yg(n[h])&&Yg(d)?o(n[h],d):Yg(d)?o({},d):hf(d)?d.slice():d}for(var s=0,c=arguments.length;s<c;s++)IC(arguments[s],i);return n},extend:function(o,n,i){return IC(n,function(s,c){o[c]=i&&"function"==typeof s?P1(s,i):s}),o},trim:function(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")},stripBOM:function(o){return 65279===o.charCodeAt(0)&&(o=o.slice(1)),o},inherits:function(o,n,i,s){o.prototype=Object.create(n.prototype,s),o.prototype.constructor=o,i&&Object.assign(o.prototype,i)},toFlatObject:function(o,n,i){var s,c,d,h={};n=n||{};do{for(c=(s=Object.getOwnPropertyNames(o)).length;c-- >0;)h[d=s[c]]||(n[d]=o[d],h[d]=!0);o=Object.getPrototypeOf(o)}while(o&&(!i||i(o,n))&&o!==Object.prototype);return n},kindOf:uf,kindOfTest:Qc,endsWith:function(o,n,i){o=String(o),(void 0===i||i>o.length)&&(i=o.length);var s=o.indexOf(n,i-=n.length);return-1!==s&&s===i},toArray:function(o){if(!o)return null;var n=o.length;if(Kg(n))return null;for(var i=new Array(n);n-- >0;)i[n]=o[n];return i},isTypedArray:L1,isFileList:M1},Rn=vi;function nA(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var x1=function(o,n,i){if(!n)return o;var s;if(i)s=i(n);else if(Rn.isURLSearchParams(n))s=n.toString();else{var c=[];Rn.forEach(n,function(h,p){null!=h&&(Rn.isArray(h)?p+="[]":h=[h],Rn.forEach(h,function(m){Rn.isDate(m)?m=m.toISOString():Rn.isObject(m)&&(m=JSON.stringify(m)),c.push(nA(p)+"="+nA(m))}))}),s=c.join("&")}if(s){var d=o.indexOf("#");-1!==d&&(o=o.slice(0,d)),o+=(-1===o.indexOf("?")?"?":"&")+s}return o},pf=vi;function Lo(){this.handlers=[]}Lo.prototype.use=function(o,n,i){return this.handlers.push({fulfilled:o,rejected:n,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1},Lo.prototype.eject=function(o){this.handlers[o]&&(this.handlers[o]=null)},Lo.prototype.forEach=function(o){pf.forEach(this.handlers,function(n){null!==n&&o(n)})};var iA,rA,F1=Lo,ld=vi;function Yu(){if(rA)return iA;rA=1;var o=vi;function n(c,d,h,p,m){Error.call(this),this.message=c,this.name="AxiosError",d&&(this.code=d),h&&(this.config=h),p&&(this.request=p),m&&(this.response=m)}o.inherits(n,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var i=n.prototype,s={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(c){s[c]={value:c}}),Object.defineProperties(n,s),Object.defineProperty(i,"isAxiosError",{value:!0}),n.from=function(c,d,h,p,m,_){var E=Object.create(i);return o.toFlatObject(c,E,function(v){return v!==Error.prototype}),n.call(E,c.message,d,h,p,m),E.name=c.name,_&&Object.assign(E,_),E},iA=n}var ff,mf,$u,oA,Xg,wC,sA={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function aA(){if(mf)return ff;mf=1;var o=vi;return ff=function(n,i){i=i||new FormData;var s=[];function c(d){return null===d?"":o.isDate(d)?d.toISOString():o.isArrayBuffer(d)||o.isTypedArray(d)?"function"==typeof Blob?new Blob([d]):Buffer.from(d):d}return function d(h,p){if(o.isPlainObject(h)||o.isArray(h)){if(-1!==s.indexOf(h))throw Error("Circular reference detected in "+p);s.push(h),o.forEach(h,function(m,_){if(!o.isUndefined(m)){var E,v=p?p+"."+_:_;if(m&&!p&&"object"==typeof m)if(o.endsWith(_,"{}"))m=JSON.stringify(m);else if(o.endsWith(_,"[]")&&(E=o.toArray(m)))return void E.forEach(function(S){!o.isUndefined(S)&&i.append(v,c(S))});d(m,v)}}),s.pop()}else i.append(p,c(h))}(n),i}}var cA,lA,dA,va,DC,dd,V1,OC,NC,B1,PC,j1,hA=function(o,n){return o&&!function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}(n)?function(o,n){return n?o.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):o}(o,n):n};function Jg(){if(dd)return DC;dd=1;var o=Yu();function n(i){o.call(this,null==i?"canceled":i,o.ERR_CANCELED),this.name="CanceledError"}return vi.inherits(n,o,{__CANCEL__:!0}),DC=n}var sr=vi,mA=function(o,n){ld.forEach(o,function(i,s){s!==n&&s.toUpperCase()===n.toUpperCase()&&(o[n]=i,delete o[s])})},_A=Yu(),W1=sA,_f=aA(),gA={"Content-Type":"application/x-www-form-urlencoded"};function MC(o,n){!sr.isUndefined(o)&&sr.isUndefined(o["Content-Type"])&&(o["Content-Type"]=n)}var LC,gf={transitional:W1,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(LC=function G1(){if(B1)return NC;B1=1;var o=vi,n=function AC(){if(oA)return $u;oA=1;var o=Yu();return $u=function(n,i,s){var c=s.config.validateStatus;s.status&&c&&!c(s.status)?i(new o("Request failed with status code "+s.status,[o.ERR_BAD_REQUEST,o.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):n(s)}}(),i=function U1(){if(wC)return Xg;wC=1;var o=vi;return Xg=o.isStandardBrowserEnv()?{write:function(n,i,s,c,d,h){var p=[];p.push(n+"="+encodeURIComponent(i)),o.isNumber(s)&&p.push("expires="+new Date(s).toGMTString()),o.isString(c)&&p.push("path="+c),o.isString(d)&&p.push("domain="+d),!0===h&&p.push("secure"),document.cookie=p.join("; ")},read:function(n){var i=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(n){this.write(n,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}}(),s=x1,c=hA,d=function pA(){if(lA)return cA;lA=1;var o=vi,n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return cA=function(i){var s,c,d,h={};return i&&o.forEach(i.split("\n"),function(p){if(d=p.indexOf(":"),s=o.trim(p.substr(0,d)).toLowerCase(),c=o.trim(p.substr(d+1)),s){if(h[s]&&n.indexOf(s)>=0)return;h[s]="set-cookie"===s?(h[s]?h[s]:[]).concat([c]):h[s]?h[s]+", "+c:c}}),h}}(),h=function H1(){if(va)return dA;va=1;var o=vi;return dA=o.isStandardBrowserEnv()?function(){var n,i=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");function c(d){var h=d;return i&&(s.setAttribute("href",h),h=s.href),s.setAttribute("href",h),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:"/"===s.pathname.charAt(0)?s.pathname:"/"+s.pathname}}return n=c(window.location.href),function(d){var h=o.isString(d)?c(d):d;return h.protocol===n.protocol&&h.host===n.host}}():function(){return!0}}(),p=sA,m=Yu(),_=Jg(),E=function fA(){return OC||(OC=1,V1=function(o){var n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return n&&n[1]||""}),V1}();return NC=function(v){return new Promise(function(S,b){var O,P=v.data,w=v.headers,M=v.responseType;function V(){v.cancelToken&&v.cancelToken.unsubscribe(O),v.signal&&v.signal.removeEventListener("abort",O)}o.isFormData(P)&&o.isStandardBrowserEnv()&&delete w["Content-Type"];var U=new XMLHttpRequest;if(v.auth){var Y=v.auth.username||"",ie=v.auth.password?unescape(encodeURIComponent(v.auth.password)):"";w.Authorization="Basic "+btoa(Y+":"+ie)}var K=c(v.baseURL,v.url);function X(){if(U){var ge="getAllResponseHeaders"in U?d(U.getAllResponseHeaders()):null;n(function(ze){S(ze),V()},function(ze){b(ze),V()},{data:M&&"text"!==M&&"json"!==M?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:ge,config:v,request:U}),U=null}}if(U.open(v.method.toUpperCase(),s(K,v.params,v.paramsSerializer),!0),U.timeout=v.timeout,"onloadend"in U?U.onloadend=X:U.onreadystatechange=function(){U&&4===U.readyState&&(0!==U.status||U.responseURL&&0===U.responseURL.indexOf("file:"))&&setTimeout(X)},U.onabort=function(){U&&(b(new m("Request aborted",m.ECONNABORTED,v,U)),U=null)},U.onerror=function(){b(new m("Network Error",m.ERR_NETWORK,v,U,U)),U=null},U.ontimeout=function(){var ge=v.timeout?"timeout of "+v.timeout+"ms exceeded":"timeout exceeded";v.timeoutErrorMessage&&(ge=v.timeoutErrorMessage),b(new m(ge,(v.transitional||p).clarifyTimeoutError?m.ETIMEDOUT:m.ECONNABORTED,v,U)),U=null},o.isStandardBrowserEnv()){var $=(v.withCredentials||h(K))&&v.xsrfCookieName?i.read(v.xsrfCookieName):void 0;$&&(w[v.xsrfHeaderName]=$)}"setRequestHeader"in U&&o.forEach(w,function(ge,Ee){void 0===P&&"content-type"===Ee.toLowerCase()?delete w[Ee]:U.setRequestHeader(Ee,ge)}),o.isUndefined(v.withCredentials)||(U.withCredentials=!!v.withCredentials),M&&"json"!==M&&(U.responseType=v.responseType),"function"==typeof v.onDownloadProgress&&U.addEventListener("progress",v.onDownloadProgress),"function"==typeof v.onUploadProgress&&U.upload&&U.upload.addEventListener("progress",v.onUploadProgress),(v.cancelToken||v.signal)&&(O=function(ge){U&&(b(!ge||ge&&ge.type?new _:ge),U.abort(),U=null)},v.cancelToken&&v.cancelToken.subscribe(O),v.signal&&(v.signal.aborted?O():v.signal.addEventListener("abort",O))),P||(P=null);var J=E(K);J&&-1===["http","https","file"].indexOf(J)?b(new m("Unsupported protocol "+J+":",m.ERR_BAD_REQUEST,v)):U.send(P)})}}()),LC),transformRequest:[function(o,n){if(mA(n,"Accept"),mA(n,"Content-Type"),sr.isFormData(o)||sr.isArrayBuffer(o)||sr.isBuffer(o)||sr.isStream(o)||sr.isFile(o)||sr.isBlob(o))return o;if(sr.isArrayBufferView(o))return o.buffer;if(sr.isURLSearchParams(o))return MC(n,"application/x-www-form-urlencoded;charset=utf-8"),o.toString();var i,s=sr.isObject(o),c=n&&n["Content-Type"];if((i=sr.isFileList(o))||s&&"multipart/form-data"===c){var d=this.env&&this.env.FormData;return _f(i?{"files[]":o}:o,d&&new d)}return s||"application/json"===c?(MC(n,"application/json"),function(h,p,m){if(sr.isString(h))try{return(0,JSON.parse)(h),sr.trim(h)}catch(_){if("SyntaxError"!==_.name)throw _}return(0,JSON.stringify)(h)}(o)):o}],transformResponse:[function(o){var n=this.transitional||gf.transitional,c=!(n&&n.silentJSONParsing)&&"json"===this.responseType;if(c||n&&n.forcedJSONParsing&&sr.isString(o)&&o.length)try{return JSON.parse(o)}catch(d){if(c)throw"SyntaxError"===d.name?_A.from(d,_A.ERR_BAD_RESPONSE,this,null,this.response):d}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:j1?PC:(j1=1,PC=null)},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};sr.forEach(["delete","get","head"],function(o){gf.headers[o]={}}),sr.forEach(["post","put","patch"],function(o){gf.headers[o]=sr.merge(gA)});var xC,Xu,FC=gf,Ef=vi,z1=FC;function EA(){return Xu?xC:(Xu=1,xC=function(o){return!(!o||!o.__CANCEL__)})}var vA=vi,UC=function(o,n,i){var s=this||z1;return Ef.forEach(i,function(c){o=c.call(s,o,n)}),o},vf=EA(),K1=FC,VC=Jg();function Qt(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new VC}var yA,Qg,Ri=vi,SA=function(o,n){n=n||{};var i={};function s(_,E){return Ri.isPlainObject(_)&&Ri.isPlainObject(E)?Ri.merge(_,E):Ri.isPlainObject(E)?Ri.merge({},E):Ri.isArray(E)?E.slice():E}function c(_){return Ri.isUndefined(n[_])?Ri.isUndefined(o[_])?void 0:s(void 0,o[_]):s(o[_],n[_])}function d(_){if(!Ri.isUndefined(n[_]))return s(void 0,n[_])}function h(_){return Ri.isUndefined(n[_])?Ri.isUndefined(o[_])?void 0:s(void 0,o[_]):s(void 0,n[_])}function p(_){return _ in n?s(o[_],n[_]):_ in o?s(void 0,o[_]):void 0}var m={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p};return Ri.forEach(Object.keys(o).concat(Object.keys(n)),function(_){var E=m[_]||c,v=E(_);Ri.isUndefined(v)&&E!==p||(i[_]=v)}),i};function CA(){return Qg?yA:(Qg=1,yA={version:"0.27.2"})}var q1=CA().version,Us=Yu(),uo={};["object","boolean","number","function","string","symbol"].forEach(function(o,n){uo[o]=function(i){return typeof i===o||"a"+(n<1?"n ":" ")+o}});var bA={};uo.transitional=function(o,n,i){function s(c,d){return"[Axios v"+q1+"] Transitional option '"+c+"'"+d+(i?". "+i:"")}return function(c,d,h){if(!1===o)throw new Us(s(d," has been removed"+(n?" in "+n:"")),Us.ERR_DEPRECATED);return n&&!bA[d]&&(bA[d]=!0,console.warn(s(d," has been deprecated since v"+n+" and will be removed in the near future"))),!o||o(c,d,h)}};var TA,BC,jC,Zg,HC,RA,$1=vi,GC=x1,eE=F1,WC=function(o){return Qt(o),o.headers=o.headers||{},o.data=UC.call(o,o.data,o.headers,o.transformRequest),o.headers=vA.merge(o.headers.common||{},o.headers[o.method]||{},o.headers),vA.forEach(["delete","get","head","post","put","patch","common"],function(n){delete o.headers[n]}),(o.adapter||K1.adapter)(o).then(function(n){return Qt(o),n.data=UC.call(o,n.data,n.headers,o.transformResponse),n},function(n){return vf(n)||(Qt(o),n&&n.response&&(n.response.data=UC.call(o,n.response.data,n.response.headers,o.transformResponse))),Promise.reject(n)})},Ju=SA,zC=hA,IA={assertOptions:function(o,n,i){if("object"!=typeof o)throw new Us("options must be an object",Us.ERR_BAD_OPTION_VALUE);for(var s=Object.keys(o),c=s.length;c-- >0;){var d=s[c],h=n[d];if(h){var p=o[d],m=void 0===p||h(p,d,o);if(!0!==m)throw new Us("option "+d+" must be "+m,Us.ERR_BAD_OPTION_VALUE)}else if(!0!==i)throw new Us("Unknown option "+d,Us.ERR_BAD_OPTION)}},validators:uo},Qu=IA.validators;function Zu(o){this.defaults=o,this.interceptors={request:new eE,response:new eE}}Zu.prototype.request=function(o,n){"string"==typeof o?(n=n||{}).url=o:n=o||{},n.method=(n=Ju(this.defaults,n)).method?n.method.toLowerCase():this.defaults.method?this.defaults.method.toLowerCase():"get";var i=n.transitional;void 0!==i&&IA.assertOptions(i,{silentJSONParsing:Qu.transitional(Qu.boolean),forcedJSONParsing:Qu.transitional(Qu.boolean),clarifyTimeoutError:Qu.transitional(Qu.boolean)},!1);var s=[],c=!0;this.interceptors.request.forEach(function(v){"function"==typeof v.runWhen&&!1===v.runWhen(n)||(c=c&&v.synchronous,s.unshift(v.fulfilled,v.rejected))});var d,h=[];if(this.interceptors.response.forEach(function(v){h.push(v.fulfilled,v.rejected)}),!c){var p=[WC,void 0];for(Array.prototype.unshift.apply(p,s),p=p.concat(h),d=Promise.resolve(n);p.length;)d=d.then(p.shift(),p.shift());return d}for(var m=n;s.length;){var _=s.shift(),E=s.shift();try{m=_(m)}catch(v){E(v);break}}try{d=WC(m)}catch(v){return Promise.reject(v)}for(;h.length;)d=d.then(h.shift(),h.shift());return d},Zu.prototype.getUri=function(o){o=Ju(this.defaults,o);var n=zC(o.baseURL,o.url);return GC(n,o.params,o.paramsSerializer)},$1.forEach(["delete","get","head","options"],function(o){Zu.prototype[o]=function(n,i){return this.request(Ju(i||{},{method:o,url:n,data:(i||{}).data}))}}),$1.forEach(["post","put","patch"],function(o){function n(i){return function(s,c,d){return this.request(Ju(d||{},{method:o,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:c}))}}Zu.prototype[o]=n(),Zu.prototype[o+"Form"]=n(!0)});var wA=vi,AA=Zw,eh=Zu,Fi=SA,yi=function o(n){var i=new eh(n),s=AA(eh.prototype.request,i);return wA.extend(s,eh.prototype,i),wA.extend(s,i),s.create=function(c){return o(Fi(n,c))},s}(FC);yi.Axios=eh,yi.CanceledError=Jg(),yi.CancelToken=function(){if(BC)return TA;BC=1;var o=Jg();function n(i){if("function"!=typeof i)throw new TypeError("executor must be a function.");var s;this.promise=new Promise(function(d){s=d});var c=this;this.promise.then(function(d){if(c._listeners){var h,p=c._listeners.length;for(h=0;h<p;h++)c._listeners[h](d);c._listeners=null}}),this.promise.then=function(d){var h,p=new Promise(function(m){c.subscribe(m),h=m}).then(d);return p.cancel=function(){c.unsubscribe(h)},p},i(function(d){c.reason||(c.reason=new o(d),s(c.reason))})}return n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.prototype.subscribe=function(i){this.reason?i(this.reason):this._listeners?this._listeners.push(i):this._listeners=[i]},n.prototype.unsubscribe=function(i){if(this._listeners){var s=this._listeners.indexOf(i);-1!==s&&this._listeners.splice(s,1)}},n.source=function(){var i;return{token:new n(function(s){i=s}),cancel:i}},TA=n}(),yi.isCancel=EA(),yi.VERSION=CA().version,yi.toFormData=aA(),yi.AxiosError=Yu(),yi.Cancel=yi.CanceledError,yi.all=function(o){return Promise.all(o)},yi.spread=Zg?jC:(Zg=1,jC=function(o){return function(n){return o.apply(null,n)}}),yi.isAxiosError=function(){if(RA)return HC;RA=1;var o=vi;return HC=function(n){return o.isObject(n)&&!0===n.isAxiosError}}(),RC.exports=yi,RC.exports.default=yi;var Hn=fr(RC.exports);function Ii(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function DA(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Ii(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Ii(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let yf,Sf=0,KC=0;function tE(o,n,i,s){return new z((c,d)=>{n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),Sf+=Ea(n.data)):i&&(n.data.size?Sf+=n.data.size:n.data instanceof FormData?Sf+=ad(n.data):Sf+=Ea(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=o,Hn.request(n).then(h=>{"string"==typeof h.data?KC+=Ea(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?KC+=h.data.byteLength:KC+=Ea(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Hn.isCancel(h)?d(new Q(k.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new Q(k.NETWORK_TIMEOUT,h.message):h.response?new Q(k.NETWORK_RESPONSE_ERROR,h.response.status):new Q(k.NETWORK_ERROR,h.message))})})}function OA(o,n){return yr.apply(this,arguments)}function yr(){return yr=L(function*(o,n){const i=new Blob([n.data],{type:"buffer"});return yield tE(o,DA(DA({},n),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}),yr.apply(this,arguments)}const NA=()=>void 0!==window.isSecureContext;function PA(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Se(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?PA(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):PA(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}var Ke;!function(o){o.SET_SESSION_ID="SET_SESSION_ID",o.SET_P2P_ID="SET_P2P_id",o.SET_DC_ID="SET_DC_id",o.SET_UID="SET_UID",o.SET_PUB_ID="SET_PUB_ID",o.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",o.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",o.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",o.AVOID_JOIN_START="AVOID_JOIN_START",o.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",o.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",o.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",o.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",o.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",o.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",o.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",o.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",o.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",o.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",o.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",o.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",o.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",o.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",o.RESET_KEY_METRICS="RESET_KEY_METRICS",o.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",o.SET_USE_P2P="SET_USE_P2P"}(Ke||(Ke={}));class X1{constructor(n,i,s,c){C(this,"state",void 0),this.state={codec:n,audioCodec:i,mode:s,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(n){this.state=function(i,s){switch(s.type){case Ke.SET_SESSION_ID:return Se(Se({},i),{},{sessionId:s.sessionId});case Ke.SET_P2P_ID:return Se(Se({},i),{},{p2pId:s.p2pId});case Ke.SET_UID:return Se(Se({},i),{},{uid:s.uid});case Ke.SET_PUB_ID:return Se(Se({},i),{},{pubId:s.pubId});case Ke.KEY_METRIC_CLIENT_CREATED:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{clientCreated:s.metric})});case Ke.KEY_METRIC_JOIN_START:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{joinStart:s.metric})});case Ke.AVOID_JOIN_START:return Se(Se({},i),{},{avoidJoinStart:s.avoidJoinStart});case Ke.KEY_METRIC_JOIN_END:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{joinEnd:s.metric})});case Ke.KEY_METRIC_REQUEST_AP_START:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{requestAPStart:s.metric})});case Ke.KEY_METRIC_REQUEST_AP_END:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{requestAPEnd:s.metric})});case Ke.KEY_METRIC_JOIN_GATEWAY_START:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{joinGatewayStart:s.metric})});case Ke.KEY_METRIC_JOIN_GATEWAY_END:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{joinGatewayEnd:s.metric})});case Ke.KEY_METRIC_PEER_CONNECTION_START:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{peerConnectionStart:s.metric})});case Ke.KEY_METRIC_PEER_CONNECTION_END:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{peerConnectionEnd:s.metric})});case Ke.KEY_METRIC_DESCRIPTION_START:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{descriptionStart:s.metric})});case Ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{signalChannelOpen:s.metric})});case Ke.KEY_METRIC_ICE_CONNECTION_END:return Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{iceConnectionEnd:s.metric})});case Ke.KEY_METRIC_PUBLISH:{const c=i.keyMetrics.publish,d=c.findIndex(h=>h.trackId===s.metric.trackId);return-1!==d?(c[d]=Se(Se({},c[d]),s.metric),Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{publish:[...c]})})):Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{publish:[...i.keyMetrics.publish,s.metric]})})}case Ke.KEY_METRIC_SUBSCRIBE:{const c=i.keyMetrics.subscribe,d=c.findIndex(h=>h.userId===s.metric.userId&&h.type===s.metric.type);return-1!==d?(c[d]=Se(Se({},c[d]),s.metric),Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{subscribe:[...c]})})):Se(Se({},i),{},{keyMetrics:Se(Se({},i.keyMetrics),{},{subscribe:[...i.keyMetrics.subscribe,s.metric]})})}case Ke.SET_CLOUD_PROXY_SERVER_MODE:return i.cloudProxyServerMode=s.mode,i;case Ke.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof s.index?i.joinChannelServiceRecords=[...i.joinChannelServiceRecords,s.record]:(i.joinChannelServiceRecords[s.index]=Se(Se({},i.joinChannelServiceRecords[s.index]),s.record),i.joinChannelServiceRecords=[...i.joinChannelServiceRecords]),i;case Ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return i.joinChannelServiceRecords=[],i;case Ke.RESET_KEY_METRICS:return i.keyMetrics={publish:[],subscribe:[]},i;case Ke.SET_USE_DATACHANNEL:return Se(Se({},i),{},{useDataChannel:s.val});case Ke.SET_USE_P2P:return Se(Se({},i),{},{useP2P:s.val});default:return i}}(this.state,n)}set sessionId(n){this.dispatch({type:Ke.SET_SESSION_ID,sessionId:n})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(n){this.dispatch({type:Ke.SET_P2P_ID,p2pId:n})}get p2pId(){return this.state.p2pId}set dcId(n){this.dispatch({type:Ke.SET_DC_ID,dcId:n})}get dcId(){return this.state.dcId}set uid(n){this.dispatch({type:Ke.SET_UID,uid:n})}get uid(){return this.state.uid}set pubId(n){this.dispatch({type:Ke.SET_PUB_ID,pubId:n})}get pubId(){return this.state.pubId}set cloudProxyServerMode(n){this.dispatch({type:Ke.SET_CLOUD_PROXY_SERVER_MODE,mode:n})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(n){this.dispatch({type:Ke.SET_USE_DATACHANNEL,val:n})}get useDataChannel(){return this.state.useDataChannel}set useP2P(n){this.dispatch({type:Ke.SET_USE_P2P,val:n})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:Ke.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ke.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ke.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ke.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ke.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ke.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ke.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ke.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ke.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Ke.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ke.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(n,i,s,c){this.dispatch({type:Ke.KEY_METRIC_PUBLISH,metric:Se(Se({trackId:n,type:i},s&&{publishStart:s}),c&&{publishEnd:c})})}subscribe(n,i,s,c,d,h,p){this.dispatch({type:Ke.KEY_METRIC_SUBSCRIBE,metric:Se(Se(Se(Se(Se({userId:n,type:i},s&&{subscribeStart:s}),c&&{subscribeEnd:c}),d&&{firstFrame:d}),h&&{streamAdded:h}),p&&{firstDecoded:p})})}massSubscribe(n,i,s,c){n.forEach(d=>{this.dispatch({type:Ke.KEY_METRIC_SUBSCRIBE,metric:Se(Se(Se({userId:d.userId,type:d.type},i&&{subscribeStart:i}),s&&{subscribeEnd:s}),c&&{firstFrame:c})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(n,i){"gateway"===n.service&&Array.isArray(n.urls)&&(n.urls=n.urls.map(s=>s.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof i?(this.dispatch({type:Ke.RECORD_JOIN_CHANNEL_SERVICE,record:Se(Se({},n),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(i<0||i>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ke.RECORD_JOIN_CHANNEL_SERVICE,record:n,index:i}),i)}catch(s){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ke.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(n){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(n){this.dispatch({type:Ke.AVOID_JOIN_START,avoidJoinStart:n})}}const Kr=function(o){if(o.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return o;const n=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(n&&n[1]&&n[2]){const c=n[2];return"".concat(n[1],".").concat(c)}const i=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){const c=i[2];return"".concat(i[1],".").concat(100*(Number(c)+1))}return"4.0.0.999"}("4.19.1"),qC=function(){try{return!0===JSON.parse("true")}catch(o){return!0}}(),nE="v4.19.1-0-g605286cc(10/11/2023, 2:37:03 PM)",ar={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}};function Nt(o,n,i){var s,c;Re(s=Object.keys(ar)).call(s,o)&&(!i&&Re(c=Object.keys(ic)).call(c,o)||(ar[o]=n))}function B(o){return ar[o]}const ic={},Cf=new class extends jt{reportLogUploadError(o){this.emit("REPORT_LOG_UPLOAD",o)}};class iE{constructor(n){C(this,"logger",void 0),C(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.debug(...this.prefixLists,...i)}info(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.info(...this.prefixLists,...i)}warning(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.warning(...this.prefixLists,...i)}error(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];this.logger.error(...this.prefixLists,...i)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function bf(){const o=new Date;return o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}function J1(){const o=new Date,n=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return n?(null==n?void 0:n[0])+":"+o.getUTCMilliseconds():o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}const ho={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},rE=Date.now(),nh=o=>{for(const n in ho)if(Object.prototype.hasOwnProperty.call(ho,n)&&ho[n]===o)return n;return"DEFAULT"},T=new class{constructor(){C(this,"proxyServerURL",void 0),C(this,"logLevel",ho.DEBUG),C(this,"uploadState","collecting"),C(this,"uploadLogWaitingList",[]),C(this,"uploadLogUploadingList",[]),C(this,"uploadErrorCount",0),C(this,"currentLogID",0),C(this,"url",void 0),C(this,"extLog",(o,n)=>{this.appendLogToWaitingList(o,...n)})}debug(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[ho.DEBUG].concat(n);this.log.apply(this,s)}info(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[ho.INFO].concat(n);this.log.apply(this,s)}warning(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[ho.WARNING].concat(n);this.log.apply(this,s)}warn(){this.warning(...arguments)}error(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[ho.ERROR].concat(n);this.log.apply(this,s)}upload(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];const s=[ho.DEBUG].concat(n);this.uploadLog.apply(this,s)}setLogLevel(o){o=Math.min(Math.max(0,o),4),this.logLevel=o}enableLogUpload(){Nt("UPLOAD_LOG",!0)}disableLogUpload(){Nt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(o){this.proxyServerURL=o}prefix(o){return new iE(this).prefix(o)}log(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];if(Date.now()-rE<100)return void setTimeout(()=>{this.log(...n)},Date.now()-rE);const s=Math.max(0,Math.min(4,n[0]));if(n[0]=bf()+" Agora-SDK [".concat(nh(s),"]:"),this.appendLogToWaitingList(s,...n),s<this.logLevel)return;const c=bf()+" %cAgora-SDK [".concat(nh(s),"]:");let d=[];if(!B("USE_NEW_LOG"))switch(s){case ho.DEBUG:d=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,d);break;case ho.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,d);break;case ho.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,d);break;case ho.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];if(Date.now()-rE<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-rE);const s=Math.max(0,Math.min(4,n[0]));n[0]=bf()+" Agora-SDK [".concat(nh(s),"]:"),this.appendLogToWaitingList(s,...n)}appendLogToWaitingList(o){if(!B("UPLOAD_LOG"))return;for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];Array.isArray(i[0])?i[0][0]=J1()+" Agora-SDK [".concat(nh(o),"]:"):i[0]=J1()+" Agora-SDK [".concat(nh(o),"]:");let c="";i.forEach(d=>{"object"==typeof d&&(d=JSON.stringify(d)),c+="".concat(d," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:o,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var o=this;return L(function*(){const n=o.uploadLogUploadingList,i={sdk_version:Kr,process_id:B("PROCESS_ID"),payload:JSON.stringify(n)};return Fs(L(function*(){const s=yield Hn.post(o.url||(o.proxyServerURL?"https://".concat(o.proxyServerURL,"/ls/?h=").concat(B("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(B("LOG_UPLOAD_SERVER"),"/upload/v1")),i,{responseType:"text"});if("OK"!==s.data){const c=new Error("unexpected upload log response");throw c.response=s,c}}),()=>(o.uploadLogUploadingList=[],!1),s=>(Cf.reportLogUploadError(s.response?{status:s.response.status,data:s.response.data,headers:s.response.headers,message:s.message}:s.request?{status:s.request.status,message:s.message}:{status:-1,message:s.message}),!0),{timeout:B("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:B("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})})()}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,B("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_INTERVAL"))}).catch(o=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),B("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var YC,kA;function $C(o){return Ei(o.reportId,"params.reportId",0,100,!1),Ei(o.category,"params.category",0,100,!1),Ei(o.event,"params.event",0,100,!1),Ei(o.label,"params.label",0,100,!1),Dt(o.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(o){o.FREE="free",o.UPLOADING="uploading"})(YC||(YC={})),function(o){o[o.MISC=0]="MISC",o[o.INTERNAL_EVENT=1]="INTERNAL_EVENT",o[o.PUBLIC_EVENT=2]="PUBLIC_EVENT",o[o.WEB_EVENT=3]="WEB_EVENT",o[o.INTERNAL_API=4]="INTERNAL_API",o[o.WEB_API=5]="WEB_API",o[o.PUBLIC_API=6]="PUBLIC_API"}(kA||(kA={}));const XC={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var ii,Kt,MA,JC;function QC(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function He(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?QC(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):QC(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}(function(o){o.PUBLISH="publish",o.SUBSCRIBE="subscribe",o.WS_COMPRESSOR_INIT="ws_compressor_init",o.SESSION_INIT="session_init",o.JOIN_CHOOSE_SERVER="join_choose_server",o.REQ_USER_ACCOUNT="req_user_account",o.JOIN_GATEWAY="join_gateway",o.REJOIN_GATEWAY="rejoin_gateway",o.STREAM_SWITCH="stream_switch",o.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",o.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",o.FIRST_VIDEO_RECEIVED="first_video_received",o.FIRST_AUDIO_RECEIVED="first_audio_received",o.FIRST_VIDEO_DECODE="first_video_decode",o.FIRST_AUDIO_DECODE="first_audio_decode",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_UPDATE_STREAM="on_update_stream",o.ON_REMOVE_STREAM="on_remove_stream",o.USER_ANALYTICS="req_user_analytics",o.PC_STATS="pc_stats"})(ii||(ii={})),function(o){o.SESSION="io.agora.pb.Wrtc.Session",o.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",o.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",o.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",o.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",o.PUBLISH="io.agora.pb.Wrtc.Publish",o.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",o.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",o.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",o.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",o.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",o.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",o.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",o.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",o.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",o.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",o.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",o.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",o.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",o.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",o.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",o.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",o.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",o.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",o.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",o.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",o.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",o.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",o.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",o.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",o.PC_STATS="io.agora.pb.Wrtc.PCStats"}(Kt||(Kt={})),function(o){o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(MA||(MA={})),function(o){o[o.SESSION=26]="SESSION",o[o.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",o[o.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",o[o.JOIN_GATEWAY=28]="JOIN_GATEWAY",o[o.PUBLISH=30]="PUBLISH",o[o.SUBSCRIBE=29]="SUBSCRIBE",o[o.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",o[o.STREAM_SWITCH=32]="STREAM_SWITCH",o[o.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",o[o.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",o[o.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",o[o.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",o[o.API_INVOKE=41]="API_INVOKE",o[o.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",o[o.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",o[o.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",o[o.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",o[o.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",o[o.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",o[o.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",o[o.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",o[o.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",o[o.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",o[o.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",o[o.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",o[o.USER_ANALYTICS=1e4]="USER_ANALYTICS",o[o.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(JC||(JC={}));class ih{constructor(){var n=this;C(this,"baseInfoMap",new Map),C(this,"proxyServer",void 0),C(this,"eventUploadTimer",void 0),C(this,"setSessionIdTimer",void 0),C(this,"url",void 0),C(this,"backupUrl",void 0),C(this,"_appId",void 0),C(this,"keyEventUploadPendingItems",[]),C(this,"normalEventUploadPendingItems",[]),C(this,"apiInvokeUploadPendingItems",[]),C(this,"apiInvokeCount",0),C(this,"ltsList",[]),C(this,"lastSendNormalEventTime",Date.now()),C(this,"customReportCounterTimer",void 0),C(this,"customReportCount",0),C(this,"extApiInvoke",function(){var i=L(function*(s){for(const c of s){const d=He(He({},c),{},{sid:null,invokeId:++n.apiInvokeCount,tag:nn.TRACER});n.sendApiInvoke(d)}});return function(s){return i.apply(this,arguments)}}()),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),B("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),B("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(n){return this.baseInfoMap.get(n)}adjustSessionStartTime(n){if(!this.baseInfoMap.has(n)&&!this.baseInfoMap.get(n))return void T.error("adjust session ".concat(n," start time, sid is not exist or info is undefined"));const i=this.baseInfoMap.get(n),s=Date.now(),c=i.startTime;i.startTime=s,T.debug("rewrite session ".concat(n," startTime: ").concat(s," , ").concat(s-c,"ms")),this.baseInfoMap.set(n,i)}setAppId(n){this._appId=n}reportApiInvoke(n,i,s){i.timeout=i.timeout||6e4,i.reportResult=void 0===i.reportResult||i.reportResult;const c=Date.now();this.apiInvokeCount+=1;const d=this.apiInvokeCount,h=()=>({tag:i.tag,invokeId:d,sid:n,name:i.name,apiInvokeTime:c,options:i.options,states:i.states||null}),p=!!B("SHOW_REPORT_INVOKER_LOG");p&&T.info("".concat(i.name," start"),i.options);let m=!1;pi(i.timeout).then(()=>{m||(this.sendApiInvoke(He(He({},h()),{},{error:k.API_INVOKE_TIMEOUT,success:!1})),T.debug("".concat(i.name," timeout")))});const _=new Q(k.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:E=>{const v=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(He(He({},h()),{},{success:!0},i.reportResult&&{result:E})),p&&T.info("".concat(i.name," onSuccess")),E};return s?Yw(v,i.name+"Success",s,()=>m=!0):v()},onError:E=>{const v=()=>{if(m)throw E;m=!0,this.sendApiInvoke(He(He({},h()),{},{success:!1,error:E})),p&&T.info("".concat(i.name," onFailure"),E.toString())};return s?Yw(v,i.name+"Error",s,()=>m=!0):v()}}}sessionInit(n,i){if(this.baseInfoMap.has(n))return;const s=Date.now(),c=this.createBaseInfo(n,s);c.cname=i.cname;const d=Object.assign({},{willUploadConsoleLog:B("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:qC?"global":"oversea",areas:B("AREAS")&&B("AREAS").join(",")},i.extend),h=Date.now(),p=He(He({},c),{},{eventType:ii.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,build:nE,lts:h,elapse:h-s,extend:JSON.stringify(d),mode:i.mode,process:B("PROCESS_ID"),appType:B("APP_TYPE"),success:!0,version:Kr});this.send({type:Kt.SESSION,data:p},!0)}joinChooseServer(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He({},c),{},{eventType:ii.JOIN_CHOOSE_SERVER,lts:d,eventElapse:d-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:d-s.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3});this.send({type:Kt.JOIN_CHOOSE_SERVER,data:h},!0)}reqUserAccount(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He({},c),{},{eventType:ii.REQ_USER_ACCOUNT,lts:d,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:d-s.startTime,eventElapse:d-i.lts,extend:JSON.stringify(i.extend)});this.send({type:Kt.REQ_USER_ACCOUNT,data:h},!0)}joinGateway(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info;i.vid&&(c.vid=i.vid),c.uid=i.uid,c.cid=i.cid;const d=Date.now(),{firstSuccess:h,avoidJoinStartTime:p,isProxy:m,addr:_}=i,E=d-(h&&p?p:s.startTime),v=He(He({},c),{},{eventType:ii.JOIN_GATEWAY,lts:d,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,elapse:E,eventElapse:d-i.lts,firstSuccess:h,signalChannel:i.signalChannel}),S=v.success?1:0;if(i.succ&&(s.lastJoinSuccessTime=d),h)this.send({type:Kt.JOIN_GATEWAY,data:v},!0);else{let b;if(_)if(m){const P=_.match(/h=(\d{1,3}-){3}\d{1,3}/g),w=_.match(/p=[0-9]{1,6}/g);b={isSuccess:S,gatewayIp:P&&P.length?P[0].split("=")[1].replace(/-/g,"."):"",port:w&&w.length?w[0].split("=")[1]:"",isProxy:m?1:0}}else{const P=_.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),w=_.match(/(:|p=)[0-9]{1,6}/g);b={isSuccess:S,gatewayIp:P&&P.length?P[0].split("//")[1].replace(/-/g,"."):"",port:w&&w.length?w[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else b={isSuccess:S,gatewayIp:"",port:"",isProxy:m?1:0};delete v.success,delete v.eventType,delete v.firstSuccess,v.vid=Number(v.vid);const O=Object.assign({},v,b,{eventType:ii.REJOIN_GATEWAY});this.send({type:Kt.RE_JOIN_GATEWAY,data:O},!0)}}joinChannelTimeout(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=Date.now(),d=He(He({},s.info),{},{lts:c,timeout:i,elapse:c-s.startTime});this.send({type:Kt.JOIN_CHANNEL_TIMEOUT,data:d},!0)}publish(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He({},c),{},{eventType:ii.PUBLISH,lts:d,eventElapse:i.eventElapse,elapse:d-s.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:Kt.PUBLISH,data:h},!0)}subscribe(n,i,s){const c=this.baseInfoMap.get(n);if(!c)return;const d=c.info,h=Date.now(),p=He(He({},d),{},{eventType:ii.SUBSCRIBE,lts:h,eventElapse:i.eventElapse,elapse:h-c.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid},s&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof i.peerid?p.peerSuid=i.peerid:p.peer=i.peerid,this.send({type:Kt.SUBSCRIBE,data:p},!0)}wsCompressorInit(n){var i;const s=[...zr(i=this.baseInfoMap).call(i)],d=this.baseInfoMap.get(s.length?s[0]:"UnableToGetSid");if(!d)return;const h=d.info,p=Date.now(),m=He(He({},h),{},{eventType:ii.WS_COMPRESSOR_INIT,lts:p,eventElapse:n.eventElapse,elapse:p-d.startTime,status:n.status?1:2});this.send({type:Kt.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(n,i,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=He(He(He({},h),c),{},{elapse:p-d.startTime,eventType:i,lts:p,firstDecodeFrame:Math.max(p-d.startTime,0),apEnd:Math.max(c.apEnd-d.startTime,0),apStart:Math.max(c.apStart-d.startTime,0),joinGwEnd:Math.max(c.joinGwEnd-d.startTime,0),joinGwStart:Math.max(c.joinGwStart-d.startTime,0),pcEnd:Math.max(c.pcEnd-d.startTime,0),pcStart:Math.max(c.pcStart-d.startTime,0),subscriberEnd:Math.max(c.subscriberEnd-d.startTime,0),subscriberStart:Math.max(c.subscriberStart-d.startTime,0),videoAddNotify:Math.max(c.videoAddNotify-d.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(n,i,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=He(He(He({},h),c),{},{elapse:p-d.startTime,eventType:i,lts:p});this.send({type:s,data:m},!0)}pcStats(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He(He({},c),i),{},{vid:void 0===c.vid?0:Number(c.vid),elapse:d-s.startTime,eventType:ii.PC_STATS,lts:d});this.send({type:Kt.PC_STATS,data:h},!0)}onGatewayStream(n,i,s,c){const d=this.baseInfoMap.get(n);if(!d)return;const h=d.info,p=Date.now(),m=He(He(He({},h),c),{},{eventType:i,lts:p});this.send({type:s,data:m},!0)}streamSwitch(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He({},c),{},{eventType:ii.STREAM_SWITCH,lts:d,isDual:i.isdual,elapse:d-s.startTime,success:i.succ});this.send({type:Kt.STREAM_SWITCH,data:h},!0)}requestProxyAppCenter(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He({},c),{},{eventType:ii.REQUEST_PROXY_APPCENTER,lts:d,eventElapse:d-i.lts,elapse:d-s.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Kt.REQUEST_PROXY_APPCENTER,data:h},!0)}requestProxyWorkerManager(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He({},c),{},{eventType:ii.REQUEST_PROXY_WORKER_MANAGER,lts:d,eventElapse:d-i.lts,elapse:d-s.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Kt.REQUEST_PROXY_WORKER_MANAGER,data:h},!0)}setProxyServer(n){this.proxyServer=n,T.debug(n?"reportProxyServerurl: ".concat(n):"disable reportProxyServerurl: ".concat(n))}peerPublishStatus(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He({},c),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:d,elapse:d-s.startTime,joinChannelSuccessElapse:d-(s.lastJoinSuccessTime||d),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:Kt.PEER_PUBLISH_STATUS,data:h},!0)}workerEvent(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now();(function(p,m,_){const E=p[m];if(!E||"string"!=typeof E)return[p];p[m]="";const v=Ea(JSON.stringify(p));let S=0;const b=[];let O=0;for(let P=0;P<E.length;P++)O+=E.charCodeAt(P)<=127?1:3,O<=1300-v||(b[b.length]=od(od({},p),{},{[m]:E.substring(S,P)}),S=P,O=E.charCodeAt(P)<=127?1:3);return S!==E.length-1&&(b[b.length]=od(od({},p),{},{[m]:E.substring(S)})),b})(He(He(He({},c),i),{},{elapse:d-s.startTime,lts:d,productType:"WebRTC"}),"payload").forEach(p=>this.send({type:Kt.WORKER_EVENT,data:p},!0))}apworkerEvent(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He(He({},c),i),{},{elapse:d-s.startTime,lts:d});this.send({type:Kt.AP_WORKER_EVENT,data:h},!0)}joinWebProxyAP(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He(He({},c),i),{},{elapse:d-s.startTime,lts:d,extend:i.extend||void 0});this.send({type:Kt.JOIN_WEB_PROXY_AP,data:h},!0)}WebSocketQuit(n,i){const s=this.baseInfoMap.get(n);if(!s)return;const c=s.info,d=Date.now(),h=He(He(He({},c),i),{},{elapse:d-s.startTime,lts:d});this.send({type:Kt.WEBSOCKET_QUIT,data:h},!0)}sendCustomReportMessage(n,i){var s=this;return L(function*(){if(s.customReportCount+=i.length,s.customReportCount>B("CUSTOM_REPORT_LIMIT"))throw new Q(k.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);s.customReportCounterTimer||(s.customReportCounterTimer=window.setInterval(()=>{s.customReportCount=0},5e3));const c=Date.now(),d=i.map(h=>({type:Kt.USER_ANALYTICS,data:He(He({sid:n},h),{},{lts:c})}));try{B("NEW_REPORT_SERVER")?yield s.postDataToStatsCollector2(d):yield s.postDataToStatsCollector(d)}catch(h){throw T.error("send custom report message failed",h.toString()),new Q(k.CUSTOM_REPORT_SEND_FAILED,h.message)}})()}sendApiInvoke(n){const i=B("NOT_REPORT_EVENT");if(n.tag&&Re(i)&&Re(i).call(i,n.tag))return!1;if(null===n.sid)return this.apiInvokeUploadPendingItems.push(n),!1;const s=this.baseInfoMap.get(n.sid);if(!s)return this.apiInvokeUploadPendingItems.push(n),!1;const{cname:c,uid:d,cid:h}=s.info;let p;if(n.lts=n.lts||Date.now(),n.error)if(n.error instanceof Q){const{code:_,message:E}=n.error;p=_||E||n.error.toString()}else p=n.error.toString();const m={invokeId:n.invokeId,sid:n.sid,cname:c,cid:h,uid:d,lts:n.lts,success:n.success,elapse:n.lts-s.startTime,execElapse:n.lts-n.apiInvokeTime,apiName:n.name,options:n.options?JSON.stringify(n.options):void 0,execStates:n.states?JSON.stringify(n.states):void 0,execResult:n.result?JSON.stringify(n.result):void 0,errorCode:n.error?p:void 0,errorMsg:n.error?JSON.stringify(n.error):void 0};return this.send({type:Kt.API_INVOKE,data:m},!1),!0}appendSessionId(){ih.__CLIENT_LIST__.forEach(n=>{if(n._sessionId){const i=this.apiInvokeUploadPendingItems.length;for(let s=0;s<i;s++){const c=this.apiInvokeUploadPendingItems.shift();c&&(c.sid=n._sessionId,this.sendApiInvoke(Object.assign({},c)))}}})}send(n,i){if(i)return this.keyEventUploadPendingItems.push(n),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(n),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(n,i){const s=[],c=[];for(;n.length;){const h=n.shift();s.length<20?s.push(h):c.push(h)}n.push(...c);for(const h of[...s]){var d;-1!==this.ltsList.indexOf(h.data.lts)?(h.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(h.data.lts)):(this.ltsList.push(h.data.lts),wu(d=this.ltsList).call(d,(p,m)=>p-m))}return i||(this.lastSendNormalEventTime=Date.now()),B("ENABLE_EVENT_REPORT")&&s.length&&(B("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((h=>p=>{B("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(h):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(h),this.normalEventUploadPendingItems.length>B("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-B("NORMAL_EVENT_QUEUE_CAPACITY")),T.warning("report: drop normal events"))))})(s)),n}postDataToStatsCollector2(n){var i=this;return L(function*(){mn.networkState===xi.OFFLINE&&(yield z.race([mn.onlineWaiter,pi(2*Ln.maxRetryTimeout)]));const s=h=>{let p=new Uint8Array;return h.forEach(m=>{const _=vC(JSON.stringify(m.data)),E=new ArrayBuffer(5),v=(b=>{let O=0;return Object.entries(Kt).forEach(P=>{let[w,M]=P;M===b.type&&(O=EventNameToID[w])}),O})(m),S=new DataView(E);S.setUint16(0,_.byteLength,!0),S.setUint8(2,255&v),S.setUint8(3,v>>>8&255),S.setUint8(4,v>>>16&255),p=rf(p,new Uint8Array(E)),p=rf(p,_)}),p},c="event";let d=i.proxyServer?"https://".concat(i.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(c):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(c);for(let h=0;h<2;h+=1){1===h&&(d=i.proxyServer?"https://".concat(i.proxyServer,"/rs/?h=").concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(c):"https://".concat(B("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(c));try{yield tE(d,{timeout:1e4,data:s(n),headers:He(He({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},i._appId&&{appid:i._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(p){if(1===h)throw p;continue}return}})()}postDataToStatsCollector(n){var i=arguments,s=this;return L(function*(){let c=i.length>1&&void 0!==i[1]&&i[1];const d={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:n.map(m=>JSON.stringify(m)),vid:(m=>{const _=m&&m.data.sid&&s.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(n[0])};mn.networkState===xi.OFFLINE&&(yield z.race([mn.onlineWaiter,pi(2*Ln.maxRetryTimeout)]));const h=c?"/events/proto-raws":"/events/messages";let p=s.url||(s.proxyServer?"https://".concat(s.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(B("EVENT_REPORT_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(h));for(let m=0;m<2;m+=1){1===m&&(p=s.backupUrl||(s.proxyServer?"https://".concat(s.proxyServer,"/rs/?h=").concat(B("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(B("STATS_COLLECTOR_PORT"),"&d=").concat(h):"https://".concat(B("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(B("STATS_COLLECTOR_PORT")).concat(h)));try{c?yield OA(p,{timeout:1e4,data:d}):yield tE(p,{timeout:1e4,data:d})}catch(_){if(1===m)throw _;continue}return}})()}createBaseInfo(n,i){const s=Object.assign({},XC);return s.sid=n,this.baseInfoMap.set(n,{info:s,startTime:i}),s}reportResourceTiming(n,i){const s=performance.getEntriesByName(n),c=s[s.length-1];c&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:c,tag:nn.TRACER}).onSuccess()}}function Ie(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(n,i,s){const c=s.value;if("function"==typeof c){const d=o.className||n.__className__||("AgoraRTCClient"===n.constructor.name?"Client":n.constructor.name);s.value=function(){for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];let _=p;if(o.argsMap)try{_=o.argsMap(this,...p)}catch(v){T.warning(v),_=[]}try{JSON.stringify(_)}catch(v){T.warning("arguments for method ".concat(d,".").concat(String(i)," not serializable for apiInvoke.")),_=[]}const E=(o.report||ye).reportApiInvoke(this._sessionId||null,{name:"".concat(d,".").concat(String(i)),options:_,tag:nn.TRACER,reportResult:o.reportResult},o.throttleTime);try{const v=c.apply(this,p);return v instanceof z?v.then(S=>(E.onSuccess(o.reportResult&&S),S)).catch(S=>{throw E.onError(S),S}):(E.onSuccess(o.reportResult&&v),v)}catch(v){throw E.onError(v),v}}}return s}}C(ih,"__CLIENT_LIST__",[]);const ye=new ih;Cf.on("REPORT_LOG_UPLOAD",o=>{o.networkState=mn.networkState,ye.reportApiInvoke(null,{name:"logUploadError",options:o,tag:nn.TRACER})});const Q1=["CHINA","GLOBAL"],qr=function(){const o="us".concat("erna","me"),n="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const s=i.join(""),c=[];for(let p=0;p<6;p++)c.push("1");const d=c.join(""),h={};return h[o]=s,h[n]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=qr,qC||(ar.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ar.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ar.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ar.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ar.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ar.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ar.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ar.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ar.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ar.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ar.AREAS=["NORTH_AMERICA","OVERSEA"]);const LA=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],rc=[];function Zc(o,n){return!!n&&rc.some(i=>i.uid===o&&i.channelName===n)}ih.__CLIENT_LIST__=rc;var oE,Sr,rh,Tf,xo,wi,be,qe,de,ve,Yr,Me,Z1,Rf,we,Qn,ya,ZC=_e("Array").values,If=Pc,xA=zi,cU=Cs,eb=ZC,sE=Array.prototype,tb={DOMTokenList:!0,NodeList:!0},Vs=fr(function(o){var n=o.values;return o===sE||cU(sE,o)&&n===sE.values||xA(tb,If(o))?eb:n});function te(o,n,i,s){var c,d=arguments.length,h=d<3?n:null===s?s=Object.getOwnPropertyDescriptor(n,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(o,n,i,s);else for(var p=o.length-1;p>=0;p--)(c=o[p])&&(h=(d<3?c(h):d>3?c(n,i,h):c(n,i))||h);return d>3&&h&&Object.defineProperty(n,i,h),h}function N(o,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(o,n)}(function(o){o.L1T1="L1T1",o.L1T2="L1T2",o.L1T3="L1T3",o.L2T1_KEY="L2T1_KEY",o.L2T2_KEY="L2T2_KEY",o.L2T3_KEY="L2T3_KEY",o.L3T1_KEY="L3T1_KEY",o.L3T2_KEY="L3T2_KEY",o.L3T3_KEY="L3T3_KEY"})(oE||(oE={})),function(o){o.CERTIFICATE="certificate",o.CODEC="codec",o.CANDIDATE_PAIR="candidate-pair",o.LOCAL_CANDIDATE="local-candidate",o.REMOTE_CANDIDATE="remote-candidate",o.INBOUND="inbound-rtp",o.TRACK="track",o.OUTBOUND="outbound-rtp",o.PC="peer-connection",o.REMOTE_INBOUND="remote-inbound-rtp",o.REMOTE_OUTBOUND="remote-outbound-rtp",o.TRANSPORT="transport",o.CSRC="csrc",o.DATA_CHANNEL="data-channel",o.STREAM="stream",o.SENDER="sender",o.RECEIVER="receiver"}(Sr||(Sr={})),function(o){o[o.ACCESS_POINT=101]="ACCESS_POINT",o[o.UNILBS=201]="UNILBS",o[o.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(rh||(rh={})),function(o){o[o.IIIEGAL_APPID=1]="IIIEGAL_APPID",o[o.IIIEGAL_UID=2]="IIIEGAL_UID",o[o.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Tf||(Tf={})),function(o){o[o.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",o[o.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",o[o.INTERNAL_ERROR=8]="INTERNAL_ERROR",o[o.NO_AUTHORIZED=9]="NO_AUTHORIZED",o[o.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",o[o.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",o[o.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",o[o.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",o[o.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",o[o.USER_OVERLOAD=16]="USER_OVERLOAD",o[o.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",o[o.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(xo||(xo={})),function(o){o[o.NO_FLAG_SET=100]="NO_FLAG_SET",o[o.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",o[o.INVALID_FALG_SET=102]="INVALID_FALG_SET",o[o.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",o[o.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",o[o.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",o[o.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",o[o.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",o[o.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",o[o.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",o[o.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",o[o.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",o[o.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",o[o.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",o[o.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",o[o.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",o[o.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",o[o.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",o[o.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(wi||(wi={})),function(o){o[o.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",o[o.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",o[o.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",o[o.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",o[o.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",o[o.K_TICKET_INVALID=7]="K_TICKET_INVALID",o[o.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",o[o.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",o[o.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",o[o.K_UID_BANNED=14]="K_UID_BANNED",o[o.K_IP_BANNED=15]="K_IP_BANNED",o[o.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",o[o.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",o[o.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",o[o.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",o[o.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",o[o.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",o[o.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",o[o.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",o[o.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",o[o.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",o[o.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",o[o.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",o[o.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",o[o.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",o[o.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",o[o.ERR_INVALID_UID=117]="ERR_INVALID_UID",o[o.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",o[o.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",o[o.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",o[o.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",o[o.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",o[o.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",o[o.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",o[o.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",o[o.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",o[o.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",o[o.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",o[o.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",o[o.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",o[o.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",o[o.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",o[o.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",o[o.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",o[o.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",o[o.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",o[o.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",o[o.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",o[o.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",o[o.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",o[o.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",o[o.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",o[o.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",o[o.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",o[o.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",o[o.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",o[o.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",o[o.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",o[o.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",o[o.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",o[o.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",o[o.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",o[o.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",o[o.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(be||(be={})),function(o){o.CONNECTING="connecting",o.CONNECTED="connected",o.RECONNECTING="reconnecting",o.CLOSED="closed"}(qe||(qe={})),function(o){o.WS_CONNECTED="ws_connected",o.WS_RECONNECTING="ws_reconnecting",o.WS_CLOSED="ws_closed",o.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",o.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",o.ON_BINARY_DATA="on_binary_data",o.REQUEST_RECOVER="request_recover",o.REQUEST_JOIN_INFO="request_join_info",o.REQUEST_REJOIN_INFO="req_rejoin_info",o.IS_P2P_DISCONNECTED="is_p2p_dis",o.DISCONNECT_P2P="dis_p2p",o.ABORT_P2P_EXECUTION="abort_p2p_execution",o.NEED_RENEW_SESSION="need-sid",o.REPORT_JOIN_GATEWAY="report_join_gateway",o.REQUEST_TIMEOUT="request_timeout",o.REQUEST_SUCCESS="request_success",o.JOIN_RESPONSE="join_response",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_CONNECTING="datachannel_connecting",o.DATACHANNEL_FAILBACK="datachannel_failback",o.P2P_START="p2p_start",o.P2P_CONNECTION="p2p_connection",o.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",o.P2P_SUBSCRIBE="p2p_subscribe",o.P2P_UNSUBSCRIBE="p2p_unsubscribe",o.P2P_EXCHANGE_SDP="p2p_exchange_sdp",o.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",o.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(de||(de={})),function(o){o.PING="ping",o.PING_BACK="ping_back",o.JOIN="join_v3",o.REJOIN="rejoin_v3",o.LEAVE="leave",o.SET_CLIENT_ROLE="set_client_role",o.PUBLISH="publish",o.PUBLISH_DATASTREAM="publish_datastream",o.UNPUBLISH="unpublish",o.UNPUBLISH_DATASTREAM="unpublish_datastream",o.SUBSCRIBE="subscribe",o.SUBSCRIBE_DATASTREAM="subscribe_datastream",o.SUBSCRIBE_STREAMS="subscribe_streams",o.UNSUBSCRIBE="unsubscribe",o.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",o.UNSUBSCRIBE_STREAMS="unsubscribe_streams",o.SUBSCRIBE_CHANGE="subscribe_change",o.TRAFFIC_STATS="traffic_stats",o.RENEW_TOKEN="renew_token",o.SWITCH_VIDEO_STREAM="switch_video_stream",o.DEFAULT_VIDEO_STREAM="default_video_stream",o.SET_FALLBACK_OPTION="set_fallback_option",o.GATEWAY_INFO="gateway_info",o.CONTROL="control",o.SEND_METADATA="send_metadata",o.DATA_STREAM="data_stream",o.PICK_SVC_LAYER="pick_svc_layer",o.RESTART_ICE="restart_ice",o.CONNECT_PC="connect_pc",o.SET_VIDEO_PROFILE="set_video_profile",o.SET_PARAMETER="set_parameter",o.SET_RTM2_FLAG="set_rtm2_flag"}(ve||(ve={})),function(o){o.PUBLISH_STATS="publish_stats",o.PUBLISH_RELATED_STATS="publish_related_stats",o.SUBSCRIBE_STATS="subscribe_stats",o.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",o.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",o.DENOISER_STATS="denoiser_stats",o.TRANSPORT_STATS="transport_stats",o.EXTENSION_USAGE_STATS="extension_usage_stats"}(Yr||(Yr={})),function(o){o.ON_USER_ONLINE="on_user_online",o.ON_USER_OFFLINE="on_user_offline",o.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",o.ON_PUBLISH_STREAM="on_publish_stream",o.ON_UPLINK_STATS="on_uplink_stats",o.ON_P2P_LOST="on_p2p_lost",o.ON_REMOVE_STREAM="on_remove_stream",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",o.ON_USER_BANNED="on_user_banned",o.ON_USER_LICENSE_BANNED="on_user_license_banned",o.ON_NOTIFICATION="on_notification",o.ON_CRYPT_ERROR="on_crypt_error",o.MUTE_AUDIO="mute_audio",o.MUTE_VIDEO="mute_video",o.UNMUTE_AUDIO="unmute_audio",o.UNMUTE_VIDEO="unmute_video",o.ON_P2P_OK="on_p2p_ok",o.RECEIVE_METADATA="receive_metadata",o.ON_DATA_STREAM="on_data_stream",o.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",o.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",o.ENABLE_LOCAL_VIDEO="enable_local_video",o.DISABLE_LOCAL_VIDEO="disable_local_video",o.ENABLE_LOCAL_AUDIO="enable_local_audio",o.DISABLE_LOCAL_AUDIO="disable_local_audio",o.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Me||(Me={})),function(o){o.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",o.NEED_ANSWER="NEED_ANSWER",o.NEED_RENEGOTIATE="NEED_RENEGOTIATE",o.P2P_LOST="P2P_LOST",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NEED_UNPUB="NEED_UNPUB",o.NEED_UNSUB="NEED_UNSUB",o.NEED_UPLOAD="NEED_UPLOAD",o.NEED_CONTROL="NEED_CONTROL",o.START_RECONNECT="START_RECONNECT",o.END_RECONNECT="END_RECONNECT",o.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(Z1||(Z1={})),function(o){o.SEND_ONLY="SEND_ONLY",o.RECEIVE_ONLY="RECEIVE_ONLY"}(Rf||(Rf={})),function(o){o.CONNECTED="websocket:connected",o.RECONNECTING="websocket:reconnecting",o.WILL_RECONNECT="websocket:will_reconnect",o.CLOSED="websocket:closed",o.FAILED="websocket:failed",o.ON_MESSAGE="websocket:on_message",o.REQUEST_NEW_URLS="websocket:request_new_urls",o.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(we||(we={}));class W extends Q{constructor(n){super(n,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),C(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",T)}throw(){super.throw(T)}}function Bs(o){if("string"!=typeof o||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(o))throw T.error("Invalid Channel Name ".concat(o)),new W(k.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function nb(o){if(!("number"==typeof(n=o)&&Math.floor(n)===n&&0<=n&&n<=4294967295||Vw(o,1,255)))throw new W(k.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;"string"==typeof o&&T.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(o){o.TRANSCODE="mix_streaming",o.RAW="raw_streaming",o.INJECT="inject_streaming"})(Qn||(Qn={})),function(o){o[o.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",o[o.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",o[o.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",o[o.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",o[o.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",o[o.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",o[o.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",o[o.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",o[o.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(ya||(ya={}));const lU={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},FA={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function UA(o,n){Ei(o.url,"".concat(n,".url"),1,1e3,!1),Jt(o.x)||Dt(o.x,"".concat(n,".x"),0,1e4),Jt(o.y)||Dt(o.y,"".concat(n,".y"),0,1e4),Jt(o.width)||Dt(o.width,"".concat(n,".width"),0,1e4),Jt(o.height)||Dt(o.height,"".concat(n,".height"),0,1e4),Jt(o.zOrder)||Dt(o.zOrder,"".concat(n,".zOrder"),0,255),Jt(o.alpha)||Dt(o.alpha,"".concat(n,".alpha"),0,1,!1)}const eL={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},VA={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var rs,wf,In,aE,Ui,yt,cr,Sa,bt,ln,oc,Fn,Af,it;function cE(o){if(!o.channelName)throw new W(k.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof o.uid)throw new W(k.INVALID_PARAMS,"invalid uid in info, uid must be a number");return o.token&&Ei(o.token,"info.token",1,2047),nb(o.uid),Bs(o.channelName),!0}(function(o){o.WARNING="@live_uap-warning",o.ERROR="@line_uap-error",o.PUBLISH_STREAM_STATUS="@live_uap-publish-status",o.INJECT_STREAM_STATUS="@live_uap-inject-status",o.WORKER_STATUS="@live_uap-worker-status",o.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(rs||(rs={})),function(o){o.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(wf||(wf={})),function(o){o[o.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",o[o.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",o[o.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",o[o.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",o[o.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",o[o.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",o[o.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",o[o.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",o[o.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",o[o.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",o[o.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",o[o.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",o[o.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",o[o.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",o[o.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",o[o.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(In||(In={})),function(o){o.CONNECT_FAILED="connect failed",o.CONNECT_TIMEOUT="connect timeout",o.WS_DISCONNECTED="websocket disconnected",o.REQUEST_TIMEOUT="request timeout",o.REQUEST_FAILED="request failed",o.WAIT_STATUS_TIMEOUT="wait status timeout",o.WAIT_STATUS_ERROR="wait status error",o.BAD_STATE="bad state",o.WS_ABORT="ws abort",o.AP_REQUEST_TIMEOUT="AP request timeout",o.AP_JSON_PARSE_ERROR="AP json parse error",o.AP_REQUEST_ERROR="AP request error",o.AP_REQUEST_ABORT="AP request abort"}(aE||(aE={})),function(o){o[o.SetSdkProfile=0]="SetSdkProfile",o[o.SetSourceChannel=1]="SetSourceChannel",o[o.SetSourceUserId=2]="SetSourceUserId",o[o.SetDestChannel=3]="SetDestChannel",o[o.StartPacketTransfer=4]="StartPacketTransfer",o[o.StopPacketTransfer=5]="StopPacketTransfer",o[o.UpdateDestChannel=6]="UpdateDestChannel",o[o.Reconnect=7]="Reconnect",o[o.SetVideoProfile=8]="SetVideoProfile"}(Ui||(Ui={})),function(o){o.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",o.NETWORK_CONNECTED="NETWORK_CONNECTED",o.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",o.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",o.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",o.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",o.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",o.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",o.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",o.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(yt||(yt={})),function(o){o.RELAY_STATE_IDLE="RELAY_STATE_IDLE",o.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",o.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",o.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(cr||(cr={})),function(o){o.RELAY_OK="RELAY_OK",o.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",o.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",o.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Sa||(Sa={})),function(o){o.High="high",o.Low="low",o.Audio="audio",o.Screen="screen",o.ScreenLow="screen_low"}(bt||(bt={})),function(o){o.DISCONNECT="disconnect",o.CONNECTION_STATE_CHANGE="connection-state-change",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGE="stream-type-change",o.IS_P2P_DISCONNECTED="is-p2p-dis",o.DISCONNECT_P2P="dis-p2p",o.REQUEST_NEW_GATEWAY_LIST="req-gate-url",o.NEED_RENEW_SESSION="need-sid",o.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",o.JOIN_RESPONSE="join-response",o.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",o.RESET_CONNECTION_EVENTS="reset-connection-events",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_FAILBACK="datachannel_failback",o.RESET_SIGNAL="reset-signal"}(ln||(ln={})),function(o){o.P2P_DISCONNECTED="P2P_DISCONNECTED",o.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",o.TIMEOUT="TIMEOUT",o.UNKNOWN_REASON="UNKNOWN_REASON"}(oc||(oc={})),function(o){o[o.Nothing=0]="Nothing",o[o.Audio=1]="Audio",o[o.LwoVideo=2]="LwoVideo",o[o.Video=4]="Video",o[o.Data=8]="Data",o[o.DataStream0=256]="DataStream0",o[o.DataStream1=512]="DataStream1",o[o.DataStream2=1024]="DataStream2",o[o.DataStream3=2048]="DataStream3",o[o.DataStream4=4096]="DataStream4",o[o.DataStream5=8192]="DataStream5",o[o.DataStream6=16384]="DataStream6",o[o.DataStream7=32768]="DataStream7"}(Fn||(Fn={})),function(o){o[o.websocket=0]="websocket",o[o.datachannel=1]="datachannel"}(Af||(Af={})),function(o){o.CHINA="CHINA",o.ASIA="ASIA",o.NORTH_AMERICA="NORTH_AMERICA",o.EUROPE="EUROPE",o.JAPAN="JAPAN",o.INDIA="INDIA",o.KOREA="KOREA",o.HKMC="HKMC",o.US="US",o.OCEANIA="OCEANIA",o.SOUTH_AMERICA="SOUTH_AMERICA",o.AFRICA="AFRICA",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="EXTENSIONS"}(it||(it={}));const BA=[it.AFRICA,it.ASIA,it.CHINA,it.EUROPE,it.GLOBAL,it.INDIA,it.JAPAN,it.NORTH_AMERICA,it.OCEANIA,it.OVERSEA,it.SOUTH_AMERICA];var fi;!function(o){o.CHINA="CN",o.ASIA="AS",o.NORTH_AMERICA="NA",o.EUROPE="EU",o.JAPAN="JP",o.INDIA="IN",o.KOREA="KR",o.HKMC="HK",o.US="US",o.OCEANIA="OC",o.SOUTH_AMERICA="SA",o.AFRICA="AF",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="GLOBAL"}(fi||(fi={}));const lE={CHINA:{},ASIA:{CODE:fi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:fi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:fi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:fi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:fi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:fi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:fi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:fi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:fi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:fi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:fi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:fi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:fi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var ud,el,fe,Si,js,ne,rt,Te,jA,$r,po,Wn,sc,dn,os,HA,Xr,fo,ss,Pt,Hs,GA;qC&&(lE.CHINA={CODE:fi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(o){o.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(ud||(ud={}));class ib extends jt{constructor(n,i){super(),C(this,"onICEConnectionStateChange",void 0),C(this,"onConnectionStateChange",void 0),C(this,"onDTLSTransportStateChange",void 0),C(this,"onDTLSTransportError",void 0),C(this,"onICETransportStateChange",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoReceived",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0)}}class Df extends ib{constructor(n,i){super(n,i)}}(function(o){o.SEND="sendonly",o.RECV="recvonly",o.SENDRECV="sendrecv",o.INACTIVE="inactive"})(el||(el={})),function(o){o.VIDEO="video",o.AUDIO="audio"}(fe||(fe={})),function(o){o[o.UDP=0]="UDP",o[o.TCP=1]="TCP",o[o.RELAY=2]="RELAY"}(Si||(Si={})),function(o){o[o.FIRST_CONNECTION=0]="FIRST_CONNECTION",o[o.TCP_RESTART=1]="TCP_RESTART",o[o.RELAY_RESTART=2]="RELAY_RESTART",o[o.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",o[o.OLD_RESTART=11]="OLD_RESTART",o[o.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(js||(js={})),function(o){o.LocalVideoTrack="videoTrack",o.LocalAudioTrack="audioTrack",o.LocalVideoLowTrack="videoLowTrack"}(ne||(ne={})),function(o){o.New="new",o.Connected="connected",o.Reconnecting="reconnecting",o.Disconnected="disconnected"}(rt||(rt={})),function(o){o.StateChange="stateChange",o.IceConnectionStateChange="iceConnectionStateChange",o.RequestMuteLocal="requestMuteLocal",o.RequestUnmuteLocal="requestUnmuteLocal",o.RequestRePublish="requestRePublish",o.RequestRePublishDataChannel="requestRePublishDataChannel",o.RequestReSubscribe="requestReSubscribe",o.RequestUploadStats="requestUploadStats",o.MediaReconnectStart="MediaReconnectStart",o.MediaReconnectEnd="MediaReconnectEnd",o.NeedSignalRTT="NeedSignalRTT",o.RequestRestartICE="RequestRestartIce",o.PeerConnectionStateChange="PeerConnectionStateChange",o.RequestReconnect="RequestReconnect",o.RequestReconnectPC="RequestReconnectPC",o.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",o.P2PLost="P2PLost",o.UpdateVideoEncoder="UpdateVideoEncoder",o.ConnectionTypeChange="ConnectionTypeChange",o.RequestLowStreamParameter="RequestLowStreamParameter",o.QueryClientConnectionState="QueryClientConnectionState",o.LocalCandidate="LocalCandidate",o.RequestP2PMuteLocal="requestP2PMuteLocal",o.RequestP2PPublish="RequestP2PPublish",o.RequestP2PUnPublish="RequestP2PUnPublish",o.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",o.RequestP2PMuteRemote="RequestP2PMuteRemote",o.RequestP2PRestartICE="RequestP2PRestartICE"}(Te||(Te={})),function(o){o.MUTE_LOCAL_VIDEO="mute_local_video",o.MUTE_LOCAL_AUDIO="mute_local_audio",o.UNMUTE_LOCAL_VIDEO="unmute_local_video",o.UNMUTE_LOCAL_AUDIO="unmute_local_audio",o.MUTE_REMOTE_VIDEO="mute_remote_video",o.MUTE_REMOTE_AUDIO="mute_remote_audio",o.UNMUTE_REMOTE_VIDEO="unmute_remote_video",o.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(jA||(jA={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}($r||($r={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(po||(po={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Wn||(Wn={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(sc||(sc={})),function(o){o.CONNECTED="transmitter:connected",o.RECONNECTING="transmitter:reconnecting",o.WILL_RECONNECT="transmitter:will_reconnect",o.CLOSED="transmitter:closed",o.FAILED="transmitter:failed",o.ON_MESSAGE="transmitter:on_message",o.REQUEST_NEW_URLS="transmitter:request_new_urls",o.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",o.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",o.FAILBACK="transmitter:failback"}(dn||(dn={})),function(o){o.CAMERA_CHANGED="camera-changed",o.MICROPHONE_CHANGED="microphone-changed",o.PLAYBACK_DEVICE_CHANGED="playback-device-changed",o.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",o.AUTOPLAY_FAILED="autoplay-failed",o.SECURITY_POLICY_VIOLATION="security-policy-violation"}(os||(os={})),function(o){o[o.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",o[o.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",o[o.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",o[o.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",o[o.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",o[o.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",o[o.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",o[o.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",o[o.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",o[o.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",o[o.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",o[o.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",o[o.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",o[o.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",o[o.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",o[o.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",o[o.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",o[o.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",o[o.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",o[o.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(HA||(HA={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}(Xr||(Xr={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(fo||(fo={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(ss||(ss={})),function(o){o.CALL="call",o.CANDIDATE="candidate",o.PUBLISH="publish",o.UNPUBLISH="unpublish",o.SUBSCRIBE="subscribe",o.UNSUBSCRIBE="unsubscribe",o.CONTROL="control",o.RESTART_ICE="restart_ice",o.ACK="ack",o.JOIN="join",o.EXCHANGE_SDP="exchange_sdp",o.DO_SUBSCRIBE="do_subscribe",o.DO_UNSUBSCRIBE="do_unsubscribe"}(Pt||(Pt={})),function(o){o.MUTE_LOCAL_AUDIO="mute_local_audio",o.MUTE_LOCAL_VIDEO="mute_local_video",o.UNMUTE_LOCAL_AUDIO="unmute_local_audio",o.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(Hs||(Hs={})),function(o){o[o.SUCCESS=1]="SUCCESS",o[o.FAILED=0]="FAILED"}(GA||(GA={}));const dU={[rh.ACCESS_POINT]:{[wi.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[wi.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[wi.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[wi.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[wi.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[wi.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[wi.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[rh.UNILBS]:{[xo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[xo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[xo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[xo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[xo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[xo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[xo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[xo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[xo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[xo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[xo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[xo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[rh.STRING_UID_ALLOCATOR]:{[Tf.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Tf.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Tf.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function dE(o){const n=dU[Math.floor(o/1e4)];if(!n)return{desc:"unkonw error",retry:!1};const i=n[o%1e4];if(!i){if(Math.floor(o/1e4)===rh.ACCESS_POINT){const s=o%1e4;if("1"===s.toString()[0])return{desc:o.toString(),retry:!1};if("2"===s.toString()[0])return{desc:o.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return i}const uU={[be.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[be.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[be.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[be.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[be.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[be.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[be.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[be.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[be.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[be.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[be.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[be.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[be.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[be.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[be.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[be.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[be.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[be.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[be.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[be.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[be.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[be.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[be.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[be.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[be.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[be.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[be.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[be.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[be.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[be.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[be.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[be.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[be.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[be.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[be.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[be.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[be.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[be.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[be.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[be.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[be.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[be.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[be.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[be.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[be.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[be.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[be.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[be.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[be.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[be.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[be.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[be.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[be.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[be.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[be.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[be.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[be.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[be.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[be.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[be.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[be.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[be.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[be.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function oh(o){return uU[o]||{desc:"UNKNOW_ERROR_".concat(o),action:"failed"}}function rb(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Fo(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?rb(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):rb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function WA(o){return o.every(n=>n.readyState===WebSocket.CLOSED||n.readyState===WebSocket.CLOSING)}function zA(o,n){if("string"==typeof o)return o;const{proxy:i,host:s,port:c}=o;if(n){const d=B("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===d?"wss://".concat(s,"/ws/?p=").concat(Number(c)+150):"wss://".concat(s,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(s,"&p=").concat(c):"wss://".concat(s,":").concat(c)}const hU=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,pU=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,fU=/wss:\/\/(.+):([0-9]+)\/?/,mU=/wss:\/\/(.[^\/]+)\/?/;let _U=0;class tL{constructor(n,i){C(this,"id",0),C(this,"store",void 0),C(this,"recordIndex",void 0),C(this,"websockets",[]),C(this,"try443PortDuration",2e3),C(this,"forceCloseWSDuration",5e3),C(this,"try443PortTimeout",null),C(this,"forceCloseTimeout",null),C(this,"isTry443PortFailed",!1),C(this,"isNormalPortFailed",!1),C(this,"useDoubleDomain",!1),C(this,"useProxy",!1),C(this,"startTime",Date.now()),this.id=++_U,this.try443PortDuration=B("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var n;const i=Date.now()-this.startTime;for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];T.debug("[choose-best-ws ".concat(null===(n=this.store)||void 0===n?void 0:n.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(n,i,s){this.logger("createWebSocket:",n,{isTry443Port:i,hasTimeoutDetection:s});const c=B("GATEWAY_DOMAINS"),d=Date.now(),h=[],p=c.find(E=>{var v;return Re(v=n.host).call(v,E)});p||(this.useDoubleDomain=!1);const m=[];if(this.useDoubleDomain)c.forEach(E=>{m.push(zA(Fo(Fo({},n),{},{host:n.host.replace(p,E)}),i))});else{const E=Fo({},n);if(i&&p){const v=c.find(S=>S!==p);v&&(E.host=E.host.replace(p,v))}m.push(zA(E,i))}try{m.forEach(E=>{const v=new WebSocket(E);v.binaryType="arraybuffer",h.push(v),this.logger("ws is connecting:",v.url)})}catch(E){if(this.logger("ws create failed"),h.forEach(v=>v.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,i,s);if(!i&&443!==Number(n.port))return this.createWebSocket(n,!0,s);throw new W(k.WS_ERR,"init websocket failed! Error: ".concat(E.toString()))}const _=Qp();return this.store&&this.store.recordJoinChannelService({urls:h.map(E=>E.url),service:"gateway"},this.recordIndex),h.forEach(E=>{E.onopen=()=>{this.logger("onopen: ws ".concat(E.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach(v=>{v!==E&&(v.onopen=null,v.onclose=null,v.onmessage=null,v.close(),this.logger("close backup websocket: ".concat(v.url)))}),this.websockets.length=0,_.resolve(E)},E.onclose=v=>{this.logger("onclose: ws ".concat(E.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(E.readyState)),i?this.isTry443PortFailed=WA(h):this.isNormalPortFailed=WA(h),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(i&&this.isTry443PortFailed||!i&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(v.reason)),_.reject({code:v.code,reason:oc.A_ROUND_WS_FAILED}))},E.onmessage=v=>this.logger("".concat(E.url," onmessage: ").concat(v.data))}),this.websockets.push(...h),s||(()=>{const E=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.websockets.forEach(v=>v.readyState!==WebSocket.OPEN&&v.close())};if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",_.isResolved),_.isResolved)return E();lt().os===ti.MAC_OS&&Bt()&&E(),this.createWebSocket(n,!0,!0).then(v=>_.resolve(v)).catch(v=>{this.isNormalPortFailed&&_.reject(v),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(E,this.forceCloseWSDuration)},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(n,i,s,c){return this.useDoubleDomain=!!i,"string"==typeof n&&(n=function(d){let h,p,m;return[,h,p,m]=d.match(hU)||[],h||([,p,m]=d.match(pU)||[]),p&&m||([,p,m]=d.match(fU)||[]),p&&m||([,p]=d.match(mU)||[]),p||T.warning("un-destructible url: ",d),{proxy:h,host:p,port:m||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,s&&this.useProxy&&(T.warn("cannot use 443 only when use proxy"),s=!1),this.createWebSocket(n,!!s,!1).finally(()=>this.clearTimeout())}}function Of(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}class KA extends jt{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;Re(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,"reconnecting"===this._state?this.emit(we.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(we.CONNECTED):"closed"===this._state?this.emit(we.CLOSED):"failed"===this._state&&this.emit(we.FAILED))}resetReconnectCount(n){T.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,i){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"urls",[]),C(this,"_reconnectMode","tryNext"),C(this,"reconnectReason",void 0),C(this,"_initMutex",new ni("websocket")),C(this,"name",void 0),C(this,"_state","closed"),C(this,"reconnectInterrupter",void 0),C(this,"websocket",void 0),C(this,"retryConfig",void 0),C(this,"reconnectCount",0),C(this,"forceCloseTimeout",5e3),C(this,"onlineReconnectListener",void 0),C(this,"useCompress",void 0),C(this,"tryDoubleDomain",!1),C(this,"use443PortOnly",!1),C(this,"wsInflateLength",0),C(this,"wsDeflateLength",0),C(this,"closeEstablishingWs",()=>{}),C(this,"store",void 0),C(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(v){for(var S=1;S<arguments.length;S++){var b=null!=arguments[S]?arguments[S]:{};S%2?Of(Object(b),!0).forEach(function(O){C(v,O,b[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(b)):Of(Object(b)).forEach(function(O){Object.defineProperty(v,O,Object.getOwnPropertyDescriptor(b,O))})}return v}({},i),this.useCompress=s,this.tryDoubleDomain=c,this.use443PortOnly=d;const{timeout:p,timeoutFactor:m}=i,_=Math.max(300,Math.floor(3*p/5)),E=Math.max(1.2,Math.floor(8*m)/10);xi.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=E),mn.on(tc.NETWORK_STATE_CHANGE,(v,S)=>{v!==S&&(this.resetReconnectCount("network state change: ".concat(S," -> ").concat(v)),v===xi.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=E):(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}init(n){var i=arguments,s=this;return L(function*(){let c=i.length>1&&void 0!==i[1]?i[1]:5e3;const d=yield s._initMutex.lock();s.forceCloseTimeout=c,s.urls=n,s.state="connecting";try{const h=Qp();s.createWebSocketConnection(s.urls[s.currentURLIndex]).then(h.resolve).catch(h.reject),s.once(we.CLOSED,()=>{h.reject(new Q(k.WS_DISCONNECT))}),s.once(we.CONNECTED,h.resolve),yield h.promise}catch(h){}finally{d()}})()}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const s=this.websocket;i?setTimeout(()=>s.close(),500):s.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,i){if(!this.websocket)return void T.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==n&&(this.reconnectMode=n),T.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const s=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),s&&s.bind(this.websocket)({code:9999,reason:i})}sendMessage(n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Q(k.WS_ABORT,"websocket is not ready");try{i||(n=JSON.stringify(n)),this.websocket.send(n)}catch(s){throw new Q(k.WS_ERR,"send websocket message error"+s.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}createWebSocketConnection(n){var i=this;return L(function*(){var s;const c=Qp();i.connectionID+=1,i.joinGatewayRecordIndex=void 0;const d=v=>{var S;null===(S=i.store)||void 0===S||S.signalChannelOpen(),T.debug("[".concat(i.name,"] websocket opened:"),v),i.reconnectMode="retry",i.state="connected",i.resetReconnectCount("opened"),c.resolve()},h=function(){var v=L(function*(S){var b;if(T.debug("[".concat(i.name,"] websocket close ").concat(null===(b=i.websocket)||void 0===b?void 0:b.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(i.reconnectMode)),i.reconnectCount>=i.retryConfig.maxRetryCount)c.reject(new Q(k.WS_DISCONNECT,"websocket close: ".concat(S.code))),i.close();else{"connected"===i.state&&(i.reconnectReason=S.reason,i.state="reconnecting");const O=lo(i,we.WILL_RECONNECT,i.reconnectMode,S.reason)||i.reconnectMode,P=yield i.reconnectWithAction(O);if("closed"===i.state)return void T.debug("[".concat(i.connectionID,"] ws is closed, no need to reconnect"));if(!P)return c.reject(new Q(k.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),i.close(!0);c.resolve()}});return function(b){return v.apply(this,arguments)}}(),p=v=>{i.emit(we.ON_MESSAGE,v)},m=v=>{T.warn("[".concat(i.connectionID,"] ws open error ").concat(v))};i.websocket&&(i.websocket.onclose=null,i.websocket.close()),B("GATEWAY_WSS_ADDRESS")&&i.name.startsWith("gateway")&&(n=B("GATEWAY_WSS_ADDRESS")),T.debug("[".concat(i.name,"] start connect, url:"),n);const _=null===(s=i.store)||void 0===s?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const v=yield i.chooseBestWebsocketConnection(n);i.websocket=v,d&&d(i.websocket.url),i.websocket.onclose=h,i.websocket.onmessage=p,i.websocket.onerror=m,null===(E=i.store)||void 0===E||E.recordJoinChannelService({endTs:Date.now(),status:"success"},_),i.joinGatewayRecordIndex=_}catch(v){const S="closed"===i.state,b=v instanceof Q,O=b&&v.code===k.WS_ABORT,P=b&&v.code===k.WS_ERR,w=b?v.message:v&&(v.reason||v.toString());T.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(w)),i.store&&i.store.recordJoinChannelService({endTs:Date.now(),status:O?"aborted":"error",errors:[v]},_),S||P?(c.reject(S?new Q(k.WS_DISCONNECT,"websocket is closed: ".concat(w)):new Q(k.WS_ERR,"init websocket failed: ".concat(w))),P&&T.error("[".concat(i.name,"] init websocket failed: ").concat(w))):h&&h(v)}return c.promise})()}reconnectWithAction(n){var i=arguments,s=this;return L(function*(){let c=!(i.length>1&&void 0!==i[1])||i[1];if(s.reconnectCount>=s.retryConfig.maxRetryCount||0===s.urls.length||"closed"===s.state)return!1;T.warning("[choose-best-ws] action: =>",n),s.onlineReconnectListener||mn.isOnline||!mn.onlineWaiter||(s.onlineReconnectListener=mn.onlineWaiter.then(()=>{s.onlineReconnectListener=void 0}));let d=!0;if(s.reconnectInterrupter=()=>d=!1,c){const m=qu(s.reconnectCount,s.retryConfig);T.debug("[".concat(s.name,"] wait ").concat(m,"ms to reconnect websocket, mode: ").concat(n)),yield z.race([pi(m),s.onlineReconnectListener||new z(()=>{})])}if("closed"===s._state||!d)return!1;s.reconnectCount+=1;const h=function(){var m=L(function*(_,E){s.emit(we.RECONNECT_CREATE_CONNECTION,E),yield s.createWebSocketConnection(_)});return function(E,v){return m.apply(this,arguments)}}();try{if("retry"===n)s.emit(we.RECONNECT_WAITTING_FINISH,n),yield h(s.urls[s.currentURLIndex],n);else if("tryNext"===n){if(s.currentURLIndex+=1,s.currentURLIndex>=s.urls.length)return s.reconnectWithAction("recover",!1);T.debug("[".concat(s.name,"] websocket url length: ").concat(s.urls.length," current index: ").concat(s.currentURLIndex)),s.emit(we.RECONNECT_WAITTING_FINISH,n),yield h(s.urls[s.currentURLIndex],n)}else"recover"===n&&(T.debug("[".concat(s.name,"] request new urls")),s.resetReconnectCount("recover mode"),s.emit(we.RECONNECT_WAITTING_FINISH,n),s.urls=yield cn(s,we.REQUEST_NEW_URLS),s.currentURLIndex=0,yield h(s.urls[s.currentURLIndex],n))}catch(m){var p;T.error("[".concat(s.name,"] reconnect failed ").concat(m&&m.toString()));const _=null==m||null===(p=m.data)||void 0===p?void 0:p.desc;return Array.isArray(_)&&Re(_).call(_,"dynamic key expired")?(s.emit(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):s.reconnectWithAction(n,c)}return!0})()}}class Nf extends KA{constructor(n,i){super(n,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(n,i){var s=this;return L(function*(){const c=Qp(),d=new tL(s.forceCloseTimeout,s.store);s.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),d.closeAllWebsockets(),c.reject(new Q(k.WS_ABORT,"choose best websocket aborted"))};const h=B("GATEWAY_DOMAINS");return T.debug("[choose-best-ws] currentDomain: ",n,", domains: ",h,"total: ".concat(s.urls.length),"current: ".concat(s.currentURLIndex+1)),d.chooseBestWebsocket(n,s.tryDoubleDomain,s.use443PortOnly,i).then(c.resolve).catch(c.reject),c.promise.finally(()=>{s.closeEstablishingWs=void 0})})()}}class sh extends KA{constructor(n,i){super(n,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}chooseBestWebsocketConnection(n,i){var s=this;return L(function*(){return new z((c,d)=>{let h=!1;const p=[];s.closeEstablishingWs=()=>{T.debug("[choose-best-ws] close establishing websockets"),p.forEach(P=>{P.onclose=null,P.onopen=null,P.onmessage=null,P.close()}),d(new Q(k.WS_ABORT,"choose best websocket aborted"))};const m=B("GATEWAY_DOMAINS");let _;const E=n.indexOf("?h="),v=m.find(P=>-1!==E?Re(n).call(n,P,E):Re(n).call(n,P));T.debug("[choose-best-ws] currentDomain: ",v,", domains: ",m);let S=!s.tryDoubleDomain||!v;if(!S&&v){var b;const P=Date.now();try{m.forEach(w=>{const M=-1===E?n.replace(v,w):n.substr(0,E)+n.substr(E).replace(v,w),V=new WebSocket(M);V.binaryType="arraybuffer",p.push(V),T.debug("[choose-best-ws] ws is connecting:",V.url)})}catch(w){for(T.debug("[choose-best-ws] ws create failed, fallback to single url"),p.forEach(M=>M.close());p.length;)p.pop();S=!0}null===(b=s.store)||void 0===b||b.recordJoinChannelService({urls:p.map(w=>w.url),service:"gateway"},i),p.forEach(w=>{w.onopen=()=>{if(h)return;const M=Date.now()-P;T.debug("[choose-best-ws] ws open cost ".concat(M,"ms")),p.filter(V=>V!==w).forEach(V=>{T.debug("[choose-best-ws]close backup websocket: ".concat(V.url)),V.close()}),h=!0,c(w)},w.onclose=M=>{_=M,!h&&(p.find(V=>!(V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING))||(T.debug("[choose-best-ws] all websocket is closed"),h=!0,d(_)))},w.onmessage=M=>{T.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(M.data))}}),pi(s.forceCloseTimeout).then(()=>{p.forEach(w=>{w.readyState!==WebSocket.OPEN&&w.close()})})}if(S){var O;let P;T.debug("[choose-best-ws] use single url: ",n),null===(O=s.store)||void 0===O||O.recordJoinChannelService({urls:[n],service:"gateway"},i);try{P=new WebSocket(n),p.push(P),P.binaryType="arraybuffer"}catch(w){const M=new Q(k.WS_ERR,"init websocket failed! Error: ".concat(w.toString()));return T.error("[".concat(s.name,"]").concat(M)),void d(M)}P.onopen=()=>{c(P)},P.onclose=w=>{d(w)},P.onmessage=w=>{T.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(w.data))},pi(s.forceCloseTimeout).then(()=>{P&&P.readyState!==WebSocket.OPEN&&P.close()})}}).then(c=>(s.closeEstablishingWs=void 0,c)).catch(c=>{throw s.closeEstablishingWs=void 0,c})})()}}class tl extends jt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===qe.CONNECTED?this.emit(de.WS_CONNECTED):n===qe.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):n===qe.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",qe.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new TC(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Me.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Me.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(c._type===Me.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case be.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case be.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case be.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case be.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case be.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case be.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new Nf("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qe.CONNECTED&&this.reconnect("retry",Gn.OFFLINE)})}request(n,i,s,c){var d=this;return L(function*(){const h=Ot(6,""),p={_id:h,_type:n,_message:i},m=d.websocket.connectionID,_=()=>new z((P,w)=>{if(d.connectionState===qe.CONNECTED)return P();const M=()=>{d.off(de.WS_CLOSED,V),P()},V=()=>{d.off(de.WS_CONNECTED,M),w(new W(k.WS_ABORT))};d.once(de.WS_CONNECTED,M),d.once(de.WS_CLOSED,V),n!==ve.PUBLISH&&n!==ve.SUBSCRIBE&&n!==ve.UNSUBSCRIBE&&n!==ve.UNPUBLISH&&n!==ve.CONTROL&&n!==ve.RESTART_ICE||d.once(de.DISCONNECT_P2P,()=>{w(new W(k.DISCONNECT_P2P))}),n!==ve.PUBLISH&&n!==ve.RESTART_ICE||d.once(de.ABORT_P2P_EXECUTION,()=>{w(new W(k.DISCONNECT_P2P))})});if(d.connectionState!==qe.CONNECTING&&d.connectionState!==qe.RECONNECTING||n===ve.JOIN||n===ve.REJOIN||(yield _()),d.websocket.sendMessage(p,!0),c)return;const E=new z((P,w)=>{let M=!1;const V=(Y,ie)=>{M=!0,P({isSuccess:"success"===Y,message:ie||{}}),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.emit(de.REQUEST_SUCCESS,n,i)};d.once("res-@".concat(h),V);const U=()=>{w(new W(k.WS_ABORT,"type: ".concat(n))),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(de.WS_CLOSED,U),d.once(de.WS_RECONNECTING,U),pi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||M||(T.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(n)),d.emit(de.REQUEST_TIMEOUT,n,i))})});let v=null;try{v=yield E}catch(P){if(d.connectionState===qe.CLOSED||n===ve.LEAVE)throw new W(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?P.throw():n===ve.JOIN||n===ve.REJOIN?null:(yield _(),yield d.request(n,i))}if(v.isSuccess)return v.message;const S=Number(v.message.error_code||v.message.code),b=oh(S),O=new W(k.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:S,data:v.message});return"success"===b.action?v.message:(T.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(S,", message: ").concat(b.desc,", action: ").concat(b.action)),S===be.ERR_TOO_MANY_BROADCASTERS?((n===ve.JOIN||n===ve.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===b.action?O.throw():"quit"===b.action?(d.initError=O,d.close(),O.throw()):(S===be.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,T.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Gn.MULTI_IP)):d.reconnect(b.action,Gn.SERVER_ERROR),n===ve.JOIN||n===ve.REJOIN?null:yield d.request(n,i)))})()}waitMessage(n,i){return new z(s=>{const c=d=>{(!i||i(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,i){const s={_type:n,_message:i};try{this.websocket.sendMessage(s)}catch(c){const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qe.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){this.websocket.sendMessage({_type:n,_message:i})}init(n,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(de.WS_CONNECTED,()=>s(this.joinResponse)),this.once(de.WS_CLOSED,()=>c(this.initError||new W(k.WS_ABORT))),this.connectionState=qe.CONNECTING,this.websocket.init(n).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ye.LEAVE,this.connectionState=qe.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),n===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Nf("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var n=this;return L(function*(){if(!n.joinResponse){n.emit(de.ABORT_P2P_EXECUTION);const i=yield cn(n,de.REQUEST_JOIN_INFO),s=yield n.request(ve.JOIN,i);if(!s)return n.emit(de.REPORT_JOIN_GATEWAY,oc.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(de.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0})()}rejoin(){var n=this;return L(function*(){if(!n.reconnectToken)throw new W(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=_a(n,de.REQUEST_REJOIN_INFO);i.token=n.reconnectToken;const s=yield n.request(ve.REJOIN,i);return!!s&&(n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),s.peers&&s.peers.forEach(c=>{n.emit(Me.ON_USER_ONLINE,{uid:c.uid}),c.audio&&n.emit(Me.ON_ADD_AUDIO_STREAM,{uid:c.uid,uint_id:c.uint_id,audio:!0,ssrcId:c.audio_ssrc}),c.video&&n.emit(Me.ON_ADD_VIDEO_STREAM,{uid:c.uid,uint_id:c.uint_id,video:!0,ssrcId:c.video_ssrc}),n.emit(c.audio_mute?Me.MUTE_AUDIO:Me.UNMUTE_AUDIO,{uid:c.uid}),n.emit(c.video_mute?Me.MUTE_VIDEO:Me.UNMUTE_VIDEO,{uid:c.uid}),n.emit(c.audio_enable_local?Me.ENABLE_LOCAL_AUDIO:Me.DISABLE_LOCAL_AUDIO,{uid:c.uid}),n.emit(c.video_enable_local?Me.ENABLE_LOCAL_VIDEO:Me.DISABLE_LOCAL_VIDEO,{uid:c.uid}),c.audio||c.video||n.emit(Me.ON_REMOVE_STREAM,{uid:c.uid,uint_id:c.uint_id})}),!0)})()}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){T.debug("[".concat(this.clientId,"] receive notification: "),n);const i=oh(n.code);if("success"!==i.action){if("failed"!==i.action)return"quit"===i.action?("ERR_REPEAT_JOIN_CHANNEL"===i.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(i.action,Gn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(T.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Gn.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();0!==n&&0!==i&&this.upload(Yr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(we.RECONNECT_WAITTING_FINISH,n=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,n)}),this.websocket.on(we.RECONNECT_CREATE_CONNECTION,n=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(we.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(we.CLOSED,()=>{this.connectionState=qe.CLOSED}),this.websocket.on(we.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=qe.CLOSED}),this.websocket.on(we.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState=this.connectionState===qe.CONNECTED?qe.RECONNECTING:qe.CONNECTING}),this.websocket.on(we.WILL_RECONNECT,(n,i,s)=>{const c=_a(this,de.IS_P2P_DISCONNECTED),d=c||"retry"!==n;c&&"retry"===n&&(T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",i=oc.P2P_DISCONNECTED),d&&(T.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(de.REPORT_JOIN_GATEWAY,i||oc.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),s(n)}),this.websocket.on(we.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",Gn.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(de.REPORT_JOIN_GATEWAY,n.message||n.code||oc.UNKNOWN_REASON,this.url||""),n instanceof W&&n.code===k.UNEXPECTED_RESPONSE&&n.data.code===be.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Gn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Gn.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(we.REQUEST_NEW_URLS,(n,i)=>{cn(this,de.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var ob="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",sb=Zm,ab=Ga,cb=ob,uE=_i("".replace),lb=RegExp("^["+cb+"]+"),hE=RegExp("(^|[^"+cb+"])["+cb+"]+$"),qA=function(o){return function(n){var i=ab(sb(n));return 1&o&&(i=uE(i,lb,"")),2&o&&(i=uE(i,hE,"$1")),i}},gU={start:qA(1),end:qA(2),trim:qA(3)},EU=Dp.PROPER,vU=Zn,db=ob,nL=gU.trim;wt({target:"String",proto:!0,forced:function(o){return vU(function(){return!!db[o]()||"\u200b\x85\u180e"!=="\u200b\x85\u180e"[o]()||EU&&db[o].name!==o})}("trim")},{trim:function(){return nL(this)}});var ri,oi,iL=_e("String").trim,YA=Cs,$A=iL,pE=String.prototype,ub=fr(function(o){var n=o.trim;return"string"==typeof o||o===pE||YA(pE,o)&&n===pE.trim?$A:n});function ah(o,n,i){return{sampleRate:o,stereo:n,bitrate:i}}function tt(o,n,i,s,c){return{width:o,height:n,frameRate:i,bitrateMin:s,bitrateMax:c}}function Jr(o,n,i,s,c){return{width:{max:o},height:{max:n},frameRate:i,bitrateMin:s,bitrateMax:c}}function XA(o,n){return{numSpatialLayers:o,numTemporalLayers:n}}(function(o){o[o.CHOOSE_SERVER=11]="CHOOSE_SERVER",o[o.CLOUD_PROXY=18]="CLOUD_PROXY",o[o.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",o[o.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(ri||(ri={})),function(o){o.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",o.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",o.IOS_INTERRUPTION_START="ios-interruption-start",o.IOS_INTERRUPTION_END="ios-interruption-end",o.STATE_CHANGE="state-change"}(oi||(oi={}));const JA={"90p":tt(160,90),"90p_1":tt(160,90),"120p":tt(160,120,15,30,65),"120p_1":tt(160,120,15,30,65),"120p_3":tt(120,120,15,30,50),"120p_4":tt(212,120),"180p":tt(320,180,15,30,140),"180p_1":tt(320,180,15,30,140),"180p_3":tt(180,180,15,30,100),"180p_4":tt(240,180,15,30,120),"240p":tt(320,240,15,40,200),"240p_1":tt(320,240,15,40,200),"240p_3":tt(240,240,15,40,140),"240p_4":tt(424,240,15,40,220),"360p":tt(640,360,15,80,400),"360p_1":tt(640,360,15,80,400),"360p_3":tt(360,360,15,80,260),"360p_4":tt(640,360,30,80,600),"360p_6":tt(360,360,30,80,400),"360p_7":tt(480,360,15,80,320),"360p_8":tt(480,360,30,80,490),"360p_9":tt(640,360,15,80,800),"360p_10":tt(640,360,24,80,800),"360p_11":tt(640,360,24,80,1e3),"480p":tt(640,480,15,100,500),"480p_1":tt(640,480,15,100,500),"480p_2":tt(640,480,30,100,1e3),"480p_3":tt(480,480,15,100,400),"480p_4":tt(640,480,30,100,750),"480p_6":tt(480,480,30,100,600),"480p_8":tt(848,480,15,100,610),"480p_9":tt(848,480,30,100,930),"480p_10":tt(640,480,10,100,400),"720p":tt(1280,720,15,120,1130),"720p_1":tt(1280,720,15,120,1130),"720p_2":tt(1280,720,30,120,2e3),"720p_3":tt(1280,720,30,120,1710),"720p_5":tt(960,720,15,120,910),"720p_6":tt(960,720,30,120,1380),"1080p":tt(1920,1080,15,120,2080),"1080p_1":tt(1920,1080,15,120,2080),"1080p_2":tt(1920,1080,30,120,3e3),"1080p_3":tt(1920,1080,30,120,3150),"1080p_5":tt(1920,1080,60,120,4780),"1440p":tt(2560,1440,30,120,4850),"1440p_1":tt(2560,1440,30,120,4850),"1440p_2":tt(2560,1440,60,120,7350),"4k":tt(3840,2160,30,120,8910),"4k_1":tt(3840,2160,30,120,8910),"4k_3":tt(3840,2160,60,120,13500)},Pf={"480p":Jr(640,480,5),"480p_1":Jr(640,480,5),"480p_2":Jr(640,480,30),"480p_3":Jr(640,480,15),"720p":Jr(1280,720,5),"720p_1":Jr(1280,720,5),"720p_2":Jr(1280,720,30),"720p_3":Jr(1280,720,15),"1080p":Jr(1920,1080,5),"1080p_1":Jr(1920,1080,5),"1080p_2":Jr(1920,1080,30),"1080p_3":Jr(1920,1080,15)},rL={"1SL1TL":XA(1,1),"3SL3TL":XA(3,3),"2SL3TL":XA(2,3)};function ac(o){return o||(o="480p_1"),"string"==typeof o?Object.assign({},JA[o]):o}function QA(o){return"string"==typeof o?Object.assign({},Pf[o]):o}function hb(o){return"string"==typeof o?Object.assign({},rL[o]):o}const oL={speech_low_quality:ah(16e3,!1),speech_standard:ah(32e3,!1,18),music_standard:ah(48e3,!1),standard_stereo:ah(48e3,!0,56),high_quality:ah(48e3,!1,128),high_quality_stereo:ah(48e3,!0,192)};function fE(o){return"string"==typeof o?Object.assign({},oL[o]):o}const kf=[];function sL(o){return Jn(o,"mediaSource",["screen","window","application"]),!0}var pe,Ht,hd,mE,ZA,Mf,pd,ch,$i,Uo;(function(o){o.NEED_RENEGOTIATE="@need_renegotiate",o.NEED_REPLACE_TRACK="@need_replace_track",o.NEED_CLOSE="@need_close",o.NEED_ENABLE_TRACK="@need_enable_track",o.NEED_DISABLE_TRACK="@need_disable_track",o.NEED_SESSION_ID="@need_sid",o.SET_OPTIMIZATION_MODE="@set_optimization_mode",o.GET_STATS="@get_stats",o.GET_LOW_VIDEO_TRACK="@get_low_video_track",o.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",o.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",o.NEED_MUTE_TRACK="@need_mute_track",o.NEED_UNMUTE_TRACK="@need_unmute_track"})(pe||(pe={})),function(o){o.SCREEN_TRACK="screen_track",o.CUSTOM_TRACK="custome_track",o.LOW_STREAM="low_stream"}(Ht||(Ht={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(hd||(hd={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(mE||(mE={})),function(o){o[o.DISABLE=0]="DISABLE",o[o.LOW_STREAM=1]="LOW_STREAM",o[o.AUDIO_ONLY=2]="AUDIO_ONLY"}(ZA||(ZA={})),function(o){o.TRANSCEIVER_UPDATED="transceiver-updated"}(Mf||(Mf={})),function(o){o.SOURCE_STATE_CHANGE="source-state-change",o.TRACK_ENDED="track-ended",o.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",o.CLOSED="closed"}(pd||(pd={})),function(o){o.FIRST_FRAME_DECODED="first-frame-decoded",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(ch||(ch={})),function(o){o.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",o.RECEIVE_TRACK_BUFFER="receive_track_buffer",o.ON_AUDIO_BUFFER="on_audio_buffer",o.UPDATE_SOURCE="update_source"}($i||($i={})),function(o){o.UPDATE_TRACK_SOURCE="update-track-source"}(Uo||(Uo={}));const eD={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},pb={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},tD={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},_n={uplinkNetworkQuality:0,downlinkNetworkQuality:0},nl={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var Vi,Nr,il,Ca,Bi;(function(o){o.ON_TRACK="on_track",o.ON_NODE="on_node"})(Vi||(Vi={})),function(o){o.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",o.REQUEST_CONSTRAINTS="request_constraints"}(Nr||(Nr={})),function(o){o.IDLE="IDLE",o.INITING="INITING",o.INITEND="INITEND"}(il||(il={})),function(o){o.STATE_CHANGE="state_change",o.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",o.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",o.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Ca||(Ca={})),function(o){o.NONE="none",o.INIT="init",o.CANPLAY="canplay",o.PLAYING="playing",o.PAUSED="paused",o.SUSPEND="suspend",o.STALLED="stalled",o.WAITING="waiting",o.ERROR="error",o.DESTROYED="destroyed",o.ABORT="abort",o.ENDED="ended",o.EMPTIED="emptied",o.LOADEDDATA="loadeddata"}(Bi||(Bi={}));const Lf={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var fd;!function(o){o.OPEN="open",o.MESSAGE="message",o.CLOSE="close",o.CLOSING="closing",o.ERROR="error"}(fd||(fd={}));class ba extends jt{constructor(n,i){super(),C(this,"_ID",void 0),C(this,"_rtpTransceiver",void 0),C(this,"_lowRtpTransceiver",void 0),C(this,"_hints",[]),C(this,"_isClosed",!1),C(this,"_originMediaStreamTrack",void 0),C(this,"_mediaStreamTrack",void 0),C(this,"_external",{}),this._ID=i||Ot(8,"track-"),this._originMediaStreamTrack=n,this._mediaStreamTrack=n,Re(kf).call(kf,this)||kf.push(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){if(!n){ye.reportApiInvoke(null,{name:fn.GET_MEDIA_STREAM_TRACK,options:[],tag:nn.TRACER}).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:"")}return this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===hd.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const i=kf.indexOf(n);-1!==i&&kf.splice(i,1)}(this),this.emit(pd.CLOSED)}_updateRtpTransceiver(n,i){if(i===hd.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(Mf.TRANSCEIVER_UPDATED,n,i)}}class zn extends ba{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}constructor(n,i){super(n,i),C(this,"_enabled",!0),C(this,"_muted",!1),C(this,"_isExternalTrack",!1),C(this,"_isClosed",!1),C(this,"_enabledMutex",void 0),C(this,"processor",void 0),C(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ni("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,i;return null!==(n=null===(i=this._originMediaStreamTrack)||void 0===i?void 0:i.label)&&void 0!==n?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,T.debug("[".concat(this.getTrackId(),"] close")),this.emit(pe.NEED_CLOSE),super.close())}_updateOriginMediaStreamTrack(n,i){var s=arguments,c=this;return L(function*(){c._isExternalTrack=s.length>2&&void 0!==s[2]&&s[2],n!==c._originMediaStreamTrack&&(c._originMediaStreamTrack&&(c._originMediaStreamTrack.removeEventListener("ended",c._handleTrackEnded),i&&c._originMediaStreamTrack.stop()),n.addEventListener("ended",c._handleTrackEnded),c._originMediaStreamTrack=n,c._muted&&(c._originMediaStreamTrack.enabled=!1),c._mediaStreamTrack=c._originMediaStreamTrack,c._updatePlayerSource(),yield Lt(c,pe.NEED_REPLACE_TRACK,c),c.processor&&c.processor.updateInput({track:c._originMediaStreamTrack,context:c.processorContext}))})()}_getDefaultPlayerConfig(){return{}}onTrackEnded(){T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(pd.TRACK_ENDED)}stateCheck(n,i){if(T.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(i,"]")),Jc(i,n),this._enabled&&this._muted&&"enabled"===n&&!1===i)throw new Q(k.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",T);if(!this._enabled&&!this._muted&&"muted"===n&&!0===i)throw new Q(k.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",T)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function nD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}const _E=window.AudioContext||window.webkitAudioContext;let Qr=null;const Tt=new class extends jt{constructor(){var o;super(...arguments),o=this,C(this,"prevState",void 0),C(this,"curState",void 0),C(this,"currentTime",void 0),C(this,"currentTimeStuckAt",void 0),C(this,"interruptDetectorTrack",void 0),C(this,"onLocalAudioTrackMute",()=>{T.info("ios15-interruption-start"),this.emit(oi.IOS_15_16_INTERRUPTION_START)}),C(this,"onLocalAudioTrackUnmute",L(function*(){T.info("ios15-interruption-end"),"running"!==o.curState||o.duringInterruption?T.info("ios15-interruption-end-canceled"):(Qr&&(yield Qr.suspend()),o.emit(oi.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(o){T.debug("webaudio bindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=o,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(o){T.debug("webaudio unbindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===o&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function lh(){if(!Qr){if(function gE(){if(!_E)return void T.error("your browser is not support web audio");T.info("create audio context");const o=function(n){for(var i=1;i<arguments.length;i++){var s=null!=arguments[i]?arguments[i]:{};i%2?nD(Object(s),!0).forEach(function(c){C(n,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):nD(Object(s)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(s,c))})}return n}({},B("WEBAUDIO_INIT_OPTIONS"));var n;T.debug("audio context init option:",JSON.stringify(o)),Qr=new _E(o),Tt.curState=Qr.state,Qr.onstatechange=()=>{Tt.prevState=Tt.curState,Tt.curState=Qr?Qr.state:void 0;const{prevState:n,curState:i}=Tt,s="running"===i,c="interrupted"===i,d="running"===n,h="suspended"===n,p="interrupted"===n,m=lt().osVersion;(hi()||pa())&&d&&c&&(T.info("ios".concat(m,"-interruption-start")),Tt.emit(oi.IOS_INTERRUPTION_START)),(hi()||pa())&&(h||p)&&s&&(T.info("ios".concat(m,"-interruption-end")),Tt.emit(oi.IOS_INTERRUPTION_END)),n!==i&&(T.debug("AudioContext State Change","".concat(n,"=>").concat(i)),Tt.emit(oi.STATE_CHANGE))},setInterval(()=>{var n;const i=null===(n=Qr)||void 0===n?void 0:n.currentTime;Tt.currentTime!==i?(Tt.currentTimeStuckAt&&(T.debug("AudioContext current time resume at ".concat(i)),Tt.currentTimeStuckAt=void 0),Tt.currentTime=i):(i!==Tt.currentTimeStuckAt&&(ye.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:nn.TRACER}).onSuccess(),T.warning("AudioContext current time stuck at ".concat(i))),Tt.currentTimeStuckAt=i)},5e3),(n=L(function*(i){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let c,d=!1,h=!1,p=!1;function m(M){"running"===i.state?_(!1):hi()||pa()?"suspended"===i.state&&(_(!0),M&&i.resume().then(v,v)):"closed"!==i.state&&(_(!0),M&&i.resume().then(v,v))}function _(M){if(d!==M){d=M;for(let V=0,U=s;V<U.length;V+=1){const Y=U[V];M?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function v(){m(!1)}function S(){m(!0)}function b(M){if(!p)if(c.paused)if(M){let V;O(!1),p=!0;try{V=c.play(),V?V.then(P,P):(c.addEventListener("playing",P),c.addEventListener("abort",P),c.addEventListener("error",P))}catch(U){P()}}else O(!0);else O(!1)}function O(M){if(h!==M){h=M;for(let V=0,U=s;V<U.length;V++){const Y=U[V];M?window.addEventListener(Y,w,{capture:!0,passive:!0}):window.removeEventListener(Y,w,{capture:!0,passive:!0})}}}function P(){c.removeEventListener("playing",P),c.removeEventListener("abort",P),c.removeEventListener("error",P),p=!1,b(!1)}function w(){b(!0)}if(hi()){const M=i.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",c=V.children.item(0),c.controls=!1,c.disableRemotePlayback=!0,c.preload="auto",c.srcObject=M.stream,b(!0)}Tt.on(oi.STATE_CHANGE,function E(){m(!0)}),m(!1)}),function(i){return n.apply(this,arguments)})(Qr)}(),!Qr)throw new Q(k.NOT_SUPPORTED,"can not create audio context");return Qr}return Qr}function iD(){return!!Qr}function rl(o){if(function(){if(null!==EE)return EE;const s=lh(),c=s.createBufferSource(),d=s.createGain(),h=s.createGain();c.connect(d),c.connect(h),c.disconnect(d);let p=!1;try{c.disconnect(d)}catch(m){p=!0}return c.disconnect(),EE=p,p}())return;const n=o.connect,i=o.disconnect;o.connect=(s,c,d)=>{var h;return o._inputNodes||(o._inputNodes=[]),Re(h=o._inputNodes).call(h,s)||(s instanceof AudioNode?(o._inputNodes.push(s),n.call(o,s,c,d)):n.call(o,s,c)),o},o.disconnect=(s,c,d)=>{i.call(o),s?Vg(o._inputNodes,s):o._inputNodes=[];for(const h of o._inputNodes)n.call(o,h)}}let EE=null;function Pr(o,n){let i=!1;const s=1/n;if(B("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):o(performance.now()/1e3)},1e3*s)}else{const c=lh();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(i)return void(d=null);const p=c.createOscillator();p.onended=h,p.connect(d),p.start(0),p.stop(c.currentTime+s),o(c.currentTime)};h()}return()=>{i=!0}}const xt={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function Ge(){return xt}class Ut{constructor(){C(this,"context",void 0),C(this,"analyserNode",void 0),C(this,"sourceNode",void 0),this.context=lh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(i){}this.sourceNode=n,null==n||n.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||hi()||pa()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const s=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(s);for(let c=0;c<n.length;++c)n[c]=s[c]/128-1}const i=cd(n).call(n,(s,c)=>s+c*c,0)/n.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,i;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(i=this.sourceNode)||void 0===i||i.connect(this.analyserNode)}catch(s){T.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class si extends jt{get processSourceNode(){return this.sourceNode}set processedNode(n){var i;if(!this.isDestroyed&&this._processedNode!==n){try{var s;null===(s=this.sourceNode)||void 0===s||s.disconnect(this.outputNode)}catch(c){}null===(i=this._processedNode)||void 0===i||i.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),C(this,"outputNode",void 0),C(this,"outputTrack",void 0),C(this,"isPlayed",!1),C(this,"context",void 0),C(this,"audioBufferNode",void 0),C(this,"destNode",void 0),C(this,"audioOutputLevel",0),C(this,"volumeLevelAnalyser",void 0),C(this,"_processedNode",void 0),C(this,"playNode",void 0),C(this,"isDestroyed",!1),C(this,"onNoAudioInput",void 0),C(this,"isNoAudioInput",!1),C(this,"_noAudioInputCount",0),this.context=lh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),rl(this.outputNode),this.volumeLevelAnalyser=new Ut}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit($i.ON_AUDIO_BUFFER,function(s){for(let c=0;c<s.outputBuffer.numberOfChannels;c+=1){const d=s.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return s.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ge().webAudioMediaStreamDest)throw new Q(k.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){"running"!==this.context.state&&is(()=>{Tt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(n){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}checkHasAudioInput(){var n=arguments,i=this;return L(function*(){let s=n.length>0&&void 0!==n[0]?n[0]:0;if(s>5)return i.isNoAudioInput=!0,i.onNoAudioInput&&i.onNoAudioInput(),!1;hi()||pa()?"suspended"===i.context.state&&i.context.resume():"running"!==i.context.state&&i.context.resume();const c=i.volumeLevelAnalyser.getAnalyserNode();let d;c.getFloatTimeDomainData?(d=new Float32Array(c.fftSize),c.getFloatTimeDomainData(d)):(d=new Uint8Array(c.fftSize),c.getByteTimeDomainData(d));let h=!1;for(let p=0;p<d.length;p++)0!==d[p]&&(h=!0);return h?(i.isNoAudioInput=!1,!0):(yield pi(200),(yield i.checkHasAudioInput(s?s+1:1))&&h)})()}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,i;null===(n=this.processedNode)||void 0===n||n.disconnect(),null===(i=this.sourceNode)||void 0===i||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?null===(n=this.processedNode)||void 0===n||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class Qe extends si{get isFreeze(){return!1}constructor(n,i,s){var c,d;if(super(),c=this,C(this,"sourceNode",void 0),C(this,"track",void 0),C(this,"clonedTrack",void 0),C(this,"audioElement",void 0),C(this,"isCurrentTrackCloned",!1),C(this,"isRemoteTrack",!1),C(this,"originVolumeLevelAnalyser",void 0),C(this,"rebuildWebAudio",L(function*(){if(T.debug("ready to rebuild web audio, state:",c.context.state),c.isNoAudioInput&&(yield c.checkHasAudioInput()),!c.isNoAudioInput||c.isDestroyed)return document.body.removeEventListener("click",c.rebuildWebAudio,!0),void T.debug("rebuild web audio success, current volume status",c.getAccurateVolumeLevel());c.context.resume().then(()=>T.info("resume success")),T.debug("rebuild web audio because of ios 12 bugs"),c.disconnect();const m=c.track;c.track=c.track.clone(),c.isCurrentTrackCloned?m.stop():c.isCurrentTrackCloned=!0;const _=new MediaStream([c.track]);c.sourceNode=c.context.createMediaStreamSource(_),rl(c.sourceNode),c.volumeLevelAnalyser.rebuildAnalyser();const E=c.outputNode.gain.value;c.outputNode=c.context.createGain(),c.outputNode.gain.setValueAtTime(E,c.context.currentTime),rl(c.outputNode),c.emit($i.UPDATE_SOURCE),c.connect(),c.audioElement.srcObject=_,c.isPlayed&&c.play(c.playNode),c.checkHasAudioInput()})),"audio"!==n.kind)throw new Q(k.UNEXPECTED_ERROR);this.track=n;const h=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(h),rl(this.sourceNode),s){const m=s.clone();m.enabled=!0,this.clonedTrack=m,T.debug("create an unmuted track ".concat(m.id," from the original track ").concat(s.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));rl(_),this.originVolumeLevelAnalyser=new Ut,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=h;const p=lt();i&&p.os===ti.IOS&&Number(null===(d=p.osVersion)||void 0===d?void 0:d.split(".")[0])<15&&(Tt.on(oi.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const i=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(i),rl(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit($i.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),Tt.off("state-change",this.rebuildWebAudio),null===(n=this.originVolumeLevelAnalyser)||void 0===n||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const i=n.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),T.debug("create an unmuted track ".concat(i.id," from the original track ").concat(n.id," to get the volume"));const s=this.context.createMediaStreamSource(new MediaStream([i]));rl(s),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(s)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}function aL(o,n,i){return fb.apply(this,arguments)}function fb(){return fb=L(function*(o,n,i){const s=(d,h)=>d?"number"!=typeof d?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxHeight:s(n.height,1080),maxWidth:s(n.width,1920)}}};return n.frameRate&&"number"!=typeof n.frameRate?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):"number"==typeof n.frameRate&&(c.video.mandatory.maxFrameRate=n.frameRate),yield navigator.mediaDevices.getUserMedia(c)}),fb.apply(this,arguments)}function cL(o,n){return mb.apply(this,arguments)}function mb(){return mb=L(function*(o,n){const i=yield rD(o.mediaSource),{sourceId:s,audio:c}=yield function(d){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new z((p,m)=>{const _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const E=document.createElement("div");E.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const v=document.createElement("div");v.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",v.setAttribute("style","height: 12%;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const b=document.createElement("div");b.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const O=document.createElement("button");O.innerHTML="cancel",O.setAttribute("style","width: 85px;"),O.onclick=()=>{document.body.removeChild(M);const V=new Error("NotAllowedError");V.name="NotAllowedError",m(V)};let P=h;const w=document.createElement("div");if(h){const V=document.createElement("input");V.setAttribute("type","checkbox");const U=document.createElement("span");V.setAttribute("style","margin-right: 6px;"),U.innerText="Share audio",V.checked=P,V.onchange=()=>{P=V.checked},w.appendChild(V),w.appendChild(U)}b.appendChild(w),b.appendChild(O),E.appendChild(v),E.appendChild(S),E.appendChild(b);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(_),M.appendChild(E),document.body.appendChild(M),d.map(V=>{if(V.id){const U=document.createElement("div");U.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Y=V.thumbnail;try{const{width:ie}=Y.getSize();ie>1920&&(Y=Y.resize({width:1920}))}catch(ie){throw ie&&ie.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ie}U.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Y.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+V.name.replace(/[\u00A0-\u9999<>\&]/g,function(ie){return"&#"+ie.charCodeAt(0)+";"})+"</span>",U.onclick=()=>{document.body.removeChild(M),p({sourceId:V.id,audio:P})},S.appendChild(U)}})})}(i,n);return yield aL(s,o,c)}),mb.apply(this,arguments)}function rD(o){return _b.apply(this,arguments)}function _b(){return _b=L(function*(o){let n=["window","screen"];"application"!==o&&"window"!==o||(n=["window"]),"screen"===o&&(n=["screen"]);const i=Wu();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Q(k.ELECTRON_IS_NULL);let s=null;try{var c;s=(null===(c=i.desktopCapturer)||void 0===c?void 0:c.getSources({types:n}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch(d){s=null}s&&s.then||(s=new z((d,h)=>{i.desktopCapturer.getSources({types:n},(p,m)=>{p?h(p):d(m)})}));try{return yield s}catch(d){throw new Q(k.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}),_b.apply(this,arguments)}function lL(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}const oD=new ni("safari");let xf=!1,Ff=!1;function Cr(o,n){return mo.apply(this,arguments)}function mo(){return mo=L(function*(o,n){let i=0,s=null;for(;i<2;)try{s=yield gb(o,n,i>0);break}catch(c){if(c instanceof Q)throw T.error("[".concat(n,"] ").concat(c.toString())),c;const d=Eb(c.name||c.code||c,c.message);if(d.code===k.MEDIA_OPTION_INVALID){T.debug("[".concat(n,"] detect media option invalid, retry")),i+=1,yield pi(500);continue}throw T.error("[".concat(n,"] ").concat(d.toString())),d}if(!s)throw new Q(k.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return s}),mo.apply(this,arguments)}function gb(o,n,i){return sD.apply(this,arguments)}function sD(){return sD=L(function*(o,n,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Q(k.NOT_SUPPORTED,"can not find getUserMedia");i&&(o.video&&(delete o.video.width,delete o.video.height),o.screen&&(delete o.screen.width,delete o.screen.height));const s=Ge(),c=new MediaStream;if(o.audioSource&&c.addTrack(o.audioSource),o.videoSource&&c.addTrack(o.videoSource),!o.audio&&!o.video&&!o.screen)return T.debug("Using Video Source/ Audio Source"),c;if(o.screen)if(Wu())Uf(c,o.screen.sourceId?yield aL(o.screen.sourceId,o.screen,o.screenAudio):yield cL(o.screen,o.screenAudio));else if(ec()&&o.screen.extensionId&&o.screen.mandatory){if(!s.getStreamFromExtension)throw new Q(k.NOT_SUPPORTED,"This browser does not support screen sharing");T.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const S=yield(h=o.screen.extensionId,p=n,new z((b,O)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},P=>{if(!P||!P.streamId)return T.error("[".concat(p,"] No response from Chrome Plugin. Plugin not installed properly"),P),void O(new Q(k.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));b(P.streamId)})}catch(P){T.error("[".concat(p,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),P.toString()),O(new Q(k.CHROME_PLUGIN_NOT_INSTALL))}}));o.screen.mandatory.chromeMediaSourceId=S,Uf(c,yield navigator.mediaDevices.getUserMedia({video:{mandatory:o.screen.mandatory}}))}else if(s.getDisplayMedia){var d;o.screen.mediaSource&&sL(o.screen.mediaSource);const S={width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate,displaySurface:null!==(d=o.screen.displaySurface)&&void 0!==d?d:"screen"===o.screen.mediaSource?"monitor":o.screen.mediaSource},{selfBrowserSurface:b,surfaceSwitching:O,systemAudio:P}=o.screen,w={selfBrowserSurface:b,surfaceSwitching:O,systemAudio:P};!b&&delete w.selfBrowserSurface,!O&&delete w.surfaceSwitching,!P&&delete w.systemAudio,T.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:S,audio:!!o.screenAudio,controls:w}));const M=yield navigator.mediaDevices.getDisplayMedia(function(V){for(var U=1;U<arguments.length;U++){var Y=null!=arguments[U]?arguments[U]:{};U%2?lL(Object(Y),!0).forEach(function(ie){C(V,ie,Y[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Y)):lL(Object(Y)).forEach(function(ie){Object.defineProperty(V,ie,Object.getOwnPropertyDescriptor(Y,ie))})}return V}({video:S,audio:!!o.screenAudio},w));Uf(c,M)}else{if(!Bt())throw T.error("[".concat(n,"] This browser does not support screenSharing")),new Q(k.NOT_SUPPORTED,"This browser does not support screen sharing");{o.screen.mediaSource&&sL(o.screen.mediaSource);const S={video:{mediaSource:o.screen.mediaSource,width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate}};T.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(S))),Uf(c,yield navigator.mediaDevices.getUserMedia(S))}}var h,p;if(!o.video&&!o.audio)return c;let m={video:o.video,audio:o.audio},_=B("MEDIA_DEVICE_CONSTRAINTS");if(_)try{"string"==typeof _&&(_=JSON.parse(_)),m=bC(m,_)}catch(S){}T.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(m)),lt();let E,v=null;(or()||hi()||ef())&&(v=yield oD.lock());try{E=yield navigator.mediaDevices.getUserMedia(m)}catch(S){throw v&&v(),S}return m.audio&&(xf=!0),m.video&&(Ff=!0),Uf(c,E),v&&v(),c}),sD.apply(this,arguments)}function Eb(o,n){switch(o){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Q(k.MEDIA_OPTION_INVALID,"".concat(o,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new Q(k.DEVICE_NOT_FOUND,"".concat(o,": ").concat(n));case"NotSupportedError":return new Q(k.NOT_SUPPORTED,"".concat(o,": ").concat(n));case"NotReadableError":return new Q(k.NOT_READABLE,"".concat(o,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Q(k.PERMISSION_DENIED,"".concat(o,": ").concat(n));case"ConstraintNotSatisfiedError":return new Q(k.CONSTRAINT_NOT_SATISFIED,"".concat(o,": ").concat(n));default:return T.error("getUserMedia unexpected error",o),new Q(k.UNEXPECTED_ERROR,"".concat(o,": ").concat(n))}}function Uf(o,n){const i=o.getVideoTracks()[0],s=o.getAudioTracks()[0],c=n.getVideoTracks()[0],d=n.getAudioTracks()[0];d&&(s&&o.removeTrack(s),o.addTrack(d)),c&&(i&&o.removeTrack(i),o.addTrack(c))}const _o=new class extends jt{get state(){return this._state}set state(o){o!==this._state&&(this.emit(Ca.STATE_CHANGE,o),this._state=o)}constructor(){super(),C(this,"_state",il.IDLE),C(this,"isAccessMicrophonePermission",!1),C(this,"isAccessCameraPermission",!1),C(this,"lastAccessMicrophonePermission",!1),C(this,"lastAccessCameraPermission",!1),C(this,"checkdeviceMatched",!1),C(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(B("ENUMERATE_DEVICES_INTERVAL")||(rd()||Zp()===ti.HARMONY_OS)&&$c())&&this.updateDevicesInfo()},B("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(o=>T.error(o.toString()))}enumerateDevices(o,n){var i=arguments,s=this;return L(function*(){let c=i.length>2&&void 0!==i[2]&&i[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Q(k.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=yield navigator.mediaDevices.enumerateDevices(),h=s.checkMediaDeviceInfoIsOk(d);let p=!s.isAccessMicrophonePermission&&o,m=!s.isAccessCameraPermission&&n;h.audio&&(p=!1),h.video&&(m=!1);let _=null,E=null,v=null;if(!c&&(p||m)){if(oD.isLocked&&(T.debug("[device manager] wait GUM lock"),(yield oD.lock())(),T.debug("[device manager] GUM unlock")),xf&&(p=!1,s.isAccessMicrophonePermission=!0),Ff&&(m=!1,s.isAccessCameraPermission=!0),T.debug("[device manager] check media device permissions",o,n,p,m),p&&m){try{v=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const b=Eb(S.name||S.code||S,S.message);if(b.code===k.PERMISSION_DENIED)throw b;T.warning("getUserMedia failed in getDevices",b)}s.isAccessCameraPermission=!0,s.isAccessMicrophonePermission=!0}else if(p){try{_=yield navigator.mediaDevices.getUserMedia({audio:o})}catch(S){const b=Eb(S.name||S.code||S,S.message);if(b.code===k.PERMISSION_DENIED)throw b;T.warning("getUserMedia failed in getDevices",b)}s.isAccessMicrophonePermission=!0}else if(m){try{E=yield navigator.mediaDevices.getUserMedia({video:n})}catch(S){const b=Eb(S.name||S.code||S,S.message);if(b.code===k.PERMISSION_DENIED)throw b;T.warning("getUserMedia failed in getDevices",b)}s.isAccessCameraPermission=!0}T.debug("[device manager] mic permission",o,"cam permission",n)}try{const S=yield navigator.mediaDevices.enumerateDevices();return _&&_.getTracks().forEach(b=>b.stop()),E&&E.getTracks().forEach(b=>b.stop()),v&&v.getTracks().forEach(b=>b.stop()),_=null,E=null,v=null,S}catch(S){return _&&_.getTracks().forEach(b=>b.stop()),E&&E.getTracks().forEach(b=>b.stop()),v&&v.getTracks().forEach(b=>b.stop()),_=null,E=null,v=null,new Q(k.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}})()}getRecordingDevices(){var o=arguments,n=this;return L(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!0,!1,i)).filter(s=>"audioinput"===s.kind)})()}getCamerasDevices(){var o=arguments,n=this;return L(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!1,!0,i)).filter(s=>"videoinput"===s.kind)})()}getSpeakers(){var o=arguments,n=this;return L(function*(){let i=o.length>0&&void 0!==o[0]&&o[0];return(yield n.enumerateDevices(!0,!1,i)).filter(s=>"audiooutput"===s.kind)})()}searchDeviceIdByName(o){let n=null;return this.deviceInfoMap.forEach(i=>{i.device.label===o&&(n=i.device.deviceId)}),n}getDeviceById(o){var n=this;return L(function*(){const i=(yield n.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===o);if(!i)throw new Q(k.DEVICE_NOT_FOUND,"deviceId: ".concat(o));return i})()}init(){var o=this;return L(function*(){o.state=il.INITING;try{yield o.updateDevicesInfo(),o.state=il.INITEND}catch(n){throw T.warning("Device Detection functionality cannot start properly.",n.toString()),o.state=il.IDLE,!("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)&&new Q(k.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),n}})()}updateDevicesInfo(){var o=this;return L(function*(){const n=yield o.enumerateDevices(!0,!0,!0),i=Date.now(),s=[];if(n[0]&&n[0].label&&!1===o.checkdeviceMatched){o.checkdeviceMatched=!0;const d=n.find(p=>"audioinput"===p.kind&&"default"===p.deviceId),h=n.find(p=>"audiooutput"===p.kind&&"default"===p.deviceId);d&&h?h.groupId===d.groupId?T.debug("[device-check] default input ".concat(d.label," and output ").concat(h.label," is the same group")):T.warning("[device-check] default input ".concat(d.label," and output ").concat(h.label," is not the same group")):T.debug("[device-check] default input or output not found")}const c=o.checkMediaDeviceInfoIsOk(n);if(n.forEach(d=>{if(!d.deviceId)return;const h=o.deviceInfoMap.get("".concat(d.kind,"_").concat(d.deviceId));if("ACTIVE"!==(h?h.state:"INACTIVE")){const p={initAt:i,updateAt:i,device:d,state:"ACTIVE"};o.deviceInfoMap.set("".concat(d.kind,"_").concat(d.deviceId),p),s.push(p)}h&&(h.updateAt=i)}),o.deviceInfoMap.forEach((d,h)=>{"ACTIVE"===d.state&&d.updateAt!==i&&(d.state="INACTIVE",s.push(d))}),o.state!==il.INITEND)return c.audio&&(o.lastAccessMicrophonePermission=!0,o.isAccessMicrophonePermission=!0),void(c.video&&(o.lastAccessCameraPermission=!0,o.isAccessCameraPermission=!0));s.forEach(d=>{switch(d.device.kind){case"audioinput":o.lastAccessMicrophonePermission&&o.isAccessMicrophonePermission&&o.emit(Ca.RECORDING_DEVICE_CHANGED,d);break;case"videoinput":o.lastAccessCameraPermission&&o.isAccessCameraPermission&&o.emit(Ca.CAMERA_DEVICE_CHANGED,d);break;case"audiooutput":o.lastAccessMicrophonePermission&&o.isAccessMicrophonePermission&&o.emit(Ca.PLAYOUT_DEVICE_CHANGED,d)}}),c.audio&&(o.lastAccessMicrophonePermission=!0,o.isAccessMicrophonePermission=!0),c.video&&(o.lastAccessCameraPermission=!0,o.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(o){const n=o.filter(c=>"audioinput"===c.kind),i=o.filter(c=>"videoinput"===c.kind),s={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){s.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){s.video=!0;break}return s}};let vb=!1;const Zr=new class extends jt{constructor(){super(...arguments),C(this,"onAutoplayFailed",void 0),C(this,"onAudioAutoplayFailed",void 0)}};function aD(){if(lt(),!vb){const o=n=>{n.preventDefault(),vb=!1,Xc()?document.body.removeEventListener("click",o,!0):(document.body.removeEventListener("touchstart",o,!0),document.body.removeEventListener("mousedown",o,!0))};vb=!0,Xc()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0)),T.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Zr.onAutoplayFailed?Zr.onAutoplayFailed():T.warning(Zr.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Zr.emit("autoplay-failed")}}function cD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function dL(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?cD(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):cD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Vo(o,n,i,s){if(!o)return;const c=ye.getBaseInfoBySessionId(o);if(!c)return;const d=c.info,h=Date.now(),p=dL(dL({},d),{},{vid:void 0===d.vid?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:Zr.onAutoplayFailed||Zr.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:n,trackId:s,extend:void 0});ye.send({type:Kt.AUTOPLAY_FAILED,data:p},!0)}const yb=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],eo=new class{constructor(){C(this,"onAutoplayFailed",void 0),C(this,"elementMap",new Map),C(this,"elementStateMap",new Map),C(this,"elementsNeedToResume",[]),C(this,"sinkIdMap",new Map),C(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[n,i]=o;const s=this.elementStateMap.get(n),c=i.srcObject.getAudioTracks()[0];tf()?c&&"live"===c.readyState&&"running"===Tt.curState&&(T.debug("auto resume after interruption for iOS 15"),i.pause(),i.play()):s&&"paused"===s&&c&&"live"===c.readyState&&"running"===Tt.curState&&(T.debug("auto resume after interruption for iOS"),i.play())})}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[n,i]=o;const s=i.srcObject.getAudioTracks()[0];s&&"live"===s.readyState&&(T.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Tt.on(oi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Tt.on(oi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Tt.on(oi.STATE_CHANGE,()=>{hi()&&"suspended"===Tt.prevState&&"running"===Tt.curState&&this.autoResumeAfterInterruption()})}setSinkID(o,n){var i=this;return L(function*(){const s=i.elementMap.get(o);if(i.sinkIdMap.set(o,n),s)try{yield s.setSinkId(n)}catch(c){throw new Q(k.PERMISSION_DENIED,"can not set sink id: "+c.toString())}})()}play(o,n,i,s){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([o]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,Bi.INIT),this.setVolume(n,i);const d=this.sinkIdMap.get(n);if(d)try{c.setSinkId(d).catch(p=>{T.warning("[".concat(n,"] set sink id failed"),p.toString())})}catch(p){T.warning("[".concat(n,"] set sink id failed"),p.toString())}const h=c.play();h&&h.then&&h.catch(p=>{s&&Vo(s,"audio",p.message,n),T.warning("audio element play warning",p.toString()),this.elementMap.has(n)&&"NotAllowedError"===p.name&&(T.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),is(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),aD()}))})}updateTrack(o,n){const i=this.elementMap.get(o);i&&(i.srcObject=new MediaStream([n]))}isPlaying(o){return this.elementMap.has(o)&&"playing"===this.elementStateMap.get(o)}setVolume(o,n){const i=this.elementMap.get(o);i&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(o){const n=this.elementMap.get(o);if(this.sinkIdMap.delete(o),!n)return;const i=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(i,1),n.srcObject=null,n.remove(),this.elementMap.delete(o),this.elementStateMap.delete(o)}bindAudioElementEvents(o,n){yb.forEach(i=>{n.addEventListener(i,s=>{const c=this.elementStateMap.get(o),d="pause"===s.type?"paused":s.type;if(T.debug("[".concat(o,"] audio-element-status change ").concat(c," => ").concat(d)),"error"===s.type){const h=null==n?void 0:n.error;h&&T.error("[".concat(o,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(o,d)})})}getPlayerState(o){return this.elementStateMap.get(o)||"uninit"}autoResumeAudioElement(){const o=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(i=>{T.debug("Auto resume audio element success")}).catch(i=>{T.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new z(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{Xc()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0))})}};function yn(){return function(o,n,i){const s=i.value;return"function"==typeof s&&(i.value=function(){this._isClosed&&new Q(k.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",T);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const p=s.apply(this,d);return p instanceof z?new z((m,_)=>{p.then(m).catch(_)}):p}),i}}function lD(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function vE(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?lD(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):lD(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class dh extends jt{constructor(n){super(),C(this,"name","VideoProcessorDestination"),C(this,"ID","0"),C(this,"_source",void 0),C(this,"videoContext",void 0),C(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Q(k.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Q(k.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(Vi.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Vi.ON_TRACK,void 0)}}class dD extends jt{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"usageRegistry",[]),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"_chained",!1),this.trackId=n,this.direction=i}getConstraints(){var n=this;return L(function*(){return yield cn(n,Nr.REQUEST_CONSTRAINTS)})()}requestApplyConstraints(n,i){var s=this;return L(function*(){var c;return T.info("processor ".concat(i.name," requestApplyConstraints for ").concat(s.trackId)),n&&s.constraintsMap.set(i,n),Lt(s,Nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vs(c=s.constraintsMap).call(c)))})()}requestRevertConstraints(n){var i=this;return L(function*(){var s;if(i.constraintsMap.has(n))return T.info("processor ".concat(n.name," requestRevertConstraints for ").concat(i.trackId)),i.constraintsMap.delete(n),Lt(i,Nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vs(s=i.constraintsMap).call(s)))})()}registerStats(n,i,s){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:s})}unregisterStats(n,i){const s=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:s,type:c,cb:d}of this.statsRegistry)try{const h=d();n.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){T.error(new Q(k.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(s=>s.processorID===n.ID&&s.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(s=>s.processorID===n.ID&&s.processorName===n.name);-1!==i&&this.usageRegistry.splice(i,1)}gatherUsage(){var n=this;return L(function*(){const i=[];if(!n.chained)return[];for(const{cb:s}of n.usageRegistry)try{let c=s();c instanceof z&&(c=yield c),i.push(vE(vE({},c),{},{direction:n.direction}))}catch(c){T.error("gather extension usage error",c)}return i})()}getDirection(){return this.direction}}class Ci extends jt{constructor(n){super(),C(this,"name","AudioProcessorDestination"),C(this,"ID","0"),C(this,"inputTrack",void 0),C(this,"inputNode",void 0),C(this,"audioProcessorContext",void 0),C(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Q(k.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Q(k.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Vi.ON_TRACK,void 0),this.emit(Vi.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(Vi.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(Vi.ON_NODE,this.inputNode))}}class Ze extends jt{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i,s){super(),C(this,"constraintsMap",new Map),C(this,"statsRegistry",[]),C(this,"audioContext",void 0),C(this,"trackId",void 0),C(this,"direction",void 0),C(this,"usageRegistry",[]),C(this,"_chained",!1),this.audioContext=n,this.trackId=i,this.direction=s}getConstraints(){var n=this;return L(function*(){return cn(n,Nr.REQUEST_CONSTRAINTS)})()}getAudioContext(){return this.audioContext}requestApplyConstraints(n,i){var s=this;return L(function*(){var c;return T.info("processor ".concat(i.name," requestApplyConstraints for ").concat(s.trackId)),n&&s.constraintsMap.set(i,n),Lt(s,Nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vs(c=s.constraintsMap).call(c)))})()}requestRevertConstraints(n){var i=this;return L(function*(){var s;if(i.constraintsMap.has(n))return i.constraintsMap.delete(n),Lt(i,Nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(Vs(s=i.constraintsMap).call(s)))})()}registerStats(n,i,s){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:s})}unregisterStats(n,i){const s=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);-1!==s&&this.statsRegistry.splice(s,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:s,type:c,cb:d}of this.statsRegistry)try{const h=d();n.push({processorID:i,processorName:s,type:c,stats:h})}catch(h){T.error(new Q(k.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(s=>s.processorID===n.ID&&s.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(s=>s.processorID===n.ID&&s.processorName===n.name);-1!==i&&this.usageRegistry.splice(i,1)}gatherUsage(){var n=this;return L(function*(){const i=[];if(!n.chained)return[];for(const{cb:s}of n.usageRegistry)try{let c=s();c instanceof z&&(c=yield c),i.push(vE(vE({},c),{},{direction:n.direction}))}catch(c){T.error("gather extension usage error",c)}return i})()}getDirection(){return this.direction}}class Rt extends jt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),C(this,"context",void 0),C(this,"processSourceNode",void 0),C(this,"outputTrack",void 0),C(this,"processedNode",void 0),C(this,"clonedTrack",void 0),C(this,"outputNode",void 0),this.outputNode=new uL}setVolume(){}createOutputTrack(){throw new Q(k.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class uL{disconnect(){}connect(){}}let cc=null;class lc{constructor(){C(this,"state","open"),C(this,"trigger",void 0),C(this,"tasks",[]),T.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",T.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(n=>n.key),"]")),this.trigger=void 0,this.tasks.forEach(n=>{let{func:i}=n;return i()}),this.tasks.length=0,T.debug("[macro-task-queue] is closed.")})}enqueue(n,i){"closed"!==this.state&&(this.tasks.push({key:n,func:i}),T.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof n?n:"")))}runTask(n){if("closed"===this.state)return;const i=this.tasks.findIndex(s=>s.key===n);if(-1!==i){const s=this.tasks.splice(i,1);T.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof n?n:"")),s[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,T.debug("[macro-task-queue] is closed."))}}function uh(o){return function(n,i,s){var c;const d=null!==(c=s.value)&&void 0!==c?c:s.get,h=function(){cc&&"open"===cc.state&&cc.runTask(o);for(var p=arguments.length,m=new Array(p),_=0;_<p;_++)m[_]=arguments[_];return null==d?void 0:d.apply(this,...m)};return s.value?s.value=h:s.get=h,s}}function as(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Sb(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?as(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):as(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class xe extends zn{get _source(){return this._trackSource}set _source(n){this._trackSource=n}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get processorDestination(){return this._processorDestination}set processorDestination(n){this._processorDestination=n}get isPlaying(){return this._useAudioElement?eo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(n,i,s,c,d){super(n,s),C(this,"trackMediaType","audio"),C(this,"_encoderConfig",void 0),C(this,"_trackSource",void 0),C(this,"_enabled",!0),C(this,"_volume",100),C(this,"_useAudioElement",!1),C(this,"_bypassWebAudio",!1),C(this,"processor",void 0),C(this,"_processorContext",void 0),C(this,"_processorDestination",void 0),C(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=i,this._getOriginVolumeLevel=!!c;const h=()=>{this.processorContext=new Ze(this._source.context,this.getTrackId(),"local"),this.processorDestination=new Ci(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on($i.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},p=d&&or()&&!iD();B("DISABLE_WEBAUDIO")?(this._source=new Rt,this._useAudioElement=!0,this._bypassWebAudio=!0):p?this._source=new Rt:(this._source=new Qe(n,!1,this._getOriginVolumeLevel?n:void 0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),h(),!B("DISABLE_WEBAUDIO")&&p&&(cc||(cc=new lc),cc).enqueue("INIT_WEBAUDIO",()=>{this._source=new Qe(n,!1,this._getOriginVolumeLevel?n:void 0),B("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),h(),this.emit(Uo.UPDATE_TRACK_SOURCE)})}setVolume(n){Dt(n,"volume",0,1e3),this._volume=n,this._source.setVolume(n/100),this._useAudioElement&&eo.setVolume(this.getTrackId(),n);try{if(this._bypassWebAudio)return void T.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,Lt(this,pe.NEED_REPLACE_TRACK,this).then(()=>{T.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{T.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch(i){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}setPlaybackDevice(n){var i=this;return L(function*(){if(!i._useAudioElement)throw new Q(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield eo.setSinkID(i.getTrackId(),n)})()}setEnabled(n,i,s){var c=this;return L(function*(){return c._setEnabled(n,i,s)})()}_setEnabled(n,i,s){var c=this;return L(function*(){if(!s){if(n===c._enabled)return;c.stateCheck("enabled",n)}if(T.info("[".concat(c.getTrackId(),"] start setEnabled"),n),n){c._originMediaStreamTrack.enabled=!0;try{s||(c._enabled=!0),yield Lt(c,pe.NEED_ENABLE_TRACK,c),T.info("[".concat(c.getTrackId(),"] setEnabled to ").concat(n," success"))}catch(d){throw s||(c._enabled=!1),T.error("[".concat(c.getTrackId(),"] setEnabled to true error"),d.toString()),d}}else{c._originMediaStreamTrack.enabled=!1,s||(c._enabled=!1);try{yield Lt(c,pe.NEED_DISABLE_TRACK,c)}catch(d){throw s||(c._enabled=!0),T.error("[".concat(c.getTrackId(),"] setEnabled to false error"),d.toString()),d}}})()}setMuted(n){var i=this;return L(function*(){n!==i._muted&&(i.stateCheck("muted",n),i._muted=n,i._originMediaStreamTrack.enabled=!n,T.debug("[".concat(i.getTrackId(),"] start set muted: ").concat(n)),n?yield Lt(i,pe.NEED_MUTE_TRACK,i):yield Lt(i,pe.NEED_UNMUTE_TRACK,i))})()}getStats(){return af(()=>{T.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),lo(this,pe.GET_STATS)||Sb({},eD)}setAudioFrameCallback(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners($i.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners($i.ON_AUDIO_BUFFER),this._source.on($i.ON_AUDIO_BUFFER,s=>n(s))}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] start audio playback in element")),eo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?eo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&eo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(n,i){var s=this;return L(function*(){s._originMediaStreamTrack!==n&&(s._originMediaStreamTrack&&(s._originMediaStreamTrack.removeEventListener("ended",s._handleTrackEnded),i&&s._originMediaStreamTrack.stop()),n.addEventListener("ended",s._handleTrackEnded),s._originMediaStreamTrack=n,s._muted&&(s._originMediaStreamTrack.enabled=!1),s.processor&&s.processor.updateInput({track:n,context:s.processorContext}),s._mediaStreamTrack!==s._source.outputTrack?(s._mediaStreamTrack=s._originMediaStreamTrack,s._updatePlayerSource(),yield Lt(s,pe.NEED_REPLACE_TRACK,s)):s._source.updateTrack(s._originMediaStreamTrack),s._getOriginVolumeLevel&&s._source.updateOriginTrack(n))})()}renewMediaStreamTrack(n){return z.resolve(void 0)}pipe(n){if(this._bypassWebAudio)throw new Q(k.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===n)return n;if(n._source)throw new Q(k.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(!this.processor)return;const i=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Vi.ON_TRACK,function(){var i=L(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(s),yield Lt(n,pe.NEED_REPLACE_TRACK,n)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield Lt(n,pe.NEED_REPLACE_TRACK,n))});return function(s){return i.apply(this,arguments)}}()),this.processorDestination.on(Vi.ON_NODE,i=>{this._source.processedNode=i})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Vi.ON_TRACK),this.processorDestination.removeAllListeners(Vi.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Nr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Nr.REQUEST_CONSTRAINTS)}}te([uh("INIT_WEBAUDIO"),N("design:type",Object),N("design:paramtypes",[Object])],xe.prototype,"_source",null),te([uh("INIT_WEBAUDIO"),N("design:type",Ze),N("design:paramtypes",[Ze])],xe.prototype,"processorContext",null),te([uh("INIT_WEBAUDIO"),N("design:type",Ci),N("design:paramtypes",[Ci])],xe.prototype,"processorDestination",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],xe.prototype,"setVolume",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],xe.prototype,"setPlaybackDevice",null),te([Ku("LocalAudioTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[Boolean,Object,Boolean]),N("design:returntype",z)],xe.prototype,"setEnabled",null),te([Ku("LocalAudioTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",z)],xe.prototype,"setMuted",null),te([yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],xe.prototype,"getStats",null),te([yn(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",void 0)],xe.prototype,"setAudioFrameCallback",null),te([Ie({argsMap:o=>[o.getTrackId()]}),yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],xe.prototype,"play",null),te([Ie({argsMap:o=>[o.getTrackId()]}),yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],xe.prototype,"stop",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],xe.prototype,"close",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],xe.prototype,"pipe",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],xe.prototype,"unpipe",null);class ol extends xe{get __className__(){return"MicrophoneAudioTrack"}constructor(n,i,s,c){super(n,i.encoderConfig?fE(i.encoderConfig):{},c,B("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),C(this,"_config",void 0),C(this,"_deviceName","default"),C(this,"_constraints",void 0),C(this,"_originalConstraints",void 0),C(this,"_enabled",!0),this._config=i,this._constraints=s,this._originalConstraints=s,this._deviceName=n.label,"boolean"==typeof i.bypassWebAudio&&(this._bypassWebAudio=i.bypassWebAudio),(tf()||Ne())&&Tt.bindInterruptDetectorTrack(this),this.on(Uo.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),iD()&&this.bindProcessorContextEvents()}setDevice(n){var i=this;return L(function*(){if(T.info("[".concat(i.getTrackId(),"] start set device to ").concat(n)),i._enabled)try{const s=yield _o.getDeviceById(n),c={};c.audio=Sb({},i._constraints),c.audio.deviceId={exact:n},i._originMediaStreamTrack.stop();let d=null;try{d=yield Cr(c,i.getTrackId())}catch(h){throw T.error("[".concat(i.getTrackId(),"] setDevice failed"),h.toString()),d=yield Cr({audio:i._constraints},i.getTrackId()),yield i._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),h}yield i._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),i._deviceName=s.label,i._config.microphoneId=n,i._constraints.deviceId={exact:n}}catch(s){throw T.error("[".concat(i.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=yield _o.getDeviceById(n);i._deviceName=s.label,i._config.microphoneId=n,i._constraints.deviceId={exact:n}}catch(s){throw T.error("[".concat(i.getTrackId(),"] setDevice error"),s.toString()),s}T.info("[".concat(i.getTrackId(),"] set device to ").concat(n," success"))})()}setEnabled(n,i,s){var c=()=>super._setEnabled,d=this;return L(function*(){if(i)return T.debug("[".concat(d.getTrackId(),"] setEnabled false (do not close microphone)")),yield c().call(d,n);if(!s){if(n===d._enabled)return;d.stateCheck("enabled",n)}if(T.info("[".concat(d.getTrackId(),"] start setEnabled"),n),!n){var h;d._originMediaStreamTrack.onended=null,d._originMediaStreamTrack.stop(),null===(h=d._source.clonedTrack)||void 0===h||h.stop(),s||(d._enabled=!1);try{yield Lt(d,pe.NEED_DISABLE_TRACK,d)}catch(_){throw T.error("[".concat(d.getTrackId(),"] setEnabled false failed"),_.toString()),_}return}const p=Sb({},d._constraints),m=_o.searchDeviceIdByName(d._deviceName);m&&!p.deviceId&&(p.deviceId=m);try{s||(d._enabled=!0);const _=yield Cr({audio:d._constraints},d.getTrackId());yield d._updateOriginMediaStreamTrack(_.getAudioTracks()[0],!1),yield Lt(d,pe.NEED_ENABLE_TRACK,d)}catch(_){throw s||(d._enabled=!1),T.error("[".concat(d.getTrackId(),"] setEnabled true failed"),_.toString()),_}T.info("[".concat(d.getTrackId(),"] setEnabled success"))})()}close(){super.close(),(tf()||Ne())&&Tt.unbindInterruptDetectorTrack(this)}onTrackEnded(){var n=this;if((hi()||pa())&&this._enabled&&!this._isClosed&&Tt.duringInterruption){const i=function(){var s=L(function*(){Tt.off(oi.IOS_INTERRUPTION_END,i),n._enabled&&!n._isClosed&&(T.debug("[".concat(n.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return s.apply(this,arguments)}}();Tt.on(oi.IOS_INTERRUPTION_END,i)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(pd.TRACK_ENDED)}renewMediaStreamTrack(n){var i=this;return L(function*(){const s=n||i._constraints,c=_o.searchDeviceIdByName(i._deviceName);if(c&&!s.deviceId&&(s.deviceId=c),i._constraints=s,i._enabled){i._originMediaStreamTrack.stop();const d=yield Cr({audio:i._constraints},i.getTrackId());yield i._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!0)}})()}bindProcessorContextEvents(){var n=this;this.processorContext.on(Nr.REQUEST_UPDATE_CONSTRAINTS,function(){var i=L(function*(s,c,d){try{const h=Object.assign({},n._originalConstraints,...s);yield n.renewMediaStreamTrack(h),c()}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this.processorContext.on(Nr.REQUEST_CONSTRAINTS,function(){var i=L(function*(s){s(n._originMediaStreamTrack.getSettings())});return function(s){return i.apply(this,arguments)}}())}}te([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],ol.prototype,"setDevice",null),te([Ku("MicrophoneAudioTrack","_enabledMutex"),Ie({argsMap:(o,n,i)=>[o.getTrackId(),n,i]}),yn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean,Boolean]),N("design:returntype",z)],ol.prototype,"setEnabled",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],ol.prototype,"close",null);class rn extends xe{get __className__(){return"BufferSourceAudioTrack"}constructor(n,i,s,c){super(i.createOutputTrack(),s,c),C(this,"source",void 0),C(this,"_bufferSource",void 0),this.source=n,this._bufferSource=i,this._bufferSource.on($i.AUDIO_SOURCE_STATE_CHANGE,d=>{this.safeEmit(pd.SOURCE_STATE_CHANGE,d)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(d){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(n){n&&this._bufferSource.updateOptions(n),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(n){this._bufferSource.seekAudioBuffer(n)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(n){Dt(n,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(n)}}te([Ie({argsMap:(o,n)=>[o.getTrackId(),n,o.duration]}),yn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],rn.prototype,"startProcessAudioBuffer",null),te([Ie({argsMap:o=>[o.getTrackId()]}),yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],rn.prototype,"pauseProcessAudioBuffer",null),te([Ie({argsMap:o=>[o.getTrackId()]}),yn(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],rn.prototype,"seekAudioBuffer",null),te([Ie({argsMap:o=>[o.getTrackId()]}),yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],rn.prototype,"resumeProcessAudioBuffer",null),te([Ie({argsMap:o=>[o.getTrackId()]}),yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],rn.prototype,"stopProcessAudioBuffer",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],rn.prototype,"close",null),te([Ie({argsMap:o=>[o.getTrackId()]}),yn(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],rn.prototype,"setAudioBufferPlaybackSpeed",null);class Un extends xe{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=lh().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,Ot(8,"track-mix-")),C(this,"trackList",void 0),C(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(i){}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return-1!==this.trackList.indexOf(n)}addAudioTrack(n){-1===this.trackList.indexOf(n)?(T.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):T.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(-1!==this.trackList.indexOf(n)){T.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch(i){}Vg(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(i=>{i instanceof Un?i.emit(Mf.TRANSCEIVER_UPDATED,n):i._updateRtpTransceiver(n)}))}}function md(o){const n={};o.facingMode&&(n.facingMode=o.facingMode),o.cameraId&&(n.deviceId={exact:o.cameraId});const i=ac(o.encoderConfig);return null!=i.width&&(n.width=i.width),null!=i.height&&(n.height=i.height),!nf()&&i.frameRate&&(n.frameRate=i.frameRate),lt().name===mt.EDGE&&"object"==typeof n.frameRate&&(n.frameRate.max=60),Bt()&&(n.frameRate={ideal:30,max:30}),n}function uD(o){const n={};if(nf()||(void 0!==o.AGC&&(n.autoGainControl=o.AGC),void 0!==o.AEC&&(n.echoCancellation=o.AEC),void 0!==o.ANS&&(n.noiseSuppression=o.ANS,ec()&&o.ANS&&(n.googHighpassFilter=o.ANS))),o.encoderConfig){const i=fE(o.encoderConfig);n.channelCount=i.stereo?2:1,n.sampleRate=i.sampleRate,n.sampleSize=i.sampleSize}return o.microphoneId&&(n.deviceId={exact:o.microphoneId}),rd()&&(n.sampleRate=void 0),n}class yE extends si{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit($i.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),C(this,"audioBuffer",void 0),C(this,"sourceNode",void 0),C(this,"startPlayTime",0),C(this,"startPlayOffset",0),C(this,"pausePlayTime",0),C(this,"options",void 0),C(this,"currentLoopCount",0),C(this,"currentPlaybackSpeed",100),C(this,"_currentState","stopped"),this.audioBuffer=n,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){"stopped"===this.currentState?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):T.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=n,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(n){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const hD=new Map;function Vf(){return Vf=L(function*(o,n){let i=null;if("string"==typeof o){const c=hD.get(o);if(c)return T.debug("use cached audio resource: ",o),c;try{i=(yield Fs(()=>Hn.get(o,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(d){throw new Q(k.FETCH_AUDIO_FILE_FAILED,d.toString())}}else i=yield new z((d,h)=>{const p=new FileReader;p.onload=m=>{m.target?d(m.target.result):h(new Q(k.READ_LOCAL_AUDIO_FILE_ERROR))},p.onerror=()=>{h(new Q(k.READ_LOCAL_AUDIO_FILE_ERROR))},p.readAsArrayBuffer(o)});const s=yield function(c){const d=lh();return new z((h,p)=>{d.decodeAudioData(c,m=>{h(m)},m=>{p(new Q(k.DECODE_AUDIO_FILE_FAILED,m.toString()))})})}(i);return"string"==typeof o&&n&&hD.set(o,s),s}),Vf.apply(this,arguments)}const hh=o=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new z((i,s)=>{n.toBlob(function(){var c=L(function*(d){if(n.remove(),d){const h=yield SE(d);i({buffer:h,width:n.width,height:n.height})}else s(new Q(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(d){return c.apply(this,arguments)}}(),o,1)})},SE=function(){var o=L(function*(n){const i=yield n.arrayBuffer();return new Uint8Array(i)});return function(i){return o.apply(this,arguments)}}(),dc=new class extends jt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),C(this,"_lastHiddenTime",0),C(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),T.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function Cb(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function fD(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Cb(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Cb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class bb{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(T.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}constructor(n){C(this,"trackId",void 0),C(this,"config",void 0),C(this,"onFirstVideoFrameDecoded",void 0),C(this,"freezeTimeCounterList",[]),C(this,"renderFreezeAccTime",0),C(this,"isKeepLastFrame",!1),C(this,"timeUpdatedCount",0),C(this,"freezeTime",0),C(this,"playbackTime",0),C(this,"lastTimeUpdatedTime",0),C(this,"autoplayFailed",!1),C(this,"videoTrack",void 0),C(this,"videoElement",void 0),C(this,"cacheVideoElement",void 0),C(this,"videoElementCheckInterval",void 0),C(this,"_videoElementStatus",Bi.NONE),C(this,"isGettingVideoDimensions",!1),C(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return T.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),C(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===Tt.curState&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(_C())),Fw()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),C(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Bi.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(s){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Bi.CANPLAY;break;case"stalled":this.videoElementStatus=Bi.STALLED;break;case"suspend":this.videoElementStatus=Bi.SUSPEND;break;case"pause":this.videoElementStatus=Bi.PAUSED,hi()||pa()||or()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Bi.WAITING;break;case"abort":this.videoElementStatus=Bi.ABORT;break;case"ended":this.videoElementStatus=Bi.ENDED;break;case"emptied":this.videoElementStatus=Bi.EMPTIED;break;case"error":{this.videoElementStatus=Bi.ERROR;const s=this.videoElement.error;s&&T.error("[".concat(this.trackId,"] media error, code: ").concat(s.code,", message: ").concat(s.message));break}case"timeupdate":{const s=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=s);const c=s-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=s,dc.lastVisibleTime<dc.lastHiddenTime||d<dc.lastHiddenTime||d<dc.lastVisibleTime)return;for(c>B("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),C(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(T.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(_C())),Fw()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,this.videoElement=n.element instanceof HTMLVideoElement?n.element:document.createElement("video"),Tt.on(oi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Tt.on(oi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return null!==(n=this.videoElement.parentElement)&&void 0!==n?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{n&&Vo(n,"video",c.message,this.trackId),"NotAllowedError"===c.name?(T.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):T.warning("[".concat(this.trackId,"] play warning: "),c)});const s=lt();if(("Safari"===s.name&&15===Number(s.version)||tf())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");if(!i)return T.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,n.width,n.height);const s=i.getImageData(0,0,n.width,n.height);return n.remove(),s}getCurrentFrameToUint8Array(n){var i=arguments,s=this;return L(function*(){let c=i.length>1&&void 0!==i[1]?i[1]:1;const d=document.createElement("canvas");d.width=s.videoElement.videoWidth,d.height=s.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(s.videoElement,0,0,d.width,d.height),new z((p,m)=>{d.toBlob(function(){var _=L(function*(E){if(d.remove(),E){const v=yield SE(E);p({buffer:v,width:d.width,height:d.height})}else m(new Q(k.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))});return function(E){return _.apply(this,arguments)}}(),n,c<0?.1:c>1?1:c)})):yield hh(n)})()}destroy(){Tt.off(oi.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Tt.off(oi.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=Bi.INIT,!this.videoElementCheckInterval&&(mD.forEach(d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{var d;(d=this.videoElement)!==document.body&&document.body.contains(d)||(this.videoElementStatus=Bi.DESTROYED)},1e3),B("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,i;let d;const h=(p,m)=>{if(this.videoElementStatus===Bi.PLAYING){if(d){const v=m.presentationTime-d.presentationTime;v>B("VIDEO_FREEZE_DURATION")&&dc.lastVisibleTime>=dc.lastHiddenTime&&d.timestamp>dc.lastVisibleTime&&d.timestamp>dc.lastHiddenTime&&(this.renderFreezeAccTime+=v)}d=fD(fD({},m),{},{timestamp:p})}var _,E;B("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(_=(E=this.videoElement).requestVideoFrameCallback)||void 0===_||_.call(E,h))};null===(n=(i=this.videoElement).requestVideoFrameCallback)||void 0===n||n.call(i,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),rd()&&(this.videoElement.poster="noposter");const s=lt();"Safari"===s.name&&15===Number(s.version)||tf()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Bt()&&this.videoElement.load());const c=this.videoElement.play();void 0!==c&&c.catch(d=>{T.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())})}resetVideoElement(){mD.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Bi.NONE}handleAutoPlayFailed(){const n=i=>{i.preventDefault(),this.videoElement.play().then(()=>{T.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(s=>{T.error(s)}),this.autoplayFailed=!1,Xc()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};Xc()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),aD()}}const mD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class _D extends bb{constructor(n){super(n),C(this,"container",void 0),C(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const i=n.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var i;null!==(i=this.container)&&void 0!==i&&i.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}getCurrentFrameToUint8Array(n){var i=arguments,s=()=>super.getCurrentFrameToUint8Array,c=this;return L(function*(){var d;let h=i.length>1&&void 0!==i[1]?i[1]:1;return null!==(d=c.container)&&void 0!==d&&d.contains(c.videoElement)?yield s().call(c,n,h):yield hh(n)})()}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(n){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",B("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if(null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(i){}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;null!==(n=this.container)&&void 0!==n&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function Tb(o){return new z((n,i)=>{let s=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=hi()?"canplay":"playing";c.addEventListener(d,()=>{const h=c.videoWidth,p=c.videoHeight;!h&&Bt()||(s=!0,c.srcObject=null,c.remove(),n([h,p]))}),c.srcObject=new MediaStream([o]),c.play().catch(Hg),setTimeout(()=>{s||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}const hL=function(){var o=L(function*(n,i,s){const c=function(p){const m=[];for(let _=0;_<p.length;_+=2)m.push(parseInt(p.slice(_,_+2),16));return Uint8Array.from(m)}(function(p){const m="0123456789abcdef";function _(ge){let Ee,ze="";for(Ee=0;Ee<=3;Ee++)ze+=m.charAt(ge>>8*Ee+4&15)+m.charAt(ge>>8*Ee&15);return ze}function E(ge,Ee){const ze=(65535&ge)+(65535&Ee);return(ge>>16)+(Ee>>16)+(ze>>16)<<16|65535&ze}function v(ge,Ee,ze,ht,St,st){return E((Ct=E(E(Ee,ge),E(ht,st)))<<(ee=St)|Ct>>>32-ee,ze);var Ct,ee}function S(ge,Ee,ze,ht,St,st,Ct){return v(Ee&ze|~Ee&ht,ge,Ee,St,st,Ct)}function b(ge,Ee,ze,ht,St,st,Ct){return v(Ee&ht|ze&~ht,ge,Ee,St,st,Ct)}function O(ge,Ee,ze,ht,St,st,Ct){return v(Ee^ze^ht,ge,Ee,St,st,Ct)}function P(ge,Ee,ze,ht,St,st,Ct){return v(ze^(Ee|~ht),ge,Ee,St,st,Ct)}const w=function(ge){let Ee;const ze=1+(ge.length+8>>6),ht=new Array(16*ze);for(Ee=0;Ee<16*ze;Ee++)ht[Ee]=0;for(Ee=0;Ee<ge.length;Ee++)ht[Ee>>2]|=ge.charCodeAt(Ee)<<Ee%4*8;return ht[Ee>>2]|=128<<Ee%4*8,ht[16*ze-2]=8*ge.length,ht}(p);let M,V,U,Y,ie,K=1732584193,X=-271733879,$=-1732584194,J=271733878;for(M=0;M<w.length;M+=16)V=K,U=X,Y=$,ie=J,K=S(K,X,$,J,w[M+0],7,-680876936),J=S(J,K,X,$,w[M+1],12,-389564586),$=S($,J,K,X,w[M+2],17,606105819),X=S(X,$,J,K,w[M+3],22,-1044525330),K=S(K,X,$,J,w[M+4],7,-176418897),J=S(J,K,X,$,w[M+5],12,1200080426),$=S($,J,K,X,w[M+6],17,-1473231341),X=S(X,$,J,K,w[M+7],22,-45705983),K=S(K,X,$,J,w[M+8],7,1770035416),J=S(J,K,X,$,w[M+9],12,-1958414417),$=S($,J,K,X,w[M+10],17,-42063),X=S(X,$,J,K,w[M+11],22,-1990404162),K=S(K,X,$,J,w[M+12],7,1804603682),J=S(J,K,X,$,w[M+13],12,-40341101),$=S($,J,K,X,w[M+14],17,-1502002290),X=S(X,$,J,K,w[M+15],22,1236535329),K=b(K,X,$,J,w[M+1],5,-165796510),J=b(J,K,X,$,w[M+6],9,-1069501632),$=b($,J,K,X,w[M+11],14,643717713),X=b(X,$,J,K,w[M+0],20,-373897302),K=b(K,X,$,J,w[M+5],5,-701558691),J=b(J,K,X,$,w[M+10],9,38016083),$=b($,J,K,X,w[M+15],14,-660478335),X=b(X,$,J,K,w[M+4],20,-405537848),K=b(K,X,$,J,w[M+9],5,568446438),J=b(J,K,X,$,w[M+14],9,-1019803690),$=b($,J,K,X,w[M+3],14,-187363961),X=b(X,$,J,K,w[M+8],20,1163531501),K=b(K,X,$,J,w[M+13],5,-1444681467),J=b(J,K,X,$,w[M+2],9,-51403784),$=b($,J,K,X,w[M+7],14,1735328473),X=b(X,$,J,K,w[M+12],20,-1926607734),K=O(K,X,$,J,w[M+5],4,-378558),J=O(J,K,X,$,w[M+8],11,-2022574463),$=O($,J,K,X,w[M+11],16,1839030562),X=O(X,$,J,K,w[M+14],23,-35309556),K=O(K,X,$,J,w[M+1],4,-1530992060),J=O(J,K,X,$,w[M+4],11,1272893353),$=O($,J,K,X,w[M+7],16,-155497632),X=O(X,$,J,K,w[M+10],23,-1094730640),K=O(K,X,$,J,w[M+13],4,681279174),J=O(J,K,X,$,w[M+0],11,-358537222),$=O($,J,K,X,w[M+3],16,-722521979),X=O(X,$,J,K,w[M+6],23,76029189),K=O(K,X,$,J,w[M+9],4,-640364487),J=O(J,K,X,$,w[M+12],11,-421815835),$=O($,J,K,X,w[M+15],16,530742520),X=O(X,$,J,K,w[M+2],23,-995338651),K=P(K,X,$,J,w[M+0],6,-198630844),J=P(J,K,X,$,w[M+7],10,1126891415),$=P($,J,K,X,w[M+14],15,-1416354905),X=P(X,$,J,K,w[M+5],21,-57434055),K=P(K,X,$,J,w[M+12],6,1700485571),J=P(J,K,X,$,w[M+3],10,-1894986606),$=P($,J,K,X,w[M+10],15,-1051523),X=P(X,$,J,K,w[M+1],21,-2054922799),K=P(K,X,$,J,w[M+8],6,1873313359),J=P(J,K,X,$,w[M+15],10,-30611744),$=P($,J,K,X,w[M+6],15,-1560198380),X=P(X,$,J,K,w[M+13],21,1309151649),K=P(K,X,$,J,w[M+4],6,-145523070),J=P(J,K,X,$,w[M+11],10,-1120210379),$=P($,J,K,X,w[M+2],15,718787259),X=P(X,$,J,K,w[M+9],21,-343485551),K=E(K,V),X=E(X,U),$=E($,Y),J=E(J,ie);return _(K)+_(X)+_($)+_(J)}(""+i+s)).slice(0,16),d=c.slice(0,12),h=yield window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(yield window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},h,n))});return function(i,s,c){return o.apply(this,arguments)}}(),Rb=function(){var o=L(function*(n,i,s){return yield hL(n.buffer,i,s)});return function(i,s,c){return o.apply(this,arguments)}}();function Bf(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function lr(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Bf(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Bf(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class We extends zn{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Bi.PLAYING)}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,i,s,c,d,h){if(super(n,d),C(this,"trackMediaType","video"),C(this,"_player",void 0),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"_encoderConfig",void 0),C(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),C(this,"_optimizationMode",void 0),C(this,"_videoHeight",void 0),C(this,"_videoWidth",void 0),C(this,"_forceBitrateLimit",void 0),C(this,"_enabled",!0),C(this,"processorDestination",void 0),C(this,"_processorContext",void 0),or()){const{width:p,height:m}=n.getSettings();this._videoWidth=p,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=s,this._optimizationMode=c,this._hints=h||[],-1===this._hints.indexOf(Ht.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(p,m,_){const E=lt();return!(E.name!==p||!E.osVersion)&&115===Number(E.version)}(mt.CHROME)&&-1!==Zp().indexOf("Windows")){const p=function(m,_){if("VideoFrame"in window&&"TransformStream"in window&&Ge().supportWebRTCInsertableStream){const E=new MediaStreamTrackProcessor(m),v=new MediaStreamTrackGenerator({kind:"video"});let S,b,O=Date.now();const P=()=>{w&&(clearInterval(w),w=void 0),S&&(S.close(),S=void 0),m.stop(),b=void 0,v.removeEventListener("ended",P)};let w=window.setInterval(()=>{if(b&&S&&Date.now()-O>1e3)try{"live"===v.readyState?b.enqueue(S.clone()):P()}catch(V){P()}},1e3);const M=new TransformStream({transform:(V,U)=>{"live"===v.readyState?(b=U,O=Date.now(),void 0===S?(S=V,U.enqueue(V.clone())):(U.enqueue(S),S=V)):V.close()}});return v.addEventListener("ended",P),E.readable.pipeThrough(M).pipeTo(v.writable),v}}(n);p&&(T.info("local screen video track begin to inject frame"),this._mediaStreamTrack=p)}i&&-1!==this._hints.indexOf(Ht.CUSTOM_TRACK)&&this.setEncoderConfiguration(i),this.processorContext=new dD(this.getTrackId(),"local"),this.processorDestination=new dh(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const c=document.getElementById(n);c?n=c:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=lr(lr(lr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(s):(this._player=n instanceof HTMLVideoElement?new bb(s):new _D(s),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(pd.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch(c){}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}setEnabled(n,i){var s=this;return L(function*(){if(!i){if(n===s._enabled)return;s.stateCheck("enabled",n)}if(T.info("[".concat(s.getTrackId(),"] start setEnabled"),n),!n){s._originMediaStreamTrack.enabled=!1;try{yield Lt(s,pe.NEED_DISABLE_TRACK,s)}catch(c){throw T.error("[".concat(s.getTrackId(),"] setEnabled to false error"),c.toString()),c}return i||(s._enabled=!1),void T.info("[".concat(s.getTrackId(),"] setEnabled to false success"))}s._originMediaStreamTrack.enabled=!0;try{yield Lt(s,pe.NEED_ENABLE_TRACK,s)}catch(c){throw T.error("[".concat(s.getTrackId(),"] setEnabled to true error"),c.toString()),c}T.info("[".concat(s.getTrackId(),"] setEnabled to true success")),i||(s._enabled=!0)})()}setMuted(n){var i=this;return L(function*(){n!==i._muted&&(i.stateCheck("muted",n),i._muted=n,i._originMediaStreamTrack.enabled=!n,T.debug("[".concat(i.getTrackId(),"] start set muted: ").concat(n)),n?yield Lt(i,pe.NEED_MUTE_TRACK,i):yield Lt(i,pe.NEED_UNMUTE_TRACK,i))})()}setEncoderConfiguration(n,i){var s=this;return L(function*(){if(!s._enabled)throw new Q(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=ac(n),s._forceBitrateLimit&&(n.bitrateMax=s._forceBitrateLimit.max_bitrate?s._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=s._forceBitrateLimit.min_bitrate?s._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const c=md({encoderConfig:n});(or()||hi()||pa())&&(c.deviceId=void 0),T.debug("[".concat(s.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{yield s._originMediaStreamTrack.applyConstraints(c),s.updateMediaStreamTrackResolution()}catch(d){const h=new Q(k.UNEXPECTED_ERROR,d.toString());throw T.error("[".concat(s.getTrackId(),"] applyConstraints error"),h.toString()),h}}s._encoderConfig=n,-1===s._hints.indexOf(Ht.SCREEN_TRACK)&&s.updateBitrateFromProfile();try{yield Lt(s,pe.NEED_UPDATE_VIDEO_ENCODER,s)}catch(c){return c.throw(T)}})()}getStats(){return af(()=>{T.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),lo(this,pe.GET_STATS)||lr({},pb)}setBeautyEffect(n){return L(function*(){T.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}getCurrentFrameImage(n){var i=arguments,s=this;return L(function*(){return s._player?s._player.getCurrentFrameToUint8Array(n,i.length>1&&void 0!==i[1]?i[1]:1):yield hh(n)})()}setBitrateLimit(n){var i=this;return L(function*(){if(T.debug("[".concat(i.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n){i._forceBitrateLimit=n,i._encoderConfig&&(i._encoderConfig.bitrateMax=i._encoderConfig.bitrateMax&&i._encoderConfig.bitrateMax<n.max_bitrate?i._encoderConfig.bitrateMax:n.max_bitrate,i._encoderConfig.bitrateMin=n.min_bitrate);try{yield Lt(i,pe.NEED_UPDATE_VIDEO_ENCODER,i)}catch(s){return s.throw(T)}}})()}setOptimizationMode(n){var i=this;return L(function*(){if("motion"!==n&&"detail"!==n&&"balanced"!==n)return void T.error(k.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=i._optimizationMode;try{i._optimizationMode=n,yield Lt(i,pe.SET_OPTIMIZATION_MODE,i)}catch(c){throw i._optimizationMode=s,T.error("[".concat(i.getTrackId(),"] set optimization mode failed"),c.toString()),c}T.info("[".concat(i.getTrackId(),"] set optimization mode success (").concat(n,")"))})()}setScalabiltyMode(n){if(1===n.numSpatialLayers&&1!==n.numTemporalLayers)return T.error(k.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,T.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){Tb(this._originMediaStreamTrack).then(n=>{let[i,s]=n;this._videoHeight=s,this._videoWidth=i}).catch(Hg)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:i,frameRate:s}=this.getMediaStreamTrackSettings();if(!n||!i||!s)return;const[c,d]=function(h,p,m,_){let E;const v=200*Math.pow(m/15,.6)*Math.pow(h*p/640/360,.75),S=v;if("STANDARD_BITRATE"===_)E=4*v;else{if("COMPATIABLE_BITRATE"!==_)return;E=2*v}return[Math.floor(E),Math.floor(S)]}(n,i,s,B("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=c,T.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(i,", fps: ").concat(s,"] => [brMax: ").concat(c,", brMin: ").concat(d,"]")))}getVideoElementVisibleStatus(){try{var n,i;const s=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),c={track:this,element:null==this||null===(i=this._player)||void 0===i?void 0:i.getVideoElement(),slot:null==s?void 0:s.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=Hw.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Q(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}renewMediaStreamTrack(n){return L(function*(){})()}pipe(n){if(this.processor===n)return n;if(n._source)throw new Q(k.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this._encoderConfig;n&&(s=lr(lr({},s),ac(n))),s=sd(s);const c=Ot(8,"track-video-cloned-"),d=new We(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,s,sd(this._scalabilityMode),this._optimizationMode,c,sd(this._hints));return n&&s&&d.setEncoderConfiguration(s),T.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),d}replaceTrack(n,i){var s=this;return L(function*(){if(!(n instanceof MediaStreamTrack))throw new Q(k.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==n.kind)throw new Q(k.INVALID_PARAMS,"track should be a video MediaStreamTrack");yield s._updateOriginMediaStreamTrack(n,i,!0),s.updateMediaStreamTrackResolution()})()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Vi.ON_TRACK,function(){var i=L(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(),yield Lt(n,pe.NEED_REPLACE_TRACK,n)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield Lt(n,pe.NEED_REPLACE_TRACK,n))});return function(s){return i.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Vi.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Nr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Nr.REQUEST_CONSTRAINTS)}}te([Ie({argsMap:(o,n,i)=>[o.getTrackId(),"string"==typeof n?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),yn(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],We.prototype,"play",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],We.prototype,"stop",null),te([Ku("LocalVideoTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",z)],We.prototype,"setEnabled",null),te([Ku("LocalVideoTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",z)],We.prototype,"setMuted",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",z)],We.prototype,"setEncoderConfiguration",null),te([yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Object)],We.prototype,"getStats",null),te([Ie({argsMap:(o,n,i)=>[o.getTrackId(),n,i]}),yn(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",z)],We.prototype,"setBeautyEffect",null),te([yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",ImageData)],We.prototype,"getCurrentFrameData",null),te([yn(),N("design:type",Function),N("design:paramtypes",[String,Number]),N("design:returntype",z)],We.prototype,"getCurrentFrameImage",null),te([yn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],We.prototype,"setBitrateLimit",null),te([yn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],We.prototype,"setOptimizationMode",null),te([yn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],We.prototype,"setScalabiltyMode",null),te([yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],We.prototype,"updateMediaStreamTrackResolution",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],We.prototype,"pipe",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],We.prototype,"unpipe",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],We.prototype,"close",null),te([Ie({argsMap:(o,n,i)=>[o.getTrackId(),n.label,i]}),N("design:type",Function),N("design:paramtypes",[MediaStreamTrack,Boolean]),N("design:returntype",z)],We.prototype,"replaceTrack",null);class sl extends We{get __className__(){return"CameraVideoTrack"}constructor(n,i,s,c,d,h){var p;super(n,ac(i.encoderConfig),c,d,h),p=this,C(this,"_config",void 0),C(this,"_originalConstraints",void 0),C(this,"_constraints",void 0),C(this,"_enabled",!0),C(this,"_deviceName","default"),C(this,"tryResumeVideoForIOS15_16WeChat",L(function*(){(tf()||Ne())&&!function(){const m=lt();if(m.os!==ti.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return 15===Number(_[0])&&Number(_[1])>=2}()&&Uw()&&p._enabled&&!p._isClosed&&(T.debug("[".concat(p.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),yield p.renewMediaStreamTrack())})),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=n.label,this._encoderConfig=ac(this._config.encoderConfig),Tt.on(oi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Tt.on(oi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}setDevice(n){var i=this;return L(function*(){return"string"==typeof n?i._setDeviceById(n):n.deviceId?i._setDeviceById(n.deviceId):n.facingMode?i._setDeviceByFacingModel(n.facingMode):void 0})()}_setDeviceById(n){var i=this;return L(function*(){if(T.info("[".concat(i.getTrackId(),"] set device to ").concat(n)),i._enabled)try{const s=yield _o.getDeviceById(n),c={};c.video=lr({},i._constraints),c.video.deviceId={exact:n},c.video.facingMode=void 0,i._originMediaStreamTrack.stop();let d=null;try{d=yield Cr(c,i.getTrackId())}catch(h){throw T.error("[".concat(i.getTrackId(),"] setDevice failed"),h.toString()),d=yield Cr({video:i._constraints},i.getTrackId()),yield i._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}yield i._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),i.updateMediaStreamTrackResolution(),i._deviceName=s.label,i._config.cameraId=n,i._constraints.deviceId={exact:n}}catch(s){throw T.error("[".concat(i.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=yield _o.getDeviceById(n);i._deviceName=s.label,i._config.cameraId=n,i._constraints.deviceId={exact:n}}catch(s){throw T.error("[".concat(i.getTrackId(),"] setDevice error"),s.toString()),s}T.info("[".concat(i.getTrackId(),"] setDevice success"))})()}_setDeviceByFacingModel(n){var i=this;return L(function*(){T.info("[".concat(i.getTrackId(),"] set facingMode ").concat(n));const s={video:lr(lr({},i._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(i._enabled){i._originMediaStreamTrack.stop();let c=null;try{c=yield Cr(s,i.getTrackId())}catch(d){throw T.error("[".concat(i.getTrackId(),"] setDeviceByFacingModel failed"),d.toString()),c=yield Cr({video:i._constraints},i.getTrackId()),yield i._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}yield i._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),i.updateMediaStreamTrackResolution()}i._deviceName="",i._config.facingMode=n,i._config.cameraId=void 0,i._constraints=lr({},s.video),T.info("[".concat(i.getTrackId(),"] setDeviceByFacingModel success"))})()}setEnabled(n,i){var s=this;return L(function*(){if(!i){if(n===s._enabled)return;s.stateCheck("enabled",n)}if(T.info("[".concat(s.getTrackId(),"] start setEnabled"),n),n){try{if(s.isExternalTrack)s._originMediaStreamTrack.enabled=!0;else{const c=yield Cr({video:s._constraints},s.getTrackId());yield s._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1)}yield Lt(s,pe.NEED_ENABLE_TRACK,s)}catch(c){throw T.error("[".concat(s.getTrackId(),"] setEnabled true error"),c.toString()),c}s.updateMediaStreamTrackResolution(),T.info("[".concat(s.getTrackId(),"] setEnabled to true success")),i||(s._enabled=!0)}else{s.isExternalTrack?s._originMediaStreamTrack.enabled=!1:(s._originMediaStreamTrack.onended=null,s._originMediaStreamTrack.stop()),i||(s._enabled=!1);try{yield Lt(s,pe.NEED_DISABLE_TRACK,s)}catch(c){throw T.error("[".concat(s.getTrackId(),"] setEnabled to false error"),c.toString()),c}T.info("[".concat(s.getTrackId(),"] setEnabled to false success"))}})()}setEncoderConfiguration(n,i){var s=this;return L(function*(){if(!s._enabled)throw new Q(k.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=ac(n),s._forceBitrateLimit&&(n.bitrateMax=s._forceBitrateLimit.max_bitrate?s._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=s._forceBitrateLimit.min_bitrate?s._forceBitrateLimit.min_bitrate:n.bitrateMin);const c=Mn(s._config);c.encoderConfig=n;const d=md(c);(or()||hi()||pa())&&(d.deviceId=void 0),T.debug("[".concat(s.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(d));try{yield s._originMediaStreamTrack.applyConstraints(d),s.updateMediaStreamTrackResolution()}catch(h){const p=new Q(k.UNEXPECTED_ERROR,h.toString());throw T.error("[".concat(s.getTrackId(),"] applyConstraints error"),p.toString()),p}s._config=c,s._constraints=d,s._originalConstraints=d,s._encoderConfig=n,-1===s._hints.indexOf(Ht.SCREEN_TRACK)&&s.updateBitrateFromProfile();try{yield Lt(s,pe.NEED_UPDATE_VIDEO_ENCODER,s)}catch(h){return h.throw(T)}})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){var n=this;if((hi()||pa())&&this._enabled&&!this._isClosed&&Tt.duringInterruption){const i=function(){var s=L(function*(){Tt.off(oi.IOS_INTERRUPTION_END,i),n._enabled&&!n._isClosed&&(T.debug("[".concat(n.getTrackId(),"] try capture camera media device for interrupted iOS device.")),yield n.setEnabled(!1),yield n.setEnabled(!0))});return function(){return s.apply(this,arguments)}}();Tt.on(oi.IOS_INTERRUPTION_END,i)}else T.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(pd.TRACK_ENDED)}renewMediaStreamTrack(n){var i=this;return L(function*(){const s=n||i._constraints,c=_o.searchDeviceIdByName(i._deviceName);if(c&&!s.deviceId&&(s.deviceId={exact:c}),i._enabled){const d=yield Cr({video:s},i.getTrackId());i._constraints=s,yield i._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!0),i.updateMediaStreamTrackResolution()}})()}close(){super.close(),Tt.off(oi.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Tt.off(oi.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this._encoderConfig;n&&(s=lr(lr({},s),ac(n))),s=sd(s);const c=Ot(8,"track-cam-cloned-"),d=new sl(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,sd(lr(lr({},this._config),{},{encoderConfig:s})),sd(this._constraints),sd(this._scalabilityMode),this._optimizationMode,c);return n&&s&&d.setEncoderConfiguration(s),T.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),d}bindProcessorContextEvents(){var n=this;this.processorContext.on(Nr.REQUEST_UPDATE_CONSTRAINTS,function(){var i=L(function*(s,c,d){try{const h=Object.assign({},n._originalConstraints,...s);yield n.renewMediaStreamTrack(h),c()}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this.processorContext.on(Nr.REQUEST_CONSTRAINTS,function(){var i=L(function*(s){s(n._originMediaStreamTrack.getSettings())});return function(s){return i.apply(this,arguments)}}())}}function CE(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function jf(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?CE(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):CE(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Ib(o,n,i,s){i.optimizationMode&&(s&&s.width&&s.height?(i.encoderConfig=jf(jf({},s),{},{bitrateMin:s.bitrateMin,bitrateMax:s.bitrateMax}),"motion"!==i.optimizationMode&&"detail"!==i.optimizationMode||(n.contentHint=i.optimizationMode,n.contentHint===i.optimizationMode?T.debug("[".concat(o,"] set content hint to"),i.optimizationMode):T.debug("[".concat(o,"] set content hint failed")))):T.warning("[".concat(o,"] can not apply optimization mode bitrate config, no encoderConfig")))}function bE(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function TE(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?bE(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):bE(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],sl.prototype,"setDevice",null),te([Ku("CameraVideoTrack","_enabledMutex"),Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[Boolean,Boolean]),N("design:returntype",z)],sl.prototype,"setEnabled",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),yn(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",z)],sl.prototype,"setEncoderConfiguration",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],sl.prototype,"close",null);class gD extends ba{getUserId(){return this._userId}constructor(n,i,s,c){super(n,"track-".concat(n.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(Ot(5,""))),C(this,"_userId",void 0),C(this,"_uintId",void 0),C(this,"_isDestroyed",!1),C(this,"store",void 0),C(this,"processor",void 0),this._userId=i,this._uintId=s,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,T.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class Ta extends gD{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Bi.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(n,i,s,c){super(n,i,s,c),C(this,"_videoVisibleTimer",null),C(this,"_previousVideoVisibleStatus",void 0),C(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),C(this,"trackMediaType","video"),C(this,"_videoWidth",void 0),C(this,"_videoHeight",void 0),C(this,"_player",void 0),C(this,"processorDestination",void 0),C(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new dD(this.getTrackId(),"remote"),this.processorDestination=new dh(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return af(()=>{T.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),lo(this,pe.GET_STATS)||TE({},nl)}play(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof n){const c=document.getElementById(n);c?n=c:(T.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}T.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=TE(TE({fit:"cover"},i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(s):(this._player=n instanceof HTMLVideoElement?new bb(s):new _D(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ch.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(ch.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch(c){}},B("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,T.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Tb(this._originMediaStreamTrack).then(n=>{let[i,s]=n;this._videoHeight=s,this._videoWidth=i}).catch(Hg)}_updatePlayerSource(){T.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var n,i;const s=null==this||null===(n=this._player)||void 0===n?void 0:n.getContainerElement(),c={track:this,element:null==this||null===(i=this._player)||void 0===i?void 0:i.getVideoElement(),slot:null==s?void 0:s.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const p=Hw.checkOneElementVisible(d),m=Object.assign({},p);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(m.visible?"Video is visible":"Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Q(k.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(n){if(this.processor===n)return n;if(n._source)throw new Q(k.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Vi.ON_TRACK,function(){var i=L(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource()):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(s){return i.apply(this,arguments)}}())}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Vi.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}te([Ie({argsMap:(o,n,i)=>[o.getTrackId(),"string"==typeof n?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",void 0)],Ta.prototype,"play",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ta.prototype,"stop",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],Ta.prototype,"pipe",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Ta.prototype,"unpipe",null);class go extends gD{get isPlaying(){return this._useAudioElement?eo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(n,i,s,c){super(n,i,s,c),C(this,"trackMediaType","audio"),C(this,"_source",void 0),C(this,"_useAudioElement",!0),C(this,"_volume",100),C(this,"processorContext",void 0),C(this,"processorDestination",void 0),C(this,"_played",!1),C(this,"_bypassWebAudio",!1),B("DISABLE_WEBAUDIO")?(this._source=new Rt,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new Qe(n,!0),B("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once($i.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ch.FIRST_FRAME_DECODED)}),this.processorContext=new Ze(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Ci(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on($i.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!n)return this._source.removeAllListeners($i.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners($i.ON_AUDIO_BUFFER),this._source.on($i.ON_AUDIO_BUFFER,s=>n(s))}setVolume(n){this._volume=n,this._useAudioElement?eo.setVolume(this.getTrackId(),n):this._source.setVolume(n/100)}setPlaybackDevice(n){var i=this;return L(function*(){if(!i._useAudioElement)throw new Q(k.NOT_SUPPORTED,"your browser does not support setting the audio output device");yield eo.setSinkID(i.getTrackId(),n)})()}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return af(()=>{T.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),lo(this,pe.GET_STATS)||TE({},tD)}play(){T.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(T.debug("[".concat(this.getTrackId(),"] use audio element to play")),eo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){T.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?eo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];T.debug("[".concat(this.getTrackId(),"] update player source track")),n&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&eo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(n){if(this._bypassWebAudio)throw new Q(k.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===n)return n;if(n._source)throw new Q(k.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),n}unpipe(){var n;if(this._bypassWebAudio)throw new Q(k.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const i=this.processor;null===(n=this._source.processSourceNode)||void 0===n||n.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){var n=this;this.processorDestination.on(Vi.ON_TRACK,function(){var i=L(function*(s){s?s!==n._mediaStreamTrack&&(n._mediaStreamTrack=s,n._updatePlayerSource(!1),n._source.processedNode=n._source.createMediaStreamSourceNode(s)):n._mediaStreamTrack!==n._originMediaStreamTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource())});return function(s){return i.apply(this,arguments)}}()),this.processorDestination.on(Vi.ON_NODE,i=>{this._source.processedNode=i;const s=!i;this._useAudioElement!==s&&(this._played?(this.stop(),this._useAudioElement=s,this.play()):this._useAudioElement=s)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Vi.ON_TRACK),this.processorDestination.removeAllListeners(Vi.ON_NODE)}}function ph(o){let n=o.length;for(;--n>=0;)o[n]=0}te([Ie({argsMap:(o,n)=>[o.getTrackId(),n],throttleTime:300}),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],go.prototype,"setVolume",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n]}),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],go.prototype,"setPlaybackDevice",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],go.prototype,"play",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],go.prototype,"stop",null),te([Ie({argsMap:(o,n)=>[o.getTrackId(),n.name]}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",Object)],go.prototype,"pipe",null),te([Ie({argsMap:o=>[o.getTrackId()]}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],go.prototype,"unpipe",null);const RE=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),IE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),yU=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),vD=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Gs=new Array(576);ph(Gs);const Hf=new Array(60);ph(Hf);const Gf=new Array(512);ph(Gf);const fh=new Array(256);ph(fh);const wE=new Array(29);ph(wE);const Ab=new Array(30);function al(o,n,i,s,c){this.static_tree=o,this.extra_bits=n,this.extra_base=i,this.elems=s,this.max_length=c,this.has_stree=o&&o.length}let yD,Db,Ob;function Nb(o,n){this.dyn_tree=o,this.max_code=0,this.stat_desc=n}ph(Ab);const SD=o=>o<256?Gf[o]:Gf[256+(o>>>7)],Wf=(o,n)=>{o.pending_buf[o.pending++]=255&n,o.pending_buf[o.pending++]=n>>>8&255},Eo=(o,n,i)=>{o.bi_valid>16-i?(o.bi_buf|=n<<o.bi_valid&65535,Wf(o,o.bi_buf),o.bi_buf=n>>16-o.bi_valid,o.bi_valid+=i-16):(o.bi_buf|=n<<o.bi_valid&65535,o.bi_valid+=i)},uc=(o,n,i)=>{Eo(o,i[2*n],i[2*n+1])},pL=(o,n)=>{let i=0;do{i|=1&o,o>>>=1,i<<=1}while(--n>0);return i>>>1},fL=(o,n,i)=>{const s=new Array(16);let c,d,h=0;for(c=1;c<=15;c++)h=h+i[c-1]<<1,s[c]=h;for(d=0;d<=n;d++){let p=o[2*d+1];0!==p&&(o[2*d]=pL(s[p]++,p))}},bi=o=>{let n;for(n=0;n<286;n++)o.dyn_ltree[2*n]=0;for(n=0;n<30;n++)o.dyn_dtree[2*n]=0;for(n=0;n<19;n++)o.bl_tree[2*n]=0;o.dyn_ltree[512]=1,o.opt_len=o.static_len=0,o.sym_next=o.matches=0},mL=o=>{o.bi_valid>8?Wf(o,o.bi_buf):o.bi_valid>0&&(o.pending_buf[o.pending++]=o.bi_buf),o.bi_buf=0,o.bi_valid=0},AE=(o,n,i,s)=>{const c=2*n,d=2*i;return o[c]<o[d]||o[c]===o[d]&&s[n]<=s[i]},CD=(o,n,i)=>{const s=o.heap[i];let c=i<<1;for(;c<=o.heap_len&&(c<o.heap_len&&AE(n,o.heap[c+1],o.heap[c],o.depth)&&c++,!AE(n,s,o.heap[c],o.depth));)o.heap[i]=o.heap[c],i=c,c<<=1;o.heap[i]=s},bD=(o,n,i)=>{let s,c,d,h,p=0;if(0!==o.sym_next)do{s=255&o.pending_buf[o.sym_buf+p++],s+=(255&o.pending_buf[o.sym_buf+p++])<<8,c=o.pending_buf[o.sym_buf+p++],0===s?uc(o,c,n):(d=fh[c],uc(o,d+256+1,n),h=RE[d],0!==h&&(c-=wE[d],Eo(o,c,h)),s--,d=SD(s),uc(o,d,i),h=IE[d],0!==h&&(s-=Ab[d],Eo(o,s,h)))}while(p<o.sym_next);uc(o,256,n)},Pb=(o,n)=>{const i=n.dyn_tree,s=n.stat_desc.static_tree,c=n.stat_desc.has_stree,d=n.stat_desc.elems;let h,p,m,_=-1;for(o.heap_len=0,o.heap_max=573,h=0;h<d;h++)0!==i[2*h]?(o.heap[++o.heap_len]=_=h,o.depth[h]=0):i[2*h+1]=0;for(;o.heap_len<2;)m=o.heap[++o.heap_len]=_<2?++_:0,i[2*m]=1,o.depth[m]=0,o.opt_len--,c&&(o.static_len-=s[2*m+1]);for(n.max_code=_,h=o.heap_len>>1;h>=1;h--)CD(o,i,h);m=d;do{h=o.heap[1],o.heap[1]=o.heap[o.heap_len--],CD(o,i,1),p=o.heap[1],o.heap[--o.heap_max]=h,o.heap[--o.heap_max]=p,i[2*m]=i[2*h]+i[2*p],o.depth[m]=(o.depth[h]>=o.depth[p]?o.depth[h]:o.depth[p])+1,i[2*h+1]=i[2*p+1]=m,o.heap[1]=m++,CD(o,i,1)}while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],((E,v)=>{const S=v.dyn_tree,b=v.max_code,O=v.stat_desc.static_tree,P=v.stat_desc.has_stree,w=v.stat_desc.extra_bits,M=v.stat_desc.extra_base,V=v.stat_desc.max_length;let U,Y,ie,K,X,$,J=0;for(K=0;K<=15;K++)E.bl_count[K]=0;for(S[2*E.heap[E.heap_max]+1]=0,U=E.heap_max+1;U<573;U++)Y=E.heap[U],K=S[2*S[2*Y+1]+1]+1,K>V&&(K=V,J++),S[2*Y+1]=K,Y>b||(E.bl_count[K]++,X=0,Y>=M&&(X=w[Y-M]),$=S[2*Y],E.opt_len+=$*(K+X),P&&(E.static_len+=$*(O[2*Y+1]+X)));if(0!==J){do{for(K=V-1;0===E.bl_count[K];)K--;E.bl_count[K]--,E.bl_count[K+1]+=2,E.bl_count[V]--,J-=2}while(J>0);for(K=V;0!==K;K--)for(Y=E.bl_count[K];0!==Y;)ie=E.heap[--U],ie>b||(S[2*ie+1]!==K&&(E.opt_len+=(K-S[2*ie+1])*S[2*ie],S[2*ie+1]=K),Y--)}})(o,n),fL(i,_,o.bl_count)},TD=(o,n,i)=>{let s,c,d=-1,h=n[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),n[2*(i+1)+1]=65535,s=0;s<=i;s++)c=h,h=n[2*(s+1)+1],++p<m&&c===h||(p<_?o.bl_tree[2*c]+=p:0!==c?(c!==d&&o.bl_tree[2*c]++,o.bl_tree[32]++):p<=10?o.bl_tree[34]++:o.bl_tree[36]++,p=0,d=c,0===h?(m=138,_=3):c===h?(m=6,_=3):(m=7,_=4))},zf=(o,n,i)=>{let s,c,d=-1,h=n[1],p=0,m=7,_=4;for(0===h&&(m=138,_=3),s=0;s<=i;s++)if(c=h,h=n[2*(s+1)+1],!(++p<m&&c===h)){if(p<_)do{uc(o,c,o.bl_tree)}while(0!=--p);else 0!==c?(c!==d&&(uc(o,c,o.bl_tree),p--),uc(o,16,o.bl_tree),Eo(o,p-3,2)):p<=10?(uc(o,17,o.bl_tree),Eo(o,p-3,3)):(uc(o,18,o.bl_tree),Eo(o,p-11,7));p=0,d=c,0===h?(m=138,_=3):c===h?(m=6,_=3):(m=7,_=4)}};let RD=!1;const Kf=(o,n,i,s)=>{Eo(o,0+(s?1:0),3),mL(o),Wf(o,i),Wf(o,~i),i&&o.pending_buf.set(o.window.subarray(n,n+i),o.pending),o.pending+=i};var vL={_tr_init:o=>{RD||((()=>{let n,i,s,c,d;const h=new Array(16);for(s=0,c=0;c<28;c++)for(wE[c]=s,n=0;n<1<<RE[c];n++)fh[s++]=c;for(fh[s-1]=c,d=0,c=0;c<16;c++)for(Ab[c]=d,n=0;n<1<<IE[c];n++)Gf[d++]=c;for(d>>=7;c<30;c++)for(Ab[c]=d<<7,n=0;n<1<<IE[c]-7;n++)Gf[256+d++]=c;for(i=0;i<=15;i++)h[i]=0;for(n=0;n<=143;)Gs[2*n+1]=8,n++,h[8]++;for(;n<=255;)Gs[2*n+1]=9,n++,h[9]++;for(;n<=279;)Gs[2*n+1]=7,n++,h[7]++;for(;n<=287;)Gs[2*n+1]=8,n++,h[8]++;for(fL(Gs,287,h),n=0;n<30;n++)Hf[2*n+1]=5,Hf[2*n]=pL(n,5);yD=new al(Gs,RE,257,286,15),Db=new al(Hf,IE,0,30,15),Ob=new al(new Array(0),yU,0,19,7)})(),RD=!0),o.l_desc=new Nb(o.dyn_ltree,yD),o.d_desc=new Nb(o.dyn_dtree,Db),o.bl_desc=new Nb(o.bl_tree,Ob),o.bi_buf=0,o.bi_valid=0,bi(o)},_tr_stored_block:Kf,_tr_flush_block:(o,n,i,s)=>{let c,d,h=0;o.level>0?(2===o.strm.data_type&&(o.strm.data_type=(p=>{let m,_=4093624447;for(m=0;m<=31;m++,_>>>=1)if(1&_&&0!==p.dyn_ltree[2*m])return 0;if(0!==p.dyn_ltree[18]||0!==p.dyn_ltree[20]||0!==p.dyn_ltree[26])return 1;for(m=32;m<256;m++)if(0!==p.dyn_ltree[2*m])return 1;return 0})(o)),Pb(o,o.l_desc),Pb(o,o.d_desc),h=(p=>{let m;for(TD(p,p.dyn_ltree,p.l_desc.max_code),TD(p,p.dyn_dtree,p.d_desc.max_code),Pb(p,p.bl_desc),m=18;m>=3&&0===p.bl_tree[2*vD[m]+1];m--);return p.opt_len+=3*(m+1)+5+5+4,m})(o),c=o.opt_len+3+7>>>3,d=o.static_len+3+7>>>3,d<=c&&(c=d)):c=d=i+5,i+4<=c&&-1!==n?Kf(o,n,i,s):4===o.strategy||d===c?(Eo(o,2+(s?1:0),3),bD(o,Gs,Hf)):(Eo(o,4+(s?1:0),3),((p,m,_,E)=>{let v;for(Eo(p,m-257,5),Eo(p,_-1,5),Eo(p,E-4,4),v=0;v<E;v++)Eo(p,p.bl_tree[2*vD[v]+1],3);zf(p,p.dyn_ltree,m-1),zf(p,p.dyn_dtree,_-1)})(o,o.l_desc.max_code+1,o.d_desc.max_code+1,h+1),bD(o,o.dyn_ltree,o.dyn_dtree)),bi(o),s&&mL(o)},_tr_tally:(o,n,i)=>(o.pending_buf[o.sym_buf+o.sym_next++]=n,o.pending_buf[o.sym_buf+o.sym_next++]=n>>8,o.pending_buf[o.sym_buf+o.sym_next++]=i,0===n?o.dyn_ltree[2*i]++:(o.matches++,n--,o.dyn_ltree[2*(fh[i]+256+1)]++,o.dyn_dtree[2*SD(n)]++),o.sym_next===o.sym_end),_tr_align:o=>{var n;Eo(o,2,3),uc(o,256,Gs),16===(n=o).bi_valid?(Wf(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)}},qf=(o,n,i,s)=>{let c=65535&o|0,d=o>>>16&65535|0,h=0;for(;0!==i;){h=i>2e3?2e3:i,i-=h;do{c=c+n[s++]|0,d=d+c|0}while(--h);c%=65521,d%=65521}return c|d<<16|0};const SU=new Uint32Array((()=>{let o,n=[];for(var i=0;i<256;i++){o=i;for(var s=0;s<8;s++)o=1&o?3988292384^o>>>1:o>>>1;n[i]=o}return n})());var dr=(o,n,i,s)=>{const c=SU,d=s+i;o^=-1;for(let h=s;h<d;h++)o=o>>>8^c[255&(o^n[h])];return-1^o},Ed={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},mh={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:yL,_tr_stored_block:ID,_tr_flush_block:SL,_tr_tally:cl,_tr_align:CL}=vL,{Z_NO_FLUSH:ll,Z_PARTIAL_FLUSH:CU,Z_FULL_FLUSH:bL,Z_FINISH:Ws,Z_BLOCK:TL,Z_OK:kr,Z_STREAM_END:RL,Z_STREAM_ERROR:hc,Z_DATA_ERROR:bU,Z_BUF_ERROR:kb,Z_DEFAULT_COMPRESSION:TU,Z_FILTERED:RU,Z_HUFFMAN_ONLY:Mb,Z_RLE:wD,Z_FIXED:IL,Z_DEFAULT_STRATEGY:wL,Z_UNKNOWN:Lb,Z_DEFLATED:dl}=mh,Ra=262,Eh=(o,n)=>(o.msg=Ed[n],n),AL=o=>2*o-(o>4?9:0),yd=o=>{let n=o.length;for(;--n>=0;)o[n]=0},AU=o=>{let n,i,s,c=o.w_size;n=o.hash_size,s=n;do{i=o.head[--s],o.head[s]=i>=c?i-c:0}while(--n);n=c,s=n;do{i=o.prev[--s],o.prev[s]=i>=c?i-c:0}while(--n)};let Sd=(o,n,i)=>(n<<o.hash_shift^i)&o.hash_mask;const cs=o=>{const n=o.state;let i=n.pending;i>o.avail_out&&(i=o.avail_out),0!==i&&(o.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),o.next_out),o.next_out+=i,n.pending_out+=i,o.total_out+=i,o.avail_out-=i,n.pending-=i,0===n.pending&&(n.pending_out=0))},ls=(o,n)=>{SL(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,n),o.block_start=o.strstart,cs(o.strm)},Sn=(o,n)=>{o.pending_buf[o.pending++]=n},Yf=(o,n)=>{o.pending_buf[o.pending++]=n>>>8&255,o.pending_buf[o.pending++]=255&n},ND=(o,n,i,s)=>{let c=o.avail_in;return c>s&&(c=s),0===c?0:(o.avail_in-=c,n.set(o.input.subarray(o.next_in,o.next_in+c),i),1===o.state.wrap?o.adler=qf(o.adler,n,c,i):2===o.state.wrap&&(o.adler=dr(o.adler,n,c,i)),o.next_in+=c,o.total_in+=c,c)},PD=(o,n)=>{let i,s,c=o.max_chain_length,d=o.strstart,h=o.prev_length,p=o.nice_match;const m=o.strstart>o.w_size-Ra?o.strstart-(o.w_size-Ra):0,_=o.window,E=o.w_mask,v=o.prev,S=o.strstart+258;let b=_[d+h-1],O=_[d+h];o.prev_length>=o.good_match&&(c>>=2),p>o.lookahead&&(p=o.lookahead);do{if(i=n,_[i+h]===O&&_[i+h-1]===b&&_[i]===_[d]&&_[++i]===_[d+1]){d+=2,i++;do{}while(_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&_[++d]===_[++i]&&d<S);if(s=258-(S-d),d=S-258,s>h){if(o.match_start=n,h=s,s>=p)break;b=_[d+h-1],O=_[d+h]}}}while((n=v[n&E])>m&&0!=--c);return h<=o.lookahead?h:o.lookahead},vh=o=>{const n=o.w_size;let i,s,c;do{if(s=o.window_size-o.lookahead-o.strstart,o.strstart>=n+(n-Ra)&&(o.window.set(o.window.subarray(n,n+n-s),0),o.match_start-=n,o.strstart-=n,o.block_start-=n,o.insert>o.strstart&&(o.insert=o.strstart),AU(o),s+=n),0===o.strm.avail_in)break;if(i=ND(o.strm,o.window,o.strstart+o.lookahead,s),o.lookahead+=i,o.lookahead+o.insert>=3)for(c=o.strstart-o.insert,o.ins_h=o.window[c],o.ins_h=Sd(o,o.ins_h,o.window[c+1]);o.insert&&(o.ins_h=Sd(o,o.ins_h,o.window[c+3-1]),o.prev[c&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=c,c++,o.insert--,!(o.lookahead+o.insert<3)););}while(o.lookahead<Ra&&0!==o.strm.avail_in)},DL=(o,n)=>{let i,s,c,d=o.pending_buf_size-5>o.w_size?o.w_size:o.pending_buf_size-5,h=0,p=o.strm.avail_in;do{if(i=65535,c=o.bi_valid+42>>3,o.strm.avail_out<c||(c=o.strm.avail_out-c,s=o.strstart-o.block_start,i>s+o.strm.avail_in&&(i=s+o.strm.avail_in),i>c&&(i=c),i<d&&(0===i&&n!==Ws||n===ll||i!==s+o.strm.avail_in)))break;h=n===Ws&&i===s+o.strm.avail_in?1:0,ID(o,0,0,h),o.pending_buf[o.pending-4]=i,o.pending_buf[o.pending-3]=i>>8,o.pending_buf[o.pending-2]=~i,o.pending_buf[o.pending-1]=~i>>8,cs(o.strm),s&&(s>i&&(s=i),o.strm.output.set(o.window.subarray(o.block_start,o.block_start+s),o.strm.next_out),o.strm.next_out+=s,o.strm.avail_out-=s,o.strm.total_out+=s,o.block_start+=s,i-=s),i&&(ND(o.strm,o.strm.output,o.strm.next_out,i),o.strm.next_out+=i,o.strm.avail_out-=i,o.strm.total_out+=i)}while(0===h);return p-=o.strm.avail_in,p&&(p>=o.w_size?(o.matches=2,o.window.set(o.strm.input.subarray(o.strm.next_in-o.w_size,o.strm.next_in),0),o.strstart=o.w_size,o.insert=o.strstart):(o.window_size-o.strstart<=p&&(o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,o.insert>o.strstart&&(o.insert=o.strstart)),o.window.set(o.strm.input.subarray(o.strm.next_in-p,o.strm.next_in),o.strstart),o.strstart+=p,o.insert+=p>o.w_size-o.insert?o.w_size-o.insert:p),o.block_start=o.strstart),o.high_water<o.strstart&&(o.high_water=o.strstart),h?4:n!==ll&&n!==Ws&&0===o.strm.avail_in&&o.strstart===o.block_start?2:(c=o.window_size-o.strstart,o.strm.avail_in>c&&o.block_start>=o.w_size&&(o.block_start-=o.w_size,o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,c+=o.w_size,o.insert>o.strstart&&(o.insert=o.strstart)),c>o.strm.avail_in&&(c=o.strm.avail_in),c&&(ND(o.strm,o.window,o.strstart,c),o.strstart+=c,o.insert+=c>o.w_size-o.insert?o.w_size-o.insert:c),o.high_water<o.strstart&&(o.high_water=o.strstart),c=o.bi_valid+42>>3,c=o.pending_buf_size-c>65535?65535:o.pending_buf_size-c,d=c>o.w_size?o.w_size:c,s=o.strstart-o.block_start,(s>=d||(s||n===Ws)&&n!==ll&&0===o.strm.avail_in&&s<=c)&&(i=s>c?c:s,h=n===Ws&&0===o.strm.avail_in&&i===s?1:0,ID(o,o.block_start,i,h),o.block_start+=i,cs(o.strm)),h?3:1)},kD=(o,n)=>{let i,s;for(;;){if(o.lookahead<Ra){if(vh(o),o.lookahead<Ra&&n===ll)return 1;if(0===o.lookahead)break}if(i=0,o.lookahead>=3&&(o.ins_h=Sd(o,o.ins_h,o.window[o.strstart+3-1]),i=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),0!==i&&o.strstart-i<=o.w_size-Ra&&(o.match_length=PD(o,i)),o.match_length>=3)if(s=cl(o,o.strstart-o.match_start,o.match_length-3),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=3){o.match_length--;do{o.strstart++,o.ins_h=Sd(o,o.ins_h,o.window[o.strstart+3-1]),i=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart}while(0!=--o.match_length);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=Sd(o,o.ins_h,o.window[o.strstart+1]);else s=cl(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(s&&(ls(o,!1),0===o.strm.avail_out))return 1}return o.insert=o.strstart<2?o.strstart:2,n===Ws?(ls(o,!0),0===o.strm.avail_out?3:4):o.sym_next&&(ls(o,!1),0===o.strm.avail_out)?1:2},$f=(o,n)=>{let i,s,c;for(;;){if(o.lookahead<Ra){if(vh(o),o.lookahead<Ra&&n===ll)return 1;if(0===o.lookahead)break}if(i=0,o.lookahead>=3&&(o.ins_h=Sd(o,o.ins_h,o.window[o.strstart+3-1]),i=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=2,0!==i&&o.prev_length<o.max_lazy_match&&o.strstart-i<=o.w_size-Ra&&(o.match_length=PD(o,i),o.match_length<=5&&(o.strategy===RU||3===o.match_length&&o.strstart-o.match_start>4096)&&(o.match_length=2)),o.prev_length>=3&&o.match_length<=o.prev_length){c=o.strstart+o.lookahead-3,s=cl(o,o.strstart-1-o.prev_match,o.prev_length-3),o.lookahead-=o.prev_length-1,o.prev_length-=2;do{++o.strstart<=c&&(o.ins_h=Sd(o,o.ins_h,o.window[o.strstart+3-1]),i=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart)}while(0!=--o.prev_length);if(o.match_available=0,o.match_length=2,o.strstart++,s&&(ls(o,!1),0===o.strm.avail_out))return 1}else if(o.match_available){if(s=cl(o,0,o.window[o.strstart-1]),s&&ls(o,!1),o.strstart++,o.lookahead--,0===o.strm.avail_out)return 1}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(s=cl(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<2?o.strstart:2,n===Ws?(ls(o,!0),0===o.strm.avail_out?3:4):o.sym_next&&(ls(o,!1),0===o.strm.avail_out)?1:2};function pc(o,n,i,s,c){this.good_length=o,this.max_lazy=n,this.nice_length=i,this.max_chain=s,this.func=c}const OE=[new pc(0,0,0,0,DL),new pc(4,4,8,4,kD),new pc(4,5,16,8,kD),new pc(4,6,32,32,kD),new pc(4,4,16,16,$f),new pc(8,16,32,32,$f),new pc(8,16,128,128,$f),new pc(8,32,128,256,$f),new pc(32,128,258,1024,$f),new pc(32,258,258,4096,$f)];function DU(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=dl,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),yd(this.dyn_ltree),yd(this.dyn_dtree),yd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),yd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),yd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const NE=o=>{if(!o)return 1;const n=o.state;return!n||n.strm!==o||42!==n.status&&57!==n.status&&69!==n.status&&73!==n.status&&91!==n.status&&103!==n.status&&113!==n.status&&666!==n.status?1:0},OL=o=>{if(NE(o))return Eh(o,hc);o.total_in=o.total_out=0,o.data_type=Lb;const n=o.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=2===n.wrap?57:n.wrap?42:113,o.adler=2===n.wrap?0:1,n.last_flush=-2,yL(n),kr},NL=o=>{const n=OL(o);var i;return n===kr&&((i=o.state).window_size=2*i.w_size,yd(i.head),i.max_lazy_match=OE[i.level].max_lazy,i.good_match=OE[i.level].good_length,i.nice_match=OE[i.level].nice_length,i.max_chain_length=OE[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),n},PL=(o,n,i,s,c,d)=>{if(!o)return hc;let h=1;if(n===TU&&(n=6),s<0?(h=0,s=-s):s>15&&(h=2,s-=16),c<1||c>9||i!==dl||s<8||s>15||n<0||n>9||d<0||d>IL||8===s&&1!==h)return Eh(o,hc);8===s&&(s=9);const p=new DU;return o.state=p,p.strm=o,p.status=42,p.wrap=h,p.gzhead=null,p.w_bits=s,p.w_size=1<<p.w_bits,p.w_mask=p.w_size-1,p.hash_bits=c+7,p.hash_size=1<<p.hash_bits,p.hash_mask=p.hash_size-1,p.hash_shift=~~((p.hash_bits+3-1)/3),p.window=new Uint8Array(2*p.w_size),p.head=new Uint16Array(p.hash_size),p.prev=new Uint16Array(p.w_size),p.lit_bufsize=1<<c+6,p.pending_buf_size=4*p.lit_bufsize,p.pending_buf=new Uint8Array(p.pending_buf_size),p.sym_buf=p.lit_bufsize,p.sym_end=3*(p.lit_bufsize-1),p.level=n,p.strategy=d,p.method=i,NL(o)};var ul_deflateInit2=PL,ul_deflateSetHeader=(o,n)=>NE(o)||2!==o.state.wrap?hc:(o.state.gzhead=n,kr),ul_deflate=(o,n)=>{if(NE(o)||n>TL||n<0)return o?Eh(o,hc):hc;const i=o.state;if(!o.output||0!==o.avail_in&&!o.input||666===i.status&&n!==Ws)return Eh(o,0===o.avail_out?kb:hc);const s=i.last_flush;if(i.last_flush=n,0!==i.pending){if(cs(o),0===o.avail_out)return i.last_flush=-1,kr}else if(0===o.avail_in&&AL(n)<=AL(s)&&n!==Ws)return Eh(o,kb);if(666===i.status&&0!==o.avail_in)return Eh(o,kb);if(42===i.status&&0===i.wrap&&(i.status=113),42===i.status){let c=dl+(i.w_bits-8<<4)<<8,d=-1;if(d=i.strategy>=Mb||i.level<2?0:i.level<6?1:6===i.level?2:3,c|=d<<6,0!==i.strstart&&(c|=32),c+=31-c%31,Yf(i,c),0!==i.strstart&&(Yf(i,o.adler>>>16),Yf(i,65535&o.adler)),o.adler=1,i.status=113,cs(o),0!==i.pending)return i.last_flush=-1,kr}if(57===i.status)if(o.adler=0,Sn(i,31),Sn(i,139),Sn(i,8),i.gzhead)Sn(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Sn(i,255&i.gzhead.time),Sn(i,i.gzhead.time>>8&255),Sn(i,i.gzhead.time>>16&255),Sn(i,i.gzhead.time>>24&255),Sn(i,9===i.level?2:i.strategy>=Mb||i.level<2?4:0),Sn(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Sn(i,255&i.gzhead.extra.length),Sn(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(o.adler=dr(o.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Sn(i,0),Sn(i,0),Sn(i,0),Sn(i,0),Sn(i,0),Sn(i,9===i.level?2:i.strategy>=Mb||i.level<2?4:0),Sn(i,3),i.status=113,cs(o),0!==i.pending)return i.last_flush=-1,kr;if(69===i.status){if(i.gzhead.extra){let c=i.pending,d=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+d>i.pending_buf_size;){let p=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+p),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(o.adler=dr(o.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=p,cs(o),0!==i.pending)return i.last_flush=-1,kr;c=0,d-=p}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+d),i.pending),i.pending+=d,i.gzhead.hcrc&&i.pending>c&&(o.adler=dr(o.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let c,d=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d&&(o.adler=dr(o.adler,i.pending_buf,i.pending-d,d)),cs(o),0!==i.pending)return i.last_flush=-1,kr;d=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Sn(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>d&&(o.adler=dr(o.adler,i.pending_buf,i.pending-d,d)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let c,d=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d&&(o.adler=dr(o.adler,i.pending_buf,i.pending-d,d)),cs(o),0!==i.pending)return i.last_flush=-1,kr;d=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Sn(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>d&&(o.adler=dr(o.adler,i.pending_buf,i.pending-d,d))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(cs(o),0!==i.pending))return i.last_flush=-1,kr;Sn(i,255&o.adler),Sn(i,o.adler>>8&255),o.adler=0}if(i.status=113,cs(o),0!==i.pending)return i.last_flush=-1,kr}if(0!==o.avail_in||0!==i.lookahead||n!==ll&&666!==i.status){let c=0===i.level?DL(i,n):i.strategy===Mb?((d,h)=>{let p;for(;;){if(0===d.lookahead&&(vh(d),0===d.lookahead)){if(h===ll)return 1;break}if(d.match_length=0,p=cl(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,p&&(ls(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===Ws?(ls(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(ls(d,!1),0===d.strm.avail_out)?1:2})(i,n):i.strategy===wD?((d,h)=>{let p,m,_,E;const v=d.window;for(;;){if(d.lookahead<=258){if(vh(d),d.lookahead<=258&&h===ll)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(_=d.strstart-1,m=v[_],m===v[++_]&&m===v[++_]&&m===v[++_])){E=d.strstart+258;do{}while(m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&m===v[++_]&&_<E);d.match_length=258-(E-_),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(p=cl(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(p=cl(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),p&&(ls(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,h===Ws?(ls(d,!0),0===d.strm.avail_out?3:4):d.sym_next&&(ls(d,!1),0===d.strm.avail_out)?1:2})(i,n):OE[i.level].func(i,n);if(3!==c&&4!==c||(i.status=666),1===c||3===c)return 0===o.avail_out&&(i.last_flush=-1),kr;if(2===c&&(n===CU?CL(i):n!==TL&&(ID(i,0,0,!1),n===bL&&(yd(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),cs(o),0===o.avail_out))return i.last_flush=-1,kr}return n!==Ws?kr:i.wrap<=0?RL:(2===i.wrap?(Sn(i,255&o.adler),Sn(i,o.adler>>8&255),Sn(i,o.adler>>16&255),Sn(i,o.adler>>24&255),Sn(i,255&o.total_in),Sn(i,o.total_in>>8&255),Sn(i,o.total_in>>16&255),Sn(i,o.total_in>>24&255)):(Yf(i,o.adler>>>16),Yf(i,65535&o.adler)),cs(o),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?kr:RL)},ul_deflateEnd=o=>{if(NE(o))return hc;const n=o.state.status;return o.state=null,113===n?Eh(o,bU):kr},ul_deflateSetDictionary=(o,n)=>{let i=n.length;if(NE(o))return hc;const s=o.state,c=s.wrap;if(2===c||1===c&&42!==s.status||s.lookahead)return hc;if(1===c&&(o.adler=qf(o.adler,n,i,0)),s.wrap=0,i>=s.w_size){0===c&&(yd(s.head),s.strstart=0,s.block_start=0,s.insert=0);let m=new Uint8Array(s.w_size);m.set(n.subarray(i-s.w_size,i),0),n=m,i=s.w_size}const d=o.avail_in,h=o.next_in,p=o.input;for(o.avail_in=i,o.next_in=0,o.input=n,vh(s);s.lookahead>=3;){let m=s.strstart,_=s.lookahead-2;do{s.ins_h=Sd(s,s.ins_h,s.window[m+3-1]),s.prev[m&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=m,m++}while(--_);s.strstart=m,s.lookahead=2,vh(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,o.next_in=h,o.input=p,o.avail_in=d,s.wrap=c,kr};const MD=(o,n)=>Object.prototype.hasOwnProperty.call(o,n);var PE_assign=function(o){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const s in i)MD(i,s)&&(o[s]=i[s])}}return o},PE_flattenChunks=o=>{let n=0;for(let s=0,c=o.length;s<c;s++)n+=o[s].length;const i=new Uint8Array(n);for(let s=0,c=0,d=o.length;s<d;s++){let h=o[s];i.set(h,c),c+=h.length}return i};let kL=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){kL=!1}const yh=new Uint8Array(256);for(let o=0;o<256;o++)yh[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;yh[254]=yh[254]=1;var Xf_string2buf=o=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(o);let n,i,s,c,d,h=o.length,p=0;for(c=0;c<h;c++)i=o.charCodeAt(c),55296==(64512&i)&&c+1<h&&(s=o.charCodeAt(c+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),c++)),p+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(p),d=0,c=0;d<p;c++)i=o.charCodeAt(c),55296==(64512&i)&&c+1<h&&(s=o.charCodeAt(c+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),c++)),i<128?n[d++]=i:i<2048?(n[d++]=192|i>>>6,n[d++]=128|63&i):i<65536?(n[d++]=224|i>>>12,n[d++]=128|i>>>6&63,n[d++]=128|63&i):(n[d++]=240|i>>>18,n[d++]=128|i>>>12&63,n[d++]=128|i>>>6&63,n[d++]=128|63&i);return n},Xf_buf2string=(o,n)=>{const i=n||o.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(o.subarray(0,n));let s,c;const d=new Array(2*i);for(c=0,s=0;s<i;){let h=o[s++];if(h<128){d[c++]=h;continue}let p=yh[h];if(p>4)d[c++]=65533,s+=p-1;else{for(h&=2===p?31:3===p?15:7;p>1&&s<i;)h=h<<6|63&o[s++],p--;p>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,p)=>{if(p<65534&&h.subarray&&kL)return String.fromCharCode.apply(null,h.length===p?h:h.subarray(0,p));let m="";for(let _=0;_<p;_++)m+=String.fromCharCode(h[_]);return m})(d,c)},Xf_utf8border=(o,n)=>{(n=n||o.length)>o.length&&(n=o.length);let i=n-1;for(;i>=0&&128==(192&o[i]);)i--;return i<0||0===i?n:i+yh[o[i]]>n?i:n},LD=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const xD=Object.prototype.toString,{Z_NO_FLUSH:NU,Z_SYNC_FLUSH:zs,Z_FULL_FLUSH:ML,Z_FINISH:LL,Z_OK:kE,Z_STREAM_END:xL,Z_DEFAULT_COMPRESSION:ME,Z_DEFAULT_STRATEGY:FL,Z_DEFLATED:UL}=mh;function Jf(o){this.options=PE_assign({level:ME,method:UL,chunkSize:16384,windowBits:15,memLevel:8,strategy:FL},o||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LD,this.strm.avail_out=0;let i=ul_deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==kE)throw new Error(Ed[i]);if(n.header&&ul_deflateSetHeader(this.strm,n.header),n.dictionary){let s;if(s="string"==typeof n.dictionary?Xf_string2buf(n.dictionary):"[object ArrayBuffer]"===xD.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,i=ul_deflateSetDictionary(this.strm,s),i!==kE)throw new Error(Ed[i]);this._dict_set=!0}}function Fb(o,n){const i=new Jf(n);if(i.push(o,!0),i.err)throw i.msg||Ed[i.err];return i.result}Jf.prototype.push=function(o,n){const i=this.strm,s=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=n===~~n?n:!0===n?LL:NU,i.input="string"==typeof o?Xf_string2buf(o):"[object ArrayBuffer]"===xD.call(o)?new Uint8Array(o):o,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(d===zs||d===ML)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=ul_deflate(i,d),c===xL)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=ul_deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===kE;if(0!==i.avail_out){if(d>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},Jf.prototype.onData=function(o){this.chunks.push(o)},Jf.prototype.onEnd=function(o){o===kE&&(this.result=PE_flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};var VL={Deflate:Jf,deflate:Fb,deflateRaw:function(o,n){return(n=n||{}).raw=!0,Fb(o,n)},gzip:function(o,n){return(n=n||{}).gzip=!0,Fb(o,n)},constants:mh};const LE=16209;var BL=function(o,n){let i,s,c,d,h,p,m,_,E,v,S,b,O,P,w,M,V,U,Y,ie,K,X,$,J;const ge=o.state;i=o.next_in,$=o.input,s=i+(o.avail_in-5),c=o.next_out,J=o.output,d=c-(n-o.avail_out),h=c+(o.avail_out-257),p=ge.dmax,m=ge.wsize,_=ge.whave,E=ge.wnext,v=ge.window,S=ge.hold,b=ge.bits,O=ge.lencode,P=ge.distcode,w=(1<<ge.lenbits)-1,M=(1<<ge.distbits)-1;e:do{b<15&&(S+=$[i++]<<b,b+=8,S+=$[i++]<<b,b+=8),V=O[S&w];t:for(;;){if(U=V>>>24,S>>>=U,b-=U,U=V>>>16&255,0===U)J[c++]=65535&V;else{if(!(16&U)){if(0==(64&U)){V=O[(65535&V)+(S&(1<<U)-1)];continue t}if(32&U){ge.mode=16191;break e}o.msg="invalid literal/length code",ge.mode=LE;break e}Y=65535&V,U&=15,U&&(b<U&&(S+=$[i++]<<b,b+=8),Y+=S&(1<<U)-1,S>>>=U,b-=U),b<15&&(S+=$[i++]<<b,b+=8,S+=$[i++]<<b,b+=8),V=P[S&M];n:for(;;){if(U=V>>>24,S>>>=U,b-=U,U=V>>>16&255,!(16&U)){if(0==(64&U)){V=P[(65535&V)+(S&(1<<U)-1)];continue n}o.msg="invalid distance code",ge.mode=LE;break e}if(ie=65535&V,U&=15,b<U&&(S+=$[i++]<<b,b+=8,b<U&&(S+=$[i++]<<b,b+=8)),ie+=S&(1<<U)-1,ie>p){o.msg="invalid distance too far back",ge.mode=LE;break e}if(S>>>=U,b-=U,U=c-d,ie>U){if(U=ie-U,U>_&&ge.sane){o.msg="invalid distance too far back",ge.mode=LE;break e}if(K=0,X=v,0===E){if(K+=m-U,U<Y){Y-=U;do{J[c++]=v[K++]}while(--U);K=c-ie,X=J}}else if(E<U){if(K+=m+E-U,U-=E,U<Y){Y-=U;do{J[c++]=v[K++]}while(--U);if(K=0,E<Y){U=E,Y-=U;do{J[c++]=v[K++]}while(--U);K=c-ie,X=J}}}else if(K+=E-U,U<Y){Y-=U;do{J[c++]=v[K++]}while(--U);K=c-ie,X=J}for(;Y>2;)J[c++]=X[K++],J[c++]=X[K++],J[c++]=X[K++],Y-=3;Y&&(J[c++]=X[K++],Y>1&&(J[c++]=X[K++]))}else{K=c-ie;do{J[c++]=J[K++],J[c++]=J[K++],J[c++]=J[K++],Y-=3}while(Y>2);Y&&(J[c++]=J[K++],Y>1&&(J[c++]=J[K++]))}break}}break}}while(i<s&&c<h);Y=b>>3,i-=Y,b-=Y<<3,S&=(1<<b)-1,o.next_in=i,o.next_out=c,o.avail_in=i<s?s-i+5:5-(i-s),o.avail_out=c<h?h-c+257:257-(c-h),ge.hold=S,ge.bits=b};const jL=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),HL=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),GL=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),WL=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Sh=(o,n,i,s,c,d,h,p)=>{const m=p.bits;let _,E,v,S,b,O,P=0,w=0,M=0,V=0,U=0,Y=0,ie=0,K=0,X=0,$=0,J=null;const ge=new Uint16Array(16),Ee=new Uint16Array(16);let ze,ht,St,st=null;for(P=0;P<=15;P++)ge[P]=0;for(w=0;w<s;w++)ge[n[i+w]]++;for(U=m,V=15;V>=1&&0===ge[V];V--);if(U>V&&(U=V),0===V)return c[d++]=20971520,c[d++]=20971520,p.bits=1,0;for(M=1;M<V&&0===ge[M];M++);for(U<M&&(U=M),K=1,P=1;P<=15;P++)if(K<<=1,K-=ge[P],K<0)return-1;if(K>0&&(0===o||1!==V))return-1;for(Ee[1]=0,P=1;P<15;P++)Ee[P+1]=Ee[P]+ge[P];for(w=0;w<s;w++)0!==n[i+w]&&(h[Ee[n[i+w]]++]=w);if(0===o?(J=st=h,O=20):1===o?(J=jL,st=HL,O=257):(J=GL,st=WL,O=0),$=0,w=0,P=M,b=d,Y=U,ie=0,v=-1,X=1<<U,S=X-1,1===o&&X>852||2===o&&X>592)return 1;for(;;){ze=P-ie,h[w]+1<O?(ht=0,St=h[w]):h[w]>=O?(ht=st[h[w]-O],St=J[h[w]-O]):(ht=96,St=0),_=1<<P-ie,E=1<<Y,M=E;do{E-=_,c[b+($>>ie)+E]=ze<<24|ht<<16|St|0}while(0!==E);for(_=1<<P-1;$&_;)_>>=1;if(0!==_?($&=_-1,$+=_):$=0,w++,0==--ge[P]){if(P===V)break;P=n[i+h[w]]}if(P>U&&($&S)!==v){for(0===ie&&(ie=U),b+=M,Y=P-ie,K=1<<Y;Y+ie<V&&(K-=ge[Y+ie],!(K<=0));)Y++,K<<=1;if(X+=1<<Y,1===o&&X>852||2===o&&X>592)return 1;v=$&S,c[v]=U<<24|Y<<16|b-d|0}}return 0!==$&&(c[b+$]=P-ie<<24|64<<16|0),p.bits=U,0};const{Z_FINISH:FD,Z_BLOCK:zL,Z_TREES:FE,Z_OK:fc,Z_STREAM_END:Ub,Z_NEED_DICT:KL,Z_STREAM_ERROR:Ks,Z_DATA_ERROR:Qf,Z_MEM_ERROR:qL,Z_BUF_ERROR:YL,Z_DEFLATED:UD}=mh,Zf=16180,UE=16190,hl=16191,VE=16199,BE=16200,Vn=16209,BD=o=>(o>>>24&255)+(o>>>8&65280)+((65280&o)<<8)+((255&o)<<24);function jE(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Cd=o=>{if(!o)return 1;const n=o.state;return!n||n.strm!==o||n.mode<Zf||n.mode>16211?1:0},Bb=o=>{if(Cd(o))return Ks;const n=o.state;return o.total_in=o.total_out=n.total=0,o.msg="",n.wrap&&(o.adler=1&n.wrap),n.mode=Zf,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,fc},jD=o=>{if(Cd(o))return Ks;const n=o.state;return n.wsize=0,n.whave=0,n.wnext=0,Bb(o)},HD=(o,n)=>{let i;if(Cd(o))return Ks;const s=o.state;return n<0?(i=0,n=-n):(i=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?Ks:(null!==s.window&&s.wbits!==n&&(s.window=null),s.wrap=i,s.wbits=n,jD(o))},HE=(o,n)=>{if(!o)return Ks;const i=new jE;o.state=i,i.strm=o,i.window=null,i.mode=Zf;const s=HD(o,n);return s!==fc&&(o.state=null),s};let jb,Ch,tm=!0;const GD=o=>{if(tm){jb=new Int32Array(512),Ch=new Int32Array(32);let n=0;for(;n<144;)o.lens[n++]=8;for(;n<256;)o.lens[n++]=9;for(;n<280;)o.lens[n++]=7;for(;n<288;)o.lens[n++]=8;for(Sh(1,o.lens,0,288,jb,0,o.work,{bits:9}),n=0;n<32;)o.lens[n++]=5;Sh(2,o.lens,0,32,Ch,0,o.work,{bits:5}),tm=!1}o.lencode=jb,o.lenbits=9,o.distcode=Ch,o.distbits=5},Hb=(o,n,i,s)=>{let c;const d=o.state;return null===d.window&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),s>=d.wsize?(d.window.set(n.subarray(i-d.wsize,i),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>s&&(c=s),d.window.set(n.subarray(i-s,i-s+c),d.wnext),(s-=c)?(d.window.set(n.subarray(i-s,i),0),d.wnext=s,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var Ia_inflateReset=jD,Ia_inflateInit2=HE,Ia_inflate=(o,n)=>{let i,s,c,d,h,p,m,_,E,v,S,b,O,P,w,M,V,U,Y,ie,K,X,$=0;const J=new Uint8Array(4);let ge,Ee;const ze=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Cd(o)||!o.output||!o.input&&0!==o.avail_in)return Ks;i=o.state,i.mode===hl&&(i.mode=16192),h=o.next_out,c=o.output,m=o.avail_out,d=o.next_in,s=o.input,p=o.avail_in,_=i.hold,E=i.bits,v=p,S=m,X=fc;e:for(;;)switch(i.mode){case Zf:if(0===i.wrap){i.mode=16192;break}for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(2&i.wrap&&35615===_){0===i.wbits&&(i.wbits=15),i.check=0,J[0]=255&_,J[1]=_>>>8&255,i.check=dr(i.check,J,2,0),_=0,E=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&_)<<8)+(_>>8))%31){o.msg="incorrect header check",i.mode=Vn;break}if((15&_)!==UD){o.msg="unknown compression method",i.mode=Vn;break}if(_>>>=4,E-=4,K=8+(15&_),0===i.wbits&&(i.wbits=K),K>15||K>i.wbits){o.msg="invalid window size",i.mode=Vn;break}i.dmax=1<<i.wbits,i.flags=0,o.adler=i.check=1,i.mode=512&_?16189:hl,_=0,E=0;break;case 16181:for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(i.flags=_,(255&i.flags)!==UD){o.msg="unknown compression method",i.mode=Vn;break}if(57344&i.flags){o.msg="unknown header flags set",i.mode=Vn;break}i.head&&(i.head.text=_>>8&1),512&i.flags&&4&i.wrap&&(J[0]=255&_,J[1]=_>>>8&255,i.check=dr(i.check,J,2,0)),_=0,E=0,i.mode=16182;case 16182:for(;E<32;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.head&&(i.head.time=_),512&i.flags&&4&i.wrap&&(J[0]=255&_,J[1]=_>>>8&255,J[2]=_>>>16&255,J[3]=_>>>24&255,i.check=dr(i.check,J,4,0)),_=0,E=0,i.mode=16183;case 16183:for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.head&&(i.head.xflags=255&_,i.head.os=_>>8),512&i.flags&&4&i.wrap&&(J[0]=255&_,J[1]=_>>>8&255,i.check=dr(i.check,J,2,0)),_=0,E=0,i.mode=16184;case 16184:if(1024&i.flags){for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.length=_,i.head&&(i.head.extra_len=_),512&i.flags&&4&i.wrap&&(J[0]=255&_,J[1]=_>>>8&255,i.check=dr(i.check,J,2,0)),_=0,E=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(b=i.length,b>p&&(b=p),b&&(i.head&&(K=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(d,d+b),K)),512&i.flags&&4&i.wrap&&(i.check=dr(i.check,s,b,d)),p-=b,d+=b,i.length-=b),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===p)break e;b=0;do{K=s[d+b++],i.head&&K&&i.length<65536&&(i.head.name+=String.fromCharCode(K))}while(K&&b<p);if(512&i.flags&&4&i.wrap&&(i.check=dr(i.check,s,b,d)),p-=b,d+=b,K)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===p)break e;b=0;do{K=s[d+b++],i.head&&K&&i.length<65536&&(i.head.comment+=String.fromCharCode(K))}while(K&&b<p);if(512&i.flags&&4&i.wrap&&(i.check=dr(i.check,s,b,d)),p-=b,d+=b,K)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;E<16;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(4&i.wrap&&_!==(65535&i.check)){o.msg="header crc mismatch",i.mode=Vn;break}_=0,E=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),o.adler=i.check=0,i.mode=hl;break;case 16189:for(;E<32;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}o.adler=i.check=BD(_),_=0,E=0,i.mode=UE;case UE:if(0===i.havedict)return o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,i.hold=_,i.bits=E,KL;o.adler=i.check=1,i.mode=hl;case hl:if(n===zL||n===FE)break e;case 16192:if(i.last){_>>>=7&E,E-=7&E,i.mode=16206;break}for(;E<3;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}switch(i.last=1&_,_>>>=1,E-=1,3&_){case 0:i.mode=16193;break;case 1:if(GD(i),i.mode=VE,n===FE){_>>>=2,E-=2;break e}break;case 2:i.mode=16196;break;case 3:o.msg="invalid block type",i.mode=Vn}_>>>=2,E-=2;break;case 16193:for(_>>>=7&E,E-=7&E;E<32;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if((65535&_)!=(_>>>16^65535)){o.msg="invalid stored block lengths",i.mode=Vn;break}if(i.length=65535&_,_=0,E=0,i.mode=16194,n===FE)break e;case 16194:i.mode=16195;case 16195:if(b=i.length,b){if(b>p&&(b=p),b>m&&(b=m),0===b)break e;c.set(s.subarray(d,d+b),h),p-=b,d+=b,m-=b,h+=b,i.length-=b;break}i.mode=hl;break;case 16196:for(;E<14;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(i.nlen=257+(31&_),_>>>=5,E-=5,i.ndist=1+(31&_),_>>>=5,E-=5,i.ncode=4+(15&_),_>>>=4,E-=4,i.nlen>286||i.ndist>30){o.msg="too many length or distance symbols",i.mode=Vn;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;E<3;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.lens[ze[i.have++]]=7&_,_>>>=3,E-=3}for(;i.have<19;)i.lens[ze[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ge={bits:i.lenbits},X=Sh(0,i.lens,0,19,i.lencode,0,i.work,ge),i.lenbits=ge.bits,X){o.msg="invalid code lengths set",i.mode=Vn;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;$=i.lencode[_&(1<<i.lenbits)-1],w=$>>>24,M=$>>>16&255,V=65535&$,!(w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(V<16)_>>>=w,E-=w,i.lens[i.have++]=V;else{if(16===V){for(Ee=w+2;E<Ee;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(_>>>=w,E-=w,0===i.have){o.msg="invalid bit length repeat",i.mode=Vn;break}K=i.lens[i.have-1],b=3+(3&_),_>>>=2,E-=2}else if(17===V){for(Ee=w+3;E<Ee;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}_>>>=w,E-=w,K=0,b=3+(7&_),_>>>=3,E-=3}else{for(Ee=w+7;E<Ee;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}_>>>=w,E-=w,K=0,b=11+(127&_),_>>>=7,E-=7}if(i.have+b>i.nlen+i.ndist){o.msg="invalid bit length repeat",i.mode=Vn;break}for(;b--;)i.lens[i.have++]=K}}if(i.mode===Vn)break;if(0===i.lens[256]){o.msg="invalid code -- missing end-of-block",i.mode=Vn;break}if(i.lenbits=9,ge={bits:i.lenbits},X=Sh(1,i.lens,0,i.nlen,i.lencode,0,i.work,ge),i.lenbits=ge.bits,X){o.msg="invalid literal/lengths set",i.mode=Vn;break}if(i.distbits=6,i.distcode=i.distdyn,ge={bits:i.distbits},X=Sh(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ge),i.distbits=ge.bits,X){o.msg="invalid distances set",i.mode=Vn;break}if(i.mode=VE,n===FE)break e;case VE:i.mode=BE;case BE:if(p>=6&&m>=258){o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,i.hold=_,i.bits=E,BL(o,S),h=o.next_out,c=o.output,m=o.avail_out,d=o.next_in,s=o.input,p=o.avail_in,_=i.hold,E=i.bits,i.mode===hl&&(i.back=-1);break}for(i.back=0;$=i.lencode[_&(1<<i.lenbits)-1],w=$>>>24,M=$>>>16&255,V=65535&$,!(w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(M&&0==(240&M)){for(U=w,Y=M,ie=V;$=i.lencode[ie+((_&(1<<U+Y)-1)>>U)],w=$>>>24,M=$>>>16&255,V=65535&$,!(U+w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}_>>>=U,E-=U,i.back+=U}if(_>>>=w,E-=w,i.back+=w,i.length=V,0===M){i.mode=16205;break}if(32&M){i.back=-1,i.mode=hl;break}if(64&M){o.msg="invalid literal/length code",i.mode=Vn;break}i.extra=15&M,i.mode=16201;case 16201:if(i.extra){for(Ee=i.extra;E<Ee;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.length+=_&(1<<i.extra)-1,_>>>=i.extra,E-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;$=i.distcode[_&(1<<i.distbits)-1],w=$>>>24,M=$>>>16&255,V=65535&$,!(w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(0==(240&M)){for(U=w,Y=M,ie=V;$=i.distcode[ie+((_&(1<<U+Y)-1)>>U)],w=$>>>24,M=$>>>16&255,V=65535&$,!(U+w<=E);){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}_>>>=U,E-=U,i.back+=U}if(_>>>=w,E-=w,i.back+=w,64&M){o.msg="invalid distance code",i.mode=Vn;break}i.offset=V,i.extra=15&M,i.mode=16203;case 16203:if(i.extra){for(Ee=i.extra;E<Ee;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}i.offset+=_&(1<<i.extra)-1,_>>>=i.extra,E-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){o.msg="invalid distance too far back",i.mode=Vn;break}i.mode=16204;case 16204:if(0===m)break e;if(b=S-m,i.offset>b){if(b=i.offset-b,b>i.whave&&i.sane){o.msg="invalid distance too far back",i.mode=Vn;break}b>i.wnext?(b-=i.wnext,O=i.wsize-b):O=i.wnext-b,b>i.length&&(b=i.length),P=i.window}else P=c,O=h-i.offset,b=i.length;b>m&&(b=m),m-=b,i.length-=b;do{c[h++]=P[O++]}while(--b);0===i.length&&(i.mode=BE);break;case 16205:if(0===m)break e;c[h++]=i.length,m--,i.mode=BE;break;case 16206:if(i.wrap){for(;E<32;){if(0===p)break e;p--,_|=s[d++]<<E,E+=8}if(S-=m,o.total_out+=S,i.total+=S,4&i.wrap&&S&&(o.adler=i.check=i.flags?dr(i.check,c,S,h-S):qf(i.check,c,S,h-S)),S=m,4&i.wrap&&(i.flags?_:BD(_))!==i.check){o.msg="incorrect data check",i.mode=Vn;break}_=0,E=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;E<32;){if(0===p)break e;p--,_+=s[d++]<<E,E+=8}if(4&i.wrap&&_!==(4294967295&i.total)){o.msg="incorrect length check",i.mode=Vn;break}_=0,E=0}i.mode=16208;case 16208:X=Ub;break e;case Vn:X=Qf;break e;case 16210:return qL;default:return Ks}return o.next_out=h,o.avail_out=m,o.next_in=d,o.avail_in=p,i.hold=_,i.bits=E,(i.wsize||S!==o.avail_out&&i.mode<Vn&&(i.mode<16206||n!==FD))&&Hb(o,o.output,o.next_out,S-o.avail_out),v-=o.avail_in,S-=o.avail_out,o.total_in+=v,o.total_out+=S,i.total+=S,4&i.wrap&&S&&(o.adler=i.check=i.flags?dr(i.check,c,S,o.next_out-S):qf(i.check,c,S,o.next_out-S)),o.data_type=i.bits+(i.last?64:0)+(i.mode===hl?128:0)+(i.mode===VE||16194===i.mode?256:0),(0===v&&0===S||n===FD)&&X===fc&&(X=YL),X},Ia_inflateEnd=o=>{if(Cd(o))return Ks;let n=o.state;return n.window&&(n.window=null),o.state=null,fc},Ia_inflateGetHeader=(o,n)=>{if(Cd(o))return Ks;const i=o.state;return 0==(2&i.wrap)?Ks:(i.head=n,n.done=!1,fc)},Ia_inflateSetDictionary=(o,n)=>{const i=n.length;let s,c,d;return Cd(o)?Ks:(s=o.state,0!==s.wrap&&s.mode!==UE?Ks:s.mode===UE&&(c=1,c=qf(c,n,i,0),c!==s.check)?Qf:(d=Hb(o,n,i,i),d?(s.mode=16210,qL):(s.havedict=1,fc)))},Gb=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const GE=Object.prototype.toString,{Z_NO_FLUSH:WD,Z_FINISH:zD,Z_OK:im,Z_STREAM_END:Wb,Z_NEED_DICT:zb,Z_STREAM_ERROR:$L,Z_DATA_ERROR:rm,Z_MEM_ERROR:KD}=mh;function WE(o){this.options=PE_assign({chunkSize:65536,windowBits:15,to:""},o||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,0===n.windowBits&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||o&&o.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&0==(15&n.windowBits)&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new LD,this.strm.avail_out=0;let i=Ia_inflateInit2(this.strm,n.windowBits);if(i!==im)throw new Error(Ed[i]);if(this.header=new Gb,Ia_inflateGetHeader(this.strm,this.header),n.dictionary&&("string"==typeof n.dictionary?n.dictionary=Xf_string2buf(n.dictionary):"[object ArrayBuffer]"===GE.call(n.dictionary)&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=Ia_inflateSetDictionary(this.strm,n.dictionary),i!==im)))throw new Error(Ed[i])}function bh(o,n){const i=new WE(n);if(i.push(o),i.err)throw i.msg||Ed[i.err];return i.result}WE.prototype.push=function(o,n){const i=this.strm,s=this.options.chunkSize,c=this.options.dictionary;let d,h,p;if(this.ended)return!1;for(h=n===~~n?n:!0===n?zD:WD,i.input="[object ArrayBuffer]"===GE.call(o)?new Uint8Array(o):o,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),d=Ia_inflate(i,h),d===zb&&c&&(d=Ia_inflateSetDictionary(i,c),d===im?d=Ia_inflate(i,h):d===rm&&(d=zb));i.avail_in>0&&d===Wb&&i.state.wrap>0&&0!==o[i.next_in];)Ia_inflateReset(i),d=Ia_inflate(i,h);switch(d){case $L:case rm:case zb:case KD:return this.onEnd(d),this.ended=!0,!1}if(p=i.avail_out,i.next_out&&(0===i.avail_out||d===Wb))if("string"===this.options.to){let m=Xf_utf8border(i.output,i.next_out),_=i.next_out-m,E=Xf_buf2string(i.output,m);i.next_out=_,i.avail_out=s-_,_&&i.output.set(i.output.subarray(m,m+_),0),this.onData(E)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(d!==im||0!==p){if(d===Wb)return d=Ia_inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},WE.prototype.onData=function(o){this.chunks.push(o)},WE.prototype.onEnd=function(o){o===im&&(this.result="string"===this.options.to?this.chunks.join(""):PE_flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};var Kb={Inflate:WE,inflate:bh,inflateRaw:function(o,n){return(n=n||{}).raw=!0,bh(o,n)},ungzip:bh,constants:mh};const{deflate:qD}=VL,{inflate:YD}=Kb;var zE,XL=qD,JL=YD;!function(o){o[o.ONE_BYTE=0]="ONE_BYTE",o[o.TWO_BYTE=1]="TWO_BYTE"}(zE||(zE={}));class QL{constructor(){C(this,"_sequence",0),C(this,"_startTime",Date.now()),C(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const p=new Uint8Array(4);p.set([1,0,0,0]);const _={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:p.buffer}]};i.commonPacketHeader.extension=1,i.extension=_,i.payload=this.compress(n),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;const s=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(s),d=new DataView(s);let h=0;if(d.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,d.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const p=this.serializeExtension(i.extension);c.set(new Uint8Array(p),h),h+=p.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return s}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const i=new DataView(n);let s=0;const c=i.getUint16(s,!0);s+=2;const d=(32768&c)>>15;let h,p;if(i.getUint16(s+2,!0),i.getUint16(s,!0),s+=4,i.getUint16(s,!0),s+=2,d){p=this.deserializeExtension(n.slice(s)),s+=2+p.length,h=n.slice(s);let m=!1;if(p.datas.length>0){const _=p.datas.find(E=>0===E.id);_&&(m=1==(1&new DataView(_.data).getUint32(0,!0)))}h=m?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:i,length:s,datas:c}=n,d=new ArrayBuffer(s+2),h=new Uint8Array(d),p=new DataView(d);let m=0;if(p.setUint8(m++,i),p.setUint8(m++,s),c.forEach(_=>{i?(p.setUint8(m++,_.id),p.setUint8(m++,_.length),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength):(p.setUint8(m++,_.id|_.length<<4),h.set(new Uint8Array(_.data),m),m+=_.data.byteLength)}),m!==s+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(s+2));return d}deserializeExtension(n){const i=new DataView(n);let s=0;const c=i.getUint8(s);s++;const d=i.getUint8(s);s++;const h=c===zE.TWO_BYTE,p=[],m=new DataView(n,2);let _=0;for(;_<d;){let E=0,v=0,S=new ArrayBuffer(0);h?(E=m.getUint8(_),_++,v=m.getUint8(_),_++):(E=15&m.getUint8(_),v=m.getUint8(_)>>4,_++),v>0&&(S=m.buffer.slice(_+2,_+2+v),_+=S.byteLength),p.push({id:E,length:v,data:S})}if(_!==d)throw Error("parse error");return{profile:c,length:d,datas:p}}decompress(n){return JL(new Uint8Array(n))}compress(n){return XL(new Uint8Array(n))}}class $D extends jt{constructor(n,i){super(),C(this,"_version",1),C(this,"_type",3),C(this,"_config",void 0),C(this,"_originDataChannel",void 0),C(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),C(this,"_dataStreamPacketHandler",void 0),C(this,"_datachannelEventMap",new Map),this._config=n,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader(),this._dataStreamPacketHandler=new QL}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return B("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,i;return null!==(n=null===(i=this._originDataChannel)||void 0===i?void 0:i.readyState)&&void 0!==n?n:"connecting"}get _originDataChannelId(){var n,i;return null!==(n=null===(i=this._originDataChannel)||void 0===i?void 0:i.id)&&void 0!==n?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}_waitTillOpen(){var n=this;return L(function*(){return new z((i,s)=>{if(n._originDataChannel){"open"===n._originDataChannel.readyState&&i();const c=setTimeout(()=>{var d;s(new Q(k.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(d=n._originDataChannel)||void 0===d?void 0:d.id)))},1e4);n._originDataChannel.onopen=()=>{clearTimeout(c),n._originDataChannel&&n._bandDataChannelEvents(n._originDataChannel),i()},n._originDataChannel.onerror=()=>{throw clearTimeout(c),new Q(k.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Q(k.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})})()}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[fd.OPEN,fd.CLOSE,fd.ERROR].forEach(i=>{const s=()=>{this.emit(i)};this._datachannelEventMap.set(i,s),n.addEventListener(i,s)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[s,c]=i;n.removeEventListener(s,c)}),this._datachannelEventMap.clear()}}class ZL extends $D{constructor(n){super(n),C(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const s=i.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(s).getUint8(3)!==this.id)return;let c=i.data.slice(this._dataStreamPacketHeader.byteLength);c=this._dataStreamPacketHandler.deserialize(c),this.emit(fd.MESSAGE,c)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class XD extends $D{send(n){if(this._originDataChannel){let i=n;i=this._dataStreamPacketHandler.serialize(n);const s=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);s.set(new Uint8Array(this._dataStreamPacketHeader),0),s.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(s.buffer)}}}class UU extends jt{constructor(){super(...arguments),C(this,"resultStorage",new Map)}setLocalAudioStats(n,i,s){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(s,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(s,i))}setLocalVideoStats(n,i,s){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(s,i)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(s,i)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(s))}setRemoteAudioStats(n,i){const s=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",s,this.checkAudioOutputLevel(i))}setRemoteVideoStats(n,i){const s=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",s,this.checkVideoDecode(i))}record(n,i,s){if(B("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(s),c.result.length>=5)){var d;const h=Re(d=c.result).call(d,!0);c.isPrevNormal&&!h&&this.emit("exception",JD[n],n,i),!c.isPrevNormal&&h&&this.emit("exception",JD[n]+2e3,n+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&0===n.receiveLevel)}checkAudioInputLevel(n,i){return i instanceof Un&&!i.isActive||!!i.muted||0!==n.sendVolumeLevel}checkFramerateInput(n,i){let s=null;i._encoderConfig&&i._encoderConfig.frameRate&&(s=vo(i._encoderConfig.frameRate));const c=n.captureFrameRate;return!s||!c||!(s>10&&c<5||s<10&&s>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,i){return!!i.muted||0!==n.sendBitrate}checkSendAudioBitrate(n,i){return i instanceof Un&&!i.isActive||!!i.muted||0!==n.sendBitrate}checkVideoDecode(n){return 0===n.receiveBitrate||0!==n.decodeFrameRate}}const JD={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ai=new class{markSubscribeStart(o,n){performance.mark("agora-web-sdk/".concat(o,"/subscribe-").concat(n))}markPublishStart(o,n){performance.mark("agora-web-sdk/".concat(o,"/publish-").concat(n))}measureFromSubscribeStart(o,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(o,"/subscribe-").concat(n));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}measureFromPublishStart(o,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(o,"/publish-").concat(n));if(i.length>0){const s=i[i.length-1];return Math.round(performance.now()-s.startTime)}return 0}};function qb(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Th(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?qb(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):qb(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Rh{constructor(n){C(this,"store",void 0),C(this,"onStatsException",void 0),C(this,"onUploadPublishDuration",void 0),C(this,"onStatsChanged",void 0),C(this,"localStats",new Map),C(this,"remoteStats",new Map),C(this,"updateStatsInterval",void 0),C(this,"trafficStats",void 0),C(this,"trafficStatsPeerList",[]),C(this,"uplinkStats",void 0),C(this,"exceptionMonitor",void 0),C(this,"p2pChannel",void 0),C(this,"scalabilityMode",oE.L1T1),C(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new UU,this.exceptionMonitor.on("exception",(i,s,c)=>{this.onStatsException&&this.onStatsException(i,s,c)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ne.LocalAudioTrack)||Th({},eD)}getLocalVideoTrackStats(){return this.localStats.get(ne.LocalVideoTrack)||Th({},pb)}getRemoteAudioTrackStats(n){const i=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},s={};if(n){var c;const d=null===(c=this.remoteStats.get(n))||void 0===c?void 0:c.audioStats;d&&(s[n]=i(n,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{audioStats:p}]=d;p&&(s[h]=i(h,p))});return s}getRemoteNetworkQualityStats(n){const i={};if(n){var s;const c=null===(s=this.remoteStats.get(n))||void 0===s?void 0:s.networkStats;c&&(i[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[d,{networkStats:h}]=c;h&&(i[d]=h)});return i}getRemoteVideoTrackStats(n){const i=(d,h)=>{if(!this.trafficStats)return h;const p=this.trafficStats.peer_delay.find(m=>m.peer_uid===d);return p&&(h.publishDuration=p.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},s={};if(n){var c;const d=null===(c=this.remoteStats.get(n))||void 0===c?void 0:c.videoStats;d&&(s[n]=i(n,d))}else Array.from(this.remoteStats.entries()).forEach(d=>{let[h,{videoStats:p}]=d;p&&(s[h]=i(h,p))});return s}getRTCStats(){let n=0,i=0,s=0,c=0;const d=this.localStats.get(ne.LocalAudioTrack);d&&(n+=d.sendBytes,i+=d.sendBitrate);const h=this.localStats.get(ne.LocalVideoTrack);h&&(n+=h.sendBytes,i+=h.sendBitrate);const p=this.localStats.get(ne.LocalVideoLowTrack);p&&(n+=p.sendBytes,i+=p.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:E,videoStats:v}=_;E&&(s+=E.receiveBytes,c+=E.receiveBitrate),v&&(s+=v.receiveBytes,c+=v.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:i,SendBytes:n,RecvBytes:s,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(i=>void 0!==i.B_ppad||void 0!==i.B_ppvd),n.peer_delay.filter(i=>-1===this.trafficStatsPeerList.indexOf(i.peer_uid)).forEach(i=>{var s;const c=null===(s=this.p2pChannel)||void 0===s?void 0:s.getRemoteMedia(i.peer_uid),d=null!=c&&c.videoSSRC?Ai.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=null!=c&&c.audioSSRC?Ai.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;void 0!==i.B_ppad&&void 0!==i.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&T.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,i,s){return!!n&&(!!s&&i.framesDecodeFreezeTime>s.framesDecodeFreezeTime||!(!s||i.framesDecodeCount>s.framesDecodeCount))}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(i=>{let[s,c]=i;switch(s){case ne.LocalVideoTrack:case ne.LocalVideoLowTrack:{const h=c,p=Th({},pb),m=n.getStats(),_=n.getLocalMedia(s);if(m){const E=m.videoSend.find(v=>v.ssrc===(null==_?void 0:_.ssrcs[0].ssrcId));if(E){const v=n.getLocalVideoSize(),S=n.getEncoderConfig(ne.LocalVideoTrack);"H264"!==E.codec&&"H265"!==E.codec&&"VP8"!==E.codec&&"VP9"!==E.codec&&"AV1X"!==E.codec&&"AV1"!==E.codec||(p.codecType=E.codec),p.sendBytes=E.bytes,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0,E.inputFrame?(p.captureFrameRate=E.inputFrame.frameRate,p.captureResolutionHeight=E.inputFrame.height,p.captureResolutionWidth=E.inputFrame.width):v&&(p.captureResolutionWidth=v.width,p.captureResolutionHeight=v.height),E.sentFrame?(p.sendFrameRate=E.sentFrame.frameRate,p.sendResolutionHeight=E.sentFrame.height,p.sendResolutionWidth=E.sentFrame.width):v&&(p.sendResolutionWidth=v.width,p.sendResolutionHeight=v.height),E.avgEncodeMs&&(p.encodeDelay=E.avgEncodeMs),S&&S.bitrateMax&&(p.targetSendBitrate=1e3*S.bitrateMax),p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.totalDuration=h?h.totalDuration+1:1,p.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(E)&&(p.totalFreezeTime+=1),E.scalabilityMode&&this.scalabilityMode!==E.scalabilityMode&&(T.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(E.scalabilityMode)),this.scalabilityMode=E.scalabilityMode)}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var d;this.localStats.set(s,p),((null==h?void 0:h.sendResolutionWidth)!==p.sendResolutionWidth||(null==h?void 0:h.sendResolutionHeight)!==p.sendResolutionHeight)&&(null===(d=this.onStatsChanged)||void 0===d||d.call(this,"resolution",{width:p.sendResolutionWidth,height:p.sendResolutionHeight})),p&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,p);break}case ne.LocalAudioTrack:{const h=c,p=Th({},eD),m=n.getStats(),_=n.getLocalMedia(s);if(m){const E=m.audioSend.find(v=>v.ssrc===(null==_?void 0:_.ssrcs[0].ssrcId));if(E){if("opus"!==E.codec&&"aac"!==E.codec&&"PCMU"!==E.codec&&"PCMA"!==E.codec&&"G722"!==E.codec||(p.codecType=E.codec),E.inputLevel)p.sendVolumeLevel=Math.round(32767*E.inputLevel);else{const v=n.getLocalAudioVolume();v&&(p.sendVolumeLevel=Math.round(32767*v))}p.sendBytes=E.bytes,p.sendPackets=E.packets,p.sendPacketsLost=E.packetsLost,p.sendJitterMs=E.jitterMs,p.sendRttMs=E.rttMs,p.sendBitrate=h?8*Math.max(0,p.sendBytes-h.sendBytes):0}}this.trafficStats&&(p.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ne.LocalAudioTrack,p),p&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,p);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{videoStats:c,audioStats:d,videoPcStats:h}]=i;const p=d,m=c,_=h,E=Th({},tD),v=Th({},nl),S=Th({},_n),{audioTrack:b,videoTrack:O,audioSSRC:P,videoSSRC:w}=n.getRemoteMedia(s),M=n.getStats(),V=null==M?void 0:M.audioRecv.find(ie=>ie.ssrc===P),U=null==M?void 0:M.videoRecv.find(ie=>ie.ssrc===w),Y=this.trafficStats&&this.trafficStats.peer_delay.find(ie=>ie.peer_uid===s);if(V&&("opus"!==V.codec&&"aac"!==V.codec&&"PCMU"!==V.codec&&"PCMA"!==V.codec&&"G722"!==V.codec||(E.codecType=V.codec),V.outputLevel?E.receiveLevel=Math.round(32767*V.outputLevel):b&&(E.receiveLevel=Math.round(32767*b.getVolumeLevel())),E.receiveBytes=V.bytes,E.receivePackets=V.packets,E.receivePacketsLost=V.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.receiveBitrate=p?8*Math.max(0,E.receiveBytes-p.receiveBytes):0,E.totalDuration=p?p.totalDuration+1:1,E.totalFreezeTime=p?p.totalFreezeTime:0,E.freezeRate=E.totalFreezeTime/E.totalDuration,E.receiveDelay=V.jitterBufferMs,E.totalDuration>10&&Rh.isRemoteAudioFreeze(b)&&(E.totalFreezeTime+=1)),U){"H264"!==U.codec&&"H265"!==U.codec&&"VP8"!==U.codec&&"VP9"!==U.codec&&"AV1X"!==U.codec&&"AV1"!==U.codec||(v.codecType=U.codec),v.receiveBytes=U.bytes,v.receiveBitrate=m?8*Math.max(0,v.receiveBytes-m.receiveBytes):0,v.decodeFrameRate=U.decodeFrameRate<0?0:U.decodeFrameRate,v.renderFrameRate=U.decodeFrameRate<0?0:U.decodeFrameRate,U.outputFrame&&(v.renderFrameRate=U.outputFrame.frameRate),U.receivedFrame?(v.receiveFrameRate=U.receivedFrame.frameRate,v.receiveResolutionHeight=U.receivedFrame.height,v.receiveResolutionWidth=U.receivedFrame.width):O&&(v.receiveResolutionHeight=O._videoHeight||0,v.receiveResolutionWidth=O._videoWidth||0),void 0!==U.framesRateFirefox&&(v.receiveFrameRate=Math.round(U.framesRateFirefox)),v.receivePackets=U.packets,v.receivePacketsLost=U.packetsLost,v.packetLossRate=v.receivePacketsLost/(v.receivePackets+v.receivePacketsLost),v.totalDuration=m?m.totalDuration+1:1,v.totalFreezeTime=m?m.totalFreezeTime:0,v.receiveDelay=U.jitterBufferMs||0;const ie=!!w&&n.getRemoteVideoIsReady(w);O&&ie&&Rh.isRemoteVideoFreeze(O,U,_)&&(v.totalFreezeTime+=1),v.freezeRate=v.totalFreezeTime/v.totalDuration}Y&&(E.end2EndDelay=Y.B_ad,v.end2EndDelay=Y.B_vd,E.transportDelay=Y.B_ed,v.transportDelay=Y.B_ed,E.currentPacketLossRate=Y.B_ealr4/100,v.currentPacketLossRate=Y.B_evlr4/100,S.uplinkNetworkQuality=Y.B_punq?Y.B_punq:0,S.downlinkNetworkQuality=Y.B_pdnq?Y.B_pdnq:0),this.remoteStats.set(s,{audioStats:E,videoStats:v,videoPcStats:U,networkStats:S}),b&&this.exceptionMonitor.setRemoteAudioStats(b,E),O&&this.exceptionMonitor.setRemoteVideoStats(O,v)})}}function ex(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Yb(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ex(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ex(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function om(o){return o.match(/^[\.\:\d]+$/)?"".concat(o.replace(/[^\d]/g,"-"),".").concat(B("TURN_DOMAIN")):(T.info("Cannot recognized as IP address ".concat(o,". Used As Host instead")),o)}function QD(o,n){var i,s;const c=B("GATEWAY_DOMAINS");let d=c[1]&&-1!==n.indexOf(c[1])?1:0;o.addresses=o.addresses||[];const h=o.addresses.map(m=>m.domain_prefix?{address:"".concat(m.domain_prefix,".").concat(c[d++%c.length],":").concat(m.port)}:m.ip.match(/^[\.\:\d]+$/)?{ip:m.ip,port:m.port,address:"".concat(m.ip.replace(/[^\d]/g,"-"),".").concat(c[d++%c.length],":").concat(m.port)}:(T.info("Cannot recognized as IP address ".concat(m.ip,". Used As Host instead")),{ip:m.ip,port:m.port,address:"".concat(m.ip,":").concat(m.port)}));if(null!==(i=o.detail)&&void 0!==i&&i[18]&&"string"==typeof(null===(s=o.detail)||void 0===s?void 0:s[18])){const m=o.detail[18],_=null==m?void 0:m.split(";");for(let E=0;E<_.length;E++){var p;const v=ub(p=_[E]).call(p);h[E]&&v&&(h[E].ip6=v)}}return{gatewayAddrs:h,uid:o.uid,cid:o.cid,cert:o.cert,vid:o.detail&&o.detail[8],uni_lbs_ip:o.detail&&o.detail[1],res:o,csIp:o.detail&&o.detail[502]}}function vo(o){return"number"==typeof o?o:o.exact||o.ideal||o.max||o.min||0}function $b(o){const n=o._encoderConfig;if(!n)return{};const i={resolution:n.width&&n.height?"".concat(vo(n.width),"x").concat(vo(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return"number"==typeof n.frameRate?(i.maxFrameRate=n.frameRate,i.minFrameRate=n.frameRate):n.frameRate&&(i.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,i.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),i}function tx(o){const n={connectionType:0,googRtt:o.rtt};switch(o.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=o.selectedCandidatePair.localCandidate.relayProtocol;"udp"===i&&(n.connectionType=1),"tcp"===i&&(n.connectionType=3),"tls"===i&&(n.connectionType=4);break}case"srflx":n.connectionType=2}return n}function Xb(o){return o>=0&&o<.17?1:o>=.17&&o<.36?2:o>=.36&&o<.59?3:o>=.59&&o<=1?4:o>1?5:0}function wa(o,n){let i,s,c;switch(n){case ri.CHOOSE_SERVER:s=4096,c="choose server";break;case ri.CLOUD_PROXY:s=1048576,c="proxy";break;case ri.CLOUD_PROXY_5:s=4194304,c="proxy5";break;case ri.CLOUD_PROXY_FALLBACK:s=4194310,c="proxy fallback";break;default:throw new W(k.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:o.detail&&o.detail[502],retry:!1})}if(o.response_body.forEach(d=>{d.buffer&&d.buffer.flag===s&&(i={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map(h=>Yb(Yb({},h),{},{ticket:d.buffer.cert})),server_ts:o.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:Yb(Yb({},d.buffer.detail),o.detail),flag:d.buffer.flag,opid:o.opid,cert:d.buffer.cert})}),!i)throw new W(k.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:o.detail&&o.detail[502]});return i}function nx(o,n){return Jb.apply(this,arguments)}function Jb(){return Jb=L(function*(o,n){return yield z.all(o.addresses.map(function(){var i=L(function*(s){return{address:om(s.ip),tcpport:s.port,udpport:s.port,username:n&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():qr.username,password:n&&B("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?yield Ww(n.toString()):qr.password}});return function(s){return i.apply(this,arguments)}}()))}),Jb.apply(this,arguments)}function sm(o,n){const i=n._videoHeight||n.getMediaStreamTrack(!0).getSettings().height;return i?Math.max(i/vo(o.height),1):(T.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function mc(o){let{candidateType:n,relayProtocol:i,type:s,address:c,port:d,protocol:h}=o;return"local-candidate"===s?{candidateType:n,relayProtocol:i,protocol:h}:{candidateType:n,relayProtocol:i,address:c,port:d,protocol:h}}function ix(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}class VU extends jt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;Re(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,"reconnecting"===this._state?this.emit(dn.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(dn.CONNECTED):"closed"===this._state?this.emit(dn.CLOSED):"failed"===this._state&&this.emit(dn.FAILED))}constructor(n,i,s,c){super(),C(this,"connectionID",0),C(this,"currentURLIndex",0),C(this,"reconnectReason",void 0),C(this,"_reconnectMode","tryNext"),C(this,"_name",void 0),C(this,"_state","closed"),C(this,"_retryConfig",void 0),C(this,"_reconnectCount",0),C(this,"_forceCloseTimeout",5e3),C(this,"_onlineReconnectListener",void 0),C(this,"_closeEstablishingTransmitter",()=>{}),C(this,"_store",void 0),C(this,"_joinChannelServiceRecordIndex",void 0),C(this,"_useCompress",void 0),C(this,"_inflateLength",0),C(this,"_deflateLength",0),this._store=c,this._name=n,this._retryConfig=function(d){for(var h=1;h<arguments.length;h++){var p=null!=arguments[h]?arguments[h]:{};h%2?ix(Object(p),!0).forEach(function(m){C(d,m,p[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(p)):ix(Object(p)).forEach(function(m){Object.defineProperty(d,m,Object.getOwnPropertyDescriptor(p,m))})}return d}({},i),this._useCompress=s}resetReconnectCount(n){T.debug("".concat(this._name," reset reconnect count, reason: ").concat(n)),this._reconnectCount=0}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const s=this._transmitter;i?setTimeout(()=>s.close(),500):s.close(),this._transmitter=void 0}this.state=n?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(n,i){if(!this._transmitter)return void T.warning("[".concat(this._name,"] can not reconnect, no websocket"));var s;void 0!==n&&(this.reconnectMode=n),T.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(s=this._store)||void 0===s||s.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));const c=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),c&&c.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){const n=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:n,deflateLength:i}}setInflateData(n){this._deflateLength=this._deflateLength+n.originLength,this._inflateLength=this._inflateLength+n.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var ds;!function(o){o[o.Default=0]="Default",o[o.Ack=1]="Ack"}(ds||(ds={}));class rx{constructor(n,i,s){C(this,"version",1),C(this,"initialRTO",void 0),C(this,"maxBatchAckCount",void 0),C(this,"maxRTO",void 0),C(this,"initialRTT",void 0),C(this,"ID",void 0),C(this,"rtt",void 0),C(this,"packetNumber",1),C(this,"rtoRatioMap",new Map),C(this,"timeoutMap",new Map),C(this,"unorderedPacketQueue",[]),C(this,"batchAckPacketQueue",[]),C(this,"lastOrderedPacketNumber",0),C(this,"batchAckTimer",void 0),C(this,"sendImpl",void 0),C(this,"receiveImpl",void 0),this.sendImpl=n,this.receiveImpl=i,this.ID=Ot(7,"transmitter-"),this.initialRTO=void 0!==(null==s?void 0:s.initialRTO)?s.initialRTO:B("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==s?void 0:s.initialRTT)?s.initialRTT:B("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==s?void 0:s.initialRTT)?s.initialRTT:B("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==s?void 0:s.maxBatchAckCount)?s.maxBatchAckCount:B("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==s?void 0:s.maxRTO)?s.maxRTO:B("TRANSMITTER_MAX_RTO")}packetize(n,i){return{type:ds.Default,version:this.version,packetNumber:i,payload:n}}serialize(n){switch(n.type){case ds.Default:{let i;i="string"==typeof n.payload?(new TextEncoder).encode(n.payload):n.payload;const s=new ArrayBuffer(i.length+15),c=new DataView(s);return c.setUint16(0,n.version),c.setUint8(2,n.type),c.setUint32(3,n.packetNumber),jw(c,7,BigInt(n.sendTs)),new Uint8Array(c.buffer).set(i,15),s}case ds.Ack:{const i=new ArrayBuffer(16),s=new DataView(i);return s.setUint16(0,n.version),s.setUint8(2,n.type),s.setUint32(3,n.maxAckPacketNumber),s.setUint8(7,n.shift),jw(s,8,BigInt(n.ackSendTs)),i}}}deserialize(n){const i=new DataView(n),s=i.getUint16(0),c=i.getUint8(2);switch(c){case ds.Default:{const d=i.getUint32(3),h=Bw(i,7),p=n.slice(15),m=(new TextDecoder).decode(p);return{version:s,type:c,packetNumber:d,sendTs:Number(h),payload:m}}case ds.Ack:{const d=i.getUint32(3),h=i.getUint8(7),p=Bw(i,8);return{version:s,type:c,maxAckPacketNumber:d,shift:h,ackSendTs:Number(p)}}default:throw T.error("[".concat(this.ID,"] Unrecognized packet type ").concat(c)),new Error("Unrecognized packet type ".concat(c))}}sendMessage(n){const i=this.packetize(n,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const s=this.calculateRTO(i),c=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,c),this.sendPacket(i)}onData(n){const i=this.deserialize(n);i.type===ds.Default?this.ack(i):i.type===ds.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(n=>{let[i,s]=n;window.clearTimeout(s)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(n){const i=this.calculateRTO(n),s=window.setTimeout(()=>{this.resendMessage(n)},i);this.timeoutMap.set(n.packetNumber,s),this.sendPacket(n)}calculateRTO(n){const i=this.rtoRatioMap.get(n.packetNumber);if(void 0===i)return this.rtoRatioMap.set(n.packetNumber,1),this.initialRTO;{const s=9*this.rtt/8*i;return this.rtoRatioMap.set(n.packetNumber,i+1),s>this.maxRTO?this.maxRTO:s}}updateRTT(n,i){this.rtt=this.rtt*(7/8)+(i-n.ackSendTs-this.rtt)/8}ack(n){if(n.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(n):(this.batchAckPacketQueue.push(n),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(n.payload);;){const i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else n.packetNumber<=this.lastOrderedPacketNumber?this.sendPacket({ackSendTs:n.sendTs,maxAckPacketNumber:n.packetNumber,shift:0,type:ds.Ack,version:this.version}):n.packetNumber>this.lastOrderedPacketNumber&&(this.unorderedPacketQueue[n.packetNumber-this.lastOrderedPacketNumber-2]=n,this.sendPacket({ackSendTs:n.sendTs,maxAckPacketNumber:n.packetNumber,shift:0,type:ds.Ack,version:this.version}))}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0,this.sendPacket({ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:ds.Ack,version:this.version}),this.batchAckPacketQueue=[]}sendPacket(n){n.type===ds.Default&&(n.sendTs=Math.round(performance.now()));const i=this.serialize(n);this.sendImpl(i)}clearRTO(n){for(let i=n.maxAckPacketNumber-n.shift;i<=n.maxAckPacketNumber;i++){const s=this.timeoutMap.get(i);void 0!==s&&window.clearTimeout(s),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class ox extends VU{constructor(n,i){super(n,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),C(this,"_initMutex",void 0),C(this,"_reconnectInterrupter",void 0),C(this,"_url",void 0),C(this,"_transmitter",void 0),C(this,"_addresses",void 0),C(this,"_reliableTransmission",void 0),this._initMutex=new ni("datachannel");const{timeout:s,timeoutFactor:c}=i,d=Math.max(300,Math.floor(3*s/5)),h=Math.max(1.2,Math.floor(8*c)/10);xi.ONLINE&&(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h),mn.on(tc.NETWORK_STATE_CHANGE,(p,m)=>{p!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(p)),p===xi.ONLINE?(this._retryConfig.timeout=d,this._retryConfig.timeoutFactor=h):(this._retryConfig.timeout=s,this._retryConfig.timeoutFactor=c))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}init(n){var i=arguments,s=this;return L(function*(){s._forceCloseTimeout=i.length>1&&void 0!==i[1]?i[1]:5e3;return s._initMutex.lock().then(h=>new z((p,m)=>{((h,p)=>{s._addresses=n,s.currentURLIndex=s._addresses.findIndex(_=>_.fingerprint||B("FINGERPRINT"));const m=s._addresses[s.currentURLIndex];s.state="connecting",s.createTransmitterConnection(m).then(h).catch(p),s.once(dn.CLOSED,()=>p(new W(k.WS_DISCONNECT))),s.once(dn.CONNECTED,()=>h())})(p,m)}).then(()=>{h()}).catch(()=>{h()}))})()}sendMessage(n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new W(k.WS_ABORT,"datachannel is not ready");try{i||(n=JSON.stringify(n)),this._reliableTransmission.sendMessage(n)}catch(s){throw new W(k.WS_ERR,"send datachannel signal message error"+s.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(n){const i=JSON.stringify(n);return{compressed:i,compressedLength:i.length,origin:n}}sendMessageWithUint8Array(n){return{compressed:n,compressedLength:n.byteLength,origin:n}}createTransmitterConnection(n){var i=this;return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(n.ip,":").concat(n.port),new z((s,c)=>{var d;const h=()=>{T.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s()},p=function(){var v=L(function*(S){var b;if(null===(b=i._closeEstablishingTransmitter)||void 0===b||b.call(i),T.debug("[".concat(i._name,"] datachannel close ").concat(i._url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(i.reconnectMode)),i._reconnectCount<i._retryConfig.maxRetryCount){"connected"===i.state&&(i.reconnectReason=S.reason,i.state="reconnecting");const O=lo(i,dn.WILL_RECONNECT,i.reconnectMode)||i.reconnectMode,P=yield i.reconnectWithAction(O);if("closed"===i.state)return void T.debug("[".concat(i.connectionID,"] dc is closed, no need to reconnect"));if(!P)return c(new W(k.WS_DISCONNECT,"datachannel reconnect failed: ".concat(S.code))),void i.close(!0);s()}else c(new W(k.WS_DISCONNECT,"datachannel close: ".concat(S.code))),i.close()});return function(b){return v.apply(this,arguments)}}(),m=v=>{var S;null===(S=this._reliableTransmission)||void 0===S||S.onData(v.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),T.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(n)));const _=null===(d=this._store)||void 0===d?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),E=Date.now();cn(this,dn.TO_CONNECT_DATACHANNEL,n).then(v=>{var S,b;if(!v)throw new Error("transmissonInfo not exist yet");const{transmitter:O,close:P}=v;this._transmitter=O,null===(S=this._store)||void 0===S||S.signalChannelOpen();const w=Date.now()-E;T.debug("[choose dc] dc open cost ".concat(w,"ms")),this._reliableTransmission=new rx(M=>{var V;this._transmitter&&"open"===this._transmitter.readyState&&(null===(V=this._transmitter)||void 0===V||V.send(M))},M=>{"string"==typeof M&&this.emit(dn.ON_MESSAGE,M)}),this._closeEstablishingTransmitter=()=>{var M;null===(M=this._reliableTransmission)||void 0===M||M.close(),this._reliableTransmission=void 0,P()},h&&h(),O.onclose=p,O.onmessage=m,null===(b=this._store)||void 0===b||b.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this._joinChannelServiceRecordIndex=_}).catch(v=>{var S;if(null===(S=this._store)||void 0===S||S.recordJoinChannelService({endTs:Date.now(),status:v instanceof W&&v.code===k.WS_ABORT?"aborted":"error",errors:[v]},_),"closed"!==this.state){if(v instanceof W&&v.code===k.WS_ERR){const b=new W(k.WS_ERR,"init datachannel failed! Error: ".concat(v.toString()));return T.error("[".concat(this._name,"]").concat(b)),void c(b)}p&&p(v)}else c(new W(k.WS_DISCONNECT,"datachannel is closed: ".concat(v.toString())))})})}reconnectWithAction(n){var i=arguments,s=this;return L(function*(){let c=!(i.length>1&&void 0!==i[1])||i[1];if(s._reconnectCount>=s._retryConfig.maxRetryCount||!s._addresses||"closed"===s.state)return!1;s._onlineReconnectListener||mn.networkState!==xi.OFFLINE||(s._onlineReconnectListener=mn.onlineWaiter&&mn.onlineWaiter.then(()=>{s._onlineReconnectListener=void 0}));let d=!0;if(s._reconnectInterrupter=()=>{d=!1},c){const _=qu(s._reconnectCount,s._retryConfig);T.debug("[".concat(s._name,"] wait ").concat(_,"ms to reconnect datachannel, mode: ").concat(n)),yield z.race([pi(_),s._onlineReconnectListener||new z(()=>{})])}if("closed"===s.state||!d)return!1;s._reconnectCount+=1;const h=function(){var _=L(function*(E,v){s.emit(dn.RECONNECT_CREATE_CONNECTION,v),yield s.createTransmitterConnection(E)});return function(v,S){return _.apply(this,arguments)}}();try{if("retry"===n){const _=s._addresses[s.currentURLIndex];s.emit(dn.RECONNECT_WAITTING_FINISH,n),yield h(_,n)}else if("tryNext"===n){s.currentURLIndex+=1;for(let E=s.currentURLIndex;E<s._addresses.length;E++){if(s._addresses[E].fingerprint||B("FINGERPRINT")){s.currentURLIndex=E;break}s.currentURLIndex+=1}if(s.currentURLIndex>=s._addresses.length)return T.debug("[".concat(s._name,"] the available addresses are exhausted, change to recover")),yield s.reconnectWithAction("recover",!1);T.debug("[".concat(s._name,"] datachannel url length: ").concat(s._addresses.length," current index: ").concat(s.currentURLIndex));const _=s._addresses[s.currentURLIndex];s.emit(dn.RECONNECT_WAITTING_FINISH,n),yield h(_,n)}else"recover"===n&&(T.debug("[".concat(s._name,"] start to failback to websocket")),s.resetReconnectCount("recover mode"),s.emit(dn.RECONNECT_WAITTING_FINISH,n),s.emit(dn.FAILBACK));return!0}catch(_){var p,m;return T.error("[".concat(s._name,"] reconnect failed"),_.toString()),null!=_&&null!==(p=_.data)&&void 0!==p&&p.desc&&Array.isArray(_.data.desc)&&_.data.desc.length&&Re(m=_.data.desc).call(m,"dynamic key expired")?(s.emit(dn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):yield s.reconnectWithAction(n,c)}})()}}class _c extends jt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===qe.CONNECTED?this.emit(de.WS_CONNECTED):n===qe.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):n===qe.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",qe.CLOSED),C(this,"reconnectToken",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new TC(5)),C(this,"pingpongTimer",void 0),C(this,"inflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"onWebsocketMessage",s=>{if(s instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,s);const c=JSON.parse(s);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")&&(this.emit(c._type,c._message),c._type===Me.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Me.ON_USER_BANNED))switch(c._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new ox("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qe.CONNECTED&&this.reconnect("retry",sc.OFFLINE)})}request(n,i,s,c){var d=this;return L(function*(){const h=Ot(6,""),p={_id:h,_type:n,_message:i},m=d.websocket.connectionID,_=()=>new z((P,w)=>{if(d.connectionState===qe.CONNECTED)return P();const M=()=>{d.off(de.WS_CLOSED,V),P()},V=()=>{d.off(de.WS_CONNECTED,M),w(new W(k.WS_ABORT))};d.once(de.WS_CONNECTED,M),d.once(de.WS_CLOSED,V),n!==ve.PUBLISH&&n!==ve.SUBSCRIBE&&n!==ve.UNSUBSCRIBE&&n!==ve.UNPUBLISH&&n!==ve.CONTROL&&n!==ve.RESTART_ICE||d.once(de.DISCONNECT_P2P,()=>{w(new W(k.DISCONNECT_P2P))}),n!==ve.PUBLISH&&n!==ve.RESTART_ICE||d.once(de.ABORT_P2P_EXECUTION,()=>{w(new W(k.DISCONNECT_P2P))})});if(d.connectionState!==qe.CONNECTING&&d.connectionState!==qe.RECONNECTING||n===ve.JOIN||n===ve.REJOIN||(yield _()),n===ve.LEAVE&&(d.websocket.unbindDcCloseEventListener(),c=!0),d.websocket.sendMessage(p,!0,!1),c)return;const E=new z((P,w)=>{let M=!1;const V=(Y,ie)=>{M=!0,P({isSuccess:"success"===Y,message:ie||{}}),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.emit(de.REQUEST_SUCCESS,n,i)};d.once("res-@".concat(h),V);const U=()=>{w(new W(k.WS_ABORT,"type: ".concat(n))),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(de.WS_CLOSED,U),d.once(de.WS_RECONNECTING,U),pi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||M||(T.warning("dc request timeout, type: ".concat(n)),d.emit(de.REQUEST_TIMEOUT,n,i))})});let v=null;try{v=yield E}catch(P){if(d.connectionState===qe.CLOSED||n===ve.LEAVE)throw new W(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?P.throw():n===ve.JOIN||n===ve.REJOIN?null:(yield _(),yield d.request(n,i))}if(v.isSuccess)return v.message;const S=Number(v.message.error_code||v.message.code),b=oh(S),O=new W(k.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:S,data:v.message});return"success"===b.action?v.message:(T.warning("[".concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(S,", message: ").concat(b.desc,", action: ").concat(b.action)),S===be.ERR_TOO_MANY_BROADCASTERS?((n===ve.JOIN||n===ve.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===b.action?O.throw():"quit"===b.action?(d.initError=O,d.close(),O.throw()):(S===be.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,T.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",sc.MULTI_IP)):d.reconnect(b.action,sc.SERVER_ERROR),n===ve.JOIN||n===ve.REJOIN?null:yield d.request(n,i)))})()}waitMessage(n,i){return new z(s=>{const c=d=>{(!i||i(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,i){const s={_type:n,_message:i};try{this.websocket.sendMessage(s)}catch(c){const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qe.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){this.websocket.sendMessage({_type:n,_message:i})}init(n,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(de.WS_CONNECTED,()=>s(this.joinResponse)),this.once(de.WS_CLOSED,()=>c(this.initError||new W(k.WS_ABORT))),this.connectionState=qe.CONNECTING,this.websocket.init(n).catch(c),this.websocket.once(dn.FAILBACK,()=>{void 0===this.openConnectionTime&&c(new W(k.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{i&&void 0===this.openConnectionTime&&(T.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),c(new W(k.INIT_DATACHANNEL_TIMEOUT)))},B("DC_JOIN_WITH_FAILBACK"))})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ye.LEAVE,this.connectionState=qe.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),n===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new ox("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}join(){var n=this;return L(function*(){if(!n.joinResponse){n.emit(de.ABORT_P2P_EXECUTION);const i=yield cn(n,de.DATACHANNEL_CONNECTING),s=yield n.request(ve.JOIN,i);if(!s)return n.emit(de.REPORT_JOIN_GATEWAY,k.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(de.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0})()}rejoin(){var n=this;return L(function*(){if(!n.reconnectToken)throw new W(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=_a(n,de.REQUEST_REJOIN_INFO);i.token=n.reconnectToken;const s=yield n.request(ve.REJOIN,i);return!!s&&(n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),s.peers&&s.peers.forEach(c=>{n.emit(Me.ON_USER_ONLINE,{uid:c.uid}),c.audio&&n.emit(Me.ON_ADD_AUDIO_STREAM,{uid:c.uid,uint_id:c.uint_id,audio:!0,ssrcId:c.audio_ssrc}),c.video&&n.emit(Me.ON_ADD_VIDEO_STREAM,{uid:c.uid,uint_id:c.uint_id,video:!0,ssrcId:c.video_ssrc}),n.emit(c.audio_mute?Me.MUTE_AUDIO:Me.UNMUTE_AUDIO,{uid:c.uid}),n.emit(c.video_mute?Me.MUTE_VIDEO:Me.UNMUTE_VIDEO,{uid:c.uid}),n.emit(c.audio_enable_local?Me.ENABLE_LOCAL_AUDIO:Me.DISABLE_LOCAL_AUDIO,{uid:c.uid}),n.emit(c.video_enable_local?Me.ENABLE_LOCAL_VIDEO:Me.DISABLE_LOCAL_VIDEO,{uid:c.uid}),c.audio||c.video||n.emit(Me.ON_REMOVE_STREAM,{uid:c.uid,uint_id:c.uint_id})}),!0)})()}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){T.debug("[".concat(this.clientId,"] receive notification: "),n);const i=oh(n.code);if("success"!==i.action){if("failed"!==i.action)return"quit"===i.action?("ERR_REPEAT_JOIN_CHANNEL"===i.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(i.action,sc.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(T.warning("PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sc.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleInflateData(){const{inflateLength:n,deflateLength:i}=this.websocket.getInflateData();0!==n&&0!==i&&this.upload(Yr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){var n=this;this.websocket.on(dn.RECONNECT_WAITTING_FINISH,i=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(dn.RECONNECT_CREATE_CONNECTION,i=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(dn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(dn.CLOSED,()=>{this.connectionState=qe.CLOSED}),this.websocket.on(dn.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=qe.CLOSED}),this.websocket.on(dn.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState=this.connectionState===qe.CONNECTED?qe.RECONNECTING:qe.CONNECTING}),this.websocket.on(dn.WILL_RECONNECT,(i,s)=>{if(_a(this,de.IS_P2P_DISCONNECTED)&&"retry"===i)return T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),s("tryNext");"retry"!==i&&(T.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),s(i)}),this.websocket.on(dn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",sc.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(de.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof W&&i.code===k.UNEXPECTED_RESPONSE&&i.data.code===be.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",sc.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sc.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(dn.REQUEST_NEW_URLS,(i,s)=>{cn(this,de.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(dn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(dn.TO_CONNECT_DATACHANNEL,function(){var i=L(function*(s,c,d){return cn(n,de.DATACHANNEL_PRECONNECT,s).then(c).catch(d)});return function(s,c,d){return i.apply(this,arguments)}}()),this.websocket.on(dn.FAILBACK,()=>{void 0!==this.openConnectionTime&&this.emit(de.DATACHANNEL_FAILBACK)})}}class Qb extends jt{constructor(n){super(),C(this,"_signal",void 0),C(this,"_sequence",0),C(this,"_userMap",new Map),C(this,"_encoder",new TextEncoder),this._signal=n}send(n,i,s,c,d){var h=this;return L(function*(){var p,m,_;"string"!=typeof i&&(i=JSON.stringify(i)),c=null!==(p=c)&&void 0!==p?p:Ot(6,""),d=null!==(m=d)&&void 0!==m?m:h._sequence++;const E={_id:c,_type:n,_seq:null!==(_=d)&&void 0!==_?_:h._sequence++,_message:i};if(B("SHOW_P2P_LOG")&&T.debug("send message",E),h.sendStreamMessage(JSON.stringify(E)),s)return;const v=new z((b,O)=>{const P=window.setTimeout(()=>{h.off("res-@".concat(c),w),T.warning("[external-signal] request timeout, type: ".concat(n)),O(new Q(0===h._userMap.size?k.INVALID_REMOTE_USER:k.TIMEOUT))},B("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),w=(M,V)=>{P&&window.clearTimeout(P),"success"===M?b({isSuccess:!0,message:V}):O(new Q(k.UNEXPECTED_ERROR,V))};h.once("res-@".concat(c),w)});let S;try{S=yield v}catch(b){if(b.code===k.TIMEOUT)return yield h.send(n,i,!1,c,d);throw b}return S.isSuccess?S.message:void 0})()}sendStreamMessage(n){this._splitMessage(n).forEach(i=>{this._signal.request(ve.DATA_STREAM,{payload:Bg(this._encoder.encode(i))})})}onMessage(n){const{_uid:i}=n;let s;const c=this._userMap.get(i);if(c?s=c.splitMessageMap:(s=new Map,this._userMap.set(i,{isStart:!1,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in n&&"total"in n){var d;const{id:h,total:p}=n,m=null!==(d=s.get(h))&&void 0!==d?d:[];if(m.push(n),s.has(h)||s.set(h,m),m.length!==p)return;{const _=wu(m).call(m,(E,v)=>E.index-v.index).map(E=>E.payload).join("");s.delete(h),(n=JSON.parse(_))._uid=i}}this.handleReceivedMessage(n)}setStart(n){this._userMap.has(n)?this._userMap.get(n).isStart=!0:this._userMap.set(n,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(n){return this._userMap.delete(n),0===this._userMap.size}ack(n,i,s){this.send(Pt.ACK,JSON.stringify({success:!s,message:i}),!0,n)}handleReceivedMessage(n){const i=()=>{this._userMap.forEach(_=>{const{receivedMessagesMap:E,nextExpectedSequenceNumber:v}=_;for(;E.has(v);){const S=E.get(v);E.delete(v),this.receiveMessage(S),_.nextExpectedSequenceNumber++}})};if(!n)return void i();const{_uid:s,_seq:c}=n,d=this._userMap.get(s),{receivedMessagesMap:h,isStart:p,nextExpectedSequenceNumber:m}=d;c<m?T.debug("[external-signal] receive old message, seq: ".concat(c)):(h.set(c,n),p&&c===m&&(this.receiveMessage(n),h.delete(m),d.nextExpectedSequenceNumber++,i()))}receiveMessage(n){const{_id:i,_type:s,_message:c,_uid:d}=n;if(B("SHOW_P2P_LOG")&&T.debug("\u6536\u5230\u6d88\u606f",n),i)switch(n._type){case Pt.PUBLISH:const h=JSON.parse(c);this._signal.emit(s,h,d),this.ack(n._id);break;case Pt.CONTROL:case Pt.UNPUBLISH:case Pt.DO_SUBSCRIBE:case Pt.DO_UNSUBSCRIBE:{const p=JSON.parse(c);p.uid=d,cn(this._signal,s,p).then(m=>{this.ack(n._id,m)}).catch(m=>{this.ack(n._id,void 0,!0)});break}case Pt.ACK:{const{success:p,message:m}=JSON.parse(c);this.emit("res-@".concat(i),p?"success":"failed",m);break}case Pt.CALL:cn(this,s,c).then(p=>{this.ack(i,p)});break;case Pt.RESTART_ICE:case Pt.EXCHANGE_SDP:case Pt.SUBSCRIBE:case Pt.UNSUBSCRIBE:cn(this._signal,s,c).then(p=>{this.ack(i,p)}).catch(p=>{this.ack(n._id,void 0,!0)});break;case Pt.CANDIDATE:this._signal.emit(s,c),this.ack(i);break;case Pt.JOIN:this.emit(s,JSON.parse(c));break;default:this.emit(s,c),this.ack(i)}}_splitMessage(n){if(n.length<Qb.MAX_MESSAGE_SIZE)return[n];const i=[],s=Ot(6,"");let c=0;const d=Math.ceil(n.length/800);for(;n.length>0;){c++;const h=n.slice(0,800);i.push({id:s,index:c,total:d,payload:h}),n=n.slice(800)}return i.map(h=>JSON.stringify(h))}clear(){this._sequence=0,this._userMap.clear()}}C(Qb,"MAX_MESSAGE_SIZE",1024);class sx extends jt{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===qe.CONNECTED?this.emit(de.WS_CONNECTED):n===qe.RECONNECTING?this.emit(de.WS_RECONNECTING,this._websocketReconnectReason):n===qe.CLOSED&&this.emit(de.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),C(this,"_disconnectedReason",void 0),C(this,"_websocketReconnectReason",void 0),C(this,"_connectionState",qe.CLOSED),C(this,"reconnectToken",void 0),C(this,"_userInRoom",!1),C(this,"_userOnlineTime",void 0),C(this,"websocket",void 0),C(this,"openConnectionTime",void 0),C(this,"clientId",void 0),C(this,"lastMsgTime",Date.now()),C(this,"uploadCache",[]),C(this,"uploadCacheInterval",void 0),C(this,"rttRolling",new TC(5)),C(this,"pingpongTimer",void 0),C(this,"wsInflateDataTimer",void 0),C(this,"pingpongTimeoutCount",0),C(this,"joinResponse",void 0),C(this,"multiIpOption",void 0),C(this,"initError",void 0),C(this,"spec",void 0),C(this,"store",void 0),C(this,"_external_signal",void 0),C(this,"onWebsocketMessage",s=>{if(s.data instanceof ArrayBuffer)return void this.emit(de.ON_BINARY_DATA,s.data);const c=JSON.parse(s.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Me.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Me.MUTE_AUDIO:case Me.MUTE_VIDEO:case Me.ON_P2P_LOST:return;case Me.ON_USER_ONLINE:this.emit(c._type,c._message);const{uid:d}=c._message;return this._external_signal.setStart(d),void this._external_signal.send(Pt.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(c._type,c._message),c._type===Me.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Me.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Ye.UID_BANNED);break;case 15:this.close(Ye.IP_BANNED);break;case 16:this.close(Ye.CHANNEL_BANNED)}if(c._type===Me.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case be.ERR_LICENSE_MISSING:this.close(Ye.LICENSE_MISSING);break;case be.ERR_LICENSE_EXPIRED:this.close(Ye.LICENSE_EXPIRED);break;case be.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ye.LICENSE_MINUTES_EXCEEDED);break;case be.ERR_LICENSE_PERIOD_INVALID:this.close(Ye.LICENSE_PERIOD_INVALID);break;case be.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ye.LICENSE_MULTIPLE_SDK_SERVICE);break;case be.ERR_LICENSE_ILLEGAL:this.close(Ye.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new Nf("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===qe.CONNECTED&&this.reconnect("retry",Gn.OFFLINE)}),this._external_signal=new Qb(this),this._handleSignalP2PEvents()}request(n,i,s,c){var d=this;return L(function*(){const h=Ot(6,""),p={_id:h,_type:n,_message:i},m=d.websocket.connectionID,_=()=>new z((P,w)=>{if(d.connectionState===qe.CONNECTED)return P();const M=()=>{d.off(de.WS_CLOSED,V),P()},V=()=>{d.off(de.WS_CONNECTED,M),w(new Q(k.WS_ABORT))};d.once(de.WS_CONNECTED,M),d.once(de.WS_CLOSED,V),n!==ve.PUBLISH&&n!==ve.SUBSCRIBE&&n!==ve.UNSUBSCRIBE&&n!==ve.UNPUBLISH&&n!==ve.CONTROL&&n!==ve.RESTART_ICE||d.once(de.DISCONNECT_P2P,()=>{w(new Q(k.DISCONNECT_P2P))}),n!==ve.PUBLISH&&n!==ve.RESTART_ICE||d.once(de.ABORT_P2P_EXECUTION,()=>{w(new Q(k.DISCONNECT_P2P))})});if(d.connectionState!==qe.CONNECTING&&d.connectionState!==qe.RECONNECTING||n===ve.JOIN||n===ve.REJOIN||(yield _()),d.websocket.sendMessage(p,!0),c)return;const E=new z((P,w)=>{let M=!1;const V=(Y,ie)=>{M=!0,P({isSuccess:"success"===Y,message:ie||{}}),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.emit(de.REQUEST_SUCCESS,n,i)};d.once("res-@".concat(h),V);const U=()=>{w(new Q(k.WS_ABORT,"type: ".concat(n))),d.off(de.WS_CLOSED,U),d.off(de.WS_RECONNECTING,U),d.off("res-@".concat(h),V)};d.once(de.WS_CLOSED,U),d.once(de.WS_RECONNECTING,U),pi(B("SIGNAL_REQUEST_TIMEOUT")).then(()=>{d.websocket.connectionID!==m||M||(T.warning("[".concat(d.clientId,"] ws request timeout, type: ").concat(n)),d.emit(de.REQUEST_TIMEOUT,n,i))})});let v=null;try{v=yield E}catch(P){if(d.connectionState===qe.CLOSED||n===ve.LEAVE)throw new Q(k.WS_ABORT);return!d.spec.forceWaitGatewayResponse||s?P.throw():n===ve.JOIN||n===ve.REJOIN?null:(yield _(),yield d.request(n,i))}if(v.isSuccess)return v.message;const S=Number(v.message.error_code||v.message.code),b=oh(S),O=new Q(k.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(v.message.error_str),{code:S,data:v.message});return"success"===b.action?v.message:(T.warning("[".concat(d.clientId,"] [").concat(d.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(S,", message: ").concat(b.desc,", action: ").concat(b.action)),S===be.ERR_TOO_MANY_BROADCASTERS?((n===ve.JOIN||n===ve.REJOIN)&&(d.initError=O,d.close()),O.throw()):"failed"===b.action?O.throw():"quit"===b.action?(d.initError=O,d.close(),O.throw()):(S===be.ERR_JOIN_BY_MULTI_IP?(d.multiIpOption=v.message.option,T.warning("[".concat(d.clientId,"] detect multi ip, recover")),d.reconnect("recover",Gn.MULTI_IP)):d.reconnect(b.action,Gn.SERVER_ERROR),n===ve.JOIN||n===ve.REJOIN?null:yield d.request(n,i)))})()}waitMessage(n,i){return new z(s=>{const c=d=>{(!i||i(d))&&(this.off(n,c),s(d))};this.on(n,c)})}upload(n,i){const s={_type:n,_message:i};try{this.websocket.sendMessage(s)}catch(c){const d=B("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(s),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==qe.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},B("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){this.websocket.sendMessage({_type:n,_message:i})}sendExtensionMessage(n,i,s){var c=this;return L(function*(){return yield c.waitTillUserOnline(),yield c._external_signal.send(n,i,s)})()}init(n,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new z((s,c)=>{this.once(de.WS_CONNECTED,()=>s(this.joinResponse)),this.once(de.WS_CLOSED,()=>c(this.initError||new Q(k.WS_ABORT))),this.connectionState=qe.CONNECTING,this.websocket.init(n).catch(c),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||Ye.LEAVE,this.connectionState=qe.CLOSED,T.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),n===Ye.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Nf("gateway-".concat(this.clientId),this.spec.retryConfig,!0,B("JOIN_GATEWAY_USE_DUAL_DOMAIN"),B("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}join(){var n=this;return L(function*(){if(!n.joinResponse){n.emit(de.ABORT_P2P_EXECUTION);const i=yield cn(n,de.REQUEST_JOIN_INFO),s=yield n.request(ve.JOIN,i);if(!s)return n.emit(de.REPORT_JOIN_GATEWAY,k.TIMEOUT,n.url||""),!1;n.joinResponse=s,n.emit(de.JOIN_RESPONSE,n.joinResponse),n.reconnectToken=n.joinResponse.rejoin_token}return n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),n._userOnlineTime=(new Date).getTime(),n._external_signal.clear(),!0})()}rejoin(){var n=this;return L(function*(){if(!n.reconnectToken)throw new Q(k.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=_a(n,de.REQUEST_REJOIN_INFO);return i.token=n.reconnectToken,!!(yield n.request(ve.REJOIN,i))&&(n.connectionState=qe.CONNECTED,n.pingpongTimer&&window.clearInterval(n.pingpongTimer),n.pingpongTimer=window.setInterval(n.handlePingPong.bind(n),3e3),!0)})()}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleDataStream(n){try{var i;const s=cf(n.payload),c=(new TextDecoder).decode(s),d=JSON.parse(c);"total"in d&&"id"in d||Re(i=Object.values(Pt)).call(i,d._type)?(n.seq&&delete n.seq,d._uid=n.uid,this._external_signal.onMessage(d)):this.emit(Me.ON_DATA_STREAM,n)}catch(s){}}handleNotification(n){T.debug("[".concat(this.clientId,"] receive notification: "),n);const i=oh(n.code);if("success"!==i.action){if("failed"!==i.action)return"quit"===i.action?("ERR_REPEAT_JOIN_CHANNEL"===i.desc&&this.close(Ye.UID_BANNED),void this.close()):void this.reconnect(i.action,Gn.SERVER_ERROR);T.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=B("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(T.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>B("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Gn.TIMEOUT):this.request(ve.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const s=Date.now()-i;this.rttRolling.add(s),B("REPORT_STATS")&&this.send(ve.PING_BACK,{pingpongElapse:s})}).catch(s=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();0!==n&&0!==i&&this.upload(Yr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(we.RECONNECT_WAITTING_FINISH,n=>{this.emit(de.WS_RECONNECT_WAITTING_FINISH,n)}),this.websocket.on(we.RECONNECT_CREATE_CONNECTION,n=>{this.emit(de.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(we.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(we.CLOSED,()=>{this.connectionState=qe.CLOSED}),this.websocket.on(we.FAILED,()=>{this._disconnectedReason=Ye.NETWORK_ERROR,this.connectionState=qe.CLOSED}),this.websocket.on(we.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState=this.connectionState===qe.CONNECTED?qe.RECONNECTING:qe.CONNECTING}),this.websocket.on(we.WILL_RECONNECT,(n,i,s)=>{if(_a(this,de.IS_P2P_DISCONNECTED)&&"retry"===n)return T.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P),s("tryNext");"retry"!==n&&(T.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0,this.emit(de.NEED_RENEW_SESSION),this.emit(de.DISCONNECT_P2P)),s(n)}),this.websocket.on(we.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{T.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",Gn.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(de.REPORT_JOIN_GATEWAY,n.message||n.code,this.url||""),n instanceof Q&&n.code===k.UNEXPECTED_RESPONSE&&n.data.code===be.ERR_NO_AUTHORIZED)return T.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Gn.SERVER_ERROR);T.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Gn.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(we.REQUEST_NEW_URLS,(n,i)=>{cn(this,de.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(we.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){var n=this;this._external_signal.on(Pt.JOIN,function(){var i=L(function*(s){if(n._userOnlineTime&&n._userOnlineTime<s.onlineTime){const c=yield cn(n,de.P2P_START,void 0),d=yield n._external_signal.send(Pt.CALL,c);n.emit(de.P2P_CONNECTION,d,!0)}n._userInRoom=!0,n.emit("user-online")});return function(s){return i.apply(this,arguments)}}()),this.on(Me.ON_USER_OFFLINE,function(){var i=L(function*(s){n._external_signal.clear(),n._userInRoom=!1});return function(s){return i.apply(this,arguments)}}()),this._external_signal.on(Pt.CALL,function(){var i=L(function*(s,c,d){n._userInRoom=!0,n.emit("user-online");try{c(yield cn(n,de.P2P_START,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}())}waitTillUserOnline(){var n=this;return L(function*(){return new z(i=>{if(n._userInRoom)i();else{const s=()=>{n.off("user-online",s),i()};n.on("user-online",s)}})})()}}function ax(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function us(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ax(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ax(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}const ZD=new Map;class BU extends jt{get state(){return this._state}set state(n){if(n===this._state)return;const i=this._state;this._state=n,"DISCONNECTED"===n&&this._disconnectedReason?this.emit(ln.CONNECTION_STATE_CHANGE,n,i,this._disconnectedReason):this.emit(ln.CONNECTION_STATE_CHANGE,n,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){T.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,i){super(),C(this,"store",void 0),C(this,"joinInfo",void 0),C(this,"key",void 0),C(this,"ntpOffset",0),C(this,"signal",void 0),C(this,"role",void 0),C(this,"inChannelInfo",{joinAt:null,duration:0}),C(this,"spec",void 0),C(this,"_state","DISCONNECTED"),C(this,"_statsCollector",void 0),C(this,"_disconnectedReason",void 0),C(this,"isSignalRecover",!1),C(this,"hasChangeBGPAddress",!1),C(this,"trafficStatsInterval",void 0),C(this,"networkQualityInterval",void 0),C(this,"_joinGatewayStartTime",0),C(this,"_signalTimeout",!1),C(this,"_clientRoleOptions",void 0),C(this,"_isProactiveJoin",!1),this.store=n,this.spec=i,this.signal=this.store.useP2P?new sx(us(us({},i),{},{retryConfig:i.websocketRetryConfig}),n):this.store.useDataChannel?new _c(us(us({},i),{},{retryConfig:i.websocketRetryConfig}),n):new tl(us(us({},i),{},{retryConfig:i.websocketRetryConfig}),n),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}join(n,i,s){var c=this;return L(function*(){if(c.signal instanceof _c){let _=!1;"disabled"!==n.cloudProxyServer?(T.debug("[".concat(c.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(n.cloudProxyServer,")")),_=!0):"".concat(n.apResponse.cid,"_").concat(n.apResponse.cert).length>255||"".concat(n.apResponse.cid,"_").concat(n.apResponse.cert).length<22?(T.debug("[".concat(c.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_=!0):n.apResponse.addresses.some(E=>E.fingerprint)||B("FINGERPRINT")||(T.debug("[".concat(c.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_=!0),_&&c.resetSignal()}c.store.joinGatewayStart(),"disabled"!==n.cloudProxyServer&&(c.hasChangeBGPAddress=!0);const d=Date.now();let h=ZD.get(n.cname);if(h||(h=new Map,ZD.set(n.cname,h)),c._isProactiveJoin=!0,h.has(n.uid)){const _=new W(k.UID_CONFLICT);throw ye.joinGateway(n.sid,{lts:d,succ:!1,ec:_.message,addr:null,uid:n.uid,cid:n.cid,firstSuccess:c._isProactiveJoin,avoidJoinStartTime:c.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:c.signal instanceof _c?"1":"0"}),c._isProactiveJoin=!1,_}h.set(n.uid,!0),c.joinInfo=n,c.key=i;let p=0;c.joinGatewayStartTime=d;const m=n.proxyServer;try{let _;if(T.debug("[".concat(c.store.clientId,"] use ").concat(c.signal instanceof _c?"datachannel":"websocket"," join uid ").concat(p)),c.signal instanceof _c)_=yield c.signal.init(n.apResponse.addresses,s);else{const E=n.gatewayAddrs.map(v=>{let{address:S}=v;const[b,O]=S.split(":"),P={host:b,port:O};return n.proxyServer&&(P.proxy=n.proxyServer),P});_=yield c.signal.init(E,s)}p=_.uid,T.debug("[".concat(c.store.clientId,"] ").concat(c.signal instanceof _c?"datachannel":"websocket"," join uid ").concat(p," cost ").concat(Date.now()-c.joinGatewayStartTime))}catch(_){throw _&&_.code===k.INIT_WEBSOCKET_TIMEOUT?(T.warning("[".concat(c.store.clientId,"] User join failed"),_.toString()),_):_&&_.code===k.INIT_DATACHANNEL_TIMEOUT?(T.warning("[".concat(c.store.clientId,"] User join datachannel failed"),_.toString()),c.resetSignal(),_):(T.error("[".concat(c.store.clientId,"] User join failed"),_.toString()),ye.joinGateway(n.sid,{lts:d,succ:!1,ec:_.message,addr:c.signal.url,uid:n.uid,cid:n.cid,firstSuccess:c._isProactiveJoin,avoidJoinStartTime:c.store.avoidJoinStart,isProxy:!!m,signalChannel:c.signal instanceof _c?"1":"0"}),c._isProactiveJoin=!1,h.delete(n.uid),c.signal.close(),_)}return c.state="CONNECTED",c.inChannelInfo.joinAt=Date.now(),T.debug("[".concat(c.store.clientId,"] Connected to gateway server")),c.trafficStatsInterval=window.setInterval(()=>{c.updateTrafficStats().catch(_=>{T.warning("[".concat(c.store.clientId,"] get traffic stats error"),_.toString())})},3e3),c.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?c.emit(ln.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):c.emit(ln.NETWORK_QUALITY,c._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===c.state&&c._statsCollector.trafficStats?{uplinkNetworkQuality:Xb(c._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Xb(c._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),c.store.joinGatewayEnd(),p})()}leave(){var n=arguments,i=this;return L(function*(){let s=n.length>0&&void 0!==n[0]&&n[0],c=n.length>1?n[1]:void 0;if("DISCONNECTED"!==i.state){c!==Ye.FALLBACK&&(i.state="DISCONNECTING");try{s||i.signal.connectionState!==qe.CONNECTED||(yield(d=i.signal.request(ve.LEAVE,void 0,!0),3e3,z.race([d,T1(3e3)])))}catch(d){T.warning("[".concat(i.store.clientId,"] leave request failed, ignore"),d)}i.signal.close(c),c!==Ye.FALLBACK&&(i.state="DISCONNECTED"),i.reset()}var d})()}publish(n,i,s){var c=this;return L(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(c.state));const d={state:"offer",p2p_id:c.store.p2pId,ortc:i,mode:c.spec.mode,extend:B("PUB_EXTEND"),twcc:!!B("PUBLISH_TWCC"),rtx:!!B("USE_PUB_RTX")};try{return(yield c.signal.request(ve.PUBLISH,d,!0))._message}catch(h){if(s&&h.data&&h.data.code===be.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(c.store.clientId,"] receive publish error code, retry"),h.toString()),yield c.tryUnpubBeforeRepub(n,i),c.publish(n,i,!1);throw h}})()}publishDataChannel(n,i,s){var c=this;return L(function*(){var d;if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(c.state));const h={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:null!==(d=i.maxRetransmits)&&void 0!==d?d:10,channel_id:i.channelId,metadata:i.metadata};try{yield c.signal.request(ve.PUBLISH_DATASTREAM,h,!0)}catch(p){if(s&&p.data&&p.data.code===be.ERR_PUBLISH_REQUEST_INVALID)return T.warning("[".concat(c.store.clientId,"] receive publish datachannels error code, retry"),p.toString()),yield c.tryUnpubDataChannelBeforeRepub(n,i),c.publishDataChannel(n,i,!1);throw p}})()}unpublish(n,i){var s=this;return L(function*(){try{if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(s.state));yield s.signal.request(ve.UNPUBLISH,{stream_id:i,ortc:n},!0)}catch(c){T.warning("[".concat(s.store.clientId,"] unpublish warning: "),c)}})()}unpublishDataChannel(n){var i=this;return L(function*(){try{if("CONNECTED"!==i.state&&"RECONNECTING"!==i.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(i.state));yield z.all(n.map(s=>i.signal.request(ve.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){T.warning("unpublish datachannels warning: ",s)}})()}subscribe(n,i,s){var c=this;return L(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new W(k.INVALID_OPERATION,"can not subscribe when connection state is ".concat(c.state));const d={stream_id:n,stream_type:i.stream_type,mode:c.spec.mode,codec:c.spec.codec,p2p_id:c.store.p2pId,twcc:!!B("SUBSCRIBE_TWCC"),rtx:!!B("USE_SUB_RTX"),extend:B("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(B("SVC"))&&0!==B("SVC").length?B("SVC"):void 0};try{return(yield c.signal.request(ve.SUBSCRIBE,d,!0))._message}catch(h){if(s&&h.data&&h.data.code===be.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(c.store.clientId,"] receiver subscribe error code, retry"),h.toString()),yield c.tryUnsubBeforeResub(n,i),yield c.subscribe(n,i,!1);throw h}})()}subscribeDataChannel(n,i,s){var c=this;return L(function*(){if("CONNECTED"!==c.state&&"RECONNECTING"!==c.state)throw new W(k.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(c.state));const d={uid:n,stream_id:i.id,channel_id:i.datachannelId};try{return void(yield c.signal.request(ve.SUBSCRIBE_DATASTREAM,d,!0))}catch(h){if(s&&h.data&&h.data.code===be.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(c.store.clientId,"] receiver subscribe datachannel error code, retry"),h.toString()),yield c.tryUnsubDataChannelBeforeResub(n,i),yield c.subscribeDataChannel(n,i,!1);throw h}})()}subscribeAll(n,i){var s=this;return L(function*(){if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new W(k.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(s.state));const c={p2p_id:s.store.p2pId,users:n,dtx:!1,rtx:!!B("USE_SUB_RTX")};try{return yield s.signal.request(ve.SUBSCRIBE_STREAMS,c,!0)}catch(d){if(i&&d.data&&d.data.code===be.ERR_SUBSCRIBE_REQUEST_INVALID)return T.warning("[".concat(s.store.clientId,"] receiver massSubscribe error code, retry"),d.toString()),yield s.tryMassUnsubBeforeResub(n),yield s.subscribeAll(n,!1);throw d}})()}setVideoProfile(n){var i=this;return L(function*(){const s=function(c){if(!(c.bitrateMax&&c.bitrateMin&&c.frameRate&&c.height&&c.width))return;let d=c.frameRate,h=c.width,p=c.height,m=!0;return"number"!=typeof d&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),"number"!=typeof h&&(h=h.exact||h.ideal||h.max||h.min||0,h||(m=!1)),"number"!=typeof p&&(p=p.exact||p.ideal||p.max||p.min||0,d||(m=!1)),m?{stream_type:0,width:h,height:p,fps:d,start_bps:1e3*c.bitrateMax,min_bps:1e3*c.bitrateMin,target_bps:1e3*c.bitrateMax}:void 0}(n);if(s)return i.signal.request(ve.SET_VIDEO_PROFILE,s);T.debug("[".concat(i.store.clientId,"] encoder config is not complete, do not report to gateway"))})()}unsubscribe(n,i){var s=this;return L(function*(){try{yield s.signal.request(ve.UNSUBSCRIBE,{p2p_id:s.store.p2pId,ortc:n,stream_id:i},!0)}catch(c){T.warning("[".concat(s.store.clientId,"] unsubscribe warning: "),c)}})()}unsubscribeDataChannel(n,i){var s=this;return L(function*(){try{if("CONNECTED"!==s.state&&"RECONNECTING"!==s.state)throw new W(k.INVALID_OPERATION,"can not publish when connection state is ".concat(s.state));yield z.all(n.map(c=>s.signal.request(ve.UNSUBSCRIBE_DATASTREAM,{stream_id:c,uid:i},!0)))}catch(c){T.warning("unsubscribeDataChannel warning: ",c)}})()}massUnsubscribe(n){var i=this;return L(function*(){try{yield i.signal.request(ve.UNSUBSCRIBE_STREAMS,n,!0)}catch(s){T.warning("[".concat(i.store.clientId,"] massUnsubscribeAll warning: "),s)}})()}reconnectPC(n){var i=this;return L(function*(){const{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}=n;return{gatewayEstablishParams:yield i.signal.request(ve.CONNECT_PC,{p2p_id:i.store.p2pId,stream_id:i.store.uid,ortc:{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}},!0),gatewayAddress:i.getCurrentGatewayAddress()}})()}getGatewayInfo(){return this.signal.request(ve.GATEWAY_INFO)}renewToken(n){var i=this;return L(function*(){yield i.signal.request(ve.RENEW_TOKEN,n),i.key=n.token})()}setClientRole(n,i){var s=this;return L(function*(){if(i&&(s._clientRoleOptions=Object.assign({},i)),"CONNECTED"!==s.state)return void(s.role=n);let c,d=0;"audience"===n?s._clientRoleOptions&&s._clientRoleOptions.delay?(c=s._clientRoleOptions.delay,d=1):d=s._clientRoleOptions&&s._clientRoleOptions.level?s._clientRoleOptions.level:2:d=0,yield s.signal.request(ve.SET_CLIENT_ROLE,{role:n,level:d,delay:c,client_ts:Date.now()}),s.role=n})()}setRemoteVideoStreamType(n,i){var s=this;return L(function*(){yield s.signal.request(ve.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:i})})()}setDefaultRemoteVideoStreamType(n){var i=this;return L(function*(){yield i.signal.request(ve.DEFAULT_VIDEO_STREAM,{stream_type:n})})()}setStreamFallbackOption(n,i){var s=this;return L(function*(){yield s.signal.request(ve.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:i})})()}pickSVCLayer(n,i){var s=this;return L(function*(){yield s.signal.request(ve.PICK_SVC_LAYER,{stream_id:n,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})})()}setRTM2Flag(n){var i=this;return L(function*(){yield i.signal.request(ve.SET_RTM2_FLAG,{rtm2_flag:n})})()}sendExtensionMessage(n,i,s){var c=this;return L(function*(){if(c.signal instanceof sx)return c.signal.sendExtensionMessage(n,i,s)})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),us({},this.inChannelInfo)}getGatewayVersion(){var n=this;return L(function*(){return(yield n.signal.request(ve.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=ZD.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(i){let s;return s=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),s?{username:qr.username,password:qr.password,turnServerURL:s[2],tcpport:parseInt(s[3])+30,udpport:parseInt(s[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(us(us({},qr),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}updateTrafficStats(){var n=this;return L(function*(){if("CONNECTED"!==n.state)return;const i=yield n.signal.request(ve.TRAFFIC_STATS,void 0,!0);i.timestamp=Date.now(),null!=i.ntp_offset&&(n.ntpOffset=i.ntp_offset),i.peer_delay.forEach(s=>{const c=n._statsCollector.trafficStats&&n._statsCollector.trafficStats.peer_delay.find(d=>d.peer_uid===s.peer_uid);c&&c.B_st!==s.B_st&&is(()=>{n.emit(ln.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),n._statsCollector.updateTrafficStats(i)})()}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new W(k.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let s=B("REPORT_APP_SCENARIO");if("string"!=typeof s)try{s=JSON.stringify(s)}catch(d){s=void 0}s&&s.length>128&&(s=void 0);const c=us({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Kr,browser:navigator.userAgent,process_id:B("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:B("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:{enablePublishedUserList:B("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:B("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof B("SUBSCRIBE_AUDIO_FILTER_TOPN")?B("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof B("ENABLE_PUBLISH_AUDIO_FILTER")?B("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof B("ENABLE_USER_LICENSE_CHECK")?B("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===B("USE_PUB_RTX")||!0===B("USE_SUB_RTX")||void 0,disableFEC:B("DISABLE_FEC"),enableNTPReport:!!B("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!B("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof B("ENABLE_DATASTREAM_2")?B("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof B("RTM2_FLAG")?B("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!B("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof B("USE_XR")?B("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(c.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(c.aes_mode=this.joinInfo.aesmode,B("ENCRYPT_AES")?(c.aes_secret=this.joinInfo.aespassword,c.aes_encrypt=!0):c.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(c.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(c.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),void 0!==this.joinInfo.defaultVideoStream&&(c.default_video_stream=this.joinInfo.defaultVideoStream),c}getRejoinMessage(){if(!this.joinInfo)throw new W(k.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){var n=this;this.signal.on(de.WS_RECONNECT_WAITTING_FINISH,i=>{var s;Re(s=["tryNext","recover"]).call(s,i)&&this.joinInfo&&ye.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(de.WS_RECONNECT_CREATE_CONNECTION,i=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(de.WS_RECONNECTING,i=>{this.joinInfo&&ye.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i||Gn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",ye.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(de.WS_CLOSED,i=>{let s;switch(i){case Ye.LEAVE:s=Gn.LEAVE;break;case Ye.UID_BANNED:case Ye.IP_BANNED:case Ye.CHANNEL_BANNED:case Ye.SERVER_ERROR:s=Gn.SERVER_ERROR;break;case Ye.FALLBACK:s=Gn.FALLBACK;break;case Ye.LICENSE_MISSING:case Ye.LICENSE_EXPIRED:case Ye.LICENSE_MINUTES_EXCEEDED:case Ye.LICENSE_PERIOD_INVALID:case Ye.LICENSE_MULTIPLE_SDK_SERVICE:case Ye.LICENSE_ILLEGAL:case Ye.TOKEN_EXPIRE:s=i;break;default:s=Gn.NETWORK_ERROR}T.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Gn.NETWORK_ERROR)),this.joinInfo&&ye.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:i===Ye.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=i,i!==Ye.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(de.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(T.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),ye.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof _c?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const i=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!i)return void T.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(i));Nt("EVENT_REPORT_DOMAIN",i[1]),Nt("EVENT_REPORT_BACKUP_DOMAIN",i[1]),Nt("LOG_UPLOAD_SERVER","".concat(i[1],":6444"))}}),this.signal.on(Me.ON_UPLINK_STATS,i=>{this._statsCollector.updateUplinkStats(i)}),this.signal.on(de.REQUEST_RECOVER,(i,s,c)=>{if(!this.joinInfo)return c(new W(k.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));i&&(this.joinInfo.multiIP=i,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,cn(this,ln.REQUEST_NEW_GATEWAY_LIST).then(s).catch(c)}),this.signal.on(de.REQUEST_JOIN_INFO,function(){var i=L(function*(s){var c;if(n.updateTurnConfigFromSignal(),n.store.useP2P)return void s(n.getJoinMessage({ortc:{}}));const{iceParameters:d,dtlsParameters:h,rtpCapabilities:p}=yield cn(n,ln.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(c=n.joinInfo)||void 0===c?void 0:c.turnServer});s(n.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:h,rtpCapabilities:p,version:"2"}}))});return function(s){return i.apply(this,arguments)}}()),this.signal.on(de.REQUEST_REJOIN_INFO,i=>{i(this.getRejoinMessage())}),this.signal.on(de.REPORT_JOIN_GATEWAY,(i,s)=>{this.joinInfo&&(ye.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof _c?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(de.IS_P2P_DISCONNECTED,i=>{i(_a(this,ln.IS_P2P_DISCONNECTED))}),this.signal.on(de.DISCONNECT_P2P,()=>{this.emit(ln.DISCONNECT_P2P)}),this.signal.on(de.NEED_RENEW_SESSION,()=>{this.emit(ln.NEED_RENEW_SESSION)}),this.signal.on(de.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(de.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(de.JOIN_RESPONSE,i=>{const s=this.getCurrentGatewayAddress();this.emit(ln.JOIN_RESPONSE,i,s)}),this.signal.on(de.DATACHANNEL_PRECONNECT,function(){var i=L(function*(s,c,d){n.updateTurnConfigFromSignal();const h=n.getCurrentGatewayAddress();return cn(n,ln.DATACHANNEL_PRECONNECT,s,h).then(c).catch(d)});return function(s,c,d){return i.apply(this,arguments)}}()),this.signal.on(de.DATACHANNEL_CONNECTING,function(){var i=L(function*(s){const{iceParameters:c,dtlsParameters:d,rtpCapabilities:h}=yield cn(n,ln.REQUEST_DC_CONNECTION_PARAMS);s(n.getJoinMessage({ortc:{iceParameters:c,dtlsParameters:d,rtpCapabilities:h,version:"2"}}))});return function(s){return i.apply(this,arguments)}}()),this.signal.on(de.DATACHANNEL_FAILBACK,()=>{T.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(ln.DATACHANNEL_FAILBACK)})}tryUnsubBeforeResub(n,i){var s=this;return L(function*(){try{yield s.signal.request(ve.UNSUBSCRIBE,{p2p_id:s.store.p2pId,stream_id:n,ortc:[i]},!0)}catch(c){throw T.warning("[".concat(s.store.clientId,"] tryUnsubBeforeResub warning"),c),c}})()}tryUnsubDataChannelBeforeResub(n,i){var s=this;return L(function*(){try{yield s.signal.request(ve.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(c){throw T.warning("unsubscribe datachannel warning",c),c}})()}tryUnpubBeforeRepub(n,i){var s=this;return L(function*(){try{yield s.signal.request(ve.UNPUBLISH,{stream_id:n,ortc:i},!0)}catch(c){throw T.warning("[".concat(s.store.clientId,"] tryUnpubBeforeRepub warning: "),c),c}})()}tryUnpubDataChannelBeforeRepub(n,i){var s=this;return L(function*(){try{yield s.signal.request(ve.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(c){throw T.warning("unpublish datastream warning: ",c),c}})()}tryMassUnsubBeforeResub(n){var i=this;return L(function*(){const s={users:n.map(c=>({stream_id:c.stream_id,stream_type:c.stream_type}))};try{yield i.signal.request(ve.UNSUBSCRIBE_STREAMS,s,!0)}catch(c){throw T.warning("[".concat(i.store.clientId,"] tryMassUnsubBeforeResub warning"),c),c}})()}muteLocal(n,i){var s=this;return L(function*(){const c={action:n.find(d=>d.stream_type===bt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:s.store.p2pId,ortc:n,stream_id:i};try{yield s.signal.request(ve.CONTROL,c,!0,!0)}catch(d){throw T.warning("[".concat(s.store.clientId,"] gateway muteLocal warning: "),d),d}})()}unmuteLocal(n,i){var s=this;return L(function*(){const c={action:n.find(d=>d.stream_type===bt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:s.store.p2pId,ortc:n,stream_id:i};try{yield s.signal.request(ve.CONTROL,c,!0,!0)}catch(d){throw T.warning("[".concat(s.store.clientId,"] gateway unmuteLocal warning: "),d),d}})()}muteRemote(n,i){var s=this;return L(function*(){const c={action:n===fe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:s.store.p2pId,stream_id:i};try{yield s.signal.request(ve.CONTROL,c,!0,!0)}catch(d){throw T.warning("[".concat(s.store.clientId,"] gateway muteRemote warning: "),d),d}})()}unmuteRemote(n,i){var s=this;return L(function*(){const c={action:n===fe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:s.store.p2pId,stream_id:i};try{yield s.signal.request(ve.CONTROL,c,!0,!0)}catch(d){throw T.warning("[".concat(s.store.clientId,"] gateway unmuteRemote warning: "),d),d}})()}uploadStats(n,i){this.signal.upload(n,i)}getSignalRTT(){return this.signal.rtt}restartICE(n){var i=this;return L(function*(){const s={p2p_id:i.store.p2pId,stream_id:i.store.uid,ortc:n};try{return yield i.signal.request(ve.RESTART_ICE,s,!0)}catch(c){throw T.warning("[".concat(i.store.clientId,"] P2PChannel.restartICE warning: "),c),c}})()}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Gn.P2P_FAILED)}getCurrentGatewayAddress(){var n;if(!B("GATEWAY_WSS_ADDRESS"))return null!==(n=this.joinInfo)&&void 0!==n&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}setPublishAudioFilterEnabled(n){var i=this;return L(function*(){yield i.signal.request(ve.SET_PARAMETER,{enablePublishAudioFilter:n})})()}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ye.FALLBACK)),this.store.useDataChannel=!1,this.signal=new tl(us(us({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(ln.RESET_SIGNAL,Af.websocket)}}let Zb=0,eO=0;function pl(o,n,i,s){return new z((c,d)=>{n.timeout=n.timeout||B("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),Zb+=Ea(n.data)):i&&(n.data.size?Zb+=n.data.size:n.data instanceof FormData?Zb+=ad(n.data):Zb+=Ea(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=o,Hn.request(n).then(h=>{"string"==typeof h.data?eO+=Ea(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?eO+=h.data.byteLength:eO+=Ea(JSON.stringify(h.data)),s&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Hn.isCancel(h)?d(new W(k.OPERATION_ABORTED,"cancel token canceled")):d("ECONNABORTED"===h.code?new W(k.NETWORK_TIMEOUT,h.message):h.response?new W(k.NETWORK_RESPONSE_ERROR,h.response.status):new W(k.NETWORK_ERROR,h.message))})})}!function(){var o;function n(ee){var ae=0;return function(){return ae<ee.length?{done:!1,value:ee[ae++]}:{done:!0}}}var s,i="function"==typeof Object.defineProperties?Object.defineProperty:function(ee,ae,me){return ee==Array.prototype||ee==Object.prototype||(ee[ae]=me.value),ee},c=function(ee){ee=["object"==typeof globalThis&&globalThis,ee,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof jd&&jd];for(var ae=0;ae<ee.length;++ae){var me=ee[ae];if(me&&me.Math==Math)return me}throw Error("Cannot find global object")}(this);function d(ee,ae){if(ae)e:{var me=c;ee=ee.split(".");for(var ke=0;ke<ee.length-1;ke++){var pt=ee[ke];if(!(pt in me))break e;me=me[pt]}(ae=ae(ke=me[ee=ee[ee.length-1]]))!=ke&&null!=ae&&i(me,ee,{configurable:!0,writable:!0,value:ae})}}function h(ee){return(ee={next:ee})[Symbol.iterator]=function(){return this},ee}function p(ee){var ae="undefined"!=typeof Symbol&&Symbol.iterator&&ee[Symbol.iterator];return ae?ae.call(ee):{next:n(ee)}}if(d("Symbol",function(ee){function ae(pt,le){this.A=pt,i(this,"description",{configurable:!0,writable:!0,value:le})}if(ee)return ee;ae.prototype.toString=function(){return this.A};var me="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ke=0;return function pt(le){if(this instanceof pt)throw new TypeError("Symbol is not a constructor");return new ae(me+(le||"")+"_"+ke++,le)}}),d("Symbol.iterator",function(ee){if(ee)return ee;ee=Symbol("Symbol.iterator");for(var ae="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),me=0;me<ae.length;me++){var ke=c[ae[me]];"function"==typeof ke&&"function"!=typeof ke.prototype[ee]&&i(ke.prototype,ee,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return ee}),"function"==typeof Object.setPrototypeOf)s=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch(ee){}m=!1}s=m?function(ee,ae){if(ee.__proto__=ae,ee.__proto__!==ae)throw new TypeError(ee+" is not extensible");return ee}:null}var E=s;function v(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function S(ee){if(ee.m)throw new TypeError("Generator is already running");ee.m=!0}function b(ee,ae){return ee.h=3,{value:ae}}function O(ee){this.g=new v,this.G=ee}function P(ee,ae,me,ke){try{var pt=ae.call(ee.g.j,me);if(!(pt instanceof Object))throw new TypeError("Iterator result "+pt+" is not an object");if(!pt.done)return ee.g.m=!1,pt;var le=pt.value}catch(I){return ee.g.j=null,ee.g.s(I),w(ee)}return ee.g.j=null,ke.call(ee.g,le),w(ee)}function w(ee){for(;ee.g.h;)try{var ae=ee.G(ee.g);if(ae)return ee.g.m=!1,{value:ae.value,done:!1}}catch(me){ee.g.v=void 0,ee.g.s(me)}if(ee.g.m=!1,ee.g.l){if(ae=ee.g.l,ee.g.l=null,ae.F)throw ae.D;return{value:ae.return,done:!0}}return{value:void 0,done:!0}}function M(ee){this.next=function(ae){return ee.o(ae)},this.throw=function(ae){return ee.s(ae)},this.return=function(ae){return function(me,ke){S(me.g);var pt=me.g.j;return pt?P(me,"return"in pt?pt.return:function(le){return{value:le,done:!0}},ke,me.g.return):(me.g.return(ke),w(me))}(ee,ae)},this[Symbol.iterator]=function(){return this}}function V(ee,ae){return ae=new M(new O(ae)),E&&ee.prototype&&E(ae,ee.prototype),ae}if(v.prototype.o=function(ee){this.v=ee},v.prototype.s=function(ee){this.l={D:ee,F:!0},this.h=this.C||this.u},v.prototype.return=function(ee){this.l={return:ee},this.h=this.u},O.prototype.o=function(ee){return S(this.g),this.g.j?P(this,this.g.j.next,ee,this.g.o):(this.g.o(ee),w(this))},O.prototype.s=function(ee){return S(this.g),this.g.j?P(this,this.g.j.throw,ee,this.g.o):(this.g.s(ee),w(this))},d("Array.prototype.entries",function(ee){return ee||function(){return function(ae,me){ae instanceof String&&(ae+="");var ke=0,pt=!1,le={next:function(){if(!pt&&ke<ae.length){var I=ke++;return{value:me(I,ae[I]),done:!1}}return pt=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}(this,function(ae,me){return[ae,me]})}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var U=function(ee,ae){for(var me=0;me<ee.length;me++)ae(ee[me])},Y=function(ee){return ee.replace(/\r?\n|\r/g,"\r\n")},ie=function(ee,ae,me){return ae instanceof Blob?(me=void 0!==me?String(me+""):"string"==typeof ae.name?ae.name:"blob",ae.name===me&&"[object Blob]"!==Object.prototype.toString.call(ae)||(ae=new File([ae],me)),[String(ee),ae]):[String(ee),String(ae)]},K=function(ee,ae){if(ee.length<ae)throw new TypeError(ae+" argument required, but only "+ee.length+" present.")},X="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,$=X.FormData,J=X.XMLHttpRequest&&X.XMLHttpRequest.prototype.send,ge=X.Request&&X.fetch,Ee=X.navigator&&X.navigator.sendBeacon,ze=X.Element&&X.Element.prototype,ht=X.Symbol&&Symbol.toStringTag;ht&&(Blob.prototype[ht]||(Blob.prototype[ht]="Blob"),"File"in X&&!File.prototype[ht]&&(File.prototype[ht]="File"));try{new File([],"")}catch(ee){X.File=function(ae,me,ke){return ae=new Blob(ae,ke||{}),Object.defineProperties(ae,{name:{value:me},lastModified:{value:+(ke&&void 0!==ke.lastModified?new Date(ke.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ht&&Object.defineProperty(ae,ht,{value:"File"}),ae}}var St=function(ee){return ee.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},st=function(ee){this.i=[];var ae=this;ee&&U(ee.elements,function(me){if(me.name&&!me.disabled&&"submit"!==me.type&&"button"!==me.type&&!me.matches("form fieldset[disabled] *"))if("file"===me.type){var ke=me.files&&me.files.length?me.files:[new File([],"",{type:"application/octet-stream"})];U(ke,function(pt){ae.append(me.name,pt)})}else"select-multiple"===me.type||"select-one"===me.type?U(me.options,function(pt){!pt.disabled&&pt.selected&&ae.append(me.name,pt.value)}):"checkbox"===me.type||"radio"===me.type?me.checked&&ae.append(me.name,me.value):(ke="textarea"===me.type?Y(me.value):me.value,ae.append(me.name,ke))})};if((o=st.prototype).append=function(ee,ae,me){K(arguments,2),this.i.push(ie(ee,ae,me))},o.delete=function(ee){K(arguments,1);var ae=[];ee=String(ee),U(this.i,function(me){me[0]!==ee&&ae.push(me)}),this.i=ae},o.entries=function ee(){var ae,me=this;return V(ee,function(ke){if(1==ke.h&&(ae=0),3!=ke.h)return ae<me.i.length?ke=b(ke,me.i[ae]):(ke.h=0,ke=void 0),ke;ae++,ke.h=2})},o.forEach=function(ee,ae){K(arguments,1);for(var me=p(this),ke=me.next();!ke.done;ke=me.next()){var pt=p(ke.value);ke=pt.next().value,pt=pt.next().value,ee.call(ae,pt,ke,this)}},o.get=function(ee){K(arguments,1);var ae=this.i;ee=String(ee);for(var me=0;me<ae.length;me++)if(ae[me][0]===ee)return ae[me][1];return null},o.getAll=function(ee){K(arguments,1);var ae=[];return ee=String(ee),U(this.i,function(me){me[0]===ee&&ae.push(me[1])}),ae},o.has=function(ee){K(arguments,1),ee=String(ee);for(var ae=0;ae<this.i.length;ae++)if(this.i[ae][0]===ee)return!0;return!1},o.keys=function ee(){var ae,me,le=this;return V(ee,function(I){if(1==I.h&&(ae=p(le),me=ae.next()),3!=I.h)return me.done?void(I.h=0):b(I,p(me.value).next().value);me=ae.next(),I.h=2})},o.set=function(ee,ae,me){K(arguments,2),ee=String(ee);var ke=[],pt=ie(ee,ae,me),le=!0;U(this.i,function(I){I[0]===ee?le&&(le=!ke.push(pt)):ke.push(I)}),le&&ke.push(pt),this.i=ke},o.values=function ee(){var ae,me,pt,le=this;return V(ee,function(I){if(1==I.h&&(ae=p(le),me=ae.next()),3!=I.h)return me.done?void(I.h=0):((pt=p(me.value)).next(),b(I,pt.next().value));me=ae.next(),I.h=2})},st.prototype._asNative=function(){for(var ee=new $,ae=p(this),me=ae.next();!me.done;me=ae.next()){var ke=p(me.value);me=ke.next().value,ke=ke.next().value,ee.append(me,ke)}return ee},st.prototype._blob=function(){var ee="----formdata-polyfill-"+Math.random(),ae=[],me="--"+ee+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(ke,pt){return"string"==typeof ke?ae.push(me+St(Y(pt))+'"\r\n\r\n'+Y(ke)+"\r\n"):ae.push(me+St(Y(pt))+'"; filename="'+St(ke.name)+'"\r\nContent-Type: '+(ke.type||"application/octet-stream")+"\r\n\r\n",ke,"\r\n")}),ae.push("--"+ee+"--"),new Blob(ae,{type:"multipart/form-data; boundary="+ee})},st.prototype[Symbol.iterator]=function(){return this.entries()},st.prototype.toString=function(){return"[object FormData]"},ze&&!ze.matches&&(ze.matches=ze.matchesSelector||ze.mozMatchesSelector||ze.msMatchesSelector||ze.oMatchesSelector||ze.webkitMatchesSelector||function(ee){for(var ae=(ee=(this.document||this.ownerDocument).querySelectorAll(ee)).length;0<=--ae&&ee.item(ae)!==this;);return-1<ae}),ht&&(st.prototype[ht]="FormData"),J){var Ct=X.XMLHttpRequest.prototype.setRequestHeader;X.XMLHttpRequest.prototype.setRequestHeader=function(ee,ae){Ct.call(this,ee,ae),"content-type"===ee.toLowerCase()&&(this.B=!0)},X.XMLHttpRequest.prototype.send=function(ee){ee instanceof st?(ee=ee._blob(),this.B||this.setRequestHeader("Content-Type",ee.type),J.call(this,ee)):J.call(this,ee)}}ge&&(X.fetch=function(ee,ae){return ae&&ae.body&&ae.body instanceof st&&(ae.body=ae.body._blob()),ge.call(this,ee,ae)}),Ee&&(X.navigator.sendBeacon=function(ee,ae){return ae instanceof st&&(ae=ae._asNative()),Ee.call(this,ee,ae)}),X.FormData=st}}();const eT=()=>{const o=B("AREAS");return 0===o.length&&o.push(it.GLOBAL),cd(o).call(o,(n,i,s)=>{const c=cx(i);return c?0===s?c:"".concat(n,",").concat(c):n},"")},cx=o=>o===it.OVERSEA?"".concat(fi.ASIA,",").concat(fi.EUROPE,",").concat(fi.AFRICA,",").concat(fi.NORTH_AMERICA,",").concat(fi.SOUTH_AMERICA,",").concat(fi.OCEANIA):fi[o],jU=o=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(i=>{const s=lE[i],c=Object.keys(s);c&&c.map(d=>{"CODE"!==d&&(n[d]=n[d].concat(s[d]))})}),n},KE={GLOBAL:{ASIA:[it.CHINA,it.JAPAN,it.INDIA,it.KOREA,it.HKMC],EUROPE:[],NORTH_AMERICA:[it.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},tT=Object.keys(KE[it.GLOBAL]),nT=[it.CHINA,it.NORTH_AMERICA,it.EUROPE,it.ASIA,it.JAPAN,it.INDIA,it.OCEANIA,it.SOUTH_AMERICA,it.AFRICA,it.KOREA,it.HKMC,it.US],qE=function(o,n){let i=[];if(Re(o).call(o,it.GLOBAL)){const d=[it.GLOBAL,it.OVERSEA],h=Object.keys(lE);if(n===it.GLOBAL)throw new W(k.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===it.CHINA)i=[it.OVERSEA];else if(c=n,Re(tT).call(tT,c)){const p=KE[it.GLOBAL][n]||[],m=[...d,n,...p];i=h.filter(_=>!Re(m).call(m,_))}else if(function(p){let m=!1;return tT.forEach(_=>{var E;Re(E=KE[it.GLOBAL][_]).call(E,p)&&(m=!0)}),m}(n)){const p=function(_){let E;return tT.forEach(v=>{var S;Re(S=KE[it.GLOBAL][v]).call(S,_)&&(E=v)}),E}(n),m=[...d,p,n];i=h.filter(_=>!Re(m).call(m,_))}else i=o;i=function(p){const m=[];return nT.forEach(_=>{Re(p).call(p,_)&&m.push(_)}),m.concat(p.filter(_=>!Re(nT).call(nT,_)))}(i)}else i=o;var c;return i};function iT(o){var n,i;if(!o&&Re(n=B("AREAS")).call(n,it.EXTENSIONS))return T.debug("update area from ap : reset"),void gc(Q1,!0);if(!Re(i=B("AREAS")).call(i,it.GLOBAL)||!o)return;let s=lE.EXTENSIONS;s&&(s={CODE:cx(it.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(o,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(o,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(o,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(o,".agora.io"),"cds-ap-web-2-".concat(o,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(o,".agora.io"),"sua-ap-web-2-".concat(o,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(o,".agora.io"),"uap-ap-web-2-".concat(o,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(o,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(o,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(o,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(o,".agora.io")]},T.debug("update area from ap success: ".concat(o,",config is "),s),Nt("AREAS",[it.EXTENSIONS],!0),Object.keys(s).map(c=>{Nt(c,"LOG_UPLOAD_SERVER"===c||"EVENT_REPORT_DOMAIN"===c||"EVENT_REPORT_BACKUP_DOMAIN"===c||"PROXY_SERVER_TYPE3"===c?s[c][0]:s[c])}))}function gc(o){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=ye.reportApiInvoke(null,{name:fn.SET_AREA,options:o,tag:nn.TRACER});try{let s=[];if("string"==typeof o&&(s=[o]),Array.isArray(o)&&(o.forEach(d=>{if(!Re(BA).call(BA,d))throw new W(k.INVALID_PARAMS,"invalid area code")}),s=o),"[object Object]"===Object.prototype.toString.call(o)){const{areaCode:d,excludedArea:h}=o;if(!d)throw new W(k.INVALID_PARAMS,"area code is needed");let p=d;"string"==typeof d&&(p=[d]),s=h?qE(p,h):p}if(!n){if(ic.AREAS){const d=new W(k.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(d),void T.warning("setArea is prohibited because of config-distribute")}if(Re(s).call(s,it.GLOBAL)&&B("AREAS")===it.EXTENSIONS){const d=new W(k.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(d),void T.warning("setArea is prohibited because of ap extensions")}}Nt("AREAS",s,n);const c=jU(s);Object.keys(c).map(d=>{Nt(d,"LOG_UPLOAD_SERVER"===d||"EVENT_REPORT_DOMAIN"===d||"EVENT_REPORT_BACKUP_DOMAIN"===d||"PROXY_SERVER_TYPE3"===d?c[d][0]:c[d])}),T.debug("set area success:",s.join(","))}catch(s){throw i.onError(s),s}i.onSuccess()}function hs(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function rT(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?hs(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):hs(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let YE=1;function lx(o,n,i,s,c){YE+=1;const d={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:YE,requestId:YE,version:Kr,cname:i.cname},h={service_name:n,json_body:JSON.stringify(d)};let p,m,_=o[0];return Fs(L(function*(){p=Date.now();const E=yield pl(_,{data:h,cancelToken:s,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-p,0!==E.code){const b=new W(k.UNEXPECTED_RESPONSE,"live streaming ap error, code"+E.code,{retry:!0,responseTime:m});throw T.error(b.toString()),b}const v=JSON.parse(E.json_body);if(200!==v.code){const b=new W(k.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(v.code,", reason: ").concat(v.reason),{code:v.code,responseTime:m});throw T.error(b.toString()),b}if(!v.servers||0===v.servers.length){const b=new W(k.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:v.code,responseTime:m});throw T.error(b.toString()),b}const S=(O=n,{addressList:(b=v).servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(O))),workerToken:b.workerToken,vid:b.vid});var b,O;return B("LIVE_STREAMING_ADDRESS")&&(S.addressList=B("LIVE_STREAMING_ADDRESS")instanceof Array?B("LIVE_STREAMING_ADDRESS"):[B("LIVE_STREAMING_ADDRESS")]),rT(rT({},S),{},{responseTime:m})}),(E,v)=>(ye.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(E.addressList),firstSuccess:0===v,responseTime:m,serverIp:o[v%o.length]}),!1),(E,v)=>(ye.apworkerEvent(i.sid,{success:!1,sc:E.data&&E.data.code||200,serviceName:n,responseTime:m,serverIp:o[v%o.length]}),!!(E.code!==k.OPERATION_ABORTED&&E.code!==k.UNEXPECTED_RESPONSE||E.data&&E.data.retry)&&(_=o[(v+1)%o.length],!0)),c)}let oT=1;function tO(o,n,i,s){let{url:c,areaCode:d}=o;const h=Date.now();let p;const[m,_]=vc(n,d,[ri.CHOOSE_SERVER]);let E=mn.networkState;return Fs(L(function*(){E&&mn.networkState===xi.OFFLINE&&mn.onlineWaiter&&(yield z.race([mn.onlineWaiter,pi(s&&s.maxRetryTimeout||Ln.maxRetryTimeout)])),E=mn.networkState;const{data:v,headers:S}=yield pl(c,{data:m,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p="1"===S.http3?1:-1,ye.reportResourceTiming(c,n.sid),Ec(v,c,n,h,[ri.CHOOSE_SERVER],p);const b=wa(v,ri.CHOOSE_SERVER);return sT(b),QD(b,c)}),v=>(v&&ye.joinChooseServer(n.sid,{lts:h,succ:!0,csAddr:c,opid:_,serverList:v.gatewayAddrs.map(S=>S.address),ec:null,cid:v.cid.toString(),uid:v.uid.toString(),csIp:v.csIp,unilbsServerIds:[ri.CHOOSE_SERVER].toString(),isHttp3:p}),!1),v=>v.code!==k.OPERATION_ABORTED&&(v.code===k.CAN_NOT_GET_GATEWAY_SERVER?v.data.retry:(ye.joinChooseServer(n.sid,{lts:h,succ:!1,csAddr:c,serverList:null,opid:_,ec:v.code,csIp:v.data&&v.data.csIp,unilbsServerIds:[ri.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:E}),isHttp3:p}),T.warning("[".concat(n.clientId,"] Choose server network error, retry"),v),!0)),s)}function am(o,n,i,s){let c,{url:d,areaCode:h,serviceIds:p}=o;const m=Date.now(),[_,E]=vc(n,h,p);let v;return Fs(L(function*(){v&&mn.networkState===xi.OFFLINE&&mn.onlineWaiter&&(yield z.race([mn.onlineWaiter,pi(s&&s.maxRetryTimeout||Ln.maxRetryTimeout)])),v=mn.networkState;const{data:S,headers:b}=yield pl(d,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c="1"===b.http3?1:-1,ye.reportResourceTiming(d,n.sid),Ec(S,d,n,m,p,c);const O=wa(S,ri.CHOOSE_SERVER),P=wa(S,"proxy5"===n.cloudProxyServer?ri.CLOUD_PROXY_5:"proxy3"===n.cloudProxyServer||"proxy4"===n.cloudProxyServer?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK);return sT(O),{gatewayInfo:QD(O,d),proxyInfo:P,url:d}}),S=>(S.gatewayInfo&&ye.joinChooseServer(n.sid,{lts:m,succ:!0,csAddr:d,serverList:S.gatewayInfo.gatewayAddrs.map(b=>b.address),ec:null,opid:E,cid:S.gatewayInfo.cid.toString(),uid:S.gatewayInfo.uid.toString(),csIp:S.gatewayInfo.csIp,unilbsServerIds:p.toString(),isHttp3:c}),S.proxyInfo&&ye.joinWebProxyAP(n.sid,{lts:m,sucess:1,apServerAddr:d,turnServerAddrList:S.proxyInfo.addresses.map(b=>b.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:p.toString()}),!1),S=>S.code!==k.OPERATION_ABORTED&&(S.code===k.CAN_NOT_GET_GATEWAY_SERVER?S.data.retry:(ye.joinWebProxyAP(n.sid,{lts:m,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:S.code,eventType:n.cloudProxyServer,unilbsServerIds:p.toString(),extend:JSON.stringify({networkState:v})}),T.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),S),!0)),s)}const Ec=(o,n,i,s,c,d)=>{const h=[],p=m=>{4096===m.flag?ye.joinChooseServer(i.sid,{lts:s,succ:!1,csAddr:n,opid:o.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d}):1048576!==m.flag&&4194304!==m.flag&&4194310!==m.flag||ye.joinWebProxyAP(i.sid,{lts:s,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:m.error.code,eventType:i.cloudProxyServer,unilbsServerIds:c.toString()})};if(o.response_body.forEach(m=>{const _=m.buffer.code;if(23===m.uri&&0===_&&!m.buffer.edges_services)if(4194310===m.buffer.flag)T.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{const E={error:new W(k.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:o.detail[502]}),flag:m.buffer.flag};h.push(E),p(E)}if(0!==_){const E=dE(_),v={error:new W(k.CAN_NOT_GET_GATEWAY_SERVER,E.desc,{desc:E.desc,retry:E.retry,csIp:o.detail[502]}),flag:m.buffer.flag};4194310===m.buffer.flag?T.warning(v.error.toString()):h.push(v),p(v)}}),h.length)throw T.warning("[".concat(i.clientId,"] multi unilbs ").concat(n," failed, ").concat(h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new W(k.CAN_NOT_GET_GATEWAY_SERVER,h.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!h.find(m=>m.error.data.retry),csIp:o.detail[502],desc:[...new Set(h.map(m=>{var _;return null==m||null===(_=m.error)||void 0===_||null===(_=_.data)||void 0===_?void 0:_.desc}).filter(m=>!!m))]})},sT=o=>{var n,i,s,c;if(o.addresses&&0===o.addresses.length&&0===o.code)throw new W(k.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:o.detail&&o.detail[502]});if(B("AP_AREA")&&(null!==(s=o.detail)&&void 0!==s&&s[23]&&"string"==typeof(null===(c=o.detail)||void 0===c?void 0:c[23])?iT(o.detail[23].toLowerCase()):iT()),null!==(n=o.detail)&&void 0!==n&&n[19]&&"string"==typeof(null===(i=o.detail)||void 0===i?void 0:i[19])){const h=o.detail[19],p=null==h?void 0:h.split(";");for(let m=0;m<p.length;m++){var d;const _=ub(d=p[m]).call(d);o.addresses[m]&&p&&(o.addresses[m].fingerprint=_)}}if(B("GATEWAY_ADDRESS")&&B("GATEWAY_ADDRESS").length>0){T.debug("assign gateway address to",B("GATEWAY_ADDRESS"));const h=B("GATEWAY_ADDRESS").map(p=>{var m,_;const E=null!==(m=null===(_=o.addresses.find(v=>v.ip===p.ip&&v.port===p.port))||void 0===_?void 0:_.fingerprint)&&void 0!==m?m:"";return{ip:p.ip,port:p.port,ticket:o.addresses[0]&&o.addresses[0].ticket,fingerprint:E}});o.addresses=h}},br=(o,n)=>{if(o.response_body&&o.response_body.length){const i=o.response_body[0];if(0!==i.buffer.code){const s=dE(i.buffer.code);throw new W(k.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(s.desc),{retry:s.retry})}return i.buffer.ticket}throw T.debug("update ticket request received ap response without response body:",n),new W(k.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},vc=(o,n,i)=>{const s=Math.floor(1e12*Math.random()),c={appid:o.appId,client_ts:Date.now(),opid:s,sid:o.sid,request_bodies:[{uri:22,buffer:{cname:o.cname,detail:rT({6:o.stringUid,11:n,12:B("USE_NEW_TOKEN")?"1":void 0,22:n},B("AP_RTM")?{26:"RTM2"}:{}),key:o.token,service_ids:i,uid:o.uid||0}}]};c.request_bodies.forEach(h=>{o.multiIP&&o.multiIP.gateway_ip&&(h.buffer.detail[5]=JSON.stringify({vocs_ip:[o.multiIP.uni_lbs_ip],vos_ip:[o.multiIP.gateway_ip]}))});const d=new FormData;return d.append("request",JSON.stringify(c)),[d,s]},dx=(o,n)=>{const i=Math.floor(1e12*Math.random()),s={appid:o.appId,client_ts:Date.now(),opid:i,sid:o.sid,request_bodies:[{uri:28,buffer:{cname:o.cname,detail:{1:"",6:o.stringUid,12:"1"},token:o.token,service_ids:n,uid:o.uid||0,edges_services:o.apResponse.addresses.map(d=>({ip:d.ip,port:d.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(s)),[c,i]};let bd=0;function Td(o){return z.all(o.map(n=>n.then(i=>{throw i},i=>i))).then(n=>{throw n},n=>n)}const Ih=function(){var o=L(function*(n){let{fragementLength:i,referenceList:s,asyncMapHandler:c,allFailedhandler:d,promisesCollector:h}=n,p=0;const m=i;let _,E=0;const v=function(){var S=L(function*(){const b=(()=>{const O=p*m;return s.slice(O,O+m).map(c)})();h&&h.push(...b);try{_=yield Td(b)}catch(O){if(E+=m,p++,!(E>=s.length))return void(yield v());d(O)}b.forEach(O=>O.cancel())});return function(){return S.apply(this,arguments)}}();return yield v(),_});return function(i){return o.apply(this,arguments)}}();function $E(o,n,i,s){return XE.apply(this,arguments)}function XE(){return XE=L(function*(o,n,i,s){return{gatewayInfo:yield(d=L(function*(h,p,m,_){let E=null;const v=[],S=function(){var O=L(function*(){const P=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(V=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:eT()})),w=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(V=>V.url)}),M=yield Ih({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:V=>(T.debug("[".concat(h.clientId,"] Connect to choose_server:"),V.url),tO(V,h,p,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},w),V[0]},promisesCollector:v});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},w),M});return function(){return O.apply(this,arguments)}}(),b=function(){var O=L(function*(){if(yield pi(1e3),null!==E)return E;const P=B("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:eT()})),w=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:P.map(V=>V.url)}),M=yield Ih({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:V=>(T.debug("[".concat(h.clientId,"] Connect to backup choose_server:"),V.url),tO(V,h,p,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},w),V[0]},promisesCollector:v});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},w),M});return function(){return O.apply(this,arguments)}}();try{return E=yield Td([S(),b()]),v.length&&v.forEach(O=>O.cancel&&"function"==typeof O.cancel&&O.cancel()),E}catch(O){throw O[0]}}),function(h,p,m,_){return d.apply(this,arguments)})(o,n,i,s)};var d}),XE.apply(this,arguments)}function aT(o,n,i,s,c){return JE.apply(this,arguments)}function JE(){return JE=L(function*(o,n,i,s,c){const d=o.cloudProxyServer;if("disabled"===d){if(!s)return;if(o.useLocalAccessPoint)return yield $E(o,n,i,c);if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_,proxyInfo:E}=yield lT(o,n,i,c);return o.turnServer&&"auto"!==o.turnServer.mode||(o.turnServer={mode:"manual",servers:E.map(v=>({turnServerURL:v.address,tcpport:v.tcpport||qr.tcpport,udpport:v.udpport||qr.udpport,username:v.username||qr.username,password:v.password||qr.password,forceturn:!1,security:!0}))}),{gatewayInfo:_}}return yield $E(o,n,i,c)}const{proxyInfo:h,gatewayInfo:p}=yield lT(o,n,i,c),m={gatewayInfo:p};return o.turnServer={mode:"manual",servers:h.map(_=>({turnServerURL:_.address,tcpport:"proxy3"===d?void 0:_.tcpport?_.tcpport:qr.tcpport,udpport:"proxy4"===d?void 0:_.udpport?_.udpport:qr.udpport,username:_.username||qr.username,password:_.password||qr.password,forceturn:"proxy4"!==d,security:"proxy5"===d}))},T.debug("[".concat(o.clientId,"] set proxy server: ").concat(o.proxyServer,", mode: ").concat(d)),m}),JE.apply(this,arguments)}function cT(o,n,i,s,c){return QE.apply(this,arguments)}function QE(){return QE=L(function*(o,n,i,s,c){let h=[];h=B("ACCOUNT_REGISTER").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(n.proxyServer?m=>"https://".concat(n.proxyServer,"/ap/?url=").concat(m+"/api/v1"):m=>"https://".concat(m,"/api/v1"));const p=null==c?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const m=yield(_=L(function*(E,v,S,b,O){const P=Date.now(),w={sid:S.sid,opid:10,appid:S.appId,string_uid:v};let M=E[0];const V=yield Fs(()=>pl(M+"".concat(-1===M.indexOf("?")?"?":"&","action=stringuid"),{data:w,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(U,Y)=>{if(0===U.code){if(U.uid<=0||U.uid>=Math.pow(2,32))throw T.error("Invalid Uint Uid ".concat(v," => ").concat(U.uid),U),ye.reqUserAccount(w.sid,{lts:P,success:!1,serverAddr:M,stringUid:w.string_uid,uid:U.uid,errorCode:k.INVALID_UINT_UID_FROM_STRING_UID,extend:w}),new W(k.INVALID_UINT_UID_FROM_STRING_UID);return ye.reqUserAccount(w.sid,{lts:P,success:!0,serverAddr:M,stringUid:w.string_uid,uid:U.uid,errorCode:null,extend:w}),!1}const ie=dE(U.code);return ie.retry&&(M=E[(Y+1)%E.length]),ye.reqUserAccount(w.sid,{lts:P,success:!1,serverAddr:M,stringUid:w.string_uid,uid:U.uid,errorCode:ie.desc,extend:w}),ie.retry},(U,Y)=>U.code!==k.OPERATION_ABORTED&&(ye.reqUserAccount(w.sid,{lts:P,success:!1,serverAddr:M,stringUid:w.string_uid,uid:null,errorCode:U.code,extend:w}),M=E[(Y+1)%E.length],!0),O);if(0!==V.code){const U=dE(V.code);throw new W(k.UNEXPECTED_RESPONSE,U.desc)}return V}),function(E,v,S,b,O){return _.apply(this,arguments)})(h,o,n,i,s);return null==c||c.recordJoinChannelService({status:"success",endTs:Date.now()},p),m.uid}catch(m){throw null==c||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},p),m}var _}),QE.apply(this,arguments)}function ev(){return ev=L(function*(o,n,i){const s=B("CDS_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(p=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")).map(p=>function(m,_,E,v){const S=lt(),b={flag:64,cipher_method:0,features:{device:S.name,system:S.os,system_general:navigator.userAgent,vendor:_.appId,version:Kr,cname:_.cname,sid:_.sid,session_id:_.sid,detail:"",proxyServer:_.proxyServer}};return Fs(()=>pl(m,{data:b,timeout:1e3,cancelToken:E,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,O=>O.code!==k.OPERATION_ABORTED,v)}(p,o,n,i));let c=null,d=null,h={};try{c=yield Td(s)}catch(p){if(p.code===k.OPERATION_ABORTED)throw p;d=p}if(s.forEach(p=>p.cancel()),ye.reportApiInvoke(o.sid,{name:fn.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:c}}).onSuccess(),c&&c.test_tags)try{h=function(p){if(!p.test_tags)return{};const m=p.test_tags,_=Object.keys(m),E={};return _.forEach(v=>{var S;const b=ub(S=v.slice(4)).call(S),O=JSON.parse(m[v])[1];E[b]=O}),E}(c)}catch(p){}return h}),ev.apply(this,arguments)}function lT(o,n,i,s){return tv.apply(this,arguments)}function tv(){return tv=L(function*(o,n,i,s){const c=B("PROXY_SERVER_TYPE3"),d=(b,O,P)=>{let w=P||c;return Array.isArray(w)&&(w=O%2==0?c[1]:c[0]),"https://".concat(w,"/ap/?url=").concat(b)};let h=null;const p=[],m=function(){var b=L(function*(){const O=B("WEBCS_DOMAIN").slice(0,B("AJAX_REQUEST_CONCURRENT")).map((M,V)=>{let U;return U="disabled"===o.cloudProxyServer&&o.proxyServer?d("".concat(M,"/api/v2/transpond/webrtc?v=2"),V,o.proxyServer):"disabled"===o.cloudProxyServer||"fallback"===o.cloudProxyServer?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):d("".concat(M,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:eT(),serviceIds:[ri.CHOOSE_SERVER,"proxy5"===o.cloudProxyServer?ri.CLOUD_PROXY_5:"proxy3"===o.cloudProxyServer||"proxy4"===o.cloudProxyServer?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK]}}),P=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(M=>M.url)}),w=yield Ih({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:M=>(T.debug("[".concat(o.clientId,"] Connect to choose_server:"),M.url),am(M,o,n,i)),allFailedhandler:M=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},P),M[0]},promisesCollector:p});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},P),w});return function(){return b.apply(this,arguments)}}(),_=function(){var b=L(function*(){if(yield pi(1e3),null!==h)return h;const O=B("WEBCS_DOMAIN_BACKUP_LIST").map((M,V)=>{let U;return U="disabled"===o.cloudProxyServer&&o.proxyServer?d("".concat(M,"/api/v2/transpond/webrtc?v=2"),V,o.proxyServer):"disabled"===o.cloudProxyServer||"fallback"===o.cloudProxyServer?"https://".concat(M,"/api/v2/transpond/webrtc?v=2"):d("".concat(M,"/api/v2/transpond/webrtc?v=2"),V),{url:U,areaCode:eT(),serviceIds:[ri.CHOOSE_SERVER,"proxy5"===o.cloudProxyServer?ri.CLOUD_PROXY_5:"proxy3"===o.cloudProxyServer||"proxy4"===o.cloudProxyServer?ri.CLOUD_PROXY:ri.CLOUD_PROXY_FALLBACK]}}),P=s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:O.map(M=>M.url)}),w=yield Ih({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:O,asyncMapHandler:M=>(T.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),M.url),am(M,o,n,i)),allFailedhandler:M=>{throw s.recordJoinChannelService({endTs:Date.now(),status:"error",errors:M},P),M[0]},promisesCollector:p});return s.recordJoinChannelService({endTs:Date.now(),status:"success"},P),w});return function(){return b.apply(this,arguments)}}();let E,v,S;try{({gatewayInfo:E,proxyInfo:v,url:S}=yield Td([m(),_()]))}catch(b){throw b[0]}if(p.length&&p.forEach(b=>b.cancel&&"function"==typeof b.cancel&&b.cancel()),!E||!v)throw new W(k.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(o.apUrl=S,"disabled"!==o.cloudProxyServer&&Array.isArray(c)&&S){const b=/^https?:\/\/(.+?)(\/.*)?$/.exec(S)[1];Re(c).call(c,b)&&(o.proxyServer=b,T.setProxyServer(b),ye.setProxyServer(b))}return h={gatewayInfo:E,proxyInfo:yield nx(v,E.uid)},h}),tv.apply(this,arguments)}function dT(o,n,i,s){return uT.apply(this,arguments)}function uT(){return uT=L(function*(o,n,i,s){const c=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(d=>n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"));return yield lx(c,o,n,i,s)}),uT.apply(this,arguments)}function nv(){return nv=L(function*(o,n,i){const s=B("UAP_AP").slice(0,B("AJAX_REQUEST_CONCURRENT")).map(c=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(c+"/api/v1?action=uap"):"https://".concat(c,"/api/v1?action=uap")).map(c=>function(d,h,p,m){const _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:Kr,cname:h.cname,uid:h.uid.toString(),requestId:oT,seq:oT};oT+=1;const E={service_name:"tele_channel",json_body:JSON.stringify(_)};return Fs(L(function*(){const v=yield pl(d,{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==v.code){const b=new W(k.UNEXPECTED_RESPONSE,"cross channel ap error, code"+v.code,{retry:!0});throw T.error(b.toString()),b}const S=JSON.parse(v.json_body);if(200!==S.code){const b=new W(k.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(S.code,", reason: ").concat(S.reason));throw T.error(b.toString()),b}if(!S.servers||0===S.servers.length){const b=new W(k.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw T.error(b.toString()),b}return{vid:S.vid,workerToken:S.workerToken,addressList:(B("CHANNEL_MEDIA_RELAY_SERVERS")||S.servers).map(b=>"wss://".concat(b.address.replace(/\./g,"-"),".").concat(B("WORKER_DOMAIN"),":").concat(b.wss))}}),void 0,v=>!!(v.code!==k.OPERATION_ABORTED&&v.code!==k.UNEXPECTED_RESPONSE||v.data&&v.data.retry),m)}(c,o,n,i));try{const c=yield Td(s);return s.forEach(d=>d.cancel()),c}catch(c){throw c[0]}}),nv.apply(this,arguments)}function iv(){return iv=L(function*(o,n,i){let s=null;const c=[],d=function(){var h=L(function*(p){const m=B(p?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return p&&(yield pi(1e3),null!==s)?s:yield Ih({fragementLength:B("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(T.debug("[".concat(o.clientId,"] update ticket, Connect to ").concat(p?"backup":""," choose_server:"),_),function(E,v,S,b){const[O]=dx(v,[ri.CHOOSE_SERVER]);let P=mn.networkState;return Fs(L(function*(){P&&mn.networkState===xi.OFFLINE&&mn.onlineWaiter&&(yield z.race([mn.onlineWaiter,pi(b&&b.maxRetryTimeout||Ln.maxRetryTimeout)])),P=mn.networkState;const w=yield pl(E,{data:O,cancelToken:S,headers:{"Content-Type":"multipart/form-data;"}},!0);return br(w,E)}),()=>!1,w=>w.code!==k.OPERATION_ABORTED&&(w.code===k.UPDATE_TICKET_FAILED?w.data.retry:(T.warning("[".concat(v.clientId,"] update ticket network error, retry"),w),!0)),b)}(_,o,n,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})});return function(m){return h.apply(this,arguments)}}();try{return s=yield Td([d(!1),d(!0)]),c.length&&c.forEach(h=>h.cancel&&"function"==typeof h.cancel&&h.cancel()),s}catch(h){throw h[0]}}),iv.apply(this,arguments)}function rv(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function pT(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?rv(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):rv(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class iO extends jt{constructor(){super(),C(this,"configs",void 0),C(this,"joinInfo",void 0),C(this,"cancelToken",void 0),C(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),C(this,"interval",void 0),C(this,"mutex",new ni("config-distribute")),C(this,"mutableParamsRead",!1)}startGetConfigDistribute(n,i){this.joinInfo=n,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),B("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},B("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}awaitConfigDistributeComplete(){var n=this;return L(function*(){!n.mutex.isLocked||(yield n.mutex.lock())()})()}updateConfigDistribute(){var n=this;return L(function*(){if(n.mutableParamsRead||(n.mutableParamsRead=!0,ye.reportApiInvoke(null,{options:void 0,name:fn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:nn.TRACER}).onSuccess(JSON.stringify(ic))),!n.joinInfo||!n.cancelToken||!n.retryConfig)return void T.debug("[config-distribute] get config distribute interrupted have no joininfo");let i;const s=yield n.mutex.lock();try{i=yield function ZE(o,n,i){return ev.apply(this,arguments)}(n.joinInfo,n.cancelToken,n.retryConfig),T.debug("[config-distribute] get config distribute",JSON.stringify(i)),i.limit_bitrate&&n.handleBitrateLimit(i.limit_bitrate),n.cacheGlobalParameterConfig(i),n.configs=i}catch(c){const d=new W(k.NETWORK_RESPONSE_ERROR,c);T.warning("[config-distribute] ".concat(d.toString()))}finally{s()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(n){var i;(i=n)&&i.uplink&&i.id&&void 0!==i.uplink.max_bitrate&&void 0!==i.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==n.id&&this.emit(ud.UPDATE_BITRATE_LIMIT,n):this.emit(ud.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&pT({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(n){var i;const s=wu(i=Object.keys(n).filter(d=>/^webrtc_ng_global_parameter/.test(d))).call(i);for(let d=0;d<s.length;d++)for(let h=s.length-1;h>d;h--){const p=s[h];if("number"==typeof n[p].__priority){const m=n[p].__priority,_=s[h-1];if("number"==typeof n[_].__priority){if(!(m>n[_].__priority))continue;{const E=p;s[h]=s[h-1],s[h-1]=E}}else{const E=p;s[h]=s[h-1],s[h-1]=E}}}const c={};s.forEach(d=>{const h=n[d],p=h.__expires;Object.keys(h).forEach(m=>{"__priority"===m||"__expires"===m||Object.prototype.hasOwnProperty.call(c,m)||(c[m]=pT({value:h[m]},p&&{expires:p}))})});try{!function(p){try{const m=Date.now();Object.keys(p).forEach(_=>{switch(_){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(ar,_)){const{value:E,expires:v}=p[_];if(v&&v<=m)return;ic[_]=E,ar[_]=E,T.debug("Update global parameters from config distribute",_,E)}}})}catch(m){T.error("Error update config immediately: ".concat(p),m.message)}}(c);const d=JSON.stringify(c),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),T.debug("Caching global parameters ".concat(d))}catch(d){T.error("Error caching global parameters:",d.message)}}}function fT(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Rd(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?fT(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):fT(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class ov extends jt{constructor(n,i,s,c){super(),C(this,"spec",void 0),C(this,"token",void 0),C(this,"websocket",void 0),C(this,"pingpongTimer",void 0),C(this,"reconnectMode","retry"),C(this,"serviceMode",void 0),C(this,"reqId",0),C(this,"commandReqId",0),C(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),C(this,"handleWebSocketMessage",d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):this.serviceMode===Qn.INJECT?this.emit(rs.INJECT_STREAM_STATUS,h):(ye.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Qn.TRANSCODE?1:2}),this.emit(rs.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=n,this.serviceMode=c,this.websocket=new sh("live-streaming",s),this.websocket.on(we.CONNECTED,this.handleWebSocketOpen),this.websocket.on(we.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(we.REQUEST_NEW_URLS,(d,h)=>{cn(this,rs.REQUEST_NEW_ADDRESS).then(d).catch(h)}),this.websocket.on(we.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}request(n,i,s,c){var d=this;return L(function*(){d.reqId+=1,"request"===n&&(d.commandReqId+=1);const h=d.commandReqId,p=d.reqId;if(!p||!d.websocket)throw new W(k.UNEXPECTED_ERROR);const m=Rd({command:n,sdkVersion:"4.19.1"===Kr?"0.0.1":Kr,seq:p,requestId:p,allocate:s,cname:d.spec.cname,appId:d.spec.appId,sid:d.spec.sid,uid:d.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if("closed"===d.websocket.state)throw new W(k.WS_DISCONNECT);const _=()=>new z((b,O)=>{d.websocket.once(we.CLOSED,()=>O(new W(k.WS_ABORT))),d.websocket.once(we.CONNECTED,b)});"connected"!==d.websocket.state&&(yield _()),m.clientRequest&&(m.clientRequest.workerToken=d.token);const E=new z((b,O)=>{const P=()=>{O(new W(k.WS_ABORT))};d.websocket.once(we.RECONNECTING,P),d.websocket.once(we.CLOSED,P),d.once("@".concat(p,"-").concat(d.spec.sid),w=>{b(w)})});c&&ye.workerEvent(d.spec.sid,Rd(Rd({},c),{},{requestId:h,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const v=Date.now();d.websocket.sendMessage(m);let S=null;try{S=yield E}catch(b){if("closed"===d.websocket.state)throw b;return yield _(),yield d.request(n,i,s)}return c&&ye.workerEvent(d.spec.sid,Rd(Rd({},c),{},{requestId:h,actionType:"response",payload:JSON.stringify(S.serverResponse),serverCode:S.code,success:200===S.code,responseTime:Date.now()-v})),200!==S.code&&d.handleResponseError(S),S})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n="4.19.1"===Kr?"0.0.1":Kr;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case In.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void T.warning("live stream response already exists stream");case In.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case In.LIVE_STREAM_RESPONSE_BAD_STREAM:case In.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new W(k.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case In.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case In.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new W(k.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case In.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new W(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(rs.WARNING,i,n.serverResponse.url)}case In.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new W(k.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(rs.WARNING,i,n.serverResponse.url)}case In.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case In.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new W(k.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case In.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new W(k.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(rs.WARNING,i,n.serverResponse.url)}case In.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case In.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case In.LIVE_STREAM_RESPONSE_WORKER_LOST:case In.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case In.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===n.serverResponse.command||"UninjectStream"===n.serverResponse.command)return;if("UpdateTranscoding"===n.serverResponse.command||"ControlStream"===n.serverResponse.command)return new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case In.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case In.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case In.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case In.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new W(k.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(Hg)},6e3)}}function mT(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function ur(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?mT(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):mT(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class rO extends jt{constructor(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ln,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ln;super(),C(this,"onLiveStreamWarning",void 0),C(this,"onLiveStreamError",void 0),C(this,"onInjectStatusChange",void 0),C(this,"spec",void 0),C(this,"retryTimeout",1e4),C(this,"connection",void 0),C(this,"httpRetryConfig",void 0),C(this,"wsRetryConfig",void 0),C(this,"streamingTasks",new Map),C(this,"isStartingStreamingTask",!1),C(this,"taskMutex",new ni("live-streaming")),C(this,"cancelToken",Hn.CancelToken.source()),C(this,"transcodingConfig",void 0),C(this,"injectConfig",ur({},VA)),C(this,"injectLoopTimes",0),C(this,"uapResponse",void 0),C(this,"lastTaskId",1),C(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=s,this.wsRetryConfig=i}setTranscodingConfig(n){var i=this;return L(function*(){const s=ur(ur({},eL),n);var p;66!==s.videoCodecProfile&&77!==s.videoCodecProfile&&100!==s.videoCodecProfile&&(T.debug("[".concat(i.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(p=>ur(ur(ur({},lU),p),{},{zOrder:p.zOrder?p.zOrder+1:1}))),Jt((p=s).width)||Dt(p.width,"config.width",0,1e4),Jt(p.height)||Dt(p.height,"config.height",0,1e4),Jt(p.videoBitrate)||Dt(p.videoBitrate,"config.videoBitrate",1,1e6),Jt(p.videoFrameRate)||Dt(p.videoFrameRate,"config.videoFrameRate"),Jt(p.lowLatency)||Jc(p.lowLatency,"config.lowLatency"),Jt(p.audioSampleRate)||Jn(p.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Jt(p.audioBitrate)||Dt(p.audioBitrate,"config.audioBitrate",1,128),Jt(p.audioChannels)||Jn(p.audioChannels,"config.audioChannels",[1,2,3,4,5]),Jt(p.videoGop)||Dt(p.videoGop,"config.videoGop"),Jt(p.videoCodecProfile)||Jn(p.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Jt(p.userCount)||Dt(p.userCount,"config.userCount",0,17),Jt(p.backgroundColor)||Dt(p.backgroundColor,"config.backgroundColor",0,16777215),Jt(p.userConfigExtraInfo)||Ei(p.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),p.transcodingUsers&&!Jt(p.transcodingUsers)&&(fa(p.transcodingUsers,"config.transcodingUsers"),p.transcodingUsers.forEach((m,_)=>{nb(m.uid),Jt(m.x)||Dt(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Jt(m.y)||Dt(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Jt(m.width)||Dt(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Jt(m.height)||Dt(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Jt(m.zOrder)||Dt(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Jt(m.alpha)||Dt(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Jt(p.watermark)||UA(p.watermark,"watermark"),Jt(p.backgroundImage)||UA(p.backgroundImage,"backgroundImage"),p.images&&!Jt(p.images)&&(fa(p.images,"config.images"),p.images.forEach((m,_)=>{UA(m,"images[".concat(_,"]"))}));const c=[];s.images&&c.push(...s.images.map(p=>ur(ur(ur({},FA),p),{},{zOrder:255}))),s.backgroundImage&&(c.push(ur(ur(ur({},FA),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(c.push(ur(ur(ur({},FA),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=c,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(p=>ur({},p)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const d=(s.userConfigs||[]).map(p=>"number"==typeof p.uid?z.resolve(p.uid):cT(p.uid,i.spec,i.cancelToken.token,i.httpRetryConfig));if((yield z.all(d)).forEach((p,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=p)}),i.transcodingConfig=s,i.connection)try{var h;const p=yield i.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:i.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Vs(h=i.streamingTasks).call(h)).map(m=>m.taskId).join("#")});T.debug("[".concat(i.spec.clientId,"] update live transcoding config success, code: ").concat(p.code,", config:"),JSON.stringify(i.transcodingConfig))}catch(p){if(!p.data||!p.data.retry)throw p;p.data.changeAddress&&i.connection.tryNextAddress(),i.streamingTasks.forEach(m=>{T.warning("[".concat(i.spec.clientId,"] live streaming receive error"),p.toString(),"try to republish",m.url),i.startLiveStreamingTask(m.url,m.mode,p).then(()=>{T.debug("[".concat(i.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{T.error("[".concat(i.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),i.onLiveStreamError&&i.onLiveStreamError(m.url,_)})})}})()}setInjectStreamConfig(n,i){this.injectConfig=Object.assign({},this.injectConfig,n),this.injectLoopTimes=i}startLiveStreamingTask(n,i,s){var c=this;return L(function*(){var d;if(Array.from(Vs(d=c.streamingTasks).call(d)).find(_=>_.mode===Qn.INJECT)&&i===Qn.INJECT)return new W(k.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!c.transcodingConfig&&i===Qn.TRANSCODE)throw new W(k.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let h={command:"PublishStream",ts:Date.now(),url:n,uid:c.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};T.debug("[".concat(c.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(i));const p=yield c.taskMutex.lock();if(!c.connection&&s)return void p();if(c.streamingTasks.get(n)&&!s)return p(),new W(k.LIVE_STREAMING_TASK_CONFLICT).throw();try{c.connection||(c.connection=yield c.connect(i))}catch(_){throw p(),_}switch(i){case Qn.TRANSCODE:h.transcodingConfig=ur({},c.transcodingConfig);break;case Qn.RAW:break;case Qn.INJECT:h={cname:c.spec.cname,command:"InjectStream",sid:c.spec.sid,transcodingConfig:c.injectConfig,ts:Date.now(),url:n,loopTimes:c.injectLoopTimes}}c.uapResponse&&c.uapResponse.vid&&(h.vid=c.uapResponse.vid),c.isStartingStreamingTask=!0;const m=c.lastTaskId++;try{const _=new z((v,S)=>{pi(c.retryTimeout).then(()=>{if(s)return S(s);const b=c.statusError.get(n);return b?(c.statusError.delete(n),S(b)):void 0})}),E=yield z.race([c.connection.request("request",{clientRequest:h},!0,{url:n,command:"PublishStream",workerType:i===Qn.TRANSCODE?1:2,requestByUser:!s,tid:m.toString()}),_]);c.isStartingStreamingTask=!1,T.debug("[".concat(c.spec.clientId,"] live streaming started, code: ").concat(E.code)),c.streamingTasks.set(n,{clientRequest:h,mode:i,url:n,taskId:m}),p()}catch(_){if(p(),c.isStartingStreamingTask=!1,!_.data||!_.data.retry||s)throw _;return _.data.changeAddress?(c.connection.tryNextAddress(),yield c.startLiveStreamingTask(n,i,_)):yield c.startLiveStreamingTask(n,i,_)}})()}stopLiveStreamingTask(n){return new z((i,s)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new W(k.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),i()},this.connection.request("request",{clientRequest:{command:d===Qn.INJECT?"UninjectStream":"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:d===Qn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{T.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),0===this.streamingTasks.size&&d!==Qn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),i(),d===Qn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(ya.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,n)}).catch(s)})}controlInjectStream(n,i,s,c){var d=this;return L(function*(){const h=d.streamingTasks.get(n);if(!h||!d.connection||h.mode!==Qn.INJECT)throw new W(k.INVALID_OPERATION,"can not find inject stream task to control");return(yield d.connection.request("request",{clientRequest:{command:"ControlStream",url:n,control:i,audioVolume:s,position:c}})).serverResponse})()}resetAllTask(){var n;const i=Array.from(Vs(n=this.streamingTasks).call(n));this.terminate();for(const s of i)this.startLiveStreamingTask(s.url,s.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(s.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Hn.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(n){var i=this;return L(function*(){if(i.connection)throw new W(k.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=yield cn(i,wf.REQUEST_WORKER_MANAGER_LIST,n);return i.uapResponse=s,i.connection=new ov(s.workerToken,i.spec,i.wsRetryConfig,n),i.connection.on(rs.WARNING,(c,d)=>i.onLiveStreamWarning&&i.onLiveStreamWarning(d,c)),i.connection.on(rs.PUBLISH_STREAM_STATUS,c=>i.handlePublishStreamServer(c)),i.connection.on(rs.INJECT_STREAM_STATUS,c=>i.handleInjectStreamServerStatus(c)),i.connection.on(rs.REQUEST_NEW_ADDRESS,(c,d)=>{if(!i.connection)return d(new W(k.UNEXPECTED_ERROR,"can not get new live streaming address list"));cn(i,wf.REQUEST_WORKER_MANAGER_LIST,n).then(h=>{i.uapResponse=h,c(h.addressList)}).catch(d)}),yield i.connection.init(s.addressList),i.connection})()}handlePublishStreamServer(n){const i=n.serverStatus&&n.serverStatus.url||"empty_url",s=this.streamingTasks.get(i),c=n.reason;switch(n.code){case In.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case In.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case In.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case In.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new W(k.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(s)return T.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case In.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new W(k.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case In.LIVE_STREAM_RESPONSE_WORKER_LOST:case In.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Vs(d=this.streamingTasks).call(d));for(const p of h)p.abortTask?p.abortTask():(T.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",p.url),this.startLiveStreamingTask(p.url,p.mode,new W(k.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{T.debug("[".concat(this.spec.clientId,"] republish live stream success"),p.url)}).catch(m=>{T.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(p.url,m)}));return}}}handleInjectStreamServerStatus(n){const i=Number(n.uid),s=n.serverStatus&&n.serverStatus.url;switch(n.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(ya.INJECT_STREAM_STATUS_START_SUCCESS,i,s));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(ya.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,i,s),void this.streamingTasks.delete(s);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(ya.INJECT_STREAM_STATUS_START_UNAUTHORIZED,i,s),void this.streamingTasks.delete(s);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(ya.INJECT_STREAM_STATUS_BROKEN,i,s),void this.streamingTasks.delete(s);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(ya.INJECT_STREAM_STATUS_START_TIMEOUT,i,s),void this.streamingTasks.delete(s);default:return void T.debug("inject stream server status",n)}}hasUrl(n){return this.streamingTasks.has(n)}}class ps{constructor(){C(this,"destChannelMediaInfos",new Map),C(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){cE(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){cE(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){Bs(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Mr(o){if(!(o instanceof ps))return new W(k.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=o.getSrcChannelMediaInfo(),i=o.getDestChannelMediaInfo();return n?0===i.size?new W(k.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new W(k.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class oO extends jt{constructor(n,i,s){super(),C(this,"ws",void 0),C(this,"requestId",1),C(this,"heartBeatTimer",void 0),C(this,"joinInfo",void 0),C(this,"clientId",void 0),C(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),C(this,"onClose",c=>{this.emit("close"),this.dispose()}),C(this,"onMessage",c=>{const d=JSON.parse(c.data);if(!d||"serverResponse"!==d.command||!d.requestId)return d&&"serverStatus"===d.command&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)}),this.joinInfo=n,this.clientId=i,this.ws=new sh("cross-channel-".concat(this.clientId),s),this.ws.on(we.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(we.CONNECTED,this.onOpen),this.ws.on(we.ON_MESSAGE,this.onMessage),this.ws.on(we.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(n){const i=this.requestId++;return n.requestId=i,n.seq=i,this.ws.sendMessage(n),i}waitStatus(n){return new z((i,s)=>{const c=window.setTimeout(()=>{s(new W(k.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,d=>{window.clearTimeout(c),d.state&&0!==d.state?s(new W(k.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),s(new W(k.WS_ABORT))})})}request(n){var i=this;return L(function*(){if("closed"===i.ws.state)throw new W(k.WS_DISCONNECT);"connected"!==i.ws.state&&(yield new z((p,m)=>{i.ws.once(we.CLOSED,()=>m(new W(k.WS_ABORT))),i.ws.once(we.CONNECTED,p)}));const c=i.sendMessage(n),d=new z((p,m)=>{const _=()=>{m(new W(k.WS_ABORT))};i.ws.once(we.RECONNECTING,_),i.ws.once(we.CLOSED,_),i.once("req_".concat(c),p),pi(3e3).then(()=>{i.removeAllListeners("req_".concat(c)),i.ws.off(we.RECONNECTING,_),i.ws.off(we.CLOSED,_),m(new W(k.TIMEOUT,"cross channel ws request timeout"))})}),h=yield d;if(!h||200!==h.code)throw new W(k.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(h)));return h})()}connect(n){var i=this;return L(function*(){i.ws.removeAllListeners(we.REQUEST_NEW_URLS),i.ws.on(we.REQUEST_NEW_URLS,s=>{s(n)}),yield i.ws.init(n)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const i=this.requestId++;return n.requestId=i,this.ws.sendMessage(n),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class HU extends jt{set state(n){n!==this._state&&(n!==cr.RELAY_STATE_FAILURE&&(this.errorCode=Sa.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,i,s,c,d){var h;super(),h=this,C(this,"joinInfo",void 0),C(this,"sid",void 0),C(this,"clientId",void 0),C(this,"cancelToken",Hn.CancelToken.source()),C(this,"workerToken",void 0),C(this,"requestId",0),C(this,"signal",void 0),C(this,"prevChannelMediaConfig",void 0),C(this,"httpRetryConfig",void 0),C(this,"_resolution",void 0),C(this,"_state",cr.RELAY_STATE_IDLE),C(this,"errorCode",Sa.RELAY_OK),C(this,"onStatus",p=>{T.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(p))),p&&p.command&&("onAudioPacketReceived"===p.command&&this.emit("event",yt.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===p.command&&this.emit("event",yt.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===p.command&&(this.errorCode=Sa.SRC_TOKEN_EXPIRED,this.state=cr.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===p.command&&(this.errorCode=Sa.DEST_TOKEN_EXPIRED,this.state=cr.RELAY_STATE_FAILURE))}),C(this,"onReconnect",L(function*(){T.debug("[".concat(h.clientId,"] ChannelMediaSocket disconnect, reconnecting")),h.emit("event",yt.NETWORK_DISCONNECTED),h.state=cr.RELAY_STATE_IDLE,h.prevChannelMediaConfig&&h.sendStartRelayMessage(h.prevChannelMediaConfig).catch(p=>{h.state!==cr.RELAY_STATE_IDLE&&(T.error("auto restart channel media relay failed",p.toString()),h.errorCode=Sa.SERVER_CONNECTION_LOST,h.state=cr.RELAY_STATE_FAILURE)})})),this.joinInfo=n,this.clientId=i,this.sid=jg(),this.signal=new oO(this.joinInfo,this.clientId,s),this.httpRetryConfig=c,this._resolution=d}startChannelMediaRelay(n){var i=this;return L(function*(){if(i.state!==cr.RELAY_STATE_IDLE)throw new W(k.INVALID_OPERATION);i.state=cr.RELAY_STATE_CONNECTING,yield i.connect(),T.debug("[".concat(i.clientId,"] startChannelMediaRelay: connect success"));try{yield i.sendStartRelayMessage(n)}catch(s){throw s.data&&s.data.serverResponse&&"SetSourceChannel"===s.data.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&"SetDestChannelStatus"===s.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&"StartPacketTransfer"===s.serverResponse.command?new W(k.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}i.prevChannelMediaConfig=n})()}updateChannelMediaRelay(n){var i=this;return L(function*(){if(i.state!==cr.RELAY_STATE_RUNNING)throw new W(k.INVALID_OPERATION);yield i.sendUpdateMessage(n),i.prevChannelMediaConfig=n})()}setVideoProfile(n){var i=this;return L(function*(){if(i._resolution=n,i.state!==cr.RELAY_STATE_RUNNING)throw new W(k.INVALID_OPERATION);const s=i.genMessage(Ui.SetVideoProfile);yield i.signal.request(s),T.debug("[".concat(i.clientId,"] startChannelMediaRelay: setVideoProfile success"))})()}stopChannelMediaRelay(){var n=this;return L(function*(){yield n.sendStopRelayMessage(),T.debug("[".concat(n.clientId,"] stopChannelMediaRelay: send stop message success")),n.state=cr.RELAY_STATE_IDLE,n.dispose()})()}dispose(){T.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Hn.CancelToken.source(),this.state=cr.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var n=this;return L(function*(){const i=yield function nO(o,n,i){return nv.apply(this,arguments)}(n.joinInfo,n.cancelToken.token,n.httpRetryConfig);n.workerToken=i.workerToken,yield n.signal.connect(i.addressList),n.emit("event",yt.NETWORK_CONNECTED),n.signal.on("status",n.onStatus),n.signal.on("reconnecting",n.onReconnect)})()}sendStartRelayMessage(n){var i=this;return L(function*(){const s=i.genMessage(Ui.StopPacketTransfer);yield i.signal.request(s),yield i.signal.waitStatus("Normal Quit"),T.debug("[".concat(i.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const c=i.genMessage(Ui.SetSdkProfile,n);yield i.signal.request(c),T.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const d=i.genMessage(Ui.SetSourceChannel,n);yield i.signal.request(d),yield i.signal.waitStatus("SetSourceChannelStatus"),i.emit("event",yt.PACKET_JOINED_SRC_CHANNEL),T.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const h=i.genMessage(Ui.SetSourceUserId,n);yield i.signal.request(h),T.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const p=i.genMessage(Ui.SetDestChannel,n);yield i.signal.request(p),yield i.signal.waitStatus("SetDestChannelStatus"),i.emit("event",yt.PACKET_JOINED_DEST_CHANNEL),T.debug("[".concat(i.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=i.genMessage(Ui.StartPacketTransfer,n);yield i.signal.request(m),i.emit("event",yt.PACKET_SENT_TO_DEST_CHANNEL),i.state=cr.RELAY_STATE_RUNNING,T.debug("[".concat(i.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),i.setVideoProfile(i._resolution)})()}sendUpdateMessage(n){var i=this;return L(function*(){const s=i.genMessage(Ui.UpdateDestChannel,n);yield i.signal.request(s),i.emit("event",yt.PACKET_UPDATE_DEST_CHANNEL),T.debug("[".concat(i.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var n=this;return L(function*(){const i=n.genMessage(Ui.StopPacketTransfer);yield n.signal.request(i),T.debug("[".concat(n.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(n,i){const s=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Kr,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.1"===h.sdkVersion&&(h.sdkVersion="0.0.1");let p=null,m=null;switch(n){case Ui.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Ui.SetSourceChannel:if(m=i&&i.getSrcChannelMediaInfo(),!m)throw new W(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},h;case Ui.SetSourceUserId:if(m=i&&i.getSrcChannelMediaInfo(),!m)throw new W(k.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:m.uid+""},h;case Ui.SetDestChannel:if(p=i&&i.getDestChannelMediaInfo(),!p)throw new W(k.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{s.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:s,uid:c,token:d},h;case Ui.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Ui.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Ui.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Ui.UpdateDestChannel:if(p=i&&i.getDestChannelMediaInfo(),!p)throw new W(k.UNEXPECTED_ERROR,"can not find dest config");return p.forEach(_=>{s.push(_.channelName),c.push(_.uid+""),d.push(_.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:s,uid:c,token:d},h;case Ui.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}class ji{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,i){C(this,"uid",void 0),C(this,"_uintid",void 0),C(this,"_trust_in_room_",!0),C(this,"_trust_audio_enabled_state_",!0),C(this,"_trust_video_enabled_state_",!0),C(this,"_trust_audio_mute_state_",!0),C(this,"_trust_video_mute_state_",!0),C(this,"_audio_muted_",!1),C(this,"_video_muted_",!1),C(this,"_audio_enabled_",!0),C(this,"_video_enabled_",!0),C(this,"_audio_added_",!1),C(this,"_video_added_",!1),C(this,"_trust_video_stream_added_state_",!0),C(this,"_trust_audio_stream_added_state_",!0),C(this,"_audioTrack",void 0),C(this,"_videoTrack",void 0),C(this,"_dataChannels",[]),C(this,"_audioSSRC",void 0),C(this,"_videoSSRC",void 0),C(this,"_audioOrtc",void 0),C(this,"_videoOrtc",void 0),C(this,"_cname",void 0),C(this,"_rtxSsrcId",void 0),this.uid=n,this._uintid=i}}var sO=Mw,aO=Za;wt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var o=aO.f(this);return{promise:o.promise,resolve:o.resolve,reject:o.reject}}});var _T=Za,sv=Ql;wt({target:"Promise",stat:!0,forced:!0},{try:function(o){var n=_T.f(this),i=sv(o);return(i.error?n.reject:n.resolve)(i.value),n.promise}});var gT=fr(sO),av=ia.f("asyncIterator"),ux=fr(av);function cO(o,n){this.v=o,this.k=n}function cv(o){var n,i;function s(d,h){try{var p=o[d](h),m=p.value,_=m instanceof cO;gT.resolve(_?m.v:m).then(function(E){if(_){var v="return"===d?"return":"next";if(!m.k||E.done)return s(v,E);E=o[v](E).value}c(p.done?"return":"normal",E)},function(E){s("throw",E)})}catch(E){c("throw",E)}}function c(d,h){switch(d){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?s(n.key,n.arg):i=null}this._invoke=function(d,h){return new gT(function(p,m){var _={key:d,arg:h,resolve:p,reject:m,next:null};i?i=i.next=_:(n=i=_,s(d,h))})},"function"!=typeof o.return&&(this.return=void 0)}function fs(o){return function(){return new cv(o.apply(this,arguments))}}function dt(o){return new cO(o,0)}function ET(o){var n={},i=!1;function s(c,d){return i=!0,{done:!1,value:new cO(d=new gT(function(h){h(o[c](d))}),1)}}return n[void 0!==Mp&&og||"@@iterator"]=function(){return this},n.next=function(c){return i?(i=!1,c):s("next",c)},"function"==typeof o.throw&&(n.throw=function(c){if(i)throw i=!1,c;return s("throw",c)}),"function"==typeof o.return&&(n.return=function(c){return i?(i=!1,c):s("return",c)}),n}cv.prototype["function"==typeof Mp&&ux||"@@asyncIterator"]=function(){return this},cv.prototype.next=function(o){return this._invoke("next",o)},cv.prototype.throw=function(o){return this._invoke("throw",o)},cv.prototype.return=function(o){return this._invoke("return",o)};var hx=fr(av),lO={exports:{}};!function(o,n){o.exports=(()=>{var i={8:(d,h,p)=>{p.r(h),p.d(h,{Parser:()=>Ee,Printer:()=>Ct,parse:()=>ke,print:()=>pt});const m="\n",_="".concat("\r").concat(m),E=" ";let v;function S(le){return le>="0"&&le<="9"}function b(le){return le>="!"&&le<="~"}function O(le){return b(le)||le>="\x80"&&le<="\xff"}function P(le){return"!"===le||le>="#"&&le<="'"||le>="*"&&le<="+"||le>="-"&&le<="."||le>="0"&&le<="9"||le>="A"&&le<="Z"||le>="^"&&le<="~"}function w(le){return le>="1"&&le<="9"}function M(le){return le>="A"&&le<="Z"||le>="a"&&le<="z"}function V(le){return"d"===le||"h"===le||"m"===le||"s"===le}function U(le){return le>"\x01"&&le<"\t"||le>"\v"&&le<"\f"||le>"\x0e"&&le<"\xff"}function Y(le){return M(le)||S(le)||"+"===le||"/"===le}function ie(le){return S(le)||M(le)||"+"===le||"/"===le||"-"===le||"_"===le}function K(le){return M(le)||S(le)||"+"===le||"/"===le}function X(le,I){var F=Object.keys(le);if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(le);I&&(H=H.filter(function(re){return Object.getOwnPropertyDescriptor(le,re).enumerable})),F.push.apply(F,H)}return F}function $(le){for(var I=1;I<arguments.length;I++){var F=null!=arguments[I]?arguments[I]:{};I%2?X(Object(F),!0).forEach(function(H){J(le,H,F[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(le,Object.getOwnPropertyDescriptors(F)):X(Object(F)).forEach(function(H){Object.defineProperty(le,H,Object.getOwnPropertyDescriptor(F,H))})}return le}function J(le,I,F){return I in le?Object.defineProperty(le,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):le[I]=F,le}var le;(le=v||(v={})).VERSION="v",le.ORIGIN="o",le.SESSION_NAME="s",le.INFORMATION="i",le.URI="u",le.EMAIL="e",le.PHONE="p",le.CONNECTION="c",le.BANDWIDTH="b",le.TIME="t",le.REPEAT="r",le.ZONE_ADJUSTMENTS="z",le.KEY="k",le.ATTRIBUTE="a",le.MEDIA="m";class ge{consumeText(I,F){let H=F;for(;H<I.length;){const re=I[H];if("\0"===re||"\r"===re||re===m)break;H+=1}if(H-F==0)throw new Error("Invalid text, at ".concat(I));return H}consumeUnicastAddress(I,F,H){return this.consumeTill(I,F,E)}consumeOneOrMore(I,F,H){let re=F;for(;H(I[re]);)re++;if(re-F==0)throw new Error("Invalid rule at ".concat(F,"."));return re}consumeSpace(I,F){if(I[F]===E)return F+1;throw new Error("Invalid space at ".concat(F,"."))}consumeIP4Address(I,F){let H=F;for(let re=0;re<4;re++)if(H=this.consumeDecimalUChar(I,H),3!==re){if("."!==I[H])throw new Error("Invalid IP4 address.");H++}return H}consumeDecimalUChar(I,F){let H=F;for(let Fe=0;Fe<3&&S(I[H]);Fe++,H++);if(H-F==0)throw new Error("Invalid decimal uchar.");const re=parseInt(I.slice(F,H));if(re>=0&&re<=255)return H;throw new Error("Invalid decimal uchar")}consumeIP6Address(I,F){let H=this.consumeHexpart(I,F);return":"===I[H]&&(H+=1,H=this.consumeIP4Address(I,H)),H}consumeHexpart(I,F){let H=F;if(":"===I[H]&&":"===I[H+1]){H+=2;try{H=this.consumeHexseq(I,H)}catch(re){}return H}if(H=this.consumeHexseq(I,H),":"===I[H]&&":"===I[H+1]){H+=2;try{H=this.consumeHexseq(I,H)}catch(re){}return H}return H}consumeHexseq(I,F){let H=F;for(;H=this.consumeHex4(I,H),":"===I[H]&&":"!==I[H+1];)H+=1;return H}consumeHex4(I,F){let H=0;for(;H<4;H++)if(!((re=I[F+H])>="0"&&re<="9"||re>="a"&&re<="f"||re>="A"&&re<="F")){if(0===H)throw new Error("Invalid hex 4");break}var re;return F+H}consumeFQDN(I,F){let H=F;for(;S(I[H])||M(I[H])||"-"===I[H]||"."===I[H];)H+=1;if(H-F<4)throw new Error("Invalid FQDN");return H}consumeExtnAddr(I,F){return this.consumeOneOrMore(I,F,O)}consumeMulticastAddress(I,F,H){switch(H){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(I,F);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(I,F);default:try{return this.consumeFQDN(I,F)}catch(re){return this.consumeExtnAddr(I,F)}}}consumeIP6MulticastAddress(I,F){const H=this.consumeHexpart(I,F);return"/"===I[H]?this.consumeInteger(I,H+1):H}consumeIP4MulticastAddress(I,F){let H=F+3;const re=I.slice(F,H),Fe=parseInt(re);if(Fe<224||Fe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Gt=0;Gt<3;Gt++){if("."!==I[H])throw new Error("Invalid IP4 multicast address.");H+=1,H=this.consumeDecimalUChar(I,H)}return"/"===I[H]&&(H+=1),H=this.consumeTTL(I,H),"/"===I[H]&&(H=this.consumeInteger(I,H)),H}consumeInteger(I,F){if(!w(I[F]))throw new Error("Invalid integer.");for(F+=1;S(I[F]);)F+=1;return F}consumeTTL(I,F){if("0"===I[F])return F+1;if(!w(I[F]))throw new Error("Invalid TTL.");F+=1;for(let H=0;H<2&&S(I[F]);H++)F+=1;return F}consumeToken(I,F){return this.consumeOneOrMore(I,F,P)}consumeTime(I,F){let H=F;if("0"===I[H])return H+1;for(w(I[H])&&(H+=1);S(I[H]);)H++;if(H-F<10)throw new Error("Invalid time");return H}consumeAddress(I,F){return this.consumeTill(I,F,E)}consumeTypedTime(I,F){let H=F;return H=this.consumeOneOrMore(I,H,S),V(I[H])?H+1:H}consumeRepeatInterval(I,F){if(!w(I[F]))throw new Error("Invalid repeat interval");for(F+=1;S(I[F]);)F+=1;return V(I[F])&&(F+=1),F}consumePort(I,F){return this.consumeOneOrMore(I,F,S)}consume(I,F,H){for(let re=0;re<H.length;re++){if(F+re>=I.length)throw new Error("consume exceeding value length");if(I[F+re]!==H[re])throw new Error("consume ".concat(H," failed at ").concat(re))}return F+H.length}consumeTill(I,F,H){let re=F;for(;re<I.length&&("string"!=typeof H||I[re]!==H)&&("function"!=typeof H||!H(I[re]));)re++;return re}}class Ee extends ge{constructor(){super(),J(this,"records",[]),J(this,"currentLine",0)}parse(I){const F=this.probeEOL(I);this.records=I.split(F).filter($n=>!!$n.trim()).map(this.parseLine),this.currentLine=0;const H=this.parseVersion(),re=this.parseOrigin(),Fe=this.parseSessionName(),Gt=this.parseInformation(),Wi=this.parseUri(),Co=this.parseEmail(),El=this.parsePhone(),GT=this.parseConnection(),WT=this.parseBandWidth(),vs=this.parseTimeFields(),Nd=this.parseKey(),wm=this.parseSessionAttribute(),wn=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:H,origin:re,sessionName:Fe,information:Gt,uri:Wi,emails:Co,phones:El,connection:GT,bandwidths:WT,timeFields:vs,key:Nd,attributes:wm,mediaDescriptions:wn}}getCurrentRecord(){const I=this.records[this.currentLine];if(!I)throw new Error("Record doesn't exit.");return I}probeEOL(I){for(let F=0;F<I.length;F++)if(I[F]===m)return"\r"===I[F-1]?_:m;throw new Error("Invalid newline character.")}parseLine(I,F){if(I.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const H=I[0];if("="!==I[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:H,value:I.slice(2),line:F,cur:0}}parseSessionAttribute(){const I=new ht;for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==v.ATTRIBUTE)break;const H={attField:this.extractOneOrMore(F,re=>P(re)&&":"!==re),_cur:0};":"===F.value[F.cur]&&(F.cur+=1,H.attValue=this.extractOneOrMore(F,U)),I.parse(H),this.currentLine++}return I.digest()}parseMediaAttributes(I){const F=new St(I);for(;this.currentLine<this.records.length;){const H=this.getCurrentRecord();if(H.type!==v.ATTRIBUTE)break;const re={attField:this.extractOneOrMore(H,Fe=>P(Fe)&&":"!==Fe),_cur:0};":"===H.value[H.cur]&&(H.cur+=1,re.attValue=this.extractOneOrMore(H,U)),F.parse(re),this.currentLine++}return F.digest()}parseKey(){const I=this.getCurrentRecord();if(I.type===v.KEY){if("prompt"===I.value||"clear:"===I.value||"base64:"===I.value||"uri:"===I.value)return I.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const I=this.getCurrentRecord();if(I.type===v.ZONE_ADJUSTMENTS){const F=[];for(;;)try{const H=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);let re=!1;"-"===I.value[I.cur]&&(re=!0,I.cur+=1);const Fe=this.extract(I,this.consumeTypedTime);F.push({time:H,typedTime:Fe,back:re})}catch(H){break}if(0===F.length)throw new Error("Invalid zone adjustments");return this.currentLine++,F}return[]}parseRepeat(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.REPEAT)break;{const H=this.extract(F,this.consumeRepeatInterval),re=this.parseTypedTime(F);I.push({repeatInterval:H,typedTimes:re}),this.currentLine++}}return I}parseTypedTime(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeTypedTime))}catch(H){break}if(0===F.length)throw new Error("Invalid typed time.");return F}parseTime(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeTime);this.consumeSpaceForRecord(I);const H=this.extract(I,this.consumeTime);return this.currentLine++,{startTime:F,stopTime:H}}parseBandWidth(){const I=[];for(;this.currentLine<this.records.length;){const F=this.getCurrentRecord();if(F.type!==v.BANDWIDTH)break;{const H=this.extractOneOrMore(F,P);if(":"!==F.value[F.cur])throw new Error("Invalid bandwidth field.");F.cur++;const re=this.extractOneOrMore(F,S);I.push({bwtype:H,bandwidth:re}),this.currentLine++}}return I}parseVersion(){const I=this.getCurrentRecord();if(I.type!==v.VERSION)throw new Error("first sdp record must be version");const F=I.value.slice(0,this.consumeOneOrMore(I.value,0,S));if(F.length!==I.value.length)throw new Error('invalid proto version, "v='.concat(I.value,'"'));return this.currentLine++,F}parseOrigin(){const I=this.getCurrentRecord();if(I.type!==v.ORIGIN)throw new Error("second line of sdp must be origin");const F=this.extractOneOrMore(I,O);this.consumeSpaceForRecord(I);const H=this.extractOneOrMore(I,S);this.consumeSpaceForRecord(I);const re=this.extractOneOrMore(I,S);this.consumeSpaceForRecord(I);const Fe=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Gt=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const Wi=this.extract(I,this.consumeUnicastAddress);return this.currentLine++,{username:F,sessId:H,sessVersion:re,nettype:Fe,addrtype:Gt,unicastAddress:Wi}}parseSessionName(){const I=this.getCurrentRecord();if(I.type===v.SESSION_NAME){const F=this.extract(I,this.consumeText);return this.currentLine++,F}}parseInformation(){const I=this.getCurrentRecord();if(I.type!==v.INFORMATION)return;const F=this.extract(I,this.consumeText);return this.currentLine++,F}parseUri(){const I=this.getCurrentRecord();if(I.type===v.URI)return this.currentLine++,I.value}parseEmail(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.EMAIL)break;I.push(F.value),this.currentLine++}return I}parsePhone(){const I=[];for(;;){const F=this.getCurrentRecord();if(F.type!==v.PHONE)break;I.push(F.value),this.currentLine++}return I}parseConnection(){const I=this.getCurrentRecord();if(I.type===v.CONNECTION){const F=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const H=this.extractOneOrMore(I,P);this.consumeSpaceForRecord(I);const re=this.extract(I,this.consumeAddress);return this.currentLine++,{nettype:F,addrtype:H,address:re}}}parseMedia(){const I=this.getCurrentRecord(),F=this.extract(I,this.consumeToken);this.consumeSpaceForRecord(I);let H=this.extract(I,this.consumePort);"/"===I.value[I.cur]&&(I.cur+=1,H+=this.extract(I,this.consumeInteger)),this.consumeSpaceForRecord(I);const re=[];for(re.push(this.extract(I,this.consumeToken));"/"===I.value[I.cur];)I.cur+=1,re.push(this.extract(I,this.consumeToken));if(0===re.length)throw new Error("Invalid proto");const Fe=this.parseFmt(I);return this.currentLine++,{mediaType:F,port:H,protos:re,fmts:Fe}}parseTimeFields(){const I=[];for(;this.getCurrentRecord().type===v.TIME;){const F=this.parseTime(),H=this.parseRepeat(),re=this.parseZone();I.push({time:F,repeats:H,zones:re})}return I}parseMediaDescription(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.MEDIA;){const F=this.parseMedia(),H=this.parseInformation(),re=this.parseConnections(),Fe=this.parseBandWidth(),Gt=this.parseKey(),Wi=this.parseMediaAttributes(F);I.push({media:F,information:H,connections:re,bandwidths:Fe,key:Gt,attributes:Wi})}return I}parseConnections(){const I=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===v.CONNECTION;)I.push(this.parseConnection());return I}parseFmt(I){const F=[];for(;;)try{this.consumeSpaceForRecord(I),F.push(this.extract(I,this.consumeToken))}catch(H){break}if(0===F.length)throw new Error("Invalid fmts");return F}extract(I,F,...H){const re=F.call(this,I.value,I.cur,...H),Fe=I.value.slice(I.cur,re);return I.cur=re,Fe}extractOneOrMore(I,F){const H=this.consumeOneOrMore(I.value,I.cur,F),re=I.value.slice(I.cur,H);return I.cur=H,re}consumeSpaceForRecord(I){if(I.value[I.cur]!==E)throw new Error("Invalid space at ".concat(I.cur,"."));I.cur+=1}}class ze extends ge{constructor(...I){super(...I),J(this,"attributes",void 0),J(this,"digested",!1)}extractOneOrMore(I,F,H){const re=this.consumeOneOrMore(I.attValue,I._cur,F),Fe=I.attValue.slice(I._cur,re),[Gt,Wi]=H||[];if("number"==typeof Gt&&Fe.length<Gt)throw new Error("error in length, should be more or equal than ".concat(Gt," characters."));if("number"==typeof Wi&&Fe.length>Wi)throw new Error("error in length, should be less or equal than ".concat(Wi," characters."));return I._cur=re,Fe}consumeAttributeSpace(I){if(I.attValue[I._cur]!==E)throw new Error("Invalid space at ".concat(I._cur,"."));I._cur+=1}extract(I,F,...H){if(!I.attValue)throw new Error("Nothing to extract from attValue.");const re=F.call(this,I.attValue,I._cur,...H),Fe=I.attValue.slice(I._cur,re);return I._cur=re,Fe}atEnd(I){if(!I.attValue)throw new Error;return I._cur>=I.attValue.length}peekChar(I){if(!I.attValue)throw new Error;return I.attValue[I._cur]}peek(I,F){if(!I.attValue)throw new Error;for(let H=0;H<F.length;H++)if(F[H]!==I.attValue[I._cur+H])return!1;return!0}parseIceUfrag(I){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(I,Y,[4,256])}parseIcePwd(I){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(I,Y,[22,256])}parseIceOptions(I){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const F=[];for(;!this.atEnd(I);){F.push(this.extractOneOrMore(I,Y));try{this.consumeAttributeSpace(I)}catch(H){if(this.atEnd(I))break;throw H}}this.attributes.iceOptions=F}parseFingerprint(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill);this.attributes.fingerprints.push({hashFunction:F,fingerprint:H})}parseExtmap(I){const F=this.extractOneOrMore(I,S);let H;"/"===this.peekChar(I)&&(this.extract(I,this.consume,"/"),H=this.extract(I,this.consumeToken)),this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeTill,E),Fe=$($({entry:parseInt(F,10)},H&&{direction:H}),{},{extensionName:re});this.peekChar(I)===E&&(this.consumeAttributeSpace(I),Fe.extensionAttributes=this.extract(I,this.consumeTill)),this.attributes.extmaps.push(Fe)}parseSetup(I){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const F=this.extract(I,this.consumeTill);if("active"!==F&&"passive"!==F&&"actpass"!==F&&"holdconn"!==F)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=F}}class ht extends ze{constructor(...I){super(...I),J(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"group":this.parseGroup(I);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"fingerprint":this.parseFingerprint(I);break;case"setup":this.parseSetup(I);break;case"tls-id":this.parseTlsId(I);break;case"identity":this.parseIdentity(I);break;case"extmap":this.parseExtmap(I);break;case"msid-semantic":this.parseMsidSemantic(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing session attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(I){const F=this.extract(I,this.consumeToken),H=[];for(;!this.atEnd(I)&&this.peekChar(I)===E;)this.consumeAttributeSpace(I),H.push(this.extract(I,this.consumeToken));this.attributes.groups.push({semantic:F,identificationTag:H})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(I){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(I,ie)}parseIdentity(I){const F=this.extractOneOrMore(I,K),H=[];for(;!this.atEnd(I)&&this.peekChar(I)===E;){this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeToken);this.extract(I,this.consume,"=");const Fe=this.extractOneOrMore(I,Gt=>Gt!==E&&U(Gt));H.push({name:re,value:Fe})}this.attributes.identities.push({assertionValue:F,extensions:H})}parseMsidSemantic(I){this.peekChar(I)===E&&this.consumeAttributeSpace(I);const F={semantic:this.extract(I,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(I)}catch(H){break}if("*"===this.peekChar(I)){this.extract(I,this.consume,"*"),F.applyForAll=!0;break}{const H=this.extract(I,this.consumeTill,E);F.identifierList.push(H)}}this.attributes.msidSemantic=F}}class St extends ze{constructor(I){super(),J(this,"attributes",void 0),-1!==I.protos.indexOf("RTP")||I.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(I){if(this.digested)throw new Error("already digested");try{switch(I.attField){case"extmap":this.parseExtmap(I);break;case"setup":this.parseSetup(I);break;case"ice-ufrag":this.parseIceUfrag(I);break;case"ice-pwd":this.parseIcePwd(I);break;case"ice-options":this.parseIceOptions(I);break;case"candidate":this.parseCandidate(I);break;case"remote-candidate":this.parseRemoteCandidate(I);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(I);break;case"rtpmap":this.parseRtpmap(I);break;case"ptime":this.parsePtime(I);break;case"maxptime":this.parseMaxPtime(I);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(I);break;case"ssrc":this.parseSSRC(I);break;case"fmtp":this.parseFmtp(I);break;case"rtcp-fb":this.parseRtcpFb(I);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(I);break;case"mid":this.parseMid(I);break;case"msid":this.parseMsid(I);break;case"imageattr":this.parseImageAttr(I);break;case"rid":this.parseRid(I);break;case"simulcast":this.parseSimulcast(I);break;case"sctp-port":this.parseSctpPort(I);break;case"max-message-size":this.parseMaxMessageSize(I);break;case"ssrc-group":this.parseSSRCGroup(I);break;default:I.ignored=!0,this.attributes.unrecognized.push(I)}}catch(F){throw console.error("parsing media attribute ".concat(I.attField,' error, "a=').concat(I.attField,":").concat(I.attValue,'"')),F}if(!I.ignored&&I.attValue&&!this.atEnd(I))throw new Error("attribute parsing error")}parseCandidate(I){const F=this.extractOneOrMore(I,Y,[1,32]);this.consumeAttributeSpace(I);const H=this.extractOneOrMore(I,S,[1,5]);this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const Fe=this.extractOneOrMore(I,S,[1,10]);this.consumeAttributeSpace(I);const Gt=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Wi=this.extract(I,this.consumePort);this.consumeAttributeSpace(I),this.extract(I,this.consume,"typ"),this.consumeAttributeSpace(I);const Co={foundation:F,componentId:H,transport:re,priority:Fe,connectionAddress:Gt,port:Wi,type:this.extract(I,this.consumeToken),extension:{}};for(this.peek(I," raddr")&&(this.extract(I,this.consume," raddr"),this.consumeAttributeSpace(I),Co.relAddr=this.extract(I,this.consumeAddress)),this.peek(I," rport")&&(this.extract(I,this.consume," rport"),this.consumeAttributeSpace(I),Co.relPort=this.extract(I,this.consumePort));this.peekChar(I)===E;){this.consumeAttributeSpace(I);const El=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I),Co.extension[El]=this.extractOneOrMore(I,b)}this.attributes.candidates.push(Co)}parseRemoteCandidate(I){const F=[];for(;;){const H=this.extractOneOrMore(I,S,[1,5]);this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeAddress);this.consumeAttributeSpace(I);const Fe=this.extract(I,this.consumePort);F.push({componentId:H,connectionAddress:re,port:Fe});try{this.consumeAttributeSpace(I)}catch(Gt){break}}this.attributes.remoteCandidatesList.push(F)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(I){const F=this.extract(I,this.consumeToken);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,"/");this.extract(I,this.consume,"/");const re={encodingName:H,clockRate:this.extractOneOrMore(I,S)};this.atEnd(I)||"/"!==this.peekChar(I)||(this.extract(I,this.consume,"/"),re.encodingParameters=parseInt(this.extract(I,this.consumeTill),10));const Fe=this.attributes.payloads.find(Gt=>Gt.payloadType===parseInt(F,10));Fe?Fe.rtpMap=re:this.attributes.payloads.push({payloadType:parseInt(F,10),rtpMap:re,rtcpFeedbacks:[]})}parsePtime(I){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(I,this.consumeTill)}parseMaxPtime(I){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(I,this.consumeTill)}parseDirection(I){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=I.attField}parseSSRC(I){const F=this.extractOneOrMore(I,S);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,":");let re;":"===this.peekChar(I)&&(this.extract(I,this.consume,":"),re=this.extract(I,this.consumeTill));const Fe=this.attributes.ssrcs.find(Gt=>Gt.ssrcId===parseInt(F,10));Fe?Fe.attributes[H]=re:this.attributes.ssrcs.push({ssrcId:parseInt(F,10),attributes:{[H]:re}})}parseFmtp(I){const F=this.extract(I,this.consumeTill,E);this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill),re={};H.split(";").forEach(Gt=>{let[Wi,Co]=Gt.split("=");Wi=Wi.trim();const El="string"==typeof Co?Co.trim():null;"string"==typeof Wi&&Wi.length>0&&(re[Wi]=El)});const Fe=this.attributes.payloads.find(Gt=>Gt.payloadType===parseInt(F,10));Fe?Fe.fmtp={parameters:re}:this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[],fmtp:{parameters:re}})}parseFmtParameters(I){const F={},H=this.extract(I,this.consumeTill,"=");I._cur++;const re=this.extract(I,this.consumeTill,";");for(F[H]=re;";"===I.attValue[I._cur];){const Fe=this.extract(I,this.consumeTill,"=");I._cur++;const Gt=this.extract(I,this.consumeTill,";");F[Fe]=Gt}return F}parseRtcpFb(I){let F="";F="*"===this.peekChar(I)?this.extract(I,this.consume,"*"):this.extract(I,this.consumeTill,E),this.consumeAttributeSpace(I);const H=this.extract(I,this.consumeTill,E);let re;if("trr-int"===H)re={type:H,interval:this.extract(I,this.consumeTill)};else{const Fe={type:H};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),Fe.parameter=this.extract(I,this.consumeToken),this.peekChar(I)===E&&(Fe.additional=this.extract(I,this.consumeTill))),re=Fe}if("*"===F)this.attributes.rtcpFeedbackWildcards.push(re);else{const Fe=this.attributes.payloads.find(Gt=>Gt.payloadType===parseInt(F,10));Fe?Fe.rtcpFeedbacks.push(re):this.attributes.payloads.push({payloadType:parseInt(F,10),rtcpFeedbacks:[re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(I){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const F={port:this.extract(I,this.consumePort)};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),F.netType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),F.addressType=this.extractOneOrMore(I,P),this.consumeAttributeSpace(I),F.address=this.extract(I,this.consumeAddress)),this.attributes.rtcp=F}parseMsid(I){const F={id:this.extractOneOrMore(I,P,[1,64])};this.peekChar(I)===E&&(this.consumeAttributeSpace(I),F.appdata=this.extractOneOrMore(I,P,[1,64])),this.attributes.msids.push(F)}parseImageAttr(I){this.attributes.imageattr.push(I.attValue)}parseRid(I){const F=this.extractOneOrMore(I,re=>M(re)||S(re)||"_"===re||"-"===re);this.consumeAttributeSpace(I);const H={id:F,direction:this.extract(I,this.consumeToken),params:[]};if(this.peekChar(I)===E){if(this.consumeAttributeSpace(I),this.peek(I,"pt=")){this.extract(I,this.consume,"pt=");const re=[];for(;;){const Fe=this.extract(I,this.consumeToken);re.push(Fe);try{this.extract(I,this.consume,",")}catch(Gt){break}}H.payloads=re,this.peekChar(I)===E&&this.extract(I,this.consume,E)}for(;;){const re=this.extract(I,this.consumeToken);switch(re){case"depend":{const Fe={type:re,rids:this.extract(I,this.consume,"=").split(",")};H.params.push(Fe);break}default:{const Fe={type:re};"="===this.peekChar(I)&&(this.extract(I,this.consume,"="),Fe.val=this.extract(I,this.consumeTill,";")),H.params.push(Fe)}}try{this.extract(I,this.consume,";")}catch(Fe){break}}}this.attributes.rids.push(H)}parseSimulcast(I){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=I.attValue,this.extract(I,this.consumeTill)}parseSctpPort(I){this.attributes.sctpPort=this.extractOneOrMore(I,S,[1,5])}parseMaxMessageSize(I){this.attributes.maxMessageSize=this.extractOneOrMore(I,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(I){this.attributes.mid=this.extract(I,this.consumeToken)}parseSSRCGroup(I){const F=this.extract(I,this.consumeToken),H=[];for(;;)try{this.consumeAttributeSpace(I);const re=this.extract(I,this.consumeInteger);H.push(parseInt(re,10))}catch(re){break}this.attributes.ssrcGroups.push({semantic:F,ssrcIds:H})}}function st(le,I,F){return I in le?Object.defineProperty(le,I,{value:F,enumerable:!0,configurable:!0,writable:!0}):le[I]=F,le}class Ct{constructor(){st(this,"eol",_)}print(I,F){let H="";return F&&(this.eol=F),H+=this.printVersion(I.version),H+=this.printOrigin(I.origin),H+=this.printSessionName(I.sessionName),H+=this.printInformation(I.information),H+=this.printUri(I.uri),H+=this.printEmail(I.emails),H+=this.printPhone(I.phones),H+=this.printConnection(I.connection),H+=this.printBandwidth(I.bandwidths),H+=this.printTimeFields(I.timeFields),H+=this.printKey(I.key),H+=this.printSessionAttributes(I.attributes),H+=this.printMediaDescription(I.mediaDescriptions),H}printVersion(I){return"v=".concat(I).concat(this.eol)}printOrigin(I){return"o=".concat(I.username," ").concat(I.sessId," ").concat(I.sessVersion," ").concat(I.nettype," ").concat(I.addrtype," ").concat(I.unicastAddress).concat(this.eol)}printSessionName(I){return I?"s=".concat(I).concat(this.eol):""}printInformation(I){return I?"i=".concat(I).concat(this.eol):""}printUri(I){return I?"u=".concat(I).concat(this.eol):""}printEmail(I){let F="";for(const H of I)F+="e=".concat(H).concat(this.eol);return F}printPhone(I){let F="";for(const H of I)F+="e=".concat(H).concat(this.eol);return F}printConnection(I){return I?"c=".concat(I.nettype," ").concat(I.addrtype," ").concat(I.address).concat(this.eol):""}printBandwidth(I){let F="";for(const H of I)F+="b=".concat(H.bwtype,":").concat(H.bandwidth).concat(this.eol);return F}printTimeFields(I){let F="";for(const H of I){F+="t=".concat(H.time.startTime," ").concat(H.time.startTime).concat(this.eol);for(const re of H.repeats)F+="r=".concat(re.repeatInterval," ").concat(re.typedTimes.join(" ")).concat(this.eol);H.zoneAdjustments&&(F+="z=",F+="z=".concat(H.zoneAdjustments.map(re=>"".concat(re.time," ").concat(re.back?"-":""," ").concat(re.typedTime)).join(" ")).concat(this.eol),F+=this.eol)}return F}printKey(I){return I?"k=".concat(I).concat(this.eol):""}printAttributes(I){let F="";for(const H of I)F+="a=".concat(H.attField).concat(H.attValue?":".concat(H.attValue):"").concat(this.eol);return F}printMediaDescription(I){let F="";for(const H of I)F+=this.printMedia(H.media),F+=this.printInformation(H.information),F+=this.printConnections(H.connections),F+=this.printBandwidth(H.bandwidths),F+=this.printKey(H.key),F+=this.printMediaAttributes(H);return F}printConnections(I){let F="";for(const H of I)F+=this.printConnection(H);return F}printMedia(I){return"m=".concat(I.mediaType," ").concat(I.port," ").concat(I.protos.join("/")," ").concat(I.fmts.join(" ")).concat(this.eol)}printSessionAttributes(I){return new ae(this.eol).print(I)}printMediaAttributes(I){return new me(this.eol).print(I)}}class ee{constructor(I){st(this,"eol",void 0),this.eol=I}printIceUfrag(I){return void 0===I?"":"a=ice-ufrag:".concat(I).concat(this.eol)}printIcePwd(I){return void 0===I?"":"a=ice-pwd:".concat(I).concat(this.eol)}printIceOptions(I){return void 0===I?"":"a=ice-options:".concat(I.join(E)).concat(this.eol)}printFingerprints(I){return I.length>0?I.map(F=>"a=fingerprint:".concat(F.hashFunction).concat(E).concat(F.fingerprint)).join(this.eol)+this.eol:""}printExtmap(I){return I.map(F=>"a=extmap:".concat(F.entry).concat(F.direction?"/".concat(F.direction):"").concat(E).concat(F.extensionName).concat(F.extensionAttributes?"".concat(E).concat(F.extensionAttributes):"").concat(this.eol)).join("")}printSetup(I){return void 0===I?"":"a=setup:".concat(I).concat(this.eol)}printUnrecognized(I){return I.map(F=>"a=".concat(F.attField).concat(F.attValue?":".concat(F.attValue):"").concat(this.eol)).join("")}}class ae extends ee{print(I){let F="";return F+=this.printGroups(I.groups),F+=this.printMsidSemantic(I.msidSemantic),F+=this.printIceLite(I.iceLite),F+=this.printIceUfrag(I.iceUfrag),F+=this.printIcePwd(I.icePwd),F+=this.printIceOptions(I.iceOptions),F+=this.printFingerprints(I.fingerprints),F+=this.printSetup(I.setup),F+=this.printTlsId(I.tlsId),F+=this.printIdentity(I.identities),F+=this.printExtmap(I.extmaps),F+=this.printUnrecognized(I.unrecognized),F}printGroups(I){let F="";return I.length>0&&(F+=I.map(H=>"a=group:".concat(H.semantic).concat(H.identificationTag.map(re=>"".concat(E).concat(re)).join("")).concat(this.eol)).join("")),F}printIceLite(I){return void 0===I?"":"a=ice-lite"+this.eol}printTlsId(I){return I?"a=tls-id:".concat(I).concat(this.eol):""}printIdentity(I){return 0===I.length?"":I.map(F=>"a=identity:".concat(F.assertionValue).concat(F.extensions.map(H=>"".concat(E).concat(H.name).concat(H.value?"=".concat(H.value):"")))).join(this.eol)+this.eol}printMsidSemantic(I){if(!I)return"";let F="a=msid-semantic:".concat(I.semantic);return I.applyForAll?F+="".concat(E,"*"):I.identifierList.length>0&&(F+=I.identifierList.map(H=>"".concat(E).concat(H))),F+this.eol}}class me extends ee{print(I){const F=I.attributes;let H="";return H+=this.printRTCP(F.rtcp),H+=this.printIceUfrag(F.iceUfrag),H+=this.printIcePwd(F.icePwd),H+=this.printIceOptions(F.iceOptions),H+=this.printCandidates(F.candidates),H+=this.printRemoteCandidatesList(F.remoteCandidatesList),H+=this.printEndOfCandidates(F.endOfCandidates),H+=this.printFingerprints(F.fingerprints),H+=this.printSetup(F.setup),H+=this.printMid(F.mid),H+=this.printExtmap(F.extmaps),H+=this.printRTPRelated(F),H+=this.printPtime(F.ptime),H+=this.printMaxPtime(F.maxPtime),H+=this.printDirection(F.direction),H+=this.printSSRCGroups(F.ssrcGroups),H+=this.printSSRC(F.ssrcs),H+=this.printRTCPMux(F.rtcpMux),H+=this.printRTCPMuxOnly(F.rtcpMuxOnly),H+=this.printRTCPRsize(F.rtcpRsize),H+=this.printMSId(F.msids),H+=this.printImageattr(F.imageattr),H+=this.printRid(F.rids),H+=this.printSimulcast(F.simulcast),H+=this.printSCTPPort(F.sctpPort),H+=this.printMaxMessageSize(F.maxMessageSize),H+=this.printUnrecognized(F.unrecognized),H}printCandidates(I){return I.map(F=>"a=candidate:".concat(F.foundation).concat(E).concat(F.componentId).concat(E).concat(F.transport).concat(E).concat(F.priority).concat(E).concat(F.connectionAddress).concat(E).concat(F.port).concat(E,"typ").concat(E).concat(F.type).concat(F.relAddr?"".concat(E,"raddr").concat(E).concat(F.relAddr):"").concat(F.relPort?"".concat(E,"rport").concat(E).concat(F.relPort):"").concat(Object.keys(F.extension).map(H=>"".concat(E).concat(H).concat(E).concat(F.extension[H])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(I){return I.map(F=>"a=remote-candidates:".concat(F.join(E)).concat(this.eol)).join("")}printEndOfCandidates(I){return void 0===I?"":"a=end-of-candidates"+this.eol}printRTPRelated(I){if(!I.payloads)return"";const F=I.payloads;let H="";H+=I.rtcpFeedbackWildcards.map(re=>this.printRTCPFeedback("*",re)).join("");for(const re of F)H+=this.printRtpMap(re.payloadType,re.rtpMap),H+=this.printFmtp(re.payloadType,re.fmtp),H+=re.rtcpFeedbacks.map(Fe=>this.printRTCPFeedback(re.payloadType,Fe)).join("");return H}printFmtp(I,F){if(!F)return"";const H=Object.keys(F.parameters);return 1===H.length&&null===F.parameters[H[0]]?"a=fmtp:".concat(I).concat(E).concat(H[0]).concat(this.eol):"a=fmtp:".concat(I).concat(E).concat(Object.keys(F.parameters).map(re=>"".concat(re,"=").concat(F.parameters[re])).join(";")).concat(this.eol)}printRtpMap(I,F){return F?"a=rtpmap:".concat(I).concat(E).concat(F.encodingName,"/").concat(F.clockRate).concat(F.encodingParameters?"/".concat(F.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(I,F){let H="a=rtcp-fb:".concat(I).concat(E),re=F;return"trr-int"===re.type?H+="ttr-int".concat(E).concat(re.interval):(H+="".concat(re.type),re.parameter&&(H+="".concat(E).concat(re.parameter),re.additional&&(H+="".concat(E).concat(re.additional)))),H+this.eol}printPtime(I){return void 0===I?"":"a=ptime:".concat(I).concat(this.eol)}printMaxPtime(I){return void 0===I?"":"a=maxptime:".concat(I).concat(this.eol)}printDirection(I){return void 0===I?"":"a=".concat(I).concat(this.eol)}printSSRC(I){return I.map(F=>Object.keys(F.attributes).map(H=>"a=ssrc:".concat(F.ssrcId.toString(10)).concat(E).concat(H).concat(F.attributes[H]?":".concat(F.attributes[H]):"").concat(this.eol)).join("")).join("")}printRTCPMux(I){return void 0===I?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(I){return void 0===I?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(I){return void 0===I?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(I){if(void 0===I)return"";let F="a=rtcp:".concat(I.port);return I.netType&&(F+="".concat(E).concat(I.netType)),I.addressType&&(F+="".concat(E).concat(I.addressType)),I.address&&(F+="".concat(E).concat(I.address)),F+this.eol}printMSId(I){return I.map(F=>"a=msid:".concat(F.id).concat(F.appdata?"".concat(E).concat(F.appdata):"").concat(this.eol)).join("")}printImageattr(I){return I.map(F=>"a=imageattr:".concat(F).concat(this.eol)).join("")}printRid(I){return I.map(F=>{let H="a=rid:".concat(F.id).concat(E).concat(F.direction);return F.payloads&&(H+="".concat(E,"pt=").concat(F.payloads.join(","))),F.params.length>0&&(H+="".concat(E).concat(F.params.map(re=>"depend"===re.type?"depend=".concat(re.rids.join(",")):"".concat(re.type,"=").concat(re.val)).join(";"))),H+this.eol}).join("")}printSimulcast(I){return void 0===I?"":"a=simulcast:".concat(I).concat(this.eol)}printSCTPPort(I){return void 0===I?"":"a=sctp-port:".concat(I).concat(this.eol)}printMaxMessageSize(I){return void 0===I?"":"a=max-message-size:".concat(I).concat(this.eol)}printMid(I){return void 0===I?"":"a=mid:".concat(I).concat(this.eol)}printSSRCGroups(I){return I.map(F=>"a=ssrc-group:".concat(F.semantic).concat(F.ssrcIds.map(H=>"".concat(E).concat(H.toString(10))).join("")).concat(this.eol)).join("")}}function ke(le){return(new Ee).parse(le)}function pt(le,I){return(new Ct).print(le,I)}}},s={};function c(d){if(s[d])return s[d].exports;var h=s[d]={exports:{}};return i[d](h,h.exports,c),h.exports}return c.d=(d,h)=>{for(var p in h)c.o(h,p)&&!c.o(d,p)&&Object.defineProperty(d,p,{enumerable:!0,get:h[p]})},c.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),c.r=d=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},c(8)})()}(lO);var un=lO.exports;function dO(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function uO(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?dO(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):dO(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function vT(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:p,filterVideoCodec:m}=n,{useXR:_}=i;let E=[],v=[],S=[],b=[],O=!1,P=!1;if(un.parse(o).mediaDescriptions.forEach(w=>{s&&s!==w.attributes.direction||("video"!==w.media.mediaType||O||(v=w.attributes.payloads,b=w.attributes.extmaps,O=!0),"audio"!==w.media.mediaType||P||(E=w.attributes.payloads,S=w.attributes.extmaps,P=!0))}),!b||0===v.length)throw new Error("Cannot get video capabilities from SDP.");if(!S||0===E.length)throw new Error("Cannot get audio capabilities from SDP.");return v.forEach(w=>{var M;null!==(M=w.rtpMap)&&void 0!==M&&M.clockRate&&(w.rtpMap.clockRate=parseInt(w.rtpMap.clockRate)),_&&w.rtcpFeedbacks.push({type:"rrtr"})}),E.forEach(w=>{var M;null!==(M=w.rtpMap)&&void 0!==M&&M.clockRate&&(w.rtpMap.clockRate=parseInt(w.rtpMap.clockRate)),_&&w.rtcpFeedbacks.push({type:"rrtr"})}),c&&(E=E.filter(w=>{var M;return"rtx"!==(null===(M=w.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())}),v=v.filter(w=>{var M;return"rtx"!==(null===(M=w.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())})),d&&(v=v.filter(w=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(M=w.rtpMap)||void 0===M?void 0:M.encodingName)||"")})),h&&(E=E.filter(w=>{var M;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(M=w.rtpMap)||void 0===M?void 0:M.encodingName)||"")})),p&&(null==p?void 0:p.length)>0&&(E=E.filter(w=>{var M;return Re(p).call(p,(null===(M=w.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())||"")})),m&&(null==m?void 0:m.length)>0&&(v=v.filter(w=>{var M;return Re(m).call(m,(null===(M=w.rtpMap)||void 0===M?void 0:M.encodingName.toLowerCase())||"")})),{audioCodecs:E,videoCodecs:v,audioExtensions:S,videoExtensions:b}}function Aa(o){const n=un.parse(o);let i,s;for(const c of n.mediaDescriptions){if(!i){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:d,icePwd:h}}if(!s){const d=c.attributes.fingerprints;d.length>0&&(s={fingerprints:d})}}if(!s&&n.attributes.fingerprints.length>0&&(s={fingerprints:n.attributes.fingerprints}),!s||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:s}}function wh(o,n){const i=[],s=o.attributes.ssrcGroups.filter(h=>"FID"===h.semantic),c=o.attributes.ssrcGroups.find(h=>"SIM"===h.semantic),d=o.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var p;const m=null===(p=s.find(_=>_.ssrcIds[0]===h))||void 0===p?void 0:p.ssrcIds[1];i.push({ssrcId:h,rtx:n?m:void 0})});else if(s.length>0){const p=s[0].ssrcIds[1];i.push({ssrcId:s[0].ssrcIds[0],rtx:n?p:void 0})}else{if(0===d.length)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:d[0].ssrcId})}return i}function cm(o,n){const{cname:i}=o;let s;n&&n.ip&&"number"==typeof n.port?(s=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip,port:n.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(n.ip,":").concat(n.port)),n.ip6&&(s.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:n.ip6,port:n.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(n.ip6,":").concat(n.port)))):s=o.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}}));const c={fingerprints:o.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},d={iceUfrag:o.iceParameters.iceUfrag,icePwd:o.iceParameters.icePwd};let h;switch(o.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}return{dtlsParameters:c,iceParameters:d,candidates:s,rtpCapabilities:fO(o.rtpCapabilities),setup:h,cname:i}}function Lr(o,n,i){const s=[],c=[];return o.forEach(d=>{let{ssrcId:h,rtx:p}=d;const m=Ot(8,"track-"),_={ssrcId:h,attributes:uO({label:m,mslabel:i=i||Ot(10,""),msid:"".concat(i," ").concat(m)},n&&{cname:n})};if(s.push(_),void 0!==p){const E={ssrcId:p,attributes:uO({label:m,mslabel:i,msid:"".concat(i," ").concat(m)},n&&{cname:n})};s.push(E),c.push({semantic:"FID",ssrcIds:[h,p]})}}),o.length>1&&c.push({semantic:"SIM",ssrcIds:o.map(d=>{let{ssrcId:h}=d;return h})}),{ssrcs:s,ssrcGroups:c}}function Id(o,n){n instanceof xe&&o.attributes.payloads.forEach(i=>{var s;const c=null===(s=i.rtpMap)||void 0===s?void 0:s.encodingName.toLowerCase();if(!c||-1===["opus","pcmu","pcma","g722"].indexOf(c))return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const d=n._encoderConfig;d&&"pcmu"!==c&&"pcma"!==c&&"g722"!==c&&(d.bitrate&&!Bt()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function lm(o){const n=o.attributes.unrecognized.findIndex(i=>"x-google-flag"===i.attField&&"conference"===i.attValue);-1!==n&&o.attributes.unrecognized.splice(n,1)}function Ah(o,n){var i;if(!(n instanceof We&&n._encoderConfig&&-1===n._hints.indexOf(Ht.SCREEN_TRACK)))return;const s=n._encoderConfig;Ge().supportMinBitrate&&s.bitrateMin&&o.attributes.payloads.forEach(c=>{var d,h;Re(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=c.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),Ge().supportMinBitrate&&!Re(i=n._hints).call(i,Ht.LOW_STREAM)&&s.bitrateMax&&o.attributes.payloads.forEach(c=>{var d,h;Re(d=["h264","h265","vp8","vp9","av1"]).call(d,(null===(h=c.rtpMap)||void 0===h?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(B("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function hO(o){if("video"!==o.media.mediaType)return;const n=lt();if(n.name!==mt.SAFARI&&n.os!==ti.IOS)return;const i=o.attributes.extmaps.findIndex(s=>/video-orientation/g.test(s.extensionName));-1!==i&&o.attributes.extmaps.splice(i,1)}function lv(o,n,i){if(!n)return;let s,c;if("video"===o.media.mediaType?(s=i.videoExtensions,c=i.videoCodecs):(s=i.audioExtensions,c=i.audioCodecs),!0===n.twcc){const d=s.find(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);d&&(o.attributes.extmaps.find(p=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===p.extensionName)||o.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),(p=c,m=o.attributes.payloads,m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(v=>"transport-cc"===v.type)))).forEach(p=>{p.rtcpFeedbacks.find(m=>"transport-cc"===m.type)||p.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(!1===n.twcc){const d=o.attributes.extmaps.findIndex(h=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===h.extensionName);-1!==d&&o.attributes.extmaps.splice(d,1),o.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"transport-cc"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}var p,m;if(!0===n.remb){const d=s.find(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);d&&(o.attributes.extmaps.find(p=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===p.extensionName)||o.attributes.extmaps.push({entry:d.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(p,m){return m.filter(_=>!!p.find(E=>E.payloadType===_.payloadType&&!!E.rtcpFeedbacks.find(v=>"goog-remb"===v.type)))}(c,o.attributes.payloads).forEach(p=>{p.rtcpFeedbacks.find(m=>"goog-remb"===m.type)||p.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(!1===n.remb){const d=o.attributes.extmaps.findIndex(h=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===h.extensionName);-1!==d&&o.attributes.extmaps.splice(d,1),o.attributes.payloads.forEach(h=>{const p=h.rtcpFeedbacks.findIndex(m=>"goog-remb"===m.type);-1!==p&&h.rtcpFeedbacks.splice(p,1)})}}function dv(o,n,i){if(Bt()||"video"!==o.media.mediaType||!(n instanceof We)||"vp9"!==i&&"vp8"!==i||"vp8"===i&&!B("SIMULCAST")||void 0===n._scalabilityMode||n._scalabilityMode.numSpatialLayers<=1)return;const s="vp8"===i?2:n._scalabilityMode.numSpatialLayers,c=o.attributes.ssrcs[0],d=o.attributes.ssrcGroups.find(p=>"FID"===p.semantic&&p.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let p=1;p<s;p++)o.attributes.ssrcs.push({ssrcId:c.ssrcId+p,attributes:Mn(c.attributes)}),h.ssrcIds.push(c.ssrcId+p),d&&(o.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+p,attributes:Mn(c.attributes)}),o.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+p,d.ssrcIds[1]+p]}));o.attributes.ssrcGroups.unshift(h)}function pO(){return uv.apply(this,arguments)}function uv(){return uv=L(function*(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{filterRTX:i,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h}=o,{useXR:p}=n,m=new RTCPeerConnection;m.addTransceiver("video",{direction:"sendonly"}),m.addTransceiver("audio",{direction:"sendonly"}),m.addTransceiver("video",{direction:"recvonly"}),m.addTransceiver("audio",{direction:"recvonly"});const _=(yield m.createOffer()).sdp,E=vT(_,{filterRTX:i,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"sendonly"),v=vT(_,{filterRTX:i,filterVideoFec:s,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:h},{useXR:p},"recvonly"),S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},O={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(hv(E,v,"videoExtensions",S,b,O),hv(E,v,"videoCodecs",S,b,O),hv(E,v,"audioExtensions",S,b,O),hv(E,v,"audioCodecs",S,b,O),B("RAISE_H264_BASELINE_PRIORITY")){const P=O.videoCodecs.findIndex(w=>{var M,V;return"h264"===(null===(M=w.rtpMap)||void 0===M?void 0:M.encodingName.toLocaleLowerCase())&&"42001f"===(null===(V=w.fmtp)||void 0===V?void 0:V.parameters["profile-level-id"])});if(-1!==P){const w=O.videoCodecs.findIndex(M=>{var V;return"h264"===(null===(V=M.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())});if(w<P){T.debug("raising H264 baseline profile priority");const M=O.videoCodecs[P];O.videoCodecs.splice(P,1),O.videoCodecs.splice(w,0,M)}-1!==w&&(b.videoCodecs=b.videoCodecs.filter(M=>{var V,U;return!("h264"===(null===(V=M.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(U=M.fmtp)||void 0===U?void 0:U.parameters["profile-level-id"]))})),-1!==w&&B("FILTER_SEND_H264_BASELINE")&&(S.videoCodecs=S.videoCodecs.filter(M=>{var V,U;return!("h264"===(null===(V=M.rtpMap)||void 0===V?void 0:V.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(U=M.fmtp)||void 0===U?void 0:U.parameters["profile-level-id"]))}))}}try{m.close()}catch(P){}return{send:S,recv:b,sendrecv:O}}),uv.apply(this,arguments)}function hv(o,n,i,s,c,d){if("videoExtensions"===i||"audioExtensions"===i){const h=[];return o[i].forEach(p=>{n[i].some((m,_)=>{if(p.entry===m.entry&&p.extensionName===m.extensionName)return h.push(_),!0})?d[i].push(p):s[i].push(p)}),void n[i].forEach((p,m)=>{-1===h.indexOf(m)&&c[i].push(p)})}if("videoCodecs"===i||"audioCodecs"===i){const h=[];return o[i].forEach(p=>{n[i].some((m,_)=>{if(p.payloadType===m.payloadType&&JSON.stringify(p)===JSON.stringify(m))return h.push(_),!0})?d[i].push(p):s[i].push(p)}),void n[i].forEach((p,m)=>{-1===h.indexOf(m)&&c[i].push(p)})}}function fO(o){const{send:n,recv:i,sendrecv:s}=o;if(!s){if(!n||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:i}}let c,d;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...s.audioCodecs],c.videoCodecs=[...n.videoCodecs,...s.videoCodecs],c.audioExtensions=[...n.audioExtensions,...s.audioExtensions],c.videoExtensions=[...n.videoExtensions,...s.videoExtensions]):c=s,i?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...i.audioCodecs,...s.audioCodecs],d.videoCodecs=[...i.videoCodecs,...s.videoCodecs],d.audioExtensions=[...i.audioExtensions,...s.audioExtensions],d.videoExtensions=[...i.videoExtensions,...s.videoExtensions]):d=s,{send:c,recv:d}}function fl(o){"audio"===o.media.mediaType&&o.attributes.payloads.filter(n=>{var i;return"opus"===(null===(i=n.rtpMap)||void 0===i?void 0:i.encodingName.toLowerCase())}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function dm(o){o.mediaDescriptions.forEach(n=>{"video"!==n.media.mediaType&&"audio"!==n.media.mediaType||n.attributes.payloads.forEach(i=>{-1===i.rtcpFeedbacks.findIndex(s=>"rrtr"===s.type)&&i.rtcpFeedbacks.push({type:"rrtr"})})})}function px(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function pv(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?px(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):px(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function ms(o){if(Array.isArray(o))return o.map(i=>i);if(!yT(o))return o;const n={};for(const i in o){const s=o[i];n[i]=yT(s)||Array.isArray(s)?ms(s):s}return n}function yT(o){return!("object"!=typeof o||Array.isArray(o)||!o)}class um{constructor(n){C(this,"input",[]),C(this,"size",void 0),this.size=n}add(n){this.input.push(n),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const _s={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},fv={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:_s,remoteCandidate:_s}},mv={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},Dh={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},hm={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},wd={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function Oh(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function mO(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Oh(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Oh(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class pm{constructor(n,i){var s=this;C(this,"onFirstVideoReceived",void 0),C(this,"onFirstVideoDecoded",void 0),C(this,"onFirstAudioReceived",void 0),C(this,"onFirstVideoDecodedTimeout",void 0),C(this,"onFirstAudioDecoded",void 0),C(this,"onSelectedLocalCandidateChanged",void 0),C(this,"onSelectedRemoteCandidateChanged",void 0),C(this,"videoIsReady",!1),C(this,"videoIsReady2",{}),C(this,"pc",void 0),C(this,"options",void 0),C(this,"intervalTimer",void 0),C(this,"stats",ms(fv)),C(this,"isFirstVideoReceived",{}),C(this,"isFirstVideoDecoded",{}),C(this,"isFirstAudioReceived",{}),C(this,"isFirstAudioDecoded",{}),C(this,"isFirstVideoDecodedTimeout",{}),C(this,"lossRateWindowStats",[]),this.pc=n,this.options=i,this.intervalTimer=window.setInterval(L(function*(){s.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new z(n=>{n({local:mO({},_s),remote:mO({},_s)})})}setVideoIsReady(n){this.videoIsReady=n}setVideoIsReady2(n,i){this.videoIsReady2[n]=i}getVideoIsReady(n){return this.videoIsReady2[n]||!1}setIsFirstAudioDecoded(n){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(n){this.lossRateWindowStats.push(n),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const i=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let c=0,d=0,h=0,p=0;for(const m of s)n[m].forEach((_,E)=>{if(!this.lossRateWindowStats[i-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const v=this.lossRateWindowStats[i-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,S=this.lossRateWindowStats[i-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;"videoSend"===m||"audioSend"===m?(c+=v,h+=S):(d+=v,p+=S),_.packetLostRate=Number.isNaN(v)||Number.isNaN(v)||v<=0||S<=0?0:S/(v+S)});n.sendPacketLossRate=c<=0||h<=0?0:h/(c+h),n.recvPacketLossRate=d<=0||p<=0?0:p/(d+p)}}function ST(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function CT(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ST(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ST(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class _O extends pm{constructor(){super(...arguments),C(this,"_stats",fv),C(this,"lastDecodeVideoReceiverStats",new Map)}updateStats(){var n=this;return L(function*(){const i=yield n._getStats(),s=n.statsResponsesToObjects(i);n._stats=ms(fv);const c=s.filter(h=>"ssrc"===h.type);n.processSSRCStats(c);const d=s.find(h=>"VideoBwe"===h.type);d&&n.processBandwidthStats(d),n._stats.timestamp=Date.now(),n.calcLossRate(n._stats),n.stats=n._stats})()}processBandwidthStats(n){this._stats.bitrate={actualEncoded:Number(n.googActualEncBitrate),targetEncoded:Number(n.googTargetEncBitrate),retransmit:Number(n.googRetransmitBitrate),transmit:Number(n.googTransmitBitrate)},this._stats.sendBandwidth=Number(n.googAvailableSendBandwidth)}processSSRCStats(n){n.forEach(i=>{var s;const c=Re(s=i.id).call(s,"send");switch("".concat(i.mediaType,"_").concat(c?"send":"recv")){case"video_send":{const d=ms(Dh);d.codec=i.googCodecName,d.adaptionChangeReason="none",i.googCpuLimitedResolution&&(d.adaptionChangeReason="cpu"),i.googBandwidthLimitedResolution&&(d.adaptionChangeReason="bandwidth"),d.avgEncodeMs=Number(i.googAvgEncodeMs),d.inputFrame={width:Number(i.googFrameWidthInput)||Number(i.googFrameWidthSent),height:Number(i.googFrameHeightInput)||Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},d.sentFrame={width:Number(i.googFrameWidthSent),height:Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},d.firsCount=Number(i.googFirReceived),d.nacksCount=Number(i.googNacksReceived),d.plisCount=Number(i.googPlisReceived),d.frameCount=Number(i.framesEncoded),d.bytes=Number(i.bytesSent),d.packets=Number(i.packetsSent),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.rttMs=Number(i.googRtt||0),this._stats.videoSend.push(d),this._stats.rtt=d.rttMs;break}case"video_recv":{const d=ms(mv),h=this.lastDecodeVideoReceiverStats.get(Number(i.ssrc));if(d.codec=i.googCodecName,d.targetDelayMs=Number(i.googTargetDelayMs),d.renderDelayMs=Number(i.googRenderDelayMs),d.currentDelayMs=Number(i.googCurrentDelayMs),d.minPlayoutDelayMs=Number(i.googMinPlayoutDelayMs),d.decodeMs=Number(i.googDecodeMs),d.maxDecodeMs=Number(i.googMaxDecodeMs),d.receivedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateReceived)},d.decodedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateDecoded)},d.decodeFrameRate=Number(i.googFrameRateDecoded),d.outputFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateOutput)},d.jitterBufferMs=Number(i.googJitterBufferMs),d.firsCount=Number(i.googFirsSent),d.nacksCount=Number(i.googNacksSent),d.plisCount=Number(i.googPlisSent),d.framesDecodeCount=Number(i.framesDecoded),d.bytes=Number(i.bytesReceived),d.packets=Number(i.packetsReceived),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,d.decodedFrame.width,d.decodedFrame.height),this.isFirstVideoDecoded[d.ssrc]=!0),h){const p=h.stats,m=Date.now()-h.lts;d.framesDecodeFreezeTime=p.framesDecodeFreezeTime,d.framesDecodeInterval=p.framesDecodeInterval,d.framesDecodeCount>p.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(h.lts=Date.now(),d.framesDecodeInterval=m,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc,10))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):d.framesDecodeCount<h.stats.framesDecodeCount&&(d.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:CT({},d),lts:Date.now()}),this._stats.videoRecv.push(d);break}case"audio_recv":{const d=ms(wd);d.codec=i.googCodecName,d.outputLevel=Math.abs(Number(i.audioOutputLevel))/32767,d.decodingCNG=Number(i.googDecodingCNG),d.decodingCTN=Number(i.googDecodingCTN),d.decodingCTSG=Number(i.googDecodingCTSG),d.decodingNormal=Number(i.googDecodingNormal),d.decodingPLC=Number(i.googDecodingPLC),d.decodingPLCCNG=Number(i.googDecodingPLCCNG),d.expandRate=Number(i.googExpandRate),d.accelerateRate=Number(i.googAccelerateRate),d.preemptiveExpandRate=Number(i.googPreemptiveExpandRate),d.secondaryDecodedRate=Number(i.googSecondaryDecodedRate),d.speechExpandRate=Number(i.googSpeechExpandRate),d.preferredJitterBufferMs=Number(i.googPreferredJitterBufferMs),d.jitterBufferMs=Number(i.googJitterBufferMs),d.jitterMs=Number(i.googJitterReceived),d.bytes=Number(i.bytesReceived),d.packets=Number(i.packetsReceived),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.receivedFrames=Number(i.googDecodingCTN)||Number(i.packetsReceived),d.droppedFrames=Number(i.googDecodingPLC)+Number(i.googDecodingPLCCNG)||Number(i.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.decodingNormal>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),this._stats.audioRecv.push(d);break}case"audio_send":{const d=ms(hm);d.codec=i.googCodecName,d.inputLevel=Math.abs(Number(i.audioInputLevel))/32767,d.aecReturnLoss=Number(i.googEchoCancellationReturnLoss||0),d.aecReturnLossEnhancement=Number(i.googEchoCancellationReturnLossEnhancement||0),d.residualEchoLikelihood=Number(i.googResidualEchoLikelihood||0),d.residualEchoLikelihoodRecentMax=Number(i.googResidualEchoLikelihoodRecentMax||0),d.bytes=Number(i.bytesSent),d.packets=Number(i.packetsSent),d.packetsLost=Number(i.packetsLost),d.ssrc=Number(i.ssrc),d.rttMs=Number(i.googRtt||0),this._stats.rtt=d.rttMs,this._stats.audioSend.push(d);break}}})}_getStats(){return new z((n,i)=>{this.pc.getStats(n,i)})}statsResponsesToObjects(n){const i=[];return n.result().forEach(s=>{const c={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(d=>{c[d]=s.stat(d)}),i.push(c)}),i}}function fm(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function yc(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?fm(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):fm(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class mm extends pm{constructor(){super(...arguments),C(this,"_stats",fv),C(this,"report",void 0),C(this,"lastDecodeVideoReceiverStats",new Map),C(this,"lastVideoFramesRecv",new Map),C(this,"lastVideoFramesSent",new Map),C(this,"lastVideoFramesDecode",new Map),C(this,"lastVideoJBDelay",new Map),C(this,"lastAudioJBDelay",new Map),C(this,"mediaBytesSent",new Map),C(this,"mediaBytesRetransmit",new Map),C(this,"mediaBytesTargetEncode",new Map),C(this,"lastEncoderMs",new Map)}updateStats(){var n=this;return L(function*(){n.report=yield n.pc.getStats(),n._stats=ms(fv),n.report.forEach(i=>{switch(i.type){case Sr.OUTBOUND:case Sr.INBOUND:{const s=i.mediaType||i.kind,c=!s&&"frameWidth"in i,d=!s&&!("frameWidth"in i);i.type===Sr.OUTBOUND?"audio"===s||d?n.processAudioOutboundStats(i):("video"===s||c)&&n.processVideoOutboundStats(i):i.type===Sr.INBOUND&&("audio"===s||d?n.processAudioInboundStats(i):("video"===s||c)&&n.processVideoInboundStats(i));break}case Sr.TRANSPORT:{const s=n.report.get(i.selectedCandidatePairId);s&&n.processCandidatePairStats(s);break}case Sr.CANDIDATE_PAIR:i.selected&&n.processCandidatePairStats(i)}}),n.updateSendBitrate(),n._stats.timestamp=Date.now(),n.calcLossRate(n._stats),n.stats=n._stats})()}getSelectedCandidatePair(){var n=this;return L(function*(){const i=yield n.pc.getStats(),s={local:yc({},_s),remote:yc({},_s)};return i.forEach(c=>{let d;if(c.type===Sr.TRANSPORT&&(d=i.get(c.selectedCandidatePairId)),c.type===Sr.CANDIDATE_PAIR&&c.selected&&(d=c),d){const h=(p,m)=>{p.type=m.type,p.id=m.id,m.address&&(p.address=m.address),m.candidateType&&(p.candidateType=m.candidateType),m.port&&(p.port=m.port),m.priority&&(p.priority=m.priority),m.protocol&&(p.protocol=m.protocol),m.relayProtocol&&(p.relayProtocol=m.relayProtocol)};if(d.localCandidateId){const p=i.get(d.localCandidateId);p&&h(s.local,p)}if(d.remoteCandidateId){const p=i.get(d.remoteCandidateId);p&&h(s.remote,p)}}}),s})()}processCandidatePairStats(n){if(this._stats.sendBandwidth=n.availableOutgoingBitrate||0,n.currentRoundTripTime&&(this._stats.rtt=1e3*n.currentRoundTripTime),this._stats.videoSend.forEach(i=>{n.currentRoundTripTime&&(i.rttMs=1e3*n.currentRoundTripTime)}),this._stats.audioSend.forEach(i=>{n.currentRoundTripTime&&(i.rttMs=1e3*n.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=n.id,n.localCandidateId){const i=this.report.get(n.localCandidateId);i&&this.processCandidateStats(i)}if(n.remoteCandidateId){const i=this.report.get(n.remoteCandidateId);i&&this.processCandidateStats(i)}}processCandidateStats(n){let i;n.type===Sr.LOCAL_CANDIDATE&&(i=this._stats.selectedCandidatePair.localCandidate),n.type===Sr.REMOTE_CANDIDATE&&(i=this._stats.selectedCandidatePair.remoteCandidate),i&&(i.type=n.type,i.id=n.id,n.address&&(i.address=n.address),n.candidateType&&(i.candidateType=n.candidateType),n.port&&(i.port=n.port),n.priority&&(i.priority=n.priority),n.protocol&&(i.protocol=n.protocol),n.relayProtocol&&(i.relayProtocol=n.relayProtocol),n.type===Sr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==i.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(yc({},i),yc({},this.stats.selectedCandidatePair.localCandidate)),n.type===Sr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==i.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(yc({},i),yc({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(n){let i=this._stats.audioRecv.find(s=>s.ssrc===n.ssrc);i||(i=ms(wd),this._stats.audioRecv.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsReceived,i.packetsLost=n.packetsLost,i.bytes=n.bytesReceived,i.jitterMs=1e3*n.jitter,this.processAudioTrackReceiverStats(n,n.trackId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),i.receivedFrames||(i.receivedFrames=n.packetsReceived),i.droppedFrames||(i.droppedFrames=n.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),"number"==typeof n.concealedSamples&&(i.concealedSamples=n.concealedSamples)}processVideoInboundStats(n){let i=this._stats.videoRecv.find(h=>h.ssrc===n.ssrc);i||(i=ms(mv),this._stats.videoRecv.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsReceived,i.packetsLost=n.packetsLost,i.bytes=n.bytesReceived,i.firsCount=n.firCount,i.nacksCount=n.nackCount,i.plisCount=n.pliCount,i.framesDecodeCount=n.framesDecoded,i.totalInterFrameDelay=n.totalInterFrameDelay,i.totalSquaredInterFrameDelay=n.totalSquaredInterFrameDelay;const s=this.lastDecodeVideoReceiverStats.get(i.ssrc),c=this.lastVideoFramesDecode.get(i.ssrc),d=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]){const h=i.decodedFrame?i.decodedFrame.width:0,p=i.decodedFrame?i.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,h,p),this.isFirstVideoDecoded[i.ssrc]=!0}if(s){const h=s.stats,p=d-s.lts;i.framesDecodeFreezeTime=h.framesDecodeFreezeTime,i.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[i.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[i.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(i.ssrc),this.isFirstVideoDecodedTimeout[i.ssrc]=!0),i.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=p,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):i.framesDecodeCount<h.framesDecodeCount&&(i.framesDecodeInterval=0),n.framesDecoded&&n.qpSum&&(i.qpSumPerFrame=s.stats.framesDecodeCount>n.framesDecoded?n.qpSum/n.framesDecoded:(n.qpSum-s.qpSum)/(n.framesDecoded-s.stats.framesDecodeCount))}c&&d-c.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:i.decodeFrameRate})):c?i.decodeFrameRate=c.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:0}),n.totalDecodeTime&&(i.decodeMs=1e3*n.totalDecodeTime),this.processVideoTrackReceiverStats(n,n.trackId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),n.framerateMean&&(i.framesRateFirefox=n.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:yc({},i),lts:s?s.lts:Date.now(),qpSum:n.qpSum})}processVideoOutboundStats(n){let i=this._stats.videoSend.find(c=>c.ssrc===n.ssrc);i||(i=ms(Dh),this._stats.videoSend.push(i));const s=this.mediaBytesSent.get(n.ssrc);if(s)s.add(n.bytesSent);else{const c=new um(10);c.add(n.bytesSent),this.mediaBytesSent.set(n.ssrc,c)}if(void 0!==n.retransmittedBytesSent){const c=this.mediaBytesRetransmit.get(n.ssrc);if(c)c.add(n.retransmittedBytesSent);else{const d=new um(10);d.add(n.retransmittedBytesSent),this.mediaBytesRetransmit.set(n.ssrc,d)}}if(n.totalEncodedBytesTarget){const c=this.mediaBytesTargetEncode.get(n.ssrc);if(c)c.add(n.totalEncodedBytesTarget);else{const d=new um(10);d.add(n.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(n.ssrc,d)}}if(i.ssrc=n.ssrc,i.bytes=n.bytesSent,i.packets=n.packetsSent,i.firsCount=n.firCount,i.nacksCount=n.nackCount,i.plisCount=n.pliCount,i.frameCount=n.framesEncoded,i.adaptionChangeReason=n.qualityLimitationReason,i.scalabilityMode=n.scalabilityMode,n.totalEncodeTime&&n.framesEncoded){const c=this.lastEncoderMs.get(n.ssrc);i.avgEncodeMs=!c||c.lastFrameCount>n.framesEncoded?1e3*n.totalEncodeTime/n.framesEncoded:1e3*(n.totalEncodeTime-c.lastEncoderTime)/(n.framesEncoded-c.lastFrameCount)}if(n.framesEncoded&&n.qpSum){const c=this.lastEncoderMs.get(n.ssrc);i.qpSumPerFrame=!c||c.lastFrameCount>n.framesEncoded?n.qpSum/n.framesEncoded:(n.qpSum-c.lastQpSum)/(n.framesEncoded-c.lastFrameCount)}if(this.lastEncoderMs.set(n.ssrc,{lastFrameCount:n.framesEncoded,lastEncoderTime:n.totalEncodeTime,lastQpSum:n.qpSum,lts:Date.now()}),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),n.mediaSourceId&&this.processVideoMediaSource(n.mediaSourceId,i),this.processVideoTrackSenderStats(n,n.trackId,i),n.remoteId)this.processRemoteInboundStats(n.remoteId,i);else{const c=this.findRemoteStatsId(n.ssrc,Sr.REMOTE_INBOUND);c&&this.processRemoteInboundStats(c,i)}}processAudioOutboundStats(n){let i=this._stats.audioSend.find(s=>s.ssrc===n.ssrc);if(i||(i=ms(hm),this._stats.audioSend.push(i)),i.ssrc=n.ssrc,i.packets=n.packetsSent,i.bytes=n.bytesSent,n.mediaSourceId&&this.processAudioMediaSource(n.mediaSourceId,i),n.codecId&&(i.codec=this.getCodecFromCodecStats(n.codecId)),this.processAudioTrackSenderStats(n,n.trackId,i),n.remoteId)this.processRemoteInboundStats(n.remoteId,i);else{const s=this.findRemoteStatsId(n.ssrc,Sr.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,i)}}findRemoteStatsId(n,i){var s;const c=Array.from(Vs(s=this.report).call(s)).find(d=>d.type===i&&d.ssrc===n);return c?c.id:null}processVideoMediaSource(n,i){const s=this.report.get(n);s&&s.width&&s.height&&s.framesPerSecond&&(i.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(n,i){const s=this.report.get(n);s&&(i.inputLevel=s.audioLevel)}processVideoTrackSenderStats(n,i,s){var c,d,h,p;const m=i?this.report.get(i):void 0,_=null!==(c=null==m?void 0:m.framesSent)&&void 0!==c?c:n.framesSent;if("number"!=typeof _)return;let E=null!==(d=null==m?void 0:m.frameWidth)&&void 0!==d?d:n.frameWidth,v=null!==(h=null==m?void 0:m.frameHeight)&&void 0!==h?h:n.frameHeight,S=null!==(p=null==m?void 0:m.framesPerSecond)&&void 0!==p?p:n.framesPerSecond;if("number"==typeof E&&"number"==typeof v||(E=0,v=0),null==S){const b=Date.now(),O=this.lastVideoFramesSent.get(s.ssrc);O&&b-O.lts>=800?(S=Math.round((_-O.count)/((b-O.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:b,rate:S})):O?S=O.rate:this.lastVideoFramesSent.set(s.ssrc,{count:_,lts:b,rate:0})}s.sentFrame={width:E,height:v,frameRate:Math.max(0,S)}}processVideoTrackReceiverStats(n,i,s){var c,d,h,p,m;const _=i?this.report.get(i):void 0,E=null!==(c=null==_?void 0:_.framesReceived)&&void 0!==c?c:n.framesReceived,v=null!==(d=null==_?void 0:_.frameWidth)&&void 0!==d?d:n.frameWidth,S=null!==(h=null==_?void 0:_.frameHeight)&&void 0!==h?h:n.frameHeight,b=null!==(p=null==_?void 0:_.jitterBufferDelay)&&void 0!==p?p:n.jitterBufferDelay,O=null!==(m=null==_?void 0:_.jitterBufferEmittedCount)&&void 0!==m?m:n.jitterBufferEmittedCount;if("number"==typeof E){const P=this.lastVideoFramesRecv.get(s.ssrc),w=Date.now();s.framesReceivedCount=E;let M=0;P&&w-P.lts>=800?(M=Math.round((E-P.count)/((w-P.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:w,rate:M})):P?M=P.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:w,rate:0}),s.receivedFrame={width:v||0,height:S||0,frameRate:M||0},s.decodedFrame={width:v||0,height:S||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:v||0,height:S||0,frameRate:s.decodeFrameRate||0}}if(b&&O){const P=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let w=P.jitterBufferMs;const M=O-P.jitterBufferEmittedCount;M>0&&(w=1e3*(b-P.jitterBufferDelay)/M),s.jitterBufferMs=w,s.currentDelayMs=Math.round(w),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:O,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(n,i,s){var c,d,h,p;const m=i?this.report.get(i):void 0,_=null!==(c=null!==(d=null==m?void 0:m.echoReturnLoss)&&void 0!==d?d:n.echoReturnLoss)&&void 0!==c?c:0,E=null!==(h=null!==(p=null==m?void 0:m.echoReturnLossEnhancement)&&void 0!==p?p:n.echoReturnLossEnhancement)&&void 0!==h?h:0;s.aecReturnLoss=_,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(n,i,s){var c,d,h,p,m,_,E;const v=i?this.report.get(i):void 0,S=null!==(c=null==v?void 0:v.removedSamplesForAcceleration)&&void 0!==c?c:n.removedSamplesForAcceleration,b=null!==(d=null==v?void 0:v.totalSamplesReceived)&&void 0!==d?d:n.totalSamplesReceived,O=null!==(h=null==v?void 0:v.jitterBufferDelay)&&void 0!==h?h:n.jitterBufferDelay,P=null!==(p=null==v?void 0:v.jitterBufferEmittedCount)&&void 0!==p?p:n.jitterBufferEmittedCount,w=null!==(m=null==v?void 0:v.audioLevel)&&void 0!==m?m:null==n?void 0:n.audioLevel,M=null!==(_=null==v?void 0:v.totalSamplesDuration)&&void 0!==_?_:null==n?void 0:n.totalSamplesDuration,V=null!==(E=null==v?void 0:v.concealedSamples)&&void 0!==E?E:n.concealedSamples;if(S&&b&&(s.accelerateRate=S/b),O&&P){const Y=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ie=Y.jitterBufferMs;const K=P-Y.jitterBufferEmittedCount;K>0&&(ie=1e3*(O-Y.jitterBufferDelay)/K),s.jitterBufferMs=Math.round(ie),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:O,jitterBufferEmittedCount:P,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=w;let U=1920;M&&b&&(U=b/M/50,s.receivedFrames=Math.round(b/U)),V&&(s.droppedFrames=Math.round(V/U))}processRemoteInboundStats(n,i){const s=this.report.get(n);s&&(i.packetsLost=s.packetsLost,s.roundTripTime&&(i.rttMs=1e3*s.roundTripTime),s.jitter&&(i.jitterMs=1e3*s.jitter),s.timestamp&&(i.timestamp=s.timestamp))}getCodecFromCodecStats(n){const i=this.report.get(n);if(!i)return"";const s=i.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let n=0,i=null,s=null;this.mediaBytesSent.forEach(d=>{n+=d.diffMean()}),this.mediaBytesRetransmit.forEach(d=>{i=null===i?d.diffMean():i+d.diffMean()}),this.mediaBytesTargetEncode.forEach(d=>{s=null===s?d.diffMean():s+d.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==i?n-i:n)/(this.options.updateInterval/1e3),transmit:8*n/(this.options.updateInterval/1e3)},null!==i&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),null!==s&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}}class gO extends pm{updateStats(){return z.resolve()}}function _m(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const d=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return d?d<76?new _O(o,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new mm(o,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):(h=o,window.RTCStatsReport&&h.getStats()instanceof z?new mm(o,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}):new gO(o,{updateInterval:n,lossRateInterval:i,freezeRateLimit:s,firstVideoDecodedTimeout:c}));var h}function bT(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function TT(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?bT(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):bT(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Kn extends Df{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(n,i){super(n,i),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"statsFilter",void 0),C(this,"useRTX",!1),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"establishPromise",void 0),C(this,"mutex",new ni("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(Kn.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=_m(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var n=this;return L(function*(){try{const i=yield n.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Aa(i.sdp),c=vT(i.sdp,{filterRTX:!n.useRTX,filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return n.localCapabilities=c,n.initialOffer=i,TT(TT({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:c},offerSDP:i.sdp})}catch(i){throw new Q(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}})()}connect(n,i,s,c,d,h){var p=this;return L(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{constructor(_){C(this,"sessionDesc",void 0),C(this,"localCapabilities",void 0),C(this,"rtpCapabilities",void 0),C(this,"candidates",void 0),C(this,"iceParameters",void 0),C(this,"dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),_=Mn(_);const{remoteIceParameters:E,remoteDtlsParameters:v,candidates:S,remoteRTPCapabilities:b,remoteSetup:O,localCapabilities:P,cname:M}=_,V=un.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=b,this.candidates=S,this.iceParameters=E,this.dtlsParameters=v,this.setup=O,this.localCapabilities=P,this.cname=M;for(let U=0;U<V.mediaDescriptions.length;U++){const Y=V.mediaDescriptions[U];Y.attributes.iceUfrag=E.iceUfrag,Y.attributes.icePwd=E.icePwd,Y.attributes.fingerprints=v.fingerprints,Y.attributes.candidates=S,Y.attributes.setup=O,"video"===Y.media.mediaType&&(Y.media.fmts=b.videoCodecs.map(ie=>ie.payloadType.toString(10)),Y.attributes.payloads=b.videoCodecs,Y.attributes.extmaps=b.videoExtensions),"audio"===Y.media.mediaType&&(Y.media.fmts=b.audioCodecs.map(ie=>ie.payloadType.toString(10)),Y.attributes.payloads=b.audioCodecs,Y.attributes.extmaps=b.audioExtensions),V.mediaDescriptions[U]=this.mungMediaDesc(Y)}this.sessionDesc=V,this.currentMidIndex=V.mediaDescriptions.length-1}toString(){return un.print(this.sessionDesc)}send(_,E,v){const{ssrcs:S,ssrcGroups:b}=Lr(E,this.cname),O=this.sessionDesc.mediaDescriptions.find(M=>_===fe.VIDEO?"video"===M.media.mediaType:"audio"===M.media.mediaType),P=S[0].attributes.label,w=S[0].attributes.mslabel;return O.attributes.ssrcs=O.attributes.ssrcs.concat(S),O.attributes.ssrcGroups=O.attributes.ssrcGroups.concat(b),{id:P,mslabel:w}}batchSend(_){return _.map(E=>{let{kind:v,ssrcMsg:S}=E;return this.send(v,S,void 0)})}stopSending(_){this.sessionDesc.mediaDescriptions.forEach(E=>{const v=[],S=[],b=[];E.attributes.ssrcs.forEach(O=>{Re(_).call(_,O.attributes.label||"")?b.push(O):v.push(O)}),E.attributes.ssrcGroups.forEach(O=>{var P;Re(P=b.map(w=>w.ssrcId)).call(P,O.ssrcIds[0])||S.push(O)}),E.attributes.ssrcs=v,E.attributes.ssrcGroups=S})}mute(_){const E=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===_);if(!E)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(_){const E=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===_);if(!E)throw new Error("mediaDescription not found with ".concat(_," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}receive(_,E,v){_.forEach((S,b)=>{const O=S._mediaStreamTrack,P=this.sessionDesc.mediaDescriptions.findIndex(M=>M.attributes.mid===O.kind),w=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[P],S);this.sessionDesc.mediaDescriptions[P]=w})}stopReceiving(_){}updateCandidates(_){_===Si.TCP?this.candidates.forEach(E=>{-1===this.candidates.findIndex(v=>"tcp"===v.transport&&v.connectionAddress===E.connectionAddress&&v.port===E.port)&&this.candidates.push(pv(pv({},E),{},{foundation:"tcpcandidate",priority:Number(E.priority)-1+"",transport:"tcp",port:Number(E.port)+90+""}))}):this.candidates=this.candidates.filter(E=>"tcp"!==E.transport);for(const E of this.sessionDesc.mediaDescriptions)E.attributes.candidates=this.candidates}restartICE(_){_=Mn(_),this.iceParameters=_,this.sessionDesc.mediaDescriptions.forEach(E=>{E.attributes.iceUfrag=_.iceUfrag,E.attributes.icePwd=_.icePwd})}predictReceivingMids(_){const E=[];for(let v=0;v<_;v++)E.push((this.currentMidIndex+v+1).toString(10));return E}mungRecvMediaDsec(_,E){const v=Mn(_);return Id(v,E),Ah(v,E),v}updateRecvMedia(_,E){const v=this.sessionDesc.mediaDescriptions.findIndex(S=>S.attributes.mid===_);if(-1!==v){const S=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],E);this.sessionDesc.mediaDescriptions[v]=S}}bumpMid(_){this.currentMidIndex+=_}updateTrackLabel(_,E,v){const S=this.sessionDesc.mediaDescriptions.find(O=>_===fe.VIDEO?"video"===O.attributes.mid:"audio"===O.attributes.mid);if(S){const O=S.attributes.ssrcs.find(P=>P.attributes.label===E);var b;O&&(O.attributes.label=v,null===(b=O.attributes.msid)||void 0===b||b.replace(E,v))}}mungMediaDesc(_){const E=Mn(_);return lm(E),function(v){const S=v.attributes.extmaps.find(b=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===b.extensionName);S&&v.attributes.extmaps.splice(v.attributes.extmaps.indexOf(S),1),v.attributes.payloads.forEach(b=>{const O=b.rtcpFeedbacks.findIndex(P=>"transport-cc"===P.type);-1!==O&&b.rtcpFeedbacks.splice(O,1)})}(E),E}getSSRC(_){for(const E of this.sessionDesc.mediaDescriptions)for(const v of E.attributes.ssrcs)if(v.attributes.label===_)return[v]}}({remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c.send,remoteSetup:d,localCapabilities:p.localCapabilities,sdkCodec:p.store.codec,cname:h});const m=p.remoteSDP.toString();yield p.peerConnection.setLocalDescription(p.initialOffer),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(n,i){var s=this;return fs(function*(){const c=yield dt(s.mutex.lock());try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=n.map(S=>s.peerConnection.addTrack(S._mediaStreamTrack)),h=yield dt(s.peerConnection.createOffer()),p=un.parse(h.sdp),m=n.map(S=>{const b=S._mediaStreamTrack,O=p.mediaDescriptions.find(P=>P.attributes.mid===b.kind);if(!O)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,w,M){const V=P.attributes.ssrcs.filter(Y=>Y.attributes.label===w),U=P.attributes.ssrcGroups;if(0===V.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(U&&V.length>1){const Y=U.find(ie=>-1!==ie.ssrcIds.indexOf(V[0].ssrcId));return Y?[{ssrcId:Y.ssrcIds[0],rtx:M?Y.ssrcIds[1]:void 0}]:[{ssrcId:V[0].ssrcId}]}return[{ssrcId:V[0].ssrcId}]}(O,b.id,s.useRTX)});let _;try{_=yield m}catch(S){throw d.forEach(b=>{or()&&b.replaceTrack(null),s.peerConnection.removeTrack(b)}),S}const E=s.mungSendOfferSDP(h.sdp,n);s.remoteSDP.receive(n,i,_);const v=s.remoteSDP.toString();return yield dt(s.peerConnection.setLocalDescription({type:"offer",sdp:E})),yield dt(s.applySendEncodings(d,n)),yield dt(s.peerConnection.setRemoteDescription({type:"answer",sdp:v})),n.map((S,b)=>({localSSRC:m[b],id:S._mediaStreamTrack.id}))}catch(d){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}})()}stopSending(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=i.peerConnection.getSenders().filter(h=>{var p;return-1!==n.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(h=>{or()&&h.replaceTrack(null),i.peerConnection.removeTrack(h)});const c=yield i.peerConnection.createOffer();yield i.peerConnection.setLocalDescription(c),i.remoteSDP.stopReceiving(n);const d=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}})()}receive(n,i,s,c){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:h,mslabel:p}=d.remoteSDP.send(n,i,c),m=new z((v,S)=>{const b=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(h)))},1e4),O=P=>{const w=lt();if(("Safari"===w.name&&11===Number(w.version)||hi())&&P.track.id!==h&&P.streams[0].id===p){var M;const V=P.streams[0].getTracks()[0];return null===(M=d.remoteSDP)||void 0===M||M.updateTrackLabel(n,h,P.track.id),d.peerConnection.removeEventListener("track",O),clearTimeout(b),void v(V)}if(P.track.id===h)return d.peerConnection.removeEventListener("track",O),clearTimeout(b),void v(P.track)};d.peerConnection.addEventListener("track",O)}),_=d.remoteSDP.toString();yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const E=yield d.peerConnection.createAnswer();return yield d.peerConnection.setLocalDescription(E),{track:yield m,id:h}}catch(h){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}stopReceiving(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(n);const s=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=yield i.peerConnection.createAnswer();yield i.peerConnection.setLocalDescription(c)}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){return L(function*(){})()}unmuteRemote(n){return L(function*(){})()}muteLocal(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getSenders().filter(c=>{var d;return-1!==n.indexOf((null===(d=c.track)||void 0===d?void 0:d.id)||"")});if(s.length!==n.length)throw new Error("sender' length doesn't match mids' length.");s.map(c=>{if(or()&&c.track)c.track.enabled=!1;else{const d=c.getParameters();d.encodings.forEach(h=>h.active=!1),c.setParameters(d)}})}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getSenders().filter(h=>{var p;return-1!==n.indexOf((null===(p=h.track)||void 0===p?void 0:p.id)||"")});if(s.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");s.map(function(){var h=L(function*(p){if(or()&&p.track)p.track.enabled=!0;else{const m=p.getParameters();m.encodings.forEach(_=>_.active=!0),yield p.setParameters(m)}});return function(p){return h.apply(this,arguments)}}());const c=yield i.peerConnection.createOffer();yield i.peerConnection.setLocalDescription(c);const d=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var i=this;return fs(function*(){const s=yield dt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ge().supportPCSetConfiguration){const m=i.peerConnection.getConfiguration(),_=n===Si.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(T.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,i.peerConnection.setConfiguration(m))}else if(n===Si.RELAY)return;n!==Si.RELAY&&i.remoteSDP.updateCandidates(n);const c=yield dt(i.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Aa(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const p=i.remoteSDP.toString();yield dt(i.peerConnection.setLocalDescription(c)),yield dt(i.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){T.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,i){var s=this;return L(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[i]);s.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const h=s.remoteSDP.toString();yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Q(k.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,i){var s=this;return L(function*(){const c=s.peerConnection.getSenders().filter(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===n});1===c.length&&(yield s.applySendEncodings(c,[i]))})()}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}replaceTrack(n,i){var s=this;return L(function*(){const c=s.peerConnection.getSenders().find(d=>{var h;return(null===(h=d.track)||void 0===h?void 0:h.id)===i});c&&(yield c.replaceTrack(n._mediaStreamTrack))})()}createDataChannels(n,i){throw new Q(k.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new Q(k.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(zu(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Kn.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Kn.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}updateRtpSenderEncodings(n,i){var s=this;return L(function*(){var c;if(i||(i=s.peerConnection.getSenders().find(E=>{var v;return(null===(v=E.track)||void 0===v?void 0:v.id)===n._mediaStreamTrack.id})),!i)return T.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!Ge().supportSetRtpSenderParameters)return T.warn("Browser not support set rtp-sender parameters");const d={},h={};if(n instanceof We)switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(B("DSCP_TYPE")&&$c()){var p;const E=B("DSCP_TYPE");Re(p=["very-low","low","medium","high"]).call(p,E)&&(h.networkPriority=E)}const m=i.getParameters(),_=null===(c=m.encodings)||void 0===c?void 0:c[0];_&&Object.assign(_,h),Object.assign(m,d),T.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),yield i.setParameters(m)})()}applySendEncodings(n,i){var s=this;return L(function*(){try{if(!Ge().supportSetRtpSenderParameters||n.length!==i.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=i[c];d&&h&&(yield s.updateRtpSenderEncodings(h,d))}}catch(c){T.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,i){const s=un.parse(n);return i.forEach((c,d)=>{const h=c._mediaStreamTrack,p=s.mediaDescriptions.find(m=>m.attributes.mid===h.kind);p&&Id(p,c)}),un.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}batchReceive(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=i.remoteSDP.batchSend(n).map((h,p)=>{let{id:m,mslabel:_}=h;const{kind:E}=n[p];return new z((v,S)=>{const b=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(m)))},1e4),O=P=>{const w=lt();if("Safari"===w.name&&11===Number(w.version)&&P.track.id!==m&&P.streams[0].id===_){var M;const V=P.streams[0].getTracks()[0];return null===(M=i.remoteSDP)||void 0===M||M.updateTrackLabel(E,m,P.track.id),i.peerConnection.removeEventListener("track",O),clearTimeout(b),void v({track:V,id:m})}if(P.track.id===m)return i.peerConnection.removeEventListener("track",O),clearTimeout(b),void v({track:P.track,id:m})};i.peerConnection.addEventListener("track",O)})}),c=i.remoteSDP.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=yield i.peerConnection.createAnswer();return yield i.peerConnection.setLocalDescription(d),yield z.all(s)}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}getRemoteSSRC(n){var i=this;return L(function*(){if(!i.remoteSDP)return;const s=i.remoteSDP.getSSRC(n);return null==s?void 0:s[0].ssrcId})()}setConfiguration(n){if(Ge().supportPCSetConfiguration){const i=Kn.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}}function to(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=L(function*(){const c=this.mutex,d=yield c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function gm(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Sc(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?gm(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):gm(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([to,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],Kn.prototype,"connect",null),te([to,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Kn.prototype,"stopSending",null),te([to,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",z)],Kn.prototype,"receive",null),te([to,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Kn.prototype,"stopReceiving",null),te([to,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Kn.prototype,"muteRemote",null),te([to,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Kn.prototype,"unmuteRemote",null),te([to,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Kn.prototype,"muteLocal",null),te([to,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Kn.prototype,"unmuteLocal",null),te([to,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Kn.prototype,"close",null),te([to,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],Kn.prototype,"updateEncoderConfig",null),te([to,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],Kn.prototype,"updateSendParameters",null),te([to,N("design:type",Function),N("design:paramtypes",[zn,String]),N("design:returntype",z)],Kn.prototype,"replaceTrack",null),te([to,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Kn.prototype,"getRemoteSSRC",null);function vm(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Ad(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?vm(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):vm(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}let mi=class h0 extends Df{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return null!==(n=null===(i=this.peerConnection.getReceivers()[0])||void 0===i||null===(i=i.transport)||void 0===i?void 0:i.state)&&void 0!==n?n:null}constructor(n,i){super(n,i),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",B("USE_XR")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new ni("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(h0.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=_m(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(){var n=this;return L(function*(){try{n.peerConnection.addTransceiver("video",{direction:"recvonly"}),n.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=yield n.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Aa(i.sdp),c=yield pO({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC")},{useXR:n.useXR});return n.localCapabilities=fO(c),n.initialOffer=i,Ad(Ad({},s),{},{rtpCapabilities:c,offerSDP:i.sdp})}catch(i){throw new Q(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}})()}connect(n,i,s,c,d,h){var p=this;return L(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");p.remoteSDP=new class{get localCapabilities(){return Mn(this._localCapabilities)}get rtpCapabilities(){return Mn(this._rtpCapabilities)}get candidates(){return Mn(this._candidates)}get iceParameters(){return Mn(this._iceParameters)}get dtlsParameters(){return Mn(this._dtlsParameters)}constructor(O){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),O=Mn(O);const{remoteIceParameters:P,remoteDtlsParameters:w,candidates:M,remoteRTPCapabilities:V,remoteSetup:U,localCapabilities:Y,cname:ie}=O,K=un.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=V,this._candidates=M,this._iceParameters=P,this._dtlsParameters=w,this._localCapabilities=Y,this.setup=U,this.cname=ie;const X=this.rtpCapabilities.send;for(const $ of K.mediaDescriptions){if($.attributes.iceUfrag=P.iceUfrag,$.attributes.icePwd=P.icePwd,$.attributes.fingerprints=w.fingerprints,$.attributes.candidates=M,$.attributes.setup=U,"video"===$.media.mediaType&&($.media.fmts=X.videoCodecs.map(J=>J.payloadType.toString(10)),$.attributes.payloads=X.videoCodecs,$.attributes.extmaps=X.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:J,ssrcGroups:ge}=Lr([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);$.attributes.ssrcs=J,$.attributes.ssrcGroups=ge}if("audio"===$.media.mediaType&&($.media.fmts=X.audioCodecs.map(J=>J.payloadType.toString(10)),$.attributes.payloads=X.audioCodecs,$.attributes.extmaps=X.audioExtensions,fl($),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:J,ssrcGroups:ge}=Lr([{ssrcId:2e4}],this.cname);$.attributes.ssrcs=J,$.attributes.ssrcGroups=ge}}this.sessionDesc=K,this.currentMidIndex=K.mediaDescriptions.length-1}preloadRemoteMedia(){const O=B("PRELOAD_MEDIA_COUNT"),P=this.candidates,w=this.dtlsParameters,M=this.iceParameters,V=this.rtpCapabilities.send;for(let U=1;U<O;U++){const Y=2*U+2e4,ie=2*U+4e4,{ssrcs:K,ssrcGroups:X}=Lr([{ssrcId:Y}],this.cname),{ssrcs:$,ssrcGroups:J}=Lr([{ssrcId:ie,rtx:B("USE_SUB_RTX")?ie+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:V.videoCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:M.iceUfrag,icePwd:M.icePwd,unrecognized:[],candidates:P,extmaps:V.videoExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:J,rtcpFeedbackWildcards:[],payloads:V.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:V.audioCodecs.map(ge=>ge.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:M.iceUfrag,icePwd:M.icePwd,unrecognized:[],candidates:P,extmaps:V.audioExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:K,ssrcGroups:X,rtcpFeedbackWildcards:[],payloads:V.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*U+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return un.print(this.sessionDesc)}send(O,P,w,M){const{ssrcs:V,ssrcGroups:U}=Lr(P,this.cname,B("SYNC_GROUP")?w:void 0),Y=this.findPreloadMediaDesc(V);if(Y){if(Bt()&&this.firefoxSsrcMidMap.set(V[0].ssrcId,Y.attributes.mid),M&&(M.twcc||M.remb)){const ie=this.sessionDesc.mediaDescriptions.indexOf(Y);return this.sessionDesc.mediaDescriptions[ie]=this.mungSendMediaDesc(Y,M),{mid:Y.attributes.mid,needExchangeSDP:!0}}return{mid:Y.attributes.mid,needExchangeSDP:!1}}{const ie=this.findAvailableMediaIndex(O,V);let K;return-1===ie||1===ie&&(or()||gC())||0===ie&&B("USE_SUB_RTX")||EC()?(K=this.createOrRecycleSendMedia(O,V,U,"sendonly",M),this.updateBundleMids()):(K=Mn(this.sessionDesc.mediaDescriptions[ie]),K.attributes.direction="sendonly",K.attributes.ssrcs=V,K.attributes.ssrcGroups=U,this.sessionDesc.mediaDescriptions[ie]=this.mungSendMediaDesc(K,M)),Bt()&&this.firefoxSsrcMidMap.set(V[0].ssrcId,K.attributes.mid),{mid:K.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:O,needExchangeSDP:P}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:O.attributes.mid,needExchangeSDP:P}}batchSend(O){const P=O.map(V=>{let{kind:U,ssrcMsg:Y,mslabel:ie}=V;return this.send(U,Y,ie)}),w=[];let M=!1;return P.forEach(V=>{let{mid:U,needExchangeSDP:Y}=V;Y&&(M=!0),w.push(U)}),{mids:w,needExchangeSDP:M}}stopSending(O){const P=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&-1!==O.indexOf(w.attributes.mid));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");P.forEach(w=>{"0"===w.attributes.mid||Bt()||EC()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")}),this.updateBundleMids()}mute(O){const P=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===O);if(!P)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.mute."));P.attributes.direction="inactive"}unmute(O){const P=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===O);if(!P)throw new Error("mediaDescription not found with ".concat(O," in remote SDP when calling RemoteSDP.unmute."));P.attributes.direction="sendonly"}muteRemote(O){const P=this.sessionDesc.mediaDescriptions.filter(w=>Re(O).call(O,w.attributes.mid||""));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(w=>{w.attributes.direction="inactive"})}unmuteRemote(O){const P=this.sessionDesc.mediaDescriptions.filter(w=>Re(O).call(O,w.attributes.mid||""));if(P.length!==O.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(w=>{w.attributes.direction="recvonly"})}receive(O,P,w,M){O.forEach((V,U)=>{this.createOrRecycleRecvMedia(V,[],"recvonly",P,w,M[U])}),this.updateBundleMids()}stopReceiving(O){const P=this.sessionDesc.mediaDescriptions.filter(w=>-1!==O.indexOf(w.attributes.mid));if(P.length!==O.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");P.forEach(w=>{w.media.port="0",w.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(O){const P=this._candidates.filter(w=>"udp"===w.transport);if(O===Si.TCP){if(0===P.length)return;if(B("TCP_CANDIDATE_ONLY")){const w=this._candidates.filter(M=>"tcp"===M.transport);P.forEach(M=>{-1===w.findIndex(V=>V.connectionAddress===M.connectionAddress)&&w.push(Sc(Sc({},M),{},{foundation:"tcpcandidate",priority:Number(M.priority)-1+"",transport:"tcp",port:Number(M.port)+90+""}))}),this._candidates=w}else{const w=[];P.forEach(M=>{w.push(Sc(Sc({},M),{},{foundation:"tcpcandidate",priority:Number(M.priority)-1+"",transport:"tcp",port:Number(M.port)+90+""}))}),this._candidates=[...P,...w]}}else if(O===Si.RELAY){if(0!==P.length)return;{const w=this._candidates.filter(M=>"tcp"===M.transport);w.forEach(M=>{P.push(Sc(Sc({},M),{},{foundation:"udpcandidate",priority:Number(M.priority)+1+"",transport:"udp",port:Number(M.port)-90+""}))}),this._candidates=[...P,...w]}}else 0===P.length?(this._candidates.filter(w=>"tcp"===w.transport).forEach(w=>{P.push(Sc(Sc({},w),{},{foundation:"udpcandidate",priority:Number(w.priority)+1+"",transport:"udp",port:Number(w.port)-90+""}))}),this._candidates=P):this._candidates=this._candidates.filter(w=>"tcp"!==w.transport);for(const w of this.sessionDesc.mediaDescriptions)w.attributes.candidates=this.candidates}restartICE(O){O=Mn(O),this._iceParameters=O,this.sessionDesc.mediaDescriptions.forEach(P=>{P.attributes.iceUfrag=O.iceUfrag,P.attributes.icePwd=O.icePwd})}predictReceivingMids(O){const P=[];for(let w=0;w<O;w++)P.push((this.currentMidIndex+w+1).toString(10));return P}findAvailableMediaIndex(O,P){return this.sessionDesc.mediaDescriptions.findIndex(w=>{const M=w.media.mediaType===O&&"0"!==w.media.port&&("sendonly"===w.attributes.direction||"sendrecv"===w.attributes.direction)&&0===w.attributes.ssrcs.length;if(Bt()){if(M){const V=this.firefoxSsrcMidMap.get(P[0].ssrcId);return!(V||"0"!==w.attributes.mid&&"1"!==w.attributes.mid)||!(!V||V!==w.attributes.mid)}return!1}return M})}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if("application"===w.media.mediaType)return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const O="".concat(this.currentMidIndex),P={media:{mediaType:"application",port:"9",protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(O),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(P),{mediaDesc:P,needExchangeSDP:!0}}createOrRecycleRecvMedia(O,P,w,M,V,U){const Y=O._mediaStreamTrack.kind,ie=this.rtpCapabilities.recv,K=this.localCapabilities.send;let X=[];if(Y===fe.VIDEO){var $,J;if(B("H264_PROFILE_LEVEL_ID")&&"h264"===M&&(X=ie.videoCodecs.filter(St=>{var st,Ct,ee;return Re(st=(null===(Ct=St.rtpMap)||void 0===Ct?void 0:Ct.encodingName.toLowerCase())||"").call(st,M)&&(null==St||null===(ee=St.fmtp)||void 0===ee?void 0:ee.parameters["profile-level-id"])===B("H264_PROFILE_LEVEL_ID")})),!X||0===(null===($=X)||void 0===$?void 0:$.length)){const St=K.videoCodecs.filter(st=>{var Ct,ee;return Re(Ct=(null===(ee=st.rtpMap)||void 0===ee?void 0:ee.encodingName.toLowerCase())||"").call(Ct,M)});0!==St.length&&(X=ie.videoCodecs.filter(st=>St.some(Ct=>Ct.payloadType===st.payloadType)))}if(B("USE_PUB_RTX")){const St=X.map(Ct=>Ct.payloadType.toString()),st=ie.videoCodecs.filter(Ct=>{var ee,ae;return"rtx"===(null===(ee=Ct.rtpMap)||void 0===ee?void 0:ee.encodingName)&&Re(St).call(St,(null===(ae=Ct.fmtp)||void 0===ae?void 0:ae.parameters.apt)||"")});X=[...X,...st]}0===X.length&&(T.warning("codec ".concat(M," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(J=ie.videoCodecs[0].rtpMap)||void 0===J?void 0:J.encodingName)),X=ie.videoCodecs)}else X=ie.audioCodecs.filter(St=>{var st,Ct;return Re(st=(null===(Ct=St.rtpMap)||void 0===Ct?void 0:Ct.encodingName.toLowerCase())||"").call(st,V)}),0===X.length&&(T.warning("codec ".concat(V," not included in rtpCapabilities, fallback to opus")),X=ie.audioCodecs.filter(St=>{var st,Ct;return Re(st=(null===(Ct=St.rtpMap)||void 0===Ct?void 0:Ct.encodingName.toLowerCase())||"").call(st,"opus")}));const ge=Y===fe.VIDEO?ie.videoExtensions:ie.audioExtensions;this.currentMidIndex+=1;const Ee="".concat(this.currentMidIndex);let ze={media:{mediaType:Y,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:X.map(St=>St.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ge,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:X,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Ee)}};ze=this.mungRecvMediaDsec(ze,O,U);const ht=this.findFirstClosedMedia(Y);if(ht){const St=this.sessionDesc.mediaDescriptions.indexOf(ht);this.sessionDesc.mediaDescriptions[St]=ze}else this.sessionDesc.mediaDescriptions.push(ze);return ze}createOrRecycleSendMedia(O,P,w,M,V){const U=this.rtpCapabilities.send,Y=O===fe.VIDEO?U.videoCodecs:U.audioCodecs,ie=O===fe.VIDEO?U.videoExtensions:U.audioExtensions;this.currentMidIndex+=1;const K="".concat(this.currentMidIndex);let X={media:{mediaType:O,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(J=>J.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ie,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:M,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(K)}};X=this.mungSendMediaDesc(X,V);const $=this.findFirstClosedMedia(O);if($){const J=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[J]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(O=>"0"!==O.media.port).map(O=>O.attributes.mid)}mungRecvMediaDsec(O,P,w){const M=Mn(O);return lm(M),Id(M,P),Ah(M,P),hO(M),lv(M,w,this.localCapabilities.send),M}mungSendMediaDesc(O,P){const w=Mn(O);return lv(w,P,this.localCapabilities.recv),fl(w),w}updateRecvMedia(O,P){const w=this.sessionDesc.mediaDescriptions.findIndex(M=>M.attributes.mid===O);if(-1!==w){const M=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],P);this.sessionDesc.mediaDescriptions[w]=M}}bumpMid(O){this.currentMidIndex+=O}findFirstClosedMedia(O){return this.sessionDesc.mediaDescriptions.find(P=>Bt()?"0"===P.media.port&&P.media.mediaType===O:"0"===P.media.port)}findPreloadMediaDesc(O){return this.sessionDesc.mediaDescriptions.find(P=>{var w;return(null===(w=P.attributes)||void 0===w||null===(w=w.ssrcs[0])||void 0===w?void 0:w.ssrcId)===O[0].ssrcId})}getSSRC(O){var P;return null===(P=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===O))||void 0===P?void 0:P.attributes.ssrcs}}({remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,remoteSetup:d,localCapabilities:p.localCapabilities,cname:h});const m=p.remoteSDP.toString(),_=un.parse(p.initialOffer.sdp),E=_.mediaDescriptions.find(O=>"audio"===O.media.mediaType);E&&fl(E),p.useXR&&dm(_);const v=un.print(_),S=p.logSDPExchange(v||"","offer","local","connect");p.store.descriptionStart(),yield p.peerConnection.setLocalDescription({type:"offer",sdp:v}),null==S||S(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m});const b=p.peerConnection.getTransceivers()[0];if(null!=b&&b.receiver&&p.tryBindTransportEvents(b.receiver),B("PRELOAD_MEDIA_COUNT")>0){p.remoteSDP.preloadRemoteMedia();const O=p.remoteSDP.toString();yield p.peerConnection.setRemoteDescription({type:"offer",sdp:O});const P=yield p.peerConnection.createAnswer();yield p.peerConnection.setLocalDescription(P)}}catch(m){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(m.toString()))}})()}send(n,i,s){var c=this;return fs(function*(){const d=yield dt(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[];n.forEach(P=>{const w=c.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(w),P._updateRtpTransceiver(w)}),Bt()&&!0===B("SIMULCAST")&&(yield dt(c.applySimulcastForFirefox(h,n)));const p=yield dt(c.peerConnection.createOffer()),m=c.remoteSDP.predictReceivingMids(n.length),_=c.mungSendOfferSDP(p.sdp,n,m),E=un.parse(_),v=m.map(P=>{const w=E.mediaDescriptions.find(M=>M.attributes.mid===P);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return wh(w,B("USE_PUB_RTX"))});let S;try{S=yield v}catch(P){S=[],c.remoteSDP.receive(n,i,s,S);const w=c.remoteSDP.toString();throw yield dt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield dt(c.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield dt(c.stopSending(m,!0)),P}c.remoteSDP.receive(n,i,s,S);const b=c.remoteSDP.toString(),O=c.logSDPExchange(_,"offer","local","send");return yield dt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield dt(c.applySimulcastEncodings(h,n)),yield dt(c.applySendEncodings(h,n)),null==O||O(b),yield dt(c.peerConnection.setRemoteDescription({type:"answer",sdp:b})),h.map((P,w)=>({localSSRC:v[w],id:m[w],transceiver:P}))}catch(h){throw h instanceof Q?h:new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}})()}createDataChannels(n,i){var s=this;return L(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let c=s.dataStreamChannelMap.get(n);c&&"open"===c.readyState?T.debug("[P2PConnection] Channels are already available and can be reused directly."):(c=s.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),c.binaryType="arraybuffer",s.dataStreamChannelMap.set(n,c)),i.forEach(h=>{h._updateOriginDataChannel(c)});const{needExchangeSDP:d}=s.remoteSDP.sendDataChannel();if(d){const h=s.remoteSDP.toString();yield s.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield s.peerConnection.createAnswer();yield s.peerConnection.setLocalDescription(p),T.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else T.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(c){throw c instanceof Q?c:new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(c.toString()))}})()}stopDataChannels(n){var i=this;return L(function*(){try{const s=i.dataStreamChannelMap.get(n);return null==s||s.close(),void i.dataStreamChannelMap.delete(n)}catch(s){throw s instanceof Q?s:new Q(k.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}})()}stopSending(n,i){var s=this;return L(function*(){const c=i?void 0:yield s.mutex.lock("From P2PConnection.stopSending");try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=s.peerConnection.getTransceivers().filter(_=>-1!==n.indexOf(_.mid));if(d.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map(_=>{var E;_.direction="inactive",null===(E=_.stop)||void 0===E||E.call(_)});const h=yield s.peerConnection.createOffer(),p=s.logSDPExchange(h.sdp||"","offer","local","stopSending");yield s.peerConnection.setLocalDescription(h),s.remoteSDP.stopReceiving(n);const m=s.remoteSDP.toString();null==p||p(m),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}receive(n,i,s,c){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(n,i,s,c);if(p){const _=d.remoteSDP.toString(),E=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=yield d.peerConnection.createAnswer(),S=d.mungReceiveAnswerSDP(v.sdp,h,n);null==E||E(S||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:S}),T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else T.debug("[".concat(d.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h,transceiver:m}}catch(h){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:c}=i.remoteSDP.batchSend(n);if(c){const d=i.remoteSDP.toString(),h=i.logSDPExchange(d,"offer","remote","receive");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield i.peerConnection.createAnswer();null==h||h(p.sdp||""),yield i.peerConnection.setLocalDescription(p),T.debug("[".concat(i.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else T.debug("[".concat(i.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return s.map(d=>{const h=i.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d,transceiver:h}})}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","stopReceiving");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();null==c||c(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));i.remoteSDP.mute(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","muteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();null==c||c(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}})()}unmuteRemote(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));i.remoteSDP.unmute(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","unmuteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();null==c||c(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}})()}muteLocal(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(p=>{p.direction="inactive"});const c=yield i.peerConnection.createOffer(),d=i.logSDPExchange(c.sdp||"","offer","local","muteLocal");yield i.peerConnection.setLocalDescription(c),i.remoteSDP.muteRemote(n);const h=i.remoteSDP.toString();null==d||d(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(function(){var p=L(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const c=yield i.peerConnection.createOffer(),d=i.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");yield i.peerConnection.setLocalDescription(c),i.remoteSDP.unmuteRemote(n);const h=i.remoteSDP.toString();null==d||d(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var i=this;return fs(function*(){const s=yield dt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ge().supportPCSetConfiguration){const _=i.peerConnection.getConfiguration(),E=n===Si.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(T.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,i.peerConnection.setConfiguration(_))}else if(n===Si.RELAY)return;i.remoteSDP.updateCandidates(n);const c=yield dt(i.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Aa(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const p=i.remoteSDP.toString(),m=i.logSDPExchange(c.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield dt(i.peerConnection.setLocalDescription(c)),null==m||m(p),yield dt(i.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){T.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{s()}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,i){var s=this;return L(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[i],[n]);s.remoteSDP.updateRecvMedia(n,i);const h=s.remoteSDP.toString(),p=s.logSDPExchange(d,"offer","local","updateEncoderConfig");yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),null==p||p(h),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new Q(k.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,i){var s=this;return L(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(i)?Bt()||(yield s.applySimulcastEncodings(c,[i])):yield s.applySendEncodings(c,[i]))})()}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}replaceTrack(n,i){var s=this;return L(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===i);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getSelectedCandidatePair(){var n=this;return L(function*(){const i=n.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:c,remote:d}=s.getSelectedCandidatePair();return{local:Ad(Ad({},_s),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port}),remote:Ad(Ad({},_s),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return n.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(zu(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...h0.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...h0.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Ge().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(om(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;null!=i&&i.state&&(null===(c=this.onDTLSTransportStateChange)||void 0===c||c.call(this,i.state))},i.onerror=c=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=null==i?void 0:i.iceTransport.state;var d;c&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(n,i){var s=this;return L(function*(){var c;if(i||(i=s.peerConnection.getSenders().find(v=>v.track===n._mediaStreamTrack)),!i)return T.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(s.isVP8Simulcast(n))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ge().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(n._encoderConfig){var p;const{bitrateMax:v,frameRate:S,scaleResolutionDownBy:b}=n._encoderConfig;v&&(h.maxBitrate=1e3*v),Re(p=n._hints).call(p,Ht.LOW_STREAM)&&(S&&(h.maxFramerate=vo(S)),b&&b>=1&&(h.scaleResolutionDownBy=b))}if(B("DSCP_TYPE")&&$c()){var m;const v=B("DSCP_TYPE");Re(m=["very-low","low","medium","high"]).call(m,v)&&(h.networkPriority=v)}const _=i.getParameters(),E=null===(c=_.encodings)||void 0===c?void 0:c[0];Bt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(_,d),T.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield i.setParameters(_)})()}applySendEncodings(n,i){var s=this;return L(function*(){try{if(!Ge().supportSetRtpSenderParameters||n.length!==i.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=i[c];h instanceof We&&!s.isVP8Simulcast(h)&&(yield s.updateRtpSenderEncodings(h,d.sender))}}catch(c){T.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,i,s){const c=un.parse(n);return i.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Id(m,d),dv(m,d,this.store.codec))}),un.print(c)}mungReceiveAnswerSDP(n,i,s){const c=un.parse(n),d=c.mediaDescriptions.find(h=>h.attributes.mid===i);return d&&(s===fe.AUDIO&&"audio"===d.media.mediaType&&fl(d),this.useXR&&dm(c)),un.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;null===(i=this.onFirstVideoDecodedTimeout)||void 0===i||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,i){var s=this;return L(function*(){if(n.length===i.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const E=n[_],v=i[_];if(v instanceof We&&!Re(c=v._hints).call(c,Ht.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const S={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,S))}}})()}applySimulcastEncodings(n,i){var s=this;return L(function*(){if(!Bt()&&n.length===i.length)for(let c=0;c<n.length;c++){const d=i[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var i,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!Re(i=n._hints).call(i,Ht.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,s,c){if(B("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,"\n"),n),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getRemoteSSRC(n){var i=this;return L(function*(){if(!i.remoteSDP)return;const s=i.remoteSDP.getSSRC(n);return null==s?void 0:s[0].ssrcId})()}setConfiguration(n){if(Ge().supportPCSetConfiguration){const i=h0.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}};function Bo(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=L(function*(){const c=this.mutex,d=yield c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function EO(o,n){let i=document.createElement("video"),s=document.createElement("canvas");i.setAttribute("style","display:none"),s.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),s.width=vo(n.width),s.height=vo(n.height);const c=vo(n.framerate||15);document.body.append(i),document.body.append(s);let d=o._mediaStreamTrack;i.srcObject=new MediaStream([d]),i.play();const h=s.getContext("2d");if(!h)throw new W(k.UNEXPECTED_ERROR,"can not get canvas context");const p=Ge(),m=s.captureStream(p.supportRequestFrame?0:c).getVideoTracks()[0];m.canvas||(m.canvas=s),s.startCapture=()=>{if(!i)return s.stopCapture&&s.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=s.width*(i.videoHeight/i.videoWidth);Math.abs(S-s.height)>=2&&(T.debug("adjust low stream resolution","".concat(s.width,"x").concat(s.height," -> ").concat(s.width,"x").concat(S)),s.height=S)}h.drawImage(i,0,0,s.width,s.height),m.requestFrame&&m.requestFrame(),d!==o._mediaStreamTrack&&(d=o._mediaStreamTrack,i.srcObject=new MediaStream([d]))},s.stopCapture=Pr(()=>s.startCapture&&s.startCapture(),c);const _=m.stop;return m.stop=()=>{_.call(m),i&&(i.remove(),i.srcObject=null,i=null),s&&(s.width=0,s.remove(),s.stopCapture&&s.stopCapture(),s.startCapture=void 0,s.stopCapture=void 0,s=null),T.debug("clean low stream renderer")},m}function fx(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function vO(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?fx(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):fx(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([Bo,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],mi.prototype,"connect",null),te([Bo,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",z)],mi.prototype,"createDataChannels",null),te([Bo,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",z)],mi.prototype,"receive",null),te([Bo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],mi.prototype,"batchReceive",null),te([Bo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],mi.prototype,"stopReceiving",null),te([Bo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],mi.prototype,"muteRemote",null),te([Bo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],mi.prototype,"unmuteRemote",null),te([Bo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],mi.prototype,"muteLocal",null),te([Bo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],mi.prototype,"unmuteLocal",null),te([Bo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],mi.prototype,"close",null),te([Bo,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],mi.prototype,"updateEncoderConfig",null),te([Bo,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],mi.prototype,"updateSendParameters",null),te([Bo,N("design:type",Function),N("design:paramtypes",[zn,String]),N("design:returntype",z)],mi.prototype,"replaceTrack",null),te([Bo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],mi.prototype,"getRemoteSSRC",null);const RT="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n";class yO{get localCapabilities(){return Mn(this._localCapabilities)}get rtpCapabilities(){return Mn(this._rtpCapabilities)}get candidates(){return Mn(this._candidates)}get iceParameters(){return Mn(this._iceParameters)}get dtlsParameters(){return Mn(this._dtlsParameters)}constructor(n){C(this,"sessionDesc",void 0),C(this,"_localCapabilities",void 0),C(this,"_rtpCapabilities",void 0),C(this,"_candidates",void 0),C(this,"_iceParameters",void 0),C(this,"_dtlsParameters",void 0),C(this,"setup",void 0),C(this,"currentMidIndex",void 0),C(this,"cname",void 0),C(this,"firefoxSsrcMidMap",new Map),n=Mn(n);const{remoteIceParameters:i,remoteDtlsParameters:s,candidates:c,remoteRTPCapabilities:d,remoteSetup:h,localCapabilities:p,cname:m}=n,_=un.parse(RT);this._rtpCapabilities=d,this._candidates=c,this._iceParameters=i,this._dtlsParameters=s,this._localCapabilities=p,this.setup=h,this.cname=m;const E=this.rtpCapabilities.send;for(const v of _.mediaDescriptions){if(v.attributes.iceUfrag=i.iceUfrag,v.attributes.icePwd=i.icePwd,v.attributes.fingerprints=s.fingerprints,v.attributes.candidates=c,v.attributes.setup=h,"application"===v.media.mediaType&&(v.attributes.sctpPort="5000"),"video"===v.media.mediaType&&(v.media.fmts=E.videoCodecs.map(S=>S.payloadType.toString(10)),v.attributes.payloads=E.videoCodecs,v.attributes.extmaps=E.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:b}=Lr([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);v.attributes.ssrcs=S,v.attributes.ssrcGroups=b}if("audio"===v.media.mediaType&&(v.media.fmts=E.audioCodecs.map(S=>S.payloadType.toString(10)),v.attributes.payloads=E.audioCodecs,v.attributes.extmaps=E.audioExtensions,fl(v),B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:S,ssrcGroups:b}=Lr([{ssrcId:2e4}],this.cname);v.attributes.ssrcs=S,v.attributes.ssrcGroups=b}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}updateRemoteRTPCapabilities(n){const i=un.parse(RT);this._rtpCapabilities=n;const s=this.rtpCapabilities.send;for(const c of i.mediaDescriptions){if(c.attributes.iceUfrag=this._iceParameters.iceUfrag,c.attributes.icePwd=this._iceParameters.icePwd,c.attributes.fingerprints=this._dtlsParameters.fingerprints,c.attributes.candidates=this._candidates,c.attributes.setup=this.setup,"application"===c.media.mediaType&&(c.attributes.sctpPort="5000"),"video"===c.media.mediaType&&(c.media.fmts=s.videoCodecs.map(d=>d.payloadType.toString(10)),c.attributes.payloads=s.videoCodecs,c.attributes.extmaps=s.videoExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Lr([{ssrcId:4e4,rtx:B("USE_SUB_RTX")?40001:void 0}],this.cname);c.attributes.ssrcs=d,c.attributes.ssrcGroups=h}if("audio"===c.media.mediaType&&(c.media.fmts=s.audioCodecs.map(d=>d.payloadType.toString(10)),c.attributes.payloads=s.audioCodecs,c.attributes.extmaps=s.audioExtensions,B("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:d,ssrcGroups:h}=Lr([{ssrcId:2e4}],this.cname);c.attributes.ssrcs=d,c.attributes.ssrcGroups=h}}this.sessionDesc=i,this.currentMidIndex=i.mediaDescriptions.length-1}preloadRemoteMedia(n){const i=this.candidates,s=this.dtlsParameters,c=this.iceParameters,d=this.rtpCapabilities.send;for(let h=1;h<n;h++){const p=2*h+2e4,m=2*h+4e4,{ssrcs:_,ssrcGroups:E}=Lr([{ssrcId:p}],this.cname),{ssrcs:v,ssrcGroups:S}=Lr([{ssrcId:m,rtx:B("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.videoCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:c.iceUfrag,icePwd:c.icePwd,unrecognized:[],candidates:i,extmaps:d.videoExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:v,ssrcGroups:S,rtcpFeedbackWildcards:[],payloads:d.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.audioCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:c.iceUfrag,icePwd:c.icePwd,unrecognized:[],candidates:i,extmaps:d.audioExtensions,fingerprints:s.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:E,rtcpFeedbackWildcards:[],payloads:d.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*h)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return un.print(this.sessionDesc)}send(n,i,s,c){const{ssrcs:d,ssrcGroups:h}=Lr(i,this.cname,B("SYNC_GROUP")?s:void 0),p=this.findPreloadMediaDesc(d);if(p){if(Bt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,p.attributes.mid),c&&(c.twcc||c.remb)){const m=this.sessionDesc.mediaDescriptions.indexOf(p);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(p,c),{mid:p.attributes.mid,needExchangeSDP:!0}}return{mid:p.attributes.mid,needExchangeSDP:!1}}{const m=this.findAvailableMediaIndex(n,d);let _;return-1===m||or()||hi()||gC()||0===m&&B("USE_SUB_RTX")?(_=this.createOrRecycleSendMedia(n,d,h,"sendonly",c),this.updateBundleMids()):(_=Mn(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=d,_.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,c)),Bt()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(n){const i=n.map(d=>{let{kind:h,ssrcMsg:p,mslabel:m}=d;return this.send(h,p,m)}),s=[];let c=!1;return i.forEach(d=>{let{mid:h,needExchangeSDP:p}=d;p&&(c=!0),s.push(h)}),{mids:s,needExchangeSDP:c}}stopSending(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&-1!==n.indexOf(s.attributes.mid));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(s=>{"0"===s.attributes.mid||Bt()||or()||hi()?s.attributes.ssrcs=[]:(s.attributes.ssrcs=[],s.attributes.direction="inactive",s.media.port="0")}),this.updateBundleMids()}mute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>Re(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>Re(n).call(n,s.attributes.mid||""));if(i.length!==n.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(s=>{s.attributes.direction="recvonly"})}receive(n,i,s,c){n.forEach((d,h)=>{this.createOrRecycleRecvMedia(d,[],"recvonly",i,s,c[h])}),this.updateBundleMids()}stopReceiving(n){const i=this.sessionDesc.mediaDescriptions.filter(s=>-1!==n.indexOf(s.attributes.mid));if(i.length!==n.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(n){n===Si.TCP?this._candidates.forEach(i=>{-1===this._candidates.findIndex(s=>"tcp"===s.transport&&s.connectionAddress===i.connectionAddress&&s.port===i.port)&&this._candidates.push(vO(vO({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this._candidates=this._candidates.filter(i=>"tcp"!==i.transport);for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(n){n=Mn(n),this._iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let s=0;s<n;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}findAvailableMediaIndex(n,i){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const c=s.media.mediaType===n&&"0"!==s.media.port&&("sendonly"===s.attributes.direction||"sendrecv"===s.attributes.direction)&&0===s.attributes.ssrcs.length;if(Bt()){if(c){const d=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(d||"0"!==s.attributes.mid&&"1"!==s.attributes.mid)||!(!d||d!==s.attributes.mid)}return!1}return c})}createOrRecycleRecvMedia(n,i,s,c,d,h){const p=n._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=this.localCapabilities.send;let E=[];if(p===fe.VIDEO){var v,S;if(B("H264_PROFILE_LEVEL_ID")&&"h264"===c&&(E=m.videoCodecs.filter(M=>{var V,U,Y;return Re(V=(null===(U=M.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,c)&&(null==M||null===(Y=M.fmtp)||void 0===Y?void 0:Y.parameters["profile-level-id"])===B("H264_PROFILE_LEVEL_ID")})),!E||0===(null===(v=E)||void 0===v?void 0:v.length)){const M=_.videoCodecs.filter(V=>{var U,Y;return Re(U=(null===(Y=V.rtpMap)||void 0===Y?void 0:Y.encodingName.toLowerCase())||"").call(U,c)});0!==M.length&&(E=m.videoCodecs.filter(V=>M.some(U=>U.payloadType===V.payloadType)))}if(B("USE_PUB_RTX")){const M=E.map(U=>U.payloadType.toString()),V=m.videoCodecs.filter(U=>{var Y,ie;return"rtx"===(null===(Y=U.rtpMap)||void 0===Y?void 0:Y.encodingName)&&Re(M).call(M,(null===(ie=U.fmtp)||void 0===ie?void 0:ie.parameters.apt)||"")});E=[...E,...V]}0===E.length&&(T.warning("codec ".concat(c," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(S=m.videoCodecs[0].rtpMap)||void 0===S?void 0:S.encodingName)),E=m.videoCodecs)}else E=m.audioCodecs.filter(M=>{var V,U;return Re(V=(null===(U=M.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,d)}),0===E.length&&(T.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),E=m.audioCodecs.filter(M=>{var V,U;return Re(V=(null===(U=M.rtpMap)||void 0===U?void 0:U.encodingName.toLowerCase())||"").call(V,"opus")}));const b=p===fe.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;const O="".concat(this.currentMidIndex);let P={media:{mediaType:p,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:E.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:b,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:E,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(O)}};P=this.mungRecvMediaDsec(P,n,h);const w=this.findFirstClosedMedia(p);if(w){const M=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[M]=P}else this.sessionDesc.mediaDescriptions.push(P);return P}createOrRecycleSendMedia(n,i,s,c,d){const h=this.rtpCapabilities.send,p=n===fe.VIDEO?h.videoCodecs:h.audioCodecs,m=n===fe.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const _="".concat(this.currentMidIndex);let E={media:{mediaType:n,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:p.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:p,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:c,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};E=this.mungSendMediaDesc(E,d);const v=this.findFirstClosedMedia(n);if(v){const S=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[S]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(n=>"0"!==n.media.port).map(n=>n.attributes.mid)}mungRecvMediaDsec(n,i,s){const c=Mn(n);return lm(c),Id(c,i),Ah(c,i),hO(c),lv(c,s,this.localCapabilities.send),c}mungSendMediaDesc(n,i){const s=Mn(n);return lv(s,i,this.localCapabilities.recv),fl(s),s}updateRecvMedia(n,i){const s=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(-1!==s){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=c}}bumpMid(n){this.currentMidIndex+=n}findFirstClosedMedia(n){return this.sessionDesc.mediaDescriptions.find(i=>Bt()?"0"===i.media.port&&i.media.mediaType===n:"0"===i.media.port)}findPreloadMediaDesc(n){return this.sessionDesc.mediaDescriptions.find(i=>{var s;return(null===(s=i.attributes)||void 0===s||null===(s=s.ssrcs[0])||void 0===s?void 0:s.ssrcId)===n[0].ssrcId})}getSSRC(n){var i;return null===(i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===n))||void 0===i?void 0:i.attributes.ssrcs}}function SO(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function ym(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?SO(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):SO(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Hi extends Df{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(n,i,s){super(n,i),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"remoteSDP",void 0),C(this,"initialOffer",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"useXR",B("USE_XR")),C(this,"localCapabilities",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"dataStreamChannelMap",new Map),C(this,"establishPromise",void 0),C(this,"mutex",new ni("NVExtentionsConnection-mutex")),C(this,"rtcMedia",void 0),this.store=i,this.peerConnection=s,this.statsFilter=_m(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}establish(n){var i=this;return L(function*(){try{const s=yield i.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Aa(s.sdp),d=yield pO({filterRTX:!B("USE_PUB_RTX")&&!B("USE_SUB_RTX"),filterVideoFec:B("FILTER_VIDEO_FEC"),filterAudioFec:B("FILTER_AUDIO_FEC")},{useXR:i.useXR});return i.localCapabilities=d,i.initialOffer=s,ym(ym({},c),{},{rtpCapabilities:d,offerSDP:s.sdp})}catch(s){throw new W(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}})()}connect(n,i,s,c,d,h){var p=this;return L(function*(){try{if(!p.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");p.remoteSDP=new yO({remoteIceParameters:n,remoteDtlsParameters:i,candidates:s,remoteRTPCapabilities:c,remoteSetup:d,localCapabilities:fO(p.localCapabilities),cname:h});const m=p.remoteSDP.toString(),_=un.parse(p.initialOffer.sdp),E=_.mediaDescriptions.find(b=>"audio"===b.media.mediaType);E&&fl(E),p.useXR&&dm(_);const v=un.print(_),S=p.logSDPExchange(v||"","offer","local","connect");yield p.peerConnection.setLocalDescription({type:"offer",sdp:v}),null==S||S(m),yield p.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(m){throw new W(k.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(m.toString()))}})()}updateRemoteConnect(n){var i=this;return L(function*(){var s,c,d;null===(s=i.remoteSDP)||void 0===s||s.updateRemoteRTPCapabilities(n),null===(c=i.remoteSDP)||void 0===c||c.preloadRemoteMedia(2);const h=null===(d=i.remoteSDP)||void 0===d?void 0:d.toString();yield i.peerConnection.setRemoteDescription({type:"offer",sdp:h});const p=yield i.peerConnection.createAnswer();yield i.peerConnection.setLocalDescription(p),T.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")})()}send(n,i,s){var c=this;return fs(function*(){const d=yield dt(c.mutex.lock("From NVExtentionsConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const h=[];n.forEach(P=>{const w=c.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});h.push(w)}),Bt()&&!0===B("SIMULCAST")&&(yield dt(c.applySimulcastForFirefox(h,n)));const p=yield dt(c.peerConnection.createOffer()),m=c.remoteSDP.predictReceivingMids(n.length),_=c.mungSendOfferSDP(p.sdp,n,m),E=un.parse(_),v=m.map(P=>{const w=E.mediaDescriptions.find(M=>M.attributes.mid===P);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return wh(w,B("USE_PUB_RTX"))});let S;try{S=yield v}catch(P){S=[],c.remoteSDP.receive(n,i,s,S);const w=c.remoteSDP.toString();throw yield dt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield dt(c.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield dt(c.stopSending(m,!0)),P}c.remoteSDP.receive(n,i,s,S);const b=c.remoteSDP.toString(),O=c.logSDPExchange(_,"offer","local","send");return yield dt(c.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield dt(c.applySimulcastEncodings(h,n)),yield dt(c.applySendEncodings(h,n)),null==O||O(b),yield dt(c.peerConnection.setRemoteDescription({type:"answer",sdp:b})),h.map((P,w)=>({localSSRC:v[w],id:m[w],transceiver:P}))}catch(h){throw h instanceof W?h:new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(h.toString()))}finally{d()}})()}stopSending(n,i){var s=this;return L(function*(){const c=i?void 0:yield s.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const d=s.peerConnection.getTransceivers().filter(_=>-1!==n.indexOf(_.mid));if(d.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");d.map(_=>{var E;_.direction="inactive",null===(E=_.stop)||void 0===E||E.call(_)});const h=yield s.peerConnection.createOffer(),p=s.logSDPExchange(h.sdp||"","offer","local","stopSending");yield s.peerConnection.setLocalDescription(h),s.remoteSDP.stopReceiving(n);const m=s.remoteSDP.toString();null==p||p(m),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(d){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}createDataChannels(n,i){var s=this;return L(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let c=s.dataStreamChannelMap.get(n);return c&&"open"===c.readyState?T.debug("[P2PConnection] Channels are already available and can be reused directly."):(c=s.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS")}),c.binaryType="arraybuffer",s.dataStreamChannelMap.set(n,c)),void i.forEach(d=>{d._updateOriginDataChannel(c)})}catch(c){throw c instanceof W?c:new W(k.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(c.toString()))}})()}stopDataChannels(n){var i=this;return L(function*(){try{const s=i.dataStreamChannelMap.get(n);return null==s||s.close(),void i.dataStreamChannelMap.delete(n)}catch(s){throw s instanceof W?s:new W(k.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(s.toString()))}})()}receive(n,i,s,c){var d=this;return L(function*(){try{if(!d.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(n," before remoteSDP created."));const{mid:h,needExchangeSDP:p}=d.remoteSDP.send(n,i,s,c);if(p){const _=d.remoteSDP.toString(),E=d.logSDPExchange(_,"offer","remote","receive");yield d.peerConnection.setRemoteDescription({type:"offer",sdp:_});const v=yield d.peerConnection.createAnswer(),S=d.mungReceiveAnswerSDP(v.sdp,h,n);null==E||E(S||""),yield d.peerConnection.setLocalDescription({type:"answer",sdp:S}),T.debug("[NVExtentionsConnection] receive ".concat(n," by exchanging SDP."))}else T.debug("[NVExtentionsConnection] receive ".concat(n," no need to exchange SDP."));const m=d.peerConnection.getTransceivers().find(_=>_.mid===h);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:h}}catch(h){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(h.toString()))}})()}batchReceive(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:c}=i.remoteSDP.batchSend(n);if(c){const d=i.remoteSDP.toString(),h=i.logSDPExchange(d,"offer","remote","receive");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:d});const p=yield i.peerConnection.createAnswer();null==h||h(p.sdp||""),yield i.peerConnection.setLocalDescription(p),T.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else T.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return s.map(d=>{const h=i.peerConnection.getTransceivers().find(p=>p.mid===d);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:d}})}catch(s){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(s.toString()))}})()}stopReceiving(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");i.remoteSDP.stopSending(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","stopReceiving");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();null==c||c(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(s.toString()))}})()}muteRemote(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(n," before remote SDP created."));i.remoteSDP.mute(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","muteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();null==c||c(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(s.toString()))}})()}unmuteRemote(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(n," before remote SDP created."));i.remoteSDP.unmute(n);const s=i.remoteSDP.toString(),c=i.logSDPExchange(s,"offer","remote","unmuteRemote");yield i.peerConnection.setRemoteDescription({type:"offer",sdp:s});const d=yield i.peerConnection.createAnswer();null==c||c(d.sdp||""),yield i.peerConnection.setLocalDescription(d)}catch(s){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(s.toString()))}})()}muteLocal(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(p=>{p.direction="inactive"});const c=yield i.peerConnection.createOffer(),d=i.logSDPExchange(c.sdp||"","offer","local","muteLocal");yield i.peerConnection.setLocalDescription(c),i.remoteSDP.muteRemote(n);const h=i.remoteSDP.toString();null==d||d(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(s.toString()))}})()}unmuteLocal(n){var i=this;return L(function*(){try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const s=i.peerConnection.getTransceivers().filter(p=>p.mid&&-1!==n.indexOf(p.mid));if(s.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(function(){var p=L(function*(m,_){m.direction="sendonly"});return function(m,_){return p.apply(this,arguments)}}());const c=yield i.peerConnection.createOffer(),d=i.logSDPExchange(c.sdp||"","offer","local","unmuteLocal");yield i.peerConnection.setLocalDescription(c),i.remoteSDP.unmuteRemote(n);const h=i.remoteSDP.toString();null==d||d(h),yield i.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new W(k.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(s.toString()))}})()}restartICE(n){var i=this;return fs(function*(){const s=yield dt(i.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ge().supportPCSetConfiguration){const _=i.peerConnection.getConfiguration(),E=n===Si.RELAY?"relay":"all";_.iceTransportPolicy!==E&&(T.debug("restartICE change iceTransportPolicy from [".concat(_.iceTransportPolicy,"] to [").concat(E,"]")),_.iceTransportPolicy=E,i.peerConnection.setConfiguration(_))}else if(n===Si.RELAY)return;n!==Si.RELAY&&i.remoteSDP.updateCandidates(n);const c=yield dt(i.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Aa(c.sdp),{remoteIceParameters:h}=yield d.iceParameters;i.remoteSDP.restartICE(h);const p=i.remoteSDP.toString(),m=i.logSDPExchange(c.sdp||"","offer","local","restartICE");yield dt(i.peerConnection.setLocalDescription(c)),null==m||m(p),yield dt(i.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(c){T.warning("restart ICE failed, abort operation",c)}finally{s()}})()}close(){var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,i){var s=this;return L(function*(){try{if(!s.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const c=yield s.peerConnection.createOffer(),d=s.mungSendOfferSDP(c.sdp,[i],[n]);s.remoteSDP.updateRecvMedia(n,i);const h=s.remoteSDP.toString(),p=s.logSDPExchange(d,"offer","local","updateEncoderConfig");yield s.peerConnection.setLocalDescription({type:"offer",sdp:d}),null==p||p(h),yield s.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(c){throw new W(k.EXCHANGE_SDP_FAILED,c.toString())}})()}updateSendParameters(n,i){var s=this;return L(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(i)?Bt()||(yield s.applySimulcastEncodings(c,[i])):yield s.applySendEncodings(c,[i]))})()}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}replaceTrack(n,i){var s=this;return L(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===i);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getP2PConnectionParams(){var n;if(null===(n=this.peerConnection.currentLocalDescription)||void 0===n||!n.sdp||!this.localCapabilities)throw new Error;return ym(ym({},Aa(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(zu(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Hi.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Hi.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(om(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}applySendEncodings(n,i){var s=this;return L(function*(){try{if(!Ge().supportSetRtpSenderParameters||n.length!==i.length)return;for(let S=0;S<n.length;S++){const b=n[S],O=i[S];if(O&&O instanceof We){var c,d,h;if(s.isVP8Simulcast(O))continue;const P={},w={};switch(O._optimizationMode){case"motion":P.degradationPreference="maintain-framerate";break;case"detail":P.degradationPreference="maintain-resolution";break;default:P.degradationPreference="balanced"}var p,m,_,E;if(null!==(c=O._encoderConfig)&&void 0!==c&&c.bitrateMax&&(w.maxBitrate=1e3*(null===(p=O._encoderConfig)||void 0===p?void 0:p.bitrateMax)),Re(d=O._hints).call(d,Ht.LOW_STREAM)&&(null!==(m=O._encoderConfig)&&void 0!==m&&m.frameRate&&(w.maxFramerate=vo(O._encoderConfig.frameRate)),null!==(_=O._encoderConfig)&&void 0!==_&&_.scaleResolutionDownBy&&(null===(E=O._encoderConfig)||void 0===E?void 0:E.scaleResolutionDownBy)>1&&(w.scaleResolutionDownBy=O._encoderConfig.scaleResolutionDownBy)),B("DSCP_TYPE")&&$c()){var v;const U=B("DSCP_TYPE");Re(v=["very-low","low","medium","high"]).call(v,U)&&(w.networkPriority=U)}const M=b.sender.getParameters(),V=null===(h=M.encodings)||void 0===h?void 0:h[0];Bt()&&!V&&(P.encodings=[w]),V&&Object.assign(V,w),Object.assign(M,P),yield b.sender.setParameters(M)}}}catch(S){T.debug("Apply RTPSendEncodings failed.")}})()}mungSendOfferSDP(n,i,s){const c=un.parse(n);return i.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Id(m,d),dv(m,d,this.store.codec))}),un.print(c)}mungReceiveAnswerSDP(n,i,s){const c=un.parse(n),d=c.mediaDescriptions.find(h=>h.attributes.mid===i);return d&&s===fe.AUDIO&&"audio"===d.media.mediaType&&fl(d),this.useXR&&dm(c),un.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;null===(i=this.onFirstVideoDecodedTimeout)||void 0===i||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,i){var s=this;return L(function*(){if(n.length===i.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const E=n[_],v=i[_];if(v instanceof We&&!Re(c=v._hints).call(c,Ht.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const S={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,S))}}})()}applySimulcastEncodings(n,i){var s=this;return L(function*(){if(!Bt()&&n.length===i.length)for(let c=0;c<n.length;c++){const d=i[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var i,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!Re(i=n._hints).call(i,Ht.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,s,c){if(B("SDP_LOGGING"))return T.upload("exchanging ".concat(s," ").concat(i," SDP during NVExtentionsConnection.").concat(c,"\n"),n),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getRemoteSSRC(n){var i=this;return L(function*(){if(!i.remoteSDP)return;const s=i.remoteSDP.getSSRC(n);return null==s?void 0:s[0].ssrcId})()}setConfiguration(n){if(Ge().supportPCSetConfiguration){const i=Hi.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}}function yo(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=L(function*(){const c=this.mutex,d=yield c.lock("From NVExtentionsConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function IT(o){var n,i,s,c=2;for("undefined"!=typeof Symbol&&(i=hx,s=Symbol.iterator);c--;){if(i&&null!=(n=o[i]))return n.call(o);if(s&&null!=(n=o[s]))return new vv(n.call(o));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function vv(o){function n(i){if(Object(i)!==i)return z.reject(new TypeError(i+" is not an object."));var s=i.done;return z.resolve(i.value).then(function(c){return{value:c,done:s}})}return(vv=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return void 0===s?z.resolve({value:i,done:!0}):n(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return void 0===s?z.reject(i):n(s.apply(this.s,arguments))}},new vv(o)}te([yo,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],Hi.prototype,"connect",null),te([yo,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],Hi.prototype,"updateRemoteConnect",null),te([yo,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",z)],Hi.prototype,"createDataChannels",null),te([yo,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",z)],Hi.prototype,"receive",null),te([yo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Hi.prototype,"batchReceive",null),te([yo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Hi.prototype,"stopReceiving",null),te([yo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Hi.prototype,"muteRemote",null),te([yo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Hi.prototype,"unmuteRemote",null),te([yo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Hi.prototype,"muteLocal",null),te([yo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Hi.prototype,"unmuteLocal",null),te([yo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Hi.prototype,"close",null),te([yo,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],Hi.prototype,"updateEncoderConfig",null),te([yo,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],Hi.prototype,"updateSendParameters",null),te([yo,N("design:type",Function),N("design:paramtypes",[zn,String]),N("design:returntype",z)],Hi.prototype,"replaceTrack",null),te([yo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Hi.prototype,"getRemoteSSRC",null);class qn extends Df{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(n,i){super(n,i),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"cname",void 0),C(this,"mutex",new ni("DataChannelConnection-mutex")),C(this,"dataChannel",void 0),C(this,"_p2pConnection",void 0),C(this,"establishPromise",void 0),C(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(qn.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Hi(n,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}establish(){var n=this;return L(function*(){var i;const s=null===(i=n._nvMedia)||void 0===i?void 0:i.getLocalRtpCapabilities();return yield n._p2pConnection.establish(s)})()}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}connect(n,i,s,c,d,h){var p=this;return L(function*(){return p.cname=h,yield p._p2pConnection.connect(n,i,s,c,d,h),yield new z((m,_)=>{const E=setTimeout(()=>{p.closeSignal(),_(new W(k.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(s))))},2e3);p.dataChannel.onopen=()=>{if("open"===p.dataChannel.readyState)return clearTimeout(E),void m()},p.dataChannel.onerror=v=>{p.closeSignal(),_(v)}}),{transmitter:p.dataChannel,close:p.closeSignal.bind(p)}})()}send(n,i,s){var c=this;return fs(function*(){const d=yield dt(c.mutex.lock("From DataChannelConnection.send"));try{return yield*ET(IT(c._p2pConnection.send(n,i,s)))}finally{d()}})()}stopSending(n,i){var s=this;return L(function*(){return s._p2pConnection.stopSending(n,i)})()}createDataChannels(n,i){var s=this;return L(function*(){return s._p2pConnection.createDataChannels(n,i)})()}stopDataChannels(n){var i=this;return L(function*(){return i._p2pConnection.stopDataChannels(n)})()}receive(n,i,s,c){var d=this;return L(function*(){return d._nvMedia?(T.debug("[DataChannelConnection] receive ".concat(n," by DataChannel.")),yield d._nvMedia.reveiveByRTCMedia(n,i,d.cname)):(T.debug("[DataChannelConnection] receive ".concat(n," by WebRTC.")),yield d._p2pConnection.receive(n,i,s,c))})()}batchReceive(n){var i=this;return L(function*(){return[...yield i._p2pConnection.batchReceive(n)]})()}stopReceiving(n){var i=this;return L(function*(){return yield i._p2pConnection.stopReceiving(n)})()}muteRemote(n){var i=this;return L(function*(){return yield i._p2pConnection.muteRemote(n)})()}unmuteRemote(n){var i=this;return L(function*(){return yield i._p2pConnection.unmuteRemote(n)})()}muteLocal(n){var i=this;return L(function*(){return yield i._p2pConnection.muteLocal(n)})()}unmuteLocal(n){var i=this;return L(function*(){return yield i._p2pConnection.unmuteLocal(n)})()}restartICE(n){var i=this;return fs(function*(){return yield*ET(IT(i._p2pConnection.restartICE(n)))})()}close(){var n;null===(n=this._nvMedia)||void 0===n||n.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(n){return this._p2pConnection.getRemoteVideoIsReady(n)}updateRemoteConnect(n){var i;null===(i=this._nvMedia)||void 0===i||i.setRemoteRtpCapabilities(n),this._p2pConnection.updateRemoteConnect(n)}updateEncoderConfig(n,i){var s=this;return L(function*(){return yield s._p2pConnection.updateEncoderConfig(n,i)})()}updateSendParameters(n,i){var s=this;return L(function*(){return yield s._p2pConnection.updateSendParameters(n,i)})()}setStatsRemoteVideoIsReady(n,i){this._p2pConnection.setStatsRemoteVideoIsReady(n,i)}replaceTrack(n,i){var s=this;return L(function*(){return yield s._p2pConnection.replaceTrack(n,i)})()}getRemoteSSRC(n){var i=this;return L(function*(){return i._p2pConnection.getRemoteSSRC(n)})()}logSDPExchange(n,i,s,c){if(B("SDP_LOGGING"))return T.upload("exchanging ".concat(s," ").concat(i," SDP during DataChannelConnection.").concat(c,"\n"),n),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(zu(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...qn.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...qn.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.security?s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(om(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}):(s.udpport&&!B("FORCE_TURN_TCP")&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.udpport,"?transport=udp")}),s.tcpport&&i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=n=>{var i;return null===(i=this.onICEConnectionStateChange)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onConnectionStateChange=n=>{var i;return null===(i=this.onConnectionStateChange)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onDTLSTransportStateChange=n=>{var i;return null===(i=this.onDTLSTransportStateChange)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onDTLSTransportError=n=>{var i;return null===(i=this.onDTLSTransportError)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onICETransportStateChange=n=>{var i;return null===(i=this.onICETransportStateChange)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onFirstAudioReceived=n=>{var i;return null===(i=this.onFirstAudioReceived)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onFirstVideoReceived=n=>{var i;return null===(i=this.onFirstVideoReceived)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onFirstAudioDecoded=n=>{var i;return null===(i=this.onFirstAudioDecoded)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onFirstVideoDecoded=(n,i,s)=>{var c;return null===(c=this.onFirstVideoDecoded)||void 0===c?void 0:c.call(this,n,i,s)},this._p2pConnection.onFirstVideoDecodedTimeout=n=>{var i;return null===(i=this.onFirstVideoDecodedTimeout)||void 0===i?void 0:i.call(this,n)},this._p2pConnection.onSelectedLocalCandidateChanged=(n,i)=>{var s;return null===(s=this.onSelectedLocalCandidateChanged)||void 0===s?void 0:s.call(this,n,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(n,i)=>{var s;return null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s?void 0:s.call(this,n,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0}setConfiguration(n){this._p2pConnection.setConfiguration(n)}}function jo(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=L(function*(){const c=this.mutex,d=yield c.lock("From DataChannelConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function wT(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function yv(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?wT(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):wT(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([jo,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],qn.prototype,"connect",null),te([jo,N("design:type",Function),N("design:paramtypes",[Object,Array]),N("design:returntype",z)],qn.prototype,"createDataChannels",null),te([jo,N("design:type",Function),N("design:paramtypes",[String,Array,String,Object]),N("design:returntype",z)],qn.prototype,"receive",null),te([jo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],qn.prototype,"stopReceiving",null),te([jo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],qn.prototype,"muteRemote",null),te([jo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],qn.prototype,"unmuteRemote",null),te([jo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],qn.prototype,"muteLocal",null),te([jo,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],qn.prototype,"unmuteLocal",null),te([jo,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],qn.prototype,"close",null),te([jo,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],qn.prototype,"updateEncoderConfig",null),te([jo,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],qn.prototype,"updateSendParameters",null),te([jo,N("design:type",Function),N("design:paramtypes",[zn,String]),N("design:returntype",z)],qn.prototype,"replaceTrack",null),te([jo,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],qn.prototype,"getRemoteSSRC",null);class CO extends jt{constructor(){super(),C(this,"uplinkStatsUploadInterval",void 0),C(this,"uplinkRelatedStatsUploadInterval",void 0),C(this,"uplinkDenoiserStatsUploadInterval",void 0),C(this,"transportStatsUploadInterval",void 0),C(this,"uplinkExtensionStatsUploadInterval",void 0),C(this,"downlinkExtensionStatsUploadInterval",void 0),C(this,"extensionUsageStatsUploadInterval",void 0),C(this,"downlinkStatsUploadInterval",void 0),C(this,"downlinkRelatedStatsUploadInterval",void 0),C(this,"lastStats",void 0),C(this,"uploadUnplinkStarted",!1),C(this,"uploadDownlinkStarted",!1),C(this,"uploadTransportStarted",!1),C(this,"uploadExtensionUsageStarted",!1),C(this,"requestStats",void 0),C(this,"requestTransportStats",void 0),C(this,"requestLocalMedia",void 0),C(this,"requestRemoteMedia",void 0),C(this,"requestAllTracks",void 0),C(this,"requestVideoIsReady",void 0),C(this,"requestUpload",void 0)}startUploadTransportStats(n){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var i;const s=null===(i=this.requestStats)||void 0===i?void 0:i.call(this);if(s){const d=tx(s);if(n){var c;const h=null===(c=this.requestStats)||void 0===c?void 0:c.call(this,!0);if(h){const p=tx(h);d.connectionType+=p.connectionType<<3}d.connectionType+=110}else d.connectionType+=100;is(()=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,Yr.TRANSPORT_STATS,d)})}},1e3))}startUploadExtensionUsageStats(){var n=this;if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const i=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(L(function*(){var s,c,d;const h=Date.now(),p={connectionInterval:B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:h};let m=[];const _=(null===(s=n.requestAllTracks)||void 0===s?void 0:s.call(n))||[];for(const b of _)!b.muted&&b.enabled&&(m=m.concat(yield b.getProcessorUsage()));const E=(null===(c=n.requestRemoteMedia)||void 0===c?void 0:c.call(n))||[];for(const[b,O]of E)O.has(fe.VIDEO)&&b.videoTrack&&(m=m.concat(yield b.videoTrack.getProcessorUsage())),O.has(fe.AUDIO)&&b.audioTrack&&(m=m.concat(yield b.audioTrack.getProcessorUsage()));if(0===m.length)return;p.details=function(b,O){const P={};for(const{id:U,value:Y,level:ie,direction:K}of b){var w;const X=null!==(w=O.get(U))&&void 0!==w?w:0,$=2===Y?X+B("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:X;var M,V;O.set(U,$),P[U]?(2===Y&&(P[U].value=Y),ie>P[U].level&&(P[U].level=ie),"remote"===K&&(P[U].remoteUidCount+=1),P[U].totalTs=null!==(M=O.get(U))&&void 0!==M?M:0):P[U]={value:Y,level:ie,remoteUidCount:"local"===K?0:1,totalTs:null!==(V=O.get(U))&&void 0!==V?V:0}}return Object.keys(P).map(U=>{const{level:Y,value:ie,totalTs:K}=P[U];return{id:U,level:Y,value:ie,totalTs:K}})}(m,i);const v=Date.now();null===(d=n.requestUpload)||void 0===d||d.call(n,Yr.EXTENSION_USAGE_STATS,{usageStats:p,sendTs:v>h?v:h+1})}),B("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var n;const i=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);i&&(this.uploadUplinkStats(i),this.lastStats=i)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var n;const i=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);i&&this.uploadRelatedUplinkStats(i,this.lastStats),this.lastStats=i},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var n;const i=null===(n=this.requestAllTracks)||void 0===n?void 0:n.call(this);i&&this.uploadDenoiserStats(i)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var n;const i=null===(n=this.requestAllTracks)||void 0===n?void 0:n.call(this);i&&this.uploadExtensionStats(i)},2e3))}uploadUplinkStats(n){var i;((null===(i=this.requestLocalMedia)||void 0===i?void 0:i.call(this))||[]).forEach(s=>{let[c,{track:d,ssrcs:h}]=s;switch(c){case ne.LocalVideoLowTrack:case ne.LocalVideoTrack:{const p=function(E,v,S){var b;const O=v.videoSend.find(w=>w.ssrc===E);if(!O)return null;const P={id:Ot(10,""),timestamp:new Date(v.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};switch(P.A_vstd=S._originMediaStreamTrack&&!S._originMediaStreamTrack.enabled||S._mediaStreamTrack&&!S._mediaStreamTrack.enabled?"1":"0",O.sentFrame&&(P.A_fhs=O.sentFrame.height.toString(),P.A_frs=O.sentFrame.frameRate.toString(),P.A_fws=O.sentFrame.width.toString()),O.adaptionChangeReason){case"none":P.A_ac="0";break;case"cpu":P.A_ac="1";break;case"bandwidth":P.A_ac="2";break;case"other":P.A_ac="3"}return P.A_lvps=Lf[S._player?S._player.videoElementStatus:"uninit"].toString(),P.A_nr=null===(b=O.nacksCount)||void 0===b?void 0:b.toString(),O.avgEncodeMs&&(P.A_aem=O.avgEncodeMs.toFixed(0).toString()),B("P2P")&&(O.bytes&&(P.bytesSent=O.bytes.toString()),"number"==typeof O.packetsLost&&(P.packetsLost=O.packetsLost.toString()),O.packets&&(P.packetsSent=O.packets.toString())),P}(h[0].ssrcId,n,d),m=c===ne.LocalVideoTrack?function(E,v,S){var b,O,P,w,M,V,U,Y;const ie=v.videoSend.find(ge=>ge.ssrc===E);if(!ie)return null;const K={id:Ot(10,""),timestamp:new Date(v.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:ie.ssrc.toString()},X=null!==(b=null!==(O=null===(P=ie.inputFrame)||void 0===P?void 0:P.height)&&void 0!==O?O:null==S?void 0:S._videoHeight)&&void 0!==b?b:0,$=null!==(w=null!==(M=null===(V=ie.inputFrame)||void 0===V?void 0:V.width)&&void 0!==M?M:null==S?void 0:S._videoWidth)&&void 0!==w?w:0,J=null!==(U=null===(Y=ie.inputFrame)||void 0===Y?void 0:Y.frameRate)&&void 0!==U?U:0;return X&&(K.A_fhi=X+""),$&&(K.A_fwi=$+""),J&&(K.A_fri=J+""),K}(h[0].ssrcId,n,d):null;p&&is(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Yr.PUBLISH_STATS,{stream_type:c===ne.LocalVideoLowTrack?"low":"high",stats:yv(yv({},p),m)})});const _=function(E){const v={id:"bweforvideo",timestamp:new Date(E.timestamp).toISOString(),type:"VideoBwe"};return E.bitrate.retransmit&&(v.A_rb=E.bitrate.retransmit.toString()),E.bitrate.targetEncoded&&(v.A_teb=E.bitrate.targetEncoded.toString()),v.A_aeb=E.bitrate.actualEncoded.toString(),v.A_tb=E.bitrate.transmit.toString(),void 0!==E.sendBandwidth&&(v.A_asb=E.sendBandwidth.toString()),v}(n);_&&setTimeout(()=>{var E;return null===(E=this.requestUpload)||void 0===E?void 0:E.call(this,Yr.PUBLISH_STATS,{stream_type:c===ne.LocalVideoLowTrack?"low":"high",stats:_})},1e3);break}case ne.LocalAudioTrack:{const p=function(m,_,E){const v=_.audioSend.find(b=>b.ssrc===m);if(!v)return null;const S={id:Ot(10,""),timestamp:new Date(_.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:v.ssrc.toString()};return S.A_astd=E._originMediaStreamTrack&&!E._originMediaStreamTrack.enabled||E._mediaStreamTrack&&!E._mediaStreamTrack.enabled?"1":"0",S.A_ail=v.inputLevel?Math.round(100*v.inputLevel).toString():Math.round(100*E._source.getAccurateVolumeLevel()).toString(),S.A_apil=Math.round(100*E._source.getAccurateVolumeLevel()).toString(),v.aecReturnLoss&&(S.A_ecrl=Math.round(v.aecReturnLoss).toString()),v.aecReturnLossEnhancement&&(S.A_ecrle=Math.round(v.aecReturnLossEnhancement).toString()),B("P2P")&&(v.bytes&&(S.bytesSent=v.bytes.toString()),"number"==typeof v.packetsLost&&(S.packetsLost=v.packetsLost.toString()),v.packets&&(S.packetsSent=v.packets.toString())),S}(h[0].ssrcId,n,d);p&&is(()=>{var m;return null===(m=this.requestUpload)||void 0===m?void 0:m.call(this,Yr.PUBLISH_STATS,{stream_type:"high",stats:p})});break}}})}uploadRelatedUplinkStats(n,i){var s;((null===(s=this.requestLocalMedia)||void 0===s?void 0:s.call(this))||[]).filter(c=>{let[d]=c;return d===ne.LocalVideoLowTrack||d===ne.LocalVideoTrack}).forEach(c=>{let[d,{ssrcs:h}]=c;const p=function(m,_){const E=_.videoSend.find(v=>v.ssrc===m);return E?{mediaType:"video",isVideoMute:!1,frameRateInput:E.inputFrame&&E.inputFrame.frameRate.toString(),frameRateSent:E.sentFrame&&E.sentFrame.frameRate.toString(),googRtt:E.rttMs.toString(),qpSumPerFrame:Math.floor(E.qpSumPerFrame).toString()}:null}(h[0].ssrcId,n);p&&is(()=>{var m;null===(m=this.requestUpload)||void 0===m||m.call(this,Yr.PUBLISH_RELATED_STATS,{stream_type:d===ne.LocalVideoLowTrack?"low":"high",stats:p})})})}uploadDenoiserStats(n){for(let d=0;d<n.length;d++){const h=n[d];if(h instanceof ol){var i,s,c;const p=null===(i=(s=h._external).getDenoiserStats)||void 0===i?void 0:i.call(s);return void(p&&(null===(c=this.requestUpload)||void 0===c||c.call(this,Yr.DENOISER_STATS,p)))}}}uploadExtensionStats(n){for(let i=0;i<n.length;i++)n[i].getProcessorStats().forEach(s=>{var c;null===(c=this.requestUpload)||void 0===c||c.call(this,s.type,s.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let n;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let i=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestStats)||void 0===s?void 0:s.call(this,!0);c&&(this.uploadDownlinkStats(c,i,n),n=c),i=!i},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestStats)||void 0===s?void 0:s.call(this,!0);c&&(this.uploadRelatedDownlinkStats(c,this.lastStats),this.lastStats=c)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var s;const c=null===(s=this.requestRemoteMedia)||void 0===s?void 0:s.call(this);c&&this.uploadDownlinkExtensionStats(c)},2e3)}uploadDownlinkStats(n,i,s){var c;((null===(c=this.requestRemoteMedia)||void 0===c?void 0:c.call(this))||[]).forEach(d=>{let[h,p]=d;if(p.has(fe.VIDEO)&&h.videoTrack){const m=h.videoTrack?function(_,E,v,S,b){const O=E.videoRecv.find(V=>V.ssrc===_);if(!O)return null;const P={id:Ot(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:O.ssrc.toString()};var w,M;if(P.bytesReceived=O.bytes.toString(),P.packetsLost=O.packetsLost.toString(),P.packetsReceived=O.packets.toString(),O.framesRateFirefox&&(P.A_frr=O.framesRateFirefox.toString()),O.receivedFrame?(P.A_frr=O.receivedFrame.frameRate.toString(),P.A_fhr=O.receivedFrame.height.toString(),P.A_fwr=O.receivedFrame.width.toString()):(P.A_fhr=null===(w=S._videoHeight)||void 0===w?void 0:w.toString(),P.A_fwr=null===(M=S._videoWidth)||void 0===M?void 0:M.toString()),P.A_frd=O.decodeFrameRate.toString(),O.outputFrame&&(P.A_fro=O.outputFrame.frameRate.toString()),void 0!==O.jitterBufferMs&&(P.A_jbm=Math.floor(O.jitterBufferMs).toString()),void 0!==O.currentDelayMs&&(P.A_cdm=Math.floor(O.currentDelayMs).toString()),P.A_fs=O.firsCount.toString(),P.A_ns=O.nacksCount.toString(),P.A_ps=O.plisCount.toString(),S&&(P.A_vrtd=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?"0":"1"),S._player&&S._player.freezeTimeCounterList.length>0&&(P.A_vrft=Math.round(S._player.freezeTimeCounterList.splice(0,1)[0]).toString()),b&&S._player&&"visible"===dc.visibility){const V=Math.min(6e3,S._player.renderFreezeAccTime);P.A_vrrft=Math.round(V).toString(),S._player.renderFreezeAccTime=Math.max(0,S._player.renderFreezeAccTime-V)}if(P.A_rvps=Lf[S._player?S._player.videoElementStatus:"uninit"].toString(),v){const V=v.videoRecv.find(U=>U.ssrc===_);if(V&&void 0!==O.totalInterFrameDelay&&void 0!==O.totalSquaredInterFrameDelay&&void 0!==V.totalInterFrameDelay&&void 0!==V.totalSquaredInterFrameDelay){const U=O.totalInterFrameDelay-V.totalInterFrameDelay,ie=O.framesDecodeCount-V.framesDecodeCount,K=U/ie*1e3,X=Math.round(1e3*Math.sqrt((O.totalSquaredInterFrameDelay-V.totalSquaredInterFrameDelay-Math.pow(U,2)/ie)/ie));!isNaN(X)&&K+X>Math.max(3*K,K+150)&&(P.A_ifdsd=X.toString())}}return P}(h._videoSSRC,n,s,h.videoTrack,i):void 0;m&&is(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,Yr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}if(p.has(fe.AUDIO)&&h.audioTrack){const m=h.audioTrack?function(_,E,v,S){const b=E.audioRecv.find(P=>P.ssrc===_);if(!b)return null;const O={id:Ot(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:b.ssrc.toString()};if(O.bytesReceived=b.bytes.toString(),O.packetsLost=b.packetsLost.toString(),O.packetsReceived=b.packets.toString(),O.A_aol=b.outputLevel?Math.round(100*b.outputLevel).toString():Math.round(100*S._source.getAccurateVolumeLevel()).toString(),O.A_apol=Math.round(100*S._source.getAccurateVolumeLevel()).toString(),S&&(O.A_artd=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?"0":"1"),O.A_jr=b.jitterMs.toString(),O.A_jbm=Math.floor(b.jitterBufferMs).toString(),O.A_cdm=Math.floor(b.jitterBufferMs).toString(),O.A_raps=Lf[eo.getPlayerState(S.getTrackId())].toString(),v){const P=v.audioRecv.find(w=>w.ssrc===_);if(P){const w=b.concealedSamples-P.concealedSamples;w>0&&(O.A_cs=Math.round(w).toString())}}return O}(h._audioSSRC,n,s,h.audioTrack):void 0;m&&is(()=>{var _;return null===(_=this.requestUpload)||void 0===_?void 0:_.call(this,Yr.SUBSCRIBE_STATS,{stream_id:h.uid,stats:m})})}})}uploadRelatedDownlinkStats(n,i){var s;((null===(s=this.requestRemoteMedia)||void 0===s?void 0:s.call(this))||[]).forEach(c=>{let[d,h]=c;if(h.has(fe.VIDEO)&&d.videoTrack){var p;const m=!0===(d._videoSSRC&&(null===(p=this.requestVideoIsReady)||void 0===p?void 0:p.call(this,d._videoSSRC))||!1),_=function(E,v,S,b,O,P){const w=S.videoRecv.find(Y=>Y.ssrc===E),M=O?O.videoRecv.find(Y=>Y.ssrc===E):void 0;if(!w)return null;const V=Rh.isRemoteVideoFreeze(P,w,M)&&v,U={mediaType:"video",isVideoMute:!1,peerId:b,frameRateReceived:w.receivedFrame&&w.receivedFrame.frameRate.toString(),frameRateDecoded:w.decodedFrame&&w.decodedFrame.frameRate.toString(),isFreeze:V,bytesReceived:w.bytes.toString(),packetsReceived:w.packets.toString(),packetsLost:w.packetsLost.toString(),qpSumPerFrame:Math.floor(w.qpSumPerFrame).toString()};return w.framesRateFirefox&&(U.frameRateDecoded=w.framesRateFirefox.toString(),U.frameRateReceived=w.framesRateFirefox.toString()),U}(d._videoSSRC,m,n,d.uid,i,d.videoTrack);_&&is(()=>{var E;null===(E=this.requestUpload)||void 0===E||E.call(this,Yr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:_})})}if(h.has(fe.AUDIO)&&d.audioTrack){const m=function(_,E,v,S){const b=E.audioRecv.find(P=>P.ssrc===_);if(!b)return null;const O=Rh.isRemoteAudioFreeze(S);return{mediaType:"audio",isAudioMute:!1,peerId:v,googJitterReceived:b.jitterMs.toString(),isFreeze:O,bytesReceived:b.bytes.toString(),packetsReceived:b.packets.toString(),packetsLost:b.packetsLost.toString(),frameReceived:b.receivedFrames.toString(),frameDropped:b.droppedFrames.toString()}}(d._audioSSRC,n,d.uid,d.audioTrack);m&&is(()=>{var _;null===(_=this.requestUpload)||void 0===_||_.call(this,Yr.SUBSCRIBE_RELATED_STATS,{stream_id:d.uid,stats:m})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(n){n.forEach(i=>{let[s,c]=i;c.has(fe.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)}),c.has(fe.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(d=>{var h;null===(h=this.requestUpload)||void 0===h||h.call(this,d.type,d.stats)})})}}function AT(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function ml(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?AT(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):AT(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}function Ph(o){var n,i,s,c=2;for("undefined"!=typeof Symbol&&(i=hx,s=Symbol.iterator);c--;){if(i&&null!=(n=o[i]))return n.call(o);if(s&&null!=(n=o[s]))return new Sv(n.call(o));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function Sv(o){function n(i){if(Object(i)!==i)return z.reject(new TypeError(i+" is not an object."));var s=i.done;return z.resolve(i.value).then(function(c){return{value:c,done:s}})}return(Sv=function(i){this.s=i,this.n=i.next}).prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var s=this.s.return;return void 0===s?z.resolve({value:i,done:!0}):n(s.apply(this.s,arguments))},throw:function(i){var s=this.s.return;return void 0===s?z.reject(i):n(s.apply(this.s,arguments))}},new Sv(o)}class ai extends jt{get state(){return this._state}set state(n){const i=this._state;this._state=n,this.emit(Te.StateChange,i,this._state)}constructor(n,i){var s;super(),s=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"connection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"remoteDataChannelMap",new Map),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"pendingLocalDataChannels",[]),C(this,"pendingRemoteDataChannels",[]),C(this,"statsCollector",void 0),C(this,"isPlanB",!1),C(this,"shouldForwardP2PCreation",void 0),C(this,"iceFailedCount",0),C(this,"dtlsFailedCount",0),C(this,"mutex",new ni("P2PChannel-mutex")),C(this,"_state",rt.Disconnected),C(this,"_pcStatsUploadType",B("NEW_ICE_RESTART")?js.FIRST_CONNECTION:js.OLD_FIRST_CONNECTION),C(this,"_isInRestartIce",!1),C(this,"_isStartRestartIce",!1),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"_isFirstConnected",!0),C(this,"handleMuteLocalTrack",function(){var c=L(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!s.connection||s.state!==rt.Connected)return void p(new Q(k.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const _=s.filterTobeMutedTracks(d);if(0===_.length)return void h();const E=_.find(S=>"videoLowTrack"===S[0]);E&&E[1].track._originMediaStreamTrack.stop(),yield s.connection.muteLocal(_.map(S=>{let[,{id:b}]=S;return b}));const v=s.createMuteMessage(_);yield Lt(s,Te.RequestMuteLocal,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var c=L(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!s.connection||s.state!==rt.Connected)return void p(new Q(k.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const _=s.filterTobeUnmutedTracks(d);if(0===_.length)return void h();const E=_.find(S=>"videoLowTrack"===S[0]);if(E){const S=E[1];if(S.track._originMediaStreamTrack.stop(),!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding){const b=d._mediaStreamTrack.clone();S.track._mediaStreamTrack=b,S.track._originMediaStreamTrack=b}else{const b=EO(d,_a(s,Te.RequestLowStreamParameter));S.track._mediaStreamTrack=b,S.track._originMediaStreamTrack=b}yield new z((b,O)=>{s.handleReplaceTrack(S.track,b,O,!0)})}yield s.connection.unmuteLocal(_.map(S=>{let[,{id:b}]=S;return b}));const v=s.createUnmuteMessage(_);yield Lt(s,Te.RequestUnmuteLocal,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var c=L(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const _=s.localTrackMap.get(ne.LocalVideoTrack);if(!s.connection||!_||_.track!==d||s.state!==rt.Connected)return void h();const{id:E,track:v}=_;yield s.connection.updateSendParameters(E,v),yield s.connection.updateEncoderConfig(E,v),s.emit(Te.UpdateVideoEncoder,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var c=L(function*(d,h,p){const m=yield s.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const _=s.localTrackMap.get(ne.LocalVideoTrack);if(!s.connection||!_||_.track!==d||s.state!==rt.Connected)return;const{id:E,track:v}=_;yield s.connection.updateSendParameters(E,v),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var c=L(function*(d,h,p,m){let _;T.debug("[".concat(s.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield s.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var E;const S=Array.from(s.localTrackMap.entries()).find(b=>{let[,{track:O}]=b;return d===O});if(!s.connection||!S||s.state!==rt.Connected)return void h();if(yield null===(E=s.connection)||void 0===E?void 0:E.replaceTrack(d,S[1].id),s.isPlanB){const b=S[1];b.id=d._mediaStreamTrack.id,s.localTrackMap.set(S[0],b)}if(S[0]===ne.LocalVideoTrack&&!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding){const b=s.localTrackMap.get(ne.LocalVideoLowTrack);if(b){const O=d._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=O,b.track._originMediaStreamTrack=O,yield new z((P,w)=>{s.handleReplaceTrack(b.track,P,w,!0)})}}h()}catch(S){p(S)}finally{var v;null===(v=_)||void 0===v||v()}});return function(d,h,p,m){return c.apply(this,arguments)}}()),C(this,"handleGetLocalVideoStats",c=>{c(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",c=>{c(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",c=>this.statsCollector.getRemoteVideoTrackStats(c.uid)[c.uid]),C(this,"handleGetRemoteAudioStats",c=>this.statsCollector.getRemoteAudioTrackStats(c.uid)[c.uid]),this.store=n,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new CO,this.bindStatsUploaderEvents(),this.isPlanB=!Ge().supportUnifiedPlan||B("CHROME_FORCE_PLAN_B")&&$c(),this.shouldForwardP2PCreation=B("FORWARD_P2P_CREATION")&&Ge().supportPCSetConfiguration&&function(){const c=Zp();return c===ti.ANDROID||c===ti.IOS||c===ti.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new qn({},this.store):this.isPlanB?new Kn({},this.store):new mi({},this.store),this.bindConnectionEvents(this.connection))}startP2PConnection(n,i){var s=this;return L(function*(){var c;s.state=rt.New;const d=s.shouldForwardP2PCreation&&"closed"===(null===(c=s.connection)||void 0===c?void 0:c.peerConnectionState);if(s.shouldForwardP2PCreation&&!d||(d&&s.connection&&(T.warning("[".concat(s.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),s.connection.close(),s.unbindConnectionEvents(s.connection)),s.connection=s.store.useDataChannel?new qn(n,s.store):s.isPlanB?new Kn(n,s.store):new mi(n,s.store),s.bindConnectionEvents(s.connection)),!s.connection)throw new Q(k.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return s._pcStatsUploadType=B("NEW_ICE_RESTART")?js.FIRST_CONNECTION:js.OLD_FIRST_CONNECTION,s._isFirstConnected=!0,s._isInRestartIce=!1,s._isStartRestartIce=!1,s.connection.setConfiguration(n),s.connection.establishPromise})()}connect(n,i,s,c,d,h){var p=this;return L(function*(){if(!p.connection)throw new Q(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.connection instanceof qn?p.connection.updateRemoteConnect(c):(p.store.peerConnectionStart(),yield p.connection.connect(n,i,s,c,d,h),p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=rt.Connected)})()}preConnect(n,i,s,c,d,h){var p=this;return L(function*(){if(!p.connection)throw new Q(k.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");p.store.peerConnectionStart();const m=yield p.connection.connect(n,i,s,c,d,h);return p.statsUploader.startUploadTransportStats(),p.statsUploader.startUploadExtensionUsageStats(),p.state=rt.Connected,m})()}getEstablishParams(){if(this.connection instanceof qn)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publishDataChannel(n){var i=this;return L(function*(){if(!i.connection){if(i.state===rt.Disconnected)throw new Q(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const c=n.filter(d=>-1!==i.pendingLocalDataChannels.findIndex(h=>h.id===d.id));return void(i.pendingLocalDataChannels=i.pendingLocalDataChannels.concat(c))}const s=i.filterTobePublishedDataChannels(n);0!==s.length&&(s.forEach(c=>{const d=Date.now();i.store.publish(c.id.toString(),"datachannel",d)}),yield i.connection.createDataChannels(i.store.uid,s),s.forEach(c=>{i.localDataChannels.push(c);const d=Date.now();i.store.publish(c.id+"","datachannel",void 0,d)}))})()}publish(n,i,s){var c=this;return fs(function*(){const d=yield dt(c.mutex.lock("From P2PChannel.publish"));try{if(!c.connection||c.state!==rt.Connected){if(c.state===rt.Disconnected)throw new Q(k.UNEXPECTED_ERROR,"PeerConnection already disconnected.");c.throwIfTrackTypeNotMatch(n);const p=n.filter(m=>-1===c.pendingLocalTracks.indexOf(m));return void(c.pendingLocalTracks=c.pendingLocalTracks.concat(p))}c.store.pubId=c.store.pubId+1,Ai.markPublishStart(c.store.clientId,c.store.pubId);const h=c.filterTobePublishedTracks(n,i,s);if(0===h.length)return void(yield dt(c.tryToUnmuteAudio(n)));yield*ET(Ph(c.doPublish(c.connection,h)))}finally{d()}})()}doPublish(n,i){var s=this;return fs(function*(){i.forEach(E=>{let{track:v,type:S}=E;const b=Date.now();s.store.publish(v.getTrackId(),S===ne.LocalAudioTrack?"audio":"video",b)}),s.bindLocalTrackEvents(i);const c=yield dt(n.send(i.map(E=>{let{track:v}=E;return v}),s.store.codec,s.store.audioCodec)),d=(yield dt(c.next())).value,h=s.createGatewayPublishMessage(i,d);let p;try{p=yield h}catch(E){throw c.throw(E),(null==E?void 0:E.code)===k.WS_ABORT&&i.forEach(v=>{let{track:S}=v;-1===s.pendingLocalTracks.indexOf(S)&&s.pendingLocalTracks.push(S)}),s.unbindLocalTrackEvents(i),E}const m=s.mapPubResToRemoteConfig(h,p),_=(yield dt(c.next(m))).value;i.forEach(E=>{let{type:v}=E;s.statsCollector.addLocalStats(v)}),s.assignLocalTracks(i,_),s.statsUploader.startUploadUplinkStats(),i.forEach(E=>{let{track:v,type:S}=E;const b=Date.now();s.store.publish(v.getTrackId(),S===ne.LocalAudioTrack?"audio":"video",void 0,b)})})()}updateVideoStreamParameter(n,i){var s=this;return L(function*(){const c=s.localTrackMap.get(i);if(!c)return;if(!(c.track instanceof We))return T.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(s.connection instanceof mi||s.connection instanceof Kn))return T.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:d}=c,h=function(p,m){const _={};return p.height&&p.width&&(_.scaleResolutionDownBy=sm(p,m)),_.maxFramerate=p.framerate?vo(p.framerate):void 0,_.maxBitrate=p.bitrate?1e3*p.bitrate:void 0,_}(n,d);if(d._encoderConfig||(d._encoderConfig={}),i!==ne.LocalVideoLowTrack||!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding)null!=h.scaleResolutionDownBy&&(d._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const p=d._originMediaStreamTrack;if(!p.canvas)return T.warn("[".concat(d.getTrackId(),"] no canvas on track"));!function(m,_){const E=m.canvas;_.width&&(E.width=vo(_.width)),_.height&&(E.height=vo(_.height)),_.framerate&&(E.stopCapture&&E.stopCapture(),E.stopCapture=Pr(()=>{!E.startCapture&&E.stopCapture&&E.stopCapture(),E.startCapture&&E.startCapture()},vo(_.framerate)))}(p,n)}null!=h.maxBitrate&&(d._encoderConfig.bitrateMax=h.maxBitrate/1e3),null!=h.maxFramerate&&(d._encoderConfig.frameRate&&"object"==typeof d._encoderConfig.frameRate?d._encoderConfig.frameRate.max=h.maxFramerate:d._encoderConfig.frameRate={max:h.maxFramerate}),T.debug("[".concat(d.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(d._encoderConfig))),yield s.connection.updateRtpSenderEncodings(d)})()}publishLowStream(n){var i=this;return fs(function*(){if(!i.connection||i.state!==rt.Connected)return;const s=yield dt(i.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const d=i.localTrackMap.get(ne.LocalVideoTrack);if(!d)throw new Q(k.UNEXPECTED_ERROR,"Could not find high stream");if(i.localTrackMap.has(ne.LocalVideoLowTrack))throw new Q(k.UNEXPECTED_ERROR,"[".concat(i.store.clientId,"] Can't publish low stream when stream already publish"));const h=[{track:i.getLowVideoTrack(d.track,n),type:ne.LocalVideoLowTrack}];if(yield*ET(Ph(i.doPublish(i.connection,h))),d.track.muted||!d.track.enabled){var c;const p=null===(c=i.localTrackMap.get(ne.LocalVideoLowTrack))||void 0===c?void 0:c.id;void 0!==p&&(yield dt(i.connection.muteLocal([p])))}}finally{s()}})()}republish(){var n=this;return L(function*(){n.pendingLocalTracks.length>0&&(T.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield cn(n,Te.RequestRePublish,n.pendingLocalTracks),n.emit(Te.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[]),n.pendingLocalDataChannels.length>0&&(T.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),yield cn(n,Te.RequestRePublishDataChannel,n.pendingLocalDataChannels),n.pendingLocalDataChannels=[])})()}reSubscribe(n){var i=this;return L(function*(){for(let s=i.pendingRemoteTracks.length-1;s>=0;s--){const{user:c,kind:d}=i.pendingRemoteTracks[s];(d!==fe.AUDIO||c._audio_added_&&c._audioSSRC)&&(d!==fe.VIDEO||c._video_added_&&c._videoSSRC)||i.pendingRemoteTracks.splice(s,1)}if(n)yield cn(i,Te.RequestReSubscribe,i.pendingRemoteTracks);else for(const{user:s,kind:c}of i.pendingRemoteTracks)yield i.subscribe(s,c,c===fe.VIDEO?s._videoSSRC:s._audioSSRC);i.pendingRemoteTracks.forEach(s=>{let{user:c}=s;i.emit(Te.MediaReconnectEnd,c.uid)}),i.pendingRemoteTracks=[]})()}unpublish(n){var i=this;return L(function*(){if(!i.connection||i.state!==rt.Connected)return void n.forEach(d=>{const h=i.pendingLocalTracks.indexOf(d);-1!==h&&i.pendingLocalTracks.splice(h,1)});const s=i.filterTobeUnpublishedTracks(n);if(0===s.length)return;const c=s.find(d=>"videoLowTrack"===d[0]);return c&&c[1].track.close(),i.doUnpublish(i.connection,s)})()}unpublishDataChannel(n){var i=this;return L(function*(){if(!i.connection||i.state!==rt.Connected)return void n.forEach(c=>{const d=i.pendingLocalDataChannels.indexOf(c);-1!==d&&i.pendingLocalDataChannels.splice(d,1)});const s=i.filterTobeUnpublishedDataChannels(n);return 0!==s.length?(s.forEach(c=>{const d=i.localDataChannels.indexOf(c);-1!==d&&i.localDataChannels.splice(d,1)}),0===i.localDataChannels.length&&(yield i.connection.stopDataChannels(i.store.uid)),s.map(c=>c.id)):void 0})()}unpublishLowStream(){var n=this;return L(function*(){if(!n.connection||n.state!==rt.Connected)return;const i=n.localTrackMap.get(ne.LocalVideoLowTrack);return i?(i.track.close(),n.doUnpublish(n.connection,[[ne.LocalVideoLowTrack,i]])):void 0})()}doUnpublish(n,i){var s=this;return L(function*(){const c=s.createGatewayUnpublishMessage(i);return yield n.stopSending(i.map(d=>{let[,{id:h}]=d;return h})),s.withdrawLocalTracks(i),s.unbindLocalTrackEvents(i.map(d=>{let[h,{track:p}]=d;return{type:h,track:p}})),i.forEach(d=>{let[h]=d;s.statsCollector.removeLocalStats(h)}),0===s.localTrackMap.size&&s.statsUploader.stopUploadUplinkStats(),c})()}subscribeDataChannel(n,i){var s=this;return L(function*(){if(!s.connection||s.state!==rt.Connected)throw new Q(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const c=i.filter(d=>{var h;return!(null!==(h=s.remoteDataChannelMap.get(n))&&void 0!==h&&h.get(d.id))});if(0!==c.length)return yield s.connection.createDataChannels(n.uid,c),c.forEach(d=>{var h;s.remoteDataChannelMap.has(n)?null===(h=s.remoteDataChannelMap.get(n))||void 0===h||h.set(d.id,d):s.remoteDataChannelMap.set(n,new Map([[d.id,d]]));const p=s.pendingRemoteDataChannels.findIndex(m=>{let{user:_,id:E}=m;return _.uid===n.uid&&E===d.id});-1!==p&&s.pendingRemoteDataChannels.splice(p,1)}),c.map(d=>d.id)})()}subscribe(n,i,s,c,d){var h=this;return L(function*(){var p;if(!h.connection||h.state!==rt.Connected)throw new Q(k.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(p=h.remoteUserMap.get(n))&&void 0!==p&&p.has(i))return;let m,_,E;if(d){const b=d.find(P=>{let{stream_type:w}=P;return w===i});if(!b)throw new Q(k.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(i," for user: ").concat(n.uid," because subscribe answer from gateway does not contain stream_type: ").concat(i,"."));const O=yield h.connection.receive(i,b.ssrcs,String(n._uintid),b.attributes);h.connection instanceof mi&&(E=O.transceiver),m=O.track,_=O.id}else{const b=yield h.connection.receive(i,[{ssrcId:s,rtx:c}],String(n._uintid),void 0);h.connection instanceof mi&&(E=b.transceiver),m=b.track,_=b.id}i===fe.AUDIO?(n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(m):(n._audioTrack=new go(m,n.uid,n._uintid,h.store),T.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),E&&n._audioTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(m):(n._videoTrack=new Ta(m,n.uid,n._uintid,h.store),T.info("[".concat(h.store.clientId,"] [").concat(h.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),E&&n._videoTrack._updateRtpTransceiver(E),h.bindRemoteTrackEvents(n,n._videoTrack));const v=h.remoteUserMap.get(n);v?v.set(i,_):h.remoteUserMap.set(n,new Map([[i,_]])),h.statsCollector.addRemoteStats(n.uid),h.statsUploader.startUploadDownlinkStats();const S=h.pendingRemoteTracks.findIndex(b=>{let{user:O,kind:P}=b;return O.uid===n.uid&&i===P});-1!==S&&(h.pendingRemoteTracks.splice(S,1),h.emit(Te.MediaReconnectEnd,n.uid))})()}massSubscribe(n){var i=this;return L(function*(){return i.massSubscribeNoLock(n)})()}massSubscribeNoLock(n){var i=this;return L(function*(){if(!i.connection||i.state!==rt.Connected)throw new Q(k.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");n=n.filter(c=>{var d;let{user:h,mediaType:p}=c;return!(null!==(d=i.remoteUserMap.get(h))&&void 0!==d&&d.has(p))});const s=yield i.connection.batchReceive(n.map(c=>{let{user:d,mediaType:h,ssrcId:p,rtxSsrcId:m}=c;return{kind:h,ssrcMsg:[{ssrcId:p,rtx:m}],mslabel:String(d._uintid)}}));n.forEach((c,d)=>{let{user:h,mediaType:p}=c;const{track:m,id:_,transceiver:E}=s[d];p===fe.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(m):(h._audioTrack=new go(m,h.uid,h._uintid,i.store),T.info("[".concat(i.store.clientId,"] [").concat(i.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),E&&h._audioTrack._updateRtpTransceiver(E),i.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(m):(h._videoTrack=new Ta(m,h.uid,h._uintid,i.store),T.info("[".concat(i.store.clientId,"] [").concat(i.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),E&&h._videoTrack._updateRtpTransceiver(E),i.bindRemoteTrackEvents(h,h._videoTrack));const v=i.remoteUserMap.get(h);v?v.set(p,_):i.remoteUserMap.set(h,new Map([[p,_]])),i.statsCollector.addRemoteStats(h.uid),i.statsUploader.startUploadDownlinkStats();const S=i.pendingRemoteTracks.findIndex(b=>{let{user:O,kind:P}=b;return O.uid===h.uid&&p===P});-1!==S&&(i.pendingRemoteTracks.splice(S,1),i.emit(Te.MediaReconnectEnd,h.uid))})})()}unsubscribe(n,i,s){var c=this;return L(function*(){const d=c.pendingRemoteTracks.filter(m=>{let{user:_,kind:E}=m;return void 0!==i?_.uid===n.uid&&i===E:_.uid===n.uid});if(d.forEach(m=>{const _=c.pendingRemoteTracks.indexOf(m);c.pendingRemoteTracks.splice(_,1)}),c.connection&&c.state===rt.Connected||s||d.forEach(m=>{let{kind:_}=m;var E;if(_===fe.AUDIO)null===(E=n._audioTrack)||void 0===E||E._destroy(),n._audioTrack=void 0;else if(_===fe.VIDEO){var v;null===(v=n._videoTrack)||void 0===v||v._destroy(),n._videoTrack=void 0}}),!c.connection||c.state!==rt.Connected)return;const h=c.filterTobeUnSubscribedTracks(n,i);if(0===h.length)return;yield c.connection.stopReceiving(h.map(m=>{let[,{id:_}]=m;return _}));const p=c.createUnsubscribeMessage(h);return c.withdrawRemoteTracks(h),0===c.remoteUserMap.size&&c.statsUploader.stopUploadDownlinkStats(),h.forEach(m=>{let[_,{kind:E}]=m;var v,S;if(E===fe.VIDEO&&_._videoSSRC&&(null===(v=c.connection)||void 0===v||v.setStatsRemoteVideoIsReady(_._videoSSRC,!1)),E===fe.VIDEO)c.unbindRemoteTrackEvents(_._videoTrack),s||(null===(S=_._videoTrack)||void 0===S||S._destroy(),_._videoTrack=void 0);else if(E===fe.AUDIO){var b;c.unbindRemoteTrackEvents(_._audioTrack),!s&&(null===(b=_._audioTrack)||void 0===b||b._destroy(),_._audioTrack=void 0)}}),p})()}unsubscribeDataChannel(n,i){var s=this;return L(function*(){if(i.forEach(h=>{const p=s.pendingRemoteDataChannels.findIndex(m=>m.id===h.id);-1!==p&&s.pendingRemoteDataChannels.splice(p,1)}),!s.connection)return;const c=s.filterTobeUnSubscribedDataChannels(n,i);if(0===c.length)return;i.forEach(h=>{h._close()});const d=s.remoteDataChannelMap.get(n);return c.forEach(h=>{d&&d.delete(h.id)}),d&&0===d.size&&(s.remoteDataChannelMap.delete(n),yield s.connection.stopDataChannels(n.uid)),c.map(h=>h.id)})()}massUnsubscribe(n){var i=this;return L(function*(){return i.massUnsubscribeNoLock(n)})()}massUnsubscribeNoLock(n){var i=this;return L(function*(){let s=[];for(const{user:h,mediaType:p}of n){const m=i.pendingRemoteTracks.filter(_=>{let{user:E,kind:v}=_;return void 0!==p?E.uid===h.uid&&p===v:E.uid===h.uid});m.forEach(_=>{const E=i.pendingRemoteTracks.indexOf(_);i.pendingRemoteTracks.splice(E,1)}),s=s.concat(m)}if(!i.connection||i.state!==rt.Connected)return void s.forEach(h=>{let{user:p,kind:m}=h;var _;if(m===fe.AUDIO)null===(_=p._audioTrack)||void 0===_||_._destroy(),p._audioTrack=void 0;else if(m===fe.VIDEO){var E;null===(E=p._videoTrack)||void 0===E||E._destroy(),p._videoTrack=void 0}});const c=cd(n).call(n,(h,p)=>{let{user:m,mediaType:_}=p;const E=i.filterTobeUnSubscribedTracks(m,_);return h.concat(E)},[]);if(0===c.length)return;yield i.connection.stopReceiving(c.map(h=>{let[,{id:p}]=h;return p}));const d=i.createUnsubscribeAllMessage(c);return i.withdrawRemoteTracks(c),0===i.remoteUserMap.size&&i.statsUploader.stopUploadDownlinkStats(),c.forEach(h=>{let[p,{kind:m}]=h;var _,E;if(m===fe.VIDEO&&p._videoSSRC&&(null===(_=i.connection)||void 0===_||_.setStatsRemoteVideoIsReady(p._videoSSRC,!1)),m===fe.VIDEO)i.unbindRemoteTrackEvents(p._videoTrack),null===(E=p._videoTrack)||void 0===E||E._destroy(),p._videoTrack=void 0;else if(m===fe.AUDIO){var v;i.unbindRemoteTrackEvents(p._audioTrack),null===(v=p._audioTrack)||void 0===v||v._destroy(),p._audioTrack=void 0}}),d})()}muteRemote(n,i){var s=this;return L(function*(){if(!s.connection)return;const c=s.remoteUserMap.get(n);if(!c)return void T.warning("[".concat(s.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid,"."));if(!c.get(i))return void T.warning("[".concat(s.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."));const d=i===fe.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==d&&s.connection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(n,i){var s=this;return L(function*(){return s.unmuteRemoteNoLock(n,i)})()}unmuteRemoteNoLock(n,i){var s=this;return L(function*(){if(!s.connection)return;const c=s.remoteUserMap.get(n);c?c.get(i)||T.warning("[".concat(s.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(i,".")):T.warning("[".concat(s.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const i=this.localTrackMap.get(ne.LocalAudioTrack);if((null==i?void 0:i.track)instanceof Un){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(c=>{let[d]=c;return d!==ne.LocalAudioTrack}).filter(c=>{let[d]=c;return!(n&&d===ne.LocalVideoLowTrack)}).map(c=>{let[,{track:d}]=c;return d}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return!(n&&c===ne.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(n,i,s,c,d){if(n){const p=this.localTrackMap.get(ne.LocalAudioTrack),m=this.localTrackMap.get(c?ne.LocalVideoLowTrack:ne.LocalVideoTrack);ye.publish(this.store.sessionId,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:null==p?void 0:p.track.getTrackLabel(),videoName:null==m?void 0:m.track.getTrackLabel(),screenshare:-1!==(null==m?void 0:m.track._hints.indexOf(Ht.SCREEN_TRACK)),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;s||(s=[]);const p=s.find(_=>_ instanceof xe),m=c?null===(h=this.localTrackMap.get(ne.LocalVideoTrack))||void 0===h?void 0:h.track:s.find(_=>_ instanceof We);ye.publish(this.store.sessionId,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:null==p?void 0:p.getTrackLabel(),videoName:null==m?void 0:m.getTrackLabel(),screenshare:-1!==(null==m?void 0:m._hints.indexOf(Ht.SCREEN_TRACK)),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,i,s,c){const d=c===fe.VIDEO?s._videoSSRC:s._audioSSRC;d&&ye.subscribe(this.store.sessionId,{succ:n,ec:i,video:c===fe.VIDEO,audio:c===fe.AUDIO,peerid:s.uid,subscribeRequestid:c===fe.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ai.measureFromSubscribeStart(this.store.clientId,d)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ni("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new qn({},this.store):this.isPlanB?new Kn({},this.store):new mi({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(ne.LocalAudioTrack);if((null==n?void 0:n.track)instanceof Un){if(n.track.trackList.length>0){const i=n.track;n.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=rt.Disconnected}getStats(){var n;return null===(n=this.connection)||void 0===n?void 0:n.getStats()}getRemoteVideoIsReady(n){var i;return(null===(i=this.connection)||void 0===i?void 0:i.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(ne.LocalVideoTrack);if(n)return{width:n.track._videoWidth||0,height:n.track._videoHeight||0}}getEncoderConfig(n){const i=this.localTrackMap.get(n);return i&&i.track instanceof We||i&&i.track instanceof xe?i.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}hasRemoteMediaWithLock(n,i){var s=this;return L(function*(){if(!n)return s.remoteUserMap.size>0;const c=s.remoteUserMap.get(n);return!!c&&(!i||c.has(i))})()}getRemoteMedia(n){var i;const s=Array.from(zr(i=this.remoteUserMap).call(i)).find(c=>c.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[c]=s;return{uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(ne.LocalAudioTrack);return i&&n.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=wu(n).call(n,(s,c)=>s.level-c.level),n}disconnectForReconnect(){var n=this;return L(function*(){n.connection&&(T.debug("[".concat(n.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),n.state=rt.Reconnecting,B("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(i=>{let[s]=i;var c;s._videoTrack&&s._videoTrack._player&&(null===(c=s._videoTrack._player.getVideoElement())||void 0===c||c.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),n.connection.close(),n.unbindConnectionEvents(n.connection),n.connection=void 0,n.shouldForwardP2PCreation&&(n.connection=n.store.useDataChannel?new qn({},n.store):n.isPlanB?new Kn({},n.store):new mi({},n.store),n.bindConnectionEvents(n.connection)),0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(i=>{var s;let[c,{track:d}]=i;switch(c){case ne.LocalVideoTrack:Re(s=d._hints).call(s,Ht.LOW_STREAM)?d.close():n.pendingLocalTracks.push(d);break;case ne.LocalAudioTrack:d instanceof Un?n.pendingLocalTracks=n.pendingLocalTracks.concat(d.trackList):n.pendingLocalTracks.push(d)}}),n.emit(Te.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(i=>{let[s,c]=i;Array.from(zr(c).call(c)).forEach(d=>{n.setPendingRemoteMedia(s,d)}),n.emit(Te.MediaReconnectStart,s.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),0!==n.localDataChannels.length&&(n.localDataChannels.forEach(i=>{n.pendingLocalDataChannels.push(i)}),n.localDataChannels.length=0),0!==n.remoteDataChannelMap.size&&(Array.from(n.remoteDataChannelMap.entries()).forEach(i=>{let[s,c]=i;Array.from(zr(c).call(c)).forEach(d=>{n.setPendingRemoteDataChannel(s,d)})}),n.remoteDataChannelMap.clear()),n.statsUploader.stopUploadUplinkStats(),n.statsUploader.stopUploadDownlinkStats(),n.statsUploader.stopUploadTransportStats(),T.debug("[".concat(n.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))})()}hasPendingRemoteDataChannel(n,i){for(const s of this.pendingRemoteDataChannels){const{user:c,id:d}=s;if((n instanceof ji?n.uid:n)===c.uid&&d===i)return!0}return!1}setPendingRemoteDataChannel(n,i){this.hasPendingRemoteDataChannel(n,i)||this.pendingRemoteDataChannels.push({user:n,id:i})}hasPendingRemoteMedia(n,i){for(const s of this.pendingRemoteTracks){const{user:c,kind:d}=s;if((n instanceof ji?n.uid:n)===c.uid&&i===d)return!0}return!1}setPendingRemoteMedia(n,i){this.hasPendingRemoteMedia(n,i)||this.pendingRemoteTracks.push({user:n,kind:i})}restartICE(n){var i=this;return fs(function*(){if(!i.connection||i.state!==rt.Connected||i.connection instanceof qn)return;const s=yield dt(i.mutex.lock("From P2PChannel.restartICE"));let c;try{c=yield dt(i.connection.restartICE(n));const h=yield dt(c.next());if(h.done)return;const p=h.value,m=yield p;switch(i.reportPCDisconnectedOrFailed(n),n){case Si.TCP:i._pcStatsUploadType=js.TCP_RESTART;break;case Si.RELAY:i._pcStatsUploadType=js.RELAY_RESTART;break;default:i._pcStatsUploadType=js.OLD_RESTART}i._isInRestartIce=!0,c.next(m)}catch(h){var d;null===(d=c)||void 0===d||d.throw(h)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats(),i=this.localTrackMap.get(ne.LocalVideoTrack),s=this.localTrackMap.get(ne.LocalAudioTrack),c=n.videoSend.find(O=>O.ssrc===(null==i?void 0:i.ssrcs[0].ssrcId)),d=n.audioSend.find(O=>O.ssrc===(null==s?void 0:s.ssrcs[0].ssrcId));if(!c||!d)return 1;const h=lo(this,Te.NeedSignalRTT),p=c?c.rttMs:void 0,m=d?d.rttMs:void 0,_=p&&m?(p+m)/2:p||m,v=100*n.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,S=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=null==i?void 0:i.track;if(b&&b._encoderConfig&&-1===b._hints.indexOf(Ht.SCREEN_TRACK)){const O=b._encoderConfig.bitrateMax,P=n.bitrate.actualEncoded;if(O&&P){const w=(1e3*O-P)/(1e3*O);return LA[w<.15?0:w<.3?1:w<.45?2:w<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.connection)return 0;const n=this.connection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[c]=s;const d=c._audioSSRC,h=c._videoSSRC,p=n.audioRecv.find(P=>P.ssrc===d),m=n.videoRecv.find(P=>P.ssrc===h);if(!p&&!m)return void(i+=1);const _=lo(this,Te.NeedSignalRTT),E=n.rtt,v=(E&&_?(E+_)/2:E||_)||0,S=p?p.jitterMs:void 0,b=n.recvPacketLossRate;let O=.7*b*100/50+.3*v/1500;S&&(O=.6*b*100/50+.2*v/1500+.2*S/400),i+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}muteLocalTrack(n){var i=this;return L(function*(){return new z((s,c)=>{i.handleMuteLocalTrack(n,s,c)})})()}filterTobePublishedTracks(n,i,s){const c=[],d=Ge(),h=this.getAllTracks();n=ga(n=n.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of n){if(_ instanceof We&&(this.localTrackMap.has(ne.LocalVideoTrack)||p?new Q(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:_,type:ne.LocalVideoTrack}),p=!0),i)){const E=this.getLowVideoTrack(_,s);c.push({track:E,type:ne.LocalVideoLowTrack})}if(_ instanceof xe){const E=this.localTrackMap.get(ne.LocalAudioTrack);if(E){if(!(E.track instanceof Un))throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const v=c.find(S=>{let{type:b}=S;return b===ne.LocalAudioTrack});if(!(v.track instanceof Un))throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_)}else{if(!d.webAudioMediaStreamDest||_ instanceof Un||_._bypassWebAudio)c.push({track:_,type:ne.LocalAudioTrack});else{const v=new Un;v.addAudioTrack(_),c.push({track:v,type:ne.LocalAudioTrack})}m=!0}}}return c}filterTobeUnpublishedTracks(n){const i=[],s=this.getAllTracks();n=ga(n=n.filter(c=>-1!==s.indexOf(c)));for(const c of n){if(c instanceof xe){const d=this.localTrackMap.get(ne.LocalAudioTrack);if(!d)continue;d.track instanceof Un?(d.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),0===d.track.trackList.length&&(i.push([ne.LocalAudioTrack,d]),d.track.close())):i.push([ne.LocalAudioTrack,d])}if(c instanceof We){const d=this.localTrackMap.get(ne.LocalVideoTrack);if(!d)continue;i.push([ne.LocalVideoTrack,d]);const h=this.localTrackMap.get(ne.LocalVideoLowTrack);h&&i.push([ne.LocalVideoLowTrack,h])}}return i}filterTobePublishedDataChannels(n){return(n=ga(n)).filter(i=>-1===this.localDataChannels.findIndex(s=>s.id===i.id))}filterTobeUnpublishedDataChannels(n){return(n=(n=ga(n)).filter(i=>-1!==this.localDataChannels.indexOf(i))).filter(i=>i._originDataChannel)}bindLocalTrackEvents(n){n.forEach(i=>{let{track:s,type:c}=i;switch(c){case ne.LocalVideoTrack:s.addListener(pe.GET_STATS,this.handleGetLocalVideoStats),s.addListener(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(pe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(pe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.addListener(pe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(s)}})}bindLocalAudioTrackEvents(n,i){n instanceof Un?n.trackList.forEach(s=>{s.addListener(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(pe.GET_STATS,this.handleGetLocalAudioStats),s.addListener(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(pe.GET_STATS,this.handleGetLocalAudioStats),n.addListener(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||n.addListener(pe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:c}]=i;return{track:c,type:s}})),n.forEach(i=>{let{track:s,type:c}=i;switch(c){case ne.LocalVideoTrack:s.off(pe.GET_STATS,this.handleGetLocalVideoStats),s.off(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(pe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(pe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.off(pe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s)}})}unbindLocalAudioTrackEvents(n){n instanceof Un?n.trackList.forEach(i=>{i.off(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(pe.GET_STATS,this.handleGetLocalAudioStats),i.off(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(pe.GET_STATS,this.handleGetLocalAudioStats),n.off(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(pe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,i){i instanceof Ta&&i.addListener(pe.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),i instanceof go&&i.addListener(pe.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(pe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;s.has(fe.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(fe.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(n,i){return n.map((s,c)=>{var d;let h,p,{track:m,type:_}=s;switch(_){case ne.LocalAudioTrack:h=bt.Audio,p={dtx:m instanceof ol&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:h=Re(d=m._hints).call(d,Ht.SCREEN_TRACK)?bt.Screen:bt.High,p=ml(ml({},$b(m)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:h=bt.Low,p=ml(ml({},$b(m)),{},{codec:this.store.codec})}return{stream_type:h,attributes:p,ssrcs:i[c]}})}createGatewayUnpublishMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalVideoTrack:c=Re(s=h._hints).call(s,Ht.SCREEN_TRACK)?bt.Screen:bt.High;break;case ne.LocalAudioTrack:c=bt.Audio;break;case ne.LocalVideoLowTrack:c=bt.Low}return{stream_type:c,ssrcs:p,mid:m}})}assignLocalTracks(n,i){n.forEach((s,c)=>{let{track:d,type:h}=s;this.localTrackMap.set(h,{track:d,id:i[c].id,ssrcs:i[c].localSSRC})})}withdrawLocalTracks(n){n.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(n){var i=this;n.onConnectionStateChange=function(){var s=L(function*(c){if(T.info("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(c,")")),i.emit(Te.PeerConnectionStateChange,c),"connected"!==c||i.store.keyMetrics.peerConnectionEnd||i.store.peerConnectionEnd(),"connected"===c&&(i._restartTimer&&(clearTimeout(i._restartTimer),i._restartTimer=void 0),(i._isFirstConnected||i._isInRestartIce)&&i.reportPCStats(Date.now(),!0,i._pcStatsUploadType),i._isInRestartIce=!1,i._isFirstConnected=!1,i._isStartRestartIce=!1),B("NEW_ICE_RESTART")){var d;if(Re(d=i._restartStates).call(d,c)){if(i._isStartRestartIce)return;i._isStartRestartIce=!0;const h=_=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(T.debug("[".concat(i.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(_)),"CONNECTED"===lo(i,Te.QueryClientConnectionState)&&i.emit(Te.RequestRestartICE,_))},p=()=>{"disconnected"!==n.iceConnectionState&&"checking"!==n.iceConnectionState&&"failed"!==n.iceConnectionState||(i.reportPCStats(Date.now(),!1,i._pcStatsUploadType),T.debug("[".concat(i.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>i.emit(Te.P2PLost),0),i.iceFailedCount+=1,i.requestReconnect())},m=B("ICE_RESTART_INTERVAL");return void(i._restartTimer=window.setTimeout(()=>{if(B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ge().supportPCSetConfiguration)h(Si.RELAY),i._restartTimer=window.setTimeout(p,m);else if(Bt())h(Si.UDP),i._restartTimer=window.setTimeout(p,4e3);else{if(h(Si.TCP),Ge().supportPCSetConfiguration)return void(i._restartTimer=window.setTimeout(()=>{h(Si.RELAY),i._restartTimer=window.setTimeout(p,m)},m));i._restartTimer=window.setTimeout(p,m)}},800))}}else{if("disconnected"===c&&"disconnected"===n.iceConnectionState)return setTimeout(()=>{"disconnected"===n.iceConnectionState&&B("ICE_RESTART")&&"CONNECTED"===lo(i,Te.QueryClientConnectionState)&&i.emit(Te.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===n.peerConnectionState&&(T.debug("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),i.reportPCStats(Date.now(),!1,i._pcStatsUploadType),i._isInRestartIce=!1,setTimeout(()=>i.emit(Te.P2PLost),0),i.iceFailedCount+=1,i.requestReconnect())},4e3);"failed"===c&&(T.debug("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection state failed, force reconnect")),i.reportPCDisconnectedOrFailed(),setTimeout(()=>i.emit(Te.P2PLost),0),i.iceFailedCount+=1,yield i.requestReconnect())}});return function(c){return s.apply(this,arguments)}}(),n.onICEConnectionStateChange=s=>{"connected"!==s||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),ye.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:nn.TRACER}).onSuccess(),this.emit(Te.IceConnectionStateChange,s)},n.onICETransportStateChange=s=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},n.onDTLSTransportStateChange=s=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},n.onDTLSTransportError=s=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},n.onFirstAudioDecoded=s=>{var c;const d=Array.from(zr(c=this.remoteUserMap).call(c)).find(p=>p._audioSSRC===s);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(ch.FIRST_FRAME_DECODED),ye.firstRemoteFrame(this.store.sessionId,ii.FIRST_AUDIO_DECODE,Kt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=s=>{var c;const d=Array.from(zr(c=this.remoteUserMap).call(c)).find(h=>h._audioSSRC===s);d&&ye.firstRemoteFrame(this.store.sessionId,ii.FIRST_AUDIO_RECEIVED,Kt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(s,c,d)=>{this.reportVideoFirstFrameDecoded(s,c,d)},n.onFirstVideoReceived=s=>{var c;const d=Array.from(zr(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===s);d&&ye.firstRemoteFrame(this.store.sessionId,ii.FIRST_VIDEO_RECEIVED,Kt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(s,c)=>{const d="relay"===s.candidateType;"unknown"!==c.candidateType&&d===("relay"===c.candidateType)||this.emit(Te.ConnectionTypeChange,d),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(mc(c))," -> ").concat(JSON.stringify(mc(s)),")"))},n.onSelectedRemoteCandidateChanged=(s,c)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(mc(c))," -> ").concat(JSON.stringify(mc(s)),")"))},n.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(n){const i=[];if(-1===this.getAllTracks().indexOf(n))return i;const s=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof xe&&(null==s?void 0:s.track)instanceof Un)return s.track.isActive||i.push([ne.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c&&(i.push(c),c[0]===ne.LocalVideoTrack)){const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&i.push([ne.LocalVideoLowTrack,d])}return i}filterTobeUnmutedTracks(n){const i=[],s=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof xe&&(null==s?void 0:s.track)instanceof Un)return s.track.isActive&&i.push([ne.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c)if(c[0]===ne.LocalVideoTrack){i.push(c);const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&i.push([ne.LocalVideoLowTrack,d])}else i.push(c);return i}createMuteMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalAudioTrack:c=bt.Audio;break;case ne.LocalVideoTrack:c=Re(s=h._hints).call(s,Ht.SCREEN_TRACK)?bt.Screen:bt.High;break;case ne.LocalVideoLowTrack:c=bt.Low}return{stream_type:c,ssrcs:p,mid:m}})}createUnmuteMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalAudioTrack:c=bt.Audio;break;case ne.LocalVideoTrack:c=Re(s=h._hints).call(s,Ht.SCREEN_TRACK)?bt.Screen:bt.High;break;case ne.LocalVideoLowTrack:c=bt.Low}return{stream_type:c,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(n,i){const s=[],c=this.remoteUserMap.get(n);if(!c)return s;if(i){const d=c.get(i);if(!d)return s;s.push([n,{kind:i,id:d}])}else Array.from(c.entries()).forEach(d=>{let[h,p]=d;s.push([n,{kind:h,id:p}])});return s}filterTobeUnSubscribedDataChannels(n,i){const s=[];return i.forEach(c=>{var d;null!==(d=this.remoteDataChannelMap.get(n))&&void 0!==d&&d.has(c.id)&&s.push(c)}),s}createUnsubscribeMessage(n){const i=[];return n.forEach(s=>{let[c,{kind:d}]=s;switch(d){case fe.VIDEO:return void(c._videoSSRC&&i.push({stream_type:fe.VIDEO,ssrcId:c._videoSSRC}));case fe.AUDIO:return void(c._audioSSRC&&i.push({stream_type:fe.AUDIO,ssrcId:c._audioSSRC}))}}),i}createUnsubscribeAllMessage(n){const i=new Map;return n.forEach(s=>{let[c,{kind:d}]=s;if(i.has(c)){let h=i.get(c);h|=d===fe.VIDEO?Fn.Video:Fn.Audio,i.set(c,h)}else i.set(c,d===fe.VIDEO?Fn.Video:Fn.Audio)}),{users:Array.from(i.entries()).map(s=>{let[c,d]=s;return{stream_id:c.uid,stream_type:d}})}}withdrawRemoteTracks(n){n.forEach(i=>{let[s,{kind:c}]=i;const d=this.remoteUserMap.get(s);d&&(d.delete(c),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(s))})}updateBitrateLimit(n){var i=this;return L(function*(){const s=i.localTrackMap.get(ne.LocalVideoTrack),c=i.localTrackMap.get(ne.LocalVideoLowTrack);s&&(yield s.track.setBitrateLimit(n.uplink)),c&&n.low_stream_uplink&&(yield c.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(n,i){return n.map((s,c)=>{var d;let{stream_type:h}=s;return null===(d=i.find(p=>{let{stream_type:m}=p;return h===m}))||void 0===d?void 0:d.attributes})}tryToUnmuteAudio(n){var i=this;return L(function*(){for(let c=0;c<n.length;c++)if(n[c]instanceof xe){var s;const d=i.filterTobeUnmutedTracks(n[c]);if(0===d.length)continue;yield null===(s=i.connection)||void 0===s?void 0:s.unmuteLocal(d.map(p=>{let[,{id:m}]=p;return m}));const h=i.createUnmuteMessage(d);return void(yield Lt(i,Te.RequestUnmuteLocal,h))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var i;return!(null===(i=this.connection)||void 0===i||!i.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,i)=>this.emit(Te.RequestUploadStats,n,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return L(function*(){n.dtlsFailedCount+=1,yield pi(qu(n.dtlsFailedCount,Ln)),n.emit(Te.RequestReconnect)})()}reconnectP2P(){var n=this;return L(function*(){const i=Array.from(n.localTrackMap.entries()),s=n.createGatewayUnpublishMessage(i);Array.from(n.remoteUserMap.entries()),s.length>0&&(yield cn(n,Te.RequestUnpublishForReconnectPC,s)),n.disconnectForReconnect(),n.emit(Te.RequestReconnectPC)})()}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof We)}throwIfTrackTypeNotMatch(n){if(n.filter(i=>i instanceof We).length>1)throw new Q(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(i=>i instanceof xe).length>1&&(n.some(i=>i instanceof xe&&i._bypassWebAudio)||!Ge().webAudioMediaStreamDest))throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of n){if(i instanceof We&&this.pendingLocalTracks.some(s=>s instanceof We))throw new Q(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof xe&&this.pendingLocalTracks.some(s=>s instanceof xe)&&(!Ge().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof xe&&s._bypassWebAudio)))throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,i){const s=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding,c=ml(ml({},{width:160,height:120,framerate:15,bitrate:50}),i);let d;d=s?n._mediaStreamTrack.clone():EO(n,c);const h=Ot(8,"track-low-"),p=new We(d,ml(ml({},s&&{scaleResolutionDownBy:sm(c,n)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(Mf.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,hd.LOW_STREAM)}),p._hints.push(Ht.LOW_STREAM),n.addListener(pe.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return L(function*(){return n.mutex.lock("From P2PChannel.globalLock")})()}reportPCStats(n,i,s){var c=arguments,d=this;return L(function*(){let h=c.length>3&&void 0!==c[3]?c[3]:null;if(d.connection&&d.connection instanceof mi){var p,m,_,E;const v=d.store.keyMetrics.descriptionStart||0,{iceConnectionState:S,dtlsTransportState:b,peerConnectionState:O}=d.connection,{local:P,remote:w}=yield d.connection.getSelectedCandidatePair();ye.pcStats(d.store.sessionId,{startTime:v,eventElapse:n-v||0,iceconnectionsate:S,dtlsstate:b,connectionstate:O,intSucc:i?1:2,error:h,selectedLocalCandidateProtocol:null!==(p=null==P?void 0:P.protocol)&&void 0!==p?p:"",selectedLocalCandidateType:null!==(m=P.candidateType)&&void 0!==m?m:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:null!==(_=w.protocol)&&void 0!==_?_:"",selectedRemoteCandidateType:null!==(E=w.candidateType)&&void 0!==E?E:"",selectedRemoteCandidateAddress:"".concat(w.address,":").concat(w.port),restartCnt:s})}})()}reportVideoFirstFrameDecoded(n,i,s,c){var d;const h=Array.from(zr(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===n);if(h){c||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);ye.firstRemoteVideoDecode(this.store.sessionId,ii.FIRST_VIDEO_DECODE,Kt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:(null==m?void 0:m.subscribeEnd)||0,subscriberStart:(null==m?void 0:m.subscribeStart)||0,videoAddNotify:(null==m?void 0:m.streamAdded)||0,state:c?1:0})}}remoteMediaSsrcChanged(n,i,s){var c=this;return L(function*(){if(!c.connection)return!1;const d=c.remoteUserMap.get(n);if(!d)return!1;const h=d.get(i);if(!h)return!1;const p=yield c.connection.getRemoteSSRC(h);return void 0!==p&&p!==s})()}resetConnection(n){T.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(n)),this.state===rt.Connected?(T.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=n===Af.datachannel?new qn({},this.store):this.isPlanB?new Kn({},this.store):new mi({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s}]=n;i===ne.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,hd.LOW_STREAM):s._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(n){this.connection&&this.connection instanceof mi&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===js.TCP_RESTART&&n===Si.RELAY?this._pcStatsUploadType:js.DISCONNECTED_OR_FAILED)))}}function Xi(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=L(function*(){const c=this.mutex,d=yield c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}function mx(o){let n={};e:for(;!RO(o);){let i=Da(o);switch(i>>>3){case 0:break e;case 1:n.requestId=MT(o,Da(o));break;case 2:n.requestType=Da(o)>>>0;break;case 3:n.scorePorn=Cv(o);break;case 4:n.scoreSexy=Cv(o);break;case 5:n.scoreNeutral=Cv(o);break;case 6:n.requestScene=Da(o)>>>0;break;case 7:n.scene=Da(o)>>>0;break;default:NT(o,7&i)}}return n}function OT(o,n){let i=o.service;void 0!==i&&(_t(n,8),_t(n,i));let s=o.vendor;void 0!==s&&(_t(n,16),_t(n,s));let c=o.token;void 0!==c&&(_t(n,26),Fr(n,c));let d=o.callbackUrl;void 0!==d&&(_t(n,34),Fr(n,d))}function _x(o){let n=Da(o),i=o.limit;return o.limit=o.offset+n,i}function NT(o,n){switch(n){case 0:for(;128&LT(o););break;case 2:Cm(o,Da(o));break;case 5:Cm(o,4);break;case 1:Cm(o,8);break;default:throw new Error("Unimplemented type: "+n)}}te([Xi,N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",z)],ai.prototype,"startP2PConnection",null),te([Xi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],ai.prototype,"connect",null),te([Xi,N("design:type",Function),N("design:paramtypes",[Object,Object,Array,Object,String,String]),N("design:returntype",z)],ai.prototype,"preConnect",null),te([Xi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"publishDataChannel",null),te([Xi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"unpublish",null),te([Xi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"unpublishDataChannel",null),te([Xi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],ai.prototype,"unpublishLowStream",null),te([Xi,N("design:type",Function),N("design:paramtypes",[ji,Array]),N("design:returntype",z)],ai.prototype,"subscribeDataChannel",null),te([Xi,N("design:type",Function),N("design:paramtypes",[ji,String,Number,Number,Array]),N("design:returntype",z)],ai.prototype,"subscribe",null),te([Xi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"massSubscribe",null),te([Xi,N("design:type",Function),N("design:paramtypes",[ji,String,Boolean]),N("design:returntype",z)],ai.prototype,"unsubscribe",null),te([Xi,N("design:type",Function),N("design:paramtypes",[ji,Array]),N("design:returntype",z)],ai.prototype,"unsubscribeDataChannel",null),te([Xi,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],ai.prototype,"massUnsubscribe",null),te([Xi,N("design:type",Function),N("design:paramtypes",[ji,String]),N("design:returntype",z)],ai.prototype,"muteRemote",null),te([Xi,N("design:type",Function),N("design:paramtypes",[ji,String]),N("design:returntype",z)],ai.prototype,"unmuteRemote",null),te([Xi,N("design:type",Function),N("design:paramtypes",[ji,String]),N("design:returntype",z)],ai.prototype,"hasRemoteMediaWithLock",null),te([Xi,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],ai.prototype,"disconnectForReconnect",null),te([Xi,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],ai.prototype,"updateBitrateLimit",null),te([Xi,N("design:type",Function),N("design:paramtypes",[ji,String,Number]),N("design:returntype",z)],ai.prototype,"remoteMediaSsrcChanged",null);let gx=new Float32Array(1);new Uint8Array(gx.buffer);let Sm=new Float64Array(1),xr=new Uint8Array(Sm.buffer);function kh(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let PT=[];function TO(){const o=PT.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}function GU(o){PT.push(o)}function Cm(o,n){if(o.offset+n>o.limit)throw new Error("Skip past limit");o.offset+=n}function RO(o){return o.offset>=o.limit}function Dd(o,n){let i=o.bytes,s=o.offset,c=o.limit,d=s+n;if(d>i.length){let h=new Uint8Array(2*d);h.set(i),o.bytes=h}return o.offset=d,d>c&&(o.limit=d),s}function kT(o,n){let i=o.offset;if(i+n>o.limit)throw new Error("Read past limit");return o.offset+=n,i}function MT(o,n){let i=kT(o,n),s=String.fromCharCode,c=o.bytes,d="\ufffd",h="";for(let p=0;p<n;p++){let m,_,E,v,S=c[p+i];0==(128&S)?h+=s(S):192==(224&S)?p+1>=n?h+=d:(m=c[p+i+1],128!=(192&m)?h+=d:(v=(31&S)<<6|63&m,v<128?h+=d:(h+=s(v),p++))):224==(240&S)?p+2>=n?h+=d:(m=c[p+i+1],_=c[p+i+2],32896!=(49344&(m|_<<8))?h+=d:(v=(15&S)<<12|(63&m)<<6|63&_,v<2048||v>=55296&&v<=57343?h+=d:(h+=s(v),p+=2))):240==(248&S)?p+3>=n?h+=d:(m=c[p+i+1],_=c[p+i+2],E=c[p+i+3],8421504!=(12632256&(m|_<<8|E<<16))?h+=d:(v=(7&S)<<18|(63&m)<<12|(63&_)<<6|63&E,v<65536||v>1114111?h+=d:(v-=65536,h+=s(55296+(v>>10),56320+(1023&v)),p+=3))):h+=d}return h}function Fr(o,n){let i=n.length,s=0;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),s+=p<128?1:p<2048?2:p<65536?3:4}_t(o,s);let c=Dd(o,s),d=o.bytes;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function Ex(o,n){let i=Dd(o,n.limit),s=o.bytes,c=n.bytes;for(let d=0,h=n.limit;d<h;d++)s[d+i]=c[d]}function LT(o){return o.bytes[kT(o,1)]}function IO(o,n){let i=Dd(o,1);o.bytes[i]=n}function Cv(o){let n=kT(o,8),i=o.bytes;return xr[0]=i[n++],xr[1]=i[n++],xr[2]=i[n++],xr[3]=i[n++],xr[4]=i[n++],xr[5]=i[n++],xr[6]=i[n++],xr[7]=i[n++],Sm[0]}function xT(o,n){let i=Dd(o,8),s=o.bytes;Sm[0]=n,s[i++]=xr[0],s[i++]=xr[1],s[i++]=xr[2],s[i++]=xr[3],s[i++]=xr[4],s[i++]=xr[5],s[i++]=xr[6],s[i++]=xr[7]}function Da(o){let n,i=0,s=0;do{n=LT(o),i<32&&(s|=(127&n)<<i),i+=7}while(128&n);return s}function _t(o,n){for(n>>>=0;n>=128;)IO(o,127&n|128),n>>>=7;IO(o,n)}function Oa(o,n){let i=n.low>>>0,s=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,d=0===c?0===s?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=Dd(o,d),p=o.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=9!==d?128|c:127&c;case 8:p[h+7]=8!==d?s>>>21|128:s>>>21&127;case 7:p[h+6]=7!==d?s>>>14|128:s>>>14&127;case 6:p[h+5]=6!==d?s>>>7|128:s>>>7&127;case 5:p[h+4]=5!==d?128|s:127&s;case 4:p[h+3]=4!==d?i>>>21|128:i>>>21&127;case 3:p[h+2]=3!==d?i>>>14|128:i>>>14&127;case 2:p[h+1]=2!==d?i>>>7|128:i>>>7&127;case 1:p[h]=1!==d?128|i:127&i}}function wO(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}const AO=new Map([["moderation",1],["supervise",2]]);class bv extends jt{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Wn.CONNECTION_STATE_CHANGE,i,n)}get inspectType(){return this._inspectType}set inspectType(n){var i;this._inspectMode=cd(i=n.map(s=>AO.get(s)||0)).call(i,(s,c)=>s+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),C(this,"name","AgoraRTCVideoContentInspect"),C(this,"_connectionState",$r.CONNECTING),C(this,"_innerConnectionState",void 0),C(this,"sequence",0),C(this,"inspectStartTime",void 0),C(this,"workerManagerConnection",void 0),C(this,"workerConnection",void 0),C(this,"workerMessageLengthLimit",void 0),C(this,"inspectIntervalMinimum",void 0),C(this,"qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",Hn.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"wmSequence",0),C(this,"inspectInterval",void 0),C(this,"inspectTimer",null),C(this,"ossFilePrefix",void 0),C(this,"extraInfo",void 0),C(this,"_inspectType",void 0),C(this,"_inspectMode",void 0),C(this,"_quality",1),C(this,"qualityTimer",null),C(this,"_inspectId",void 0),C(this,"_needWorkUrlOnly",!1),C(this,"inspectImage",()=>{if(this.connectionState!==$r.CONNECTED)throw new W(k.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===$r.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ot(5,"inspect-"),this.workerMessageLengthLimit=B("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=B("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=B("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new sh("worker-manager-"+this._inspectId,Ln),this.on(Wn.STATE_CHANGE,(i,s)=>{this._innerConnectionState=i,T.debug("[".concat(this._inspectId,"] Inspect operation :").concat(po[i]," ").concat(s||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new sh("worker-"+this._inspectId,Ln),this.handleWorkerEvents()}init(n,i){var s=this;return L(function*(){s.emit(Wn.STATE_CHANGE,po.CONNECT_AP),s._connectInfo=n;const c=s._cancelTokenSource.token;return s._retryConfig=i,new z((d,h)=>{s.on(Wn.CONNECTION_STATE_CHANGE,(p,m)=>{m===$r.CONNECTED&&d()}),s.requestAP(n,c,i).then(p=>{s.connectWorkerManager(p)}).catch(p=>{h(p)})})})()}requestAP(n,i,s){var c=this;return L(function*(){const d=B("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),h=yield function(m,_,E,v){let{appId:S,areaCode:b,cname:O,sid:P,token:w,uid:M}=_;bd++;const V="image_moderation_api",U={service_name:V,json_body:JSON.stringify({appId:S,areaCode:b,cname:O,command:"allocateEdge",requestId:bd,seq:bd,sid:P,token:w,ts:Date.now(),uid:M+""})};let Y,ie,K=m[0];return Fs(L(function*(){Y=Date.now();const X=yield pl(K,{data:U,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ie=Date.now()-Y,0!==X.code){const Ee=new W(k.UNEXPECTED_RESPONSE,"image inspect ap error, code"+X.code,{retry:!0,responseTime:ie});throw T.error(Ee.toString()),Ee}const $=JSON.parse(X.json_body);if(200!==$.code){const Ee=new W(k.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:ie});throw T.error(Ee.toString()),Ee}if(!$.servers||!Array.isArray($.servers)||0===$.servers.length){const Ee=new W(k.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:$.code,responseTime:ie});throw T.error(Ee.toString()),Ee}const J=B("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ge=B("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:$.servers.map(Ee=>{let{address:ze,wss:ht}=Ee;if(ze&&ht)return"wss://".concat(ze.replace(/\./g,"-"),".").concat(J,":").concat(ge||ht)}).filter(Ee=>!!Ee),workerToken:$.workerToken,vid:$.vid,responseTime:ie}}),(X,$)=>(ye.apworkerEvent(P,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(X.addressList),firstSuccess:0===$,responseTime:ie,serverIp:m[$%m.length]}),!1),(X,$)=>(ye.apworkerEvent(P,{success:!1,sc:X.data&&X.data.code||200,serviceName:V,responseTime:ie,serverIp:m[$%m.length]}),!!(X.code!==k.OPERATION_ABORTED&&X.code!==k.UNEXPECTED_RESPONSE||X.data&&X.data.retry)&&(K=m[($+1)%m.length],!0)),v)}(d,n,i,s);c.emit(Wn.STATE_CHANGE,po.AP_CONNECTED);const{addressList:p}=h;return c.wmSequence++,p})()}connectWorkerManager(n){var i=arguments,s=this;return L(function*(){s._needWorkUrlOnly=i.length>1&&void 0!==i[1]&&i[1],s.emit(Wn.STATE_CHANGE,po.CONNECT_WORKER_MANAGER),yield s.workerManagerConnection.init(n,1e4)})()}connectWorker(n){var i=this;return L(function*(){yield i.workerConnection.init([n])})()}handleWorkerManagerEvents(){var n=this;this.workerManagerConnection.on(we.CONNECTED,L(function*(){n.emit(Wn.STATE_CHANGE,po.WORKER_MANAGER_CONNECTED,n.workerManagerConnection.url),n.workerManagerConnection.sendMessage({appId:n._connectInfo.appId,cname:n._connectInfo.cname,uid:n._connectInfo.uid+"",sdkVersion:"4.19.1",sid:n._connectInfo.sid,seq:n.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(we.CLOSED,()=>{this._innerConnectionState<po.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(we.FAILED,()=>{this._innerConnectionState<po.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(we.RECONNECTING,()=>{this._innerConnectionState<po.GET_WORKER_MANAGER_RESPONSE&&T.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(we.ON_MESSAGE,function(){var i=L(function*(s){n.emit(Wn.STATE_CHANGE,po.GET_WORKER_MANAGER_RESPONSE);const c=n.workerManagerConnection.url;n.workerManagerConnection.close();const d=JSON.parse(s.data);if(200!==d.code)throw T.error("[".concat(n._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new W(k.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&c))throw T.error("[".concat(n._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new W(k.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=B("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,p=c.replace(/:\d+\/?$/,":".concat(h));n.emit(Wn.STATE_CHANGE,po.CONNECT_WORKER,p),n._needWorkUrlOnly?n.emit(Wn.REQUEST_NEW_WORKER_URL,p):yield n.connectWorker(p)}});return function(s){return i.apply(this,arguments)}}()),this.workerManagerConnection.on(we.WILL_RECONNECT,(i,s,c)=>{c(i)}),this.workerManagerConnection.on(we.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}handleWorkerEvents(){var n=this;this.workerConnection.on(we.CONNECTED,L(function*(){n.emit(Wn.STATE_CHANGE,po.WORKER_CONNECTED,n.workerConnection.url),n.connectionState=$r.CONNECTED})),this.workerConnection.on(we.ON_MESSAGE,function(){var i=L(function*(s){if(s.data instanceof ArrayBuffer){const d=function bO(o){return function(i){let s={};e:for(;!RO(i);){let c=Da(i);switch(c>>>3){case 0:break e;case 1:s.code=Da(i);break;case 2:s.msg=MT(i,Da(i));break;case 3:{let d=_x(i);s.data=mx(i),i.limit=d;break}default:NT(i,7&c)}}return s}({bytes:n=o,offset:0,limit:n.length});var n}(new Uint8Array(s.data));if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&T.debug("[".concat(n._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),200===d.code){if(Array.isArray(n.inspectType)&&1===n.inspectType.length&&"supervise"===n.inspectType[0])return void n.emit(Wn.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var c;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},p=cd(c=Object.keys(h)).call(c,(_,E)=>h[_]>h[E]?_:E,"porn"),m=Object.keys(h).find(_=>_===p);n.emit(Wn.INSPECT_RESULT,m)}else n.emit(Wn.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else n.emit(Wn.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else T.error("[".concat(n._inspectId,"] Unexpected message type from worker")),n.emit(Wn.INSPECT_RESULT,void 0,new W(k.UNEXPECTED_RESPONSE,"invalid worker message type"))});return function(s){return i.apply(this,arguments)}}()),this.workerConnection.on(we.CLOSED,()=>{this.connectionState=$r.CLOSED}),this.workerConnection.on(we.FAILED,()=>{this.connectionState=$r.CLOSED}),this.workerConnection.on(we.RECONNECTING,()=>{this.connectionState=this.connectionState===$r.CONNECTED?$r.RECONNECTING:$r.CONNECTING}),this.workerConnection.on(we.WILL_RECONNECT,(i,s,c)=>{"recover"===i&&c(i),c("tryNext")}),this.workerConnection.on(we.REQUEST_NEW_URLS,(i,s)=>{this.workerManagerConnection.close(),this.once(Wn.REQUEST_NEW_WORKER_URL,c=>{i([c])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(c=>{this.connectWorkerManager(c,!0)}).catch(c=>{s(c)})})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}requestToInspectImage(){var n=this;return L(function*(){n.sequence++;const i=lo(n,Wn.CLIENT_LOCAL_VIDEO_TRACK),s={appId:n._connectInfo.appId,cname:n._connectInfo.cname,cid:n._connectInfo.cid,sid:n._connectInfo.sid,uid:n._connectInfo.uid,vid:n._connectInfo.vid};if(i){if(!i.isPlaying)return void n.emit(Wn.INSPECT_RESULT,void 0,new W(k.INVALID_OPERATION,"Only the track being played can be inspected"));const c=yield n.generateRequestData(i,s);n.workerConnection.sendMessage(c,!0,!0)}else n.emit(Wn.INSPECT_RESULT,void 0,new W(k.INVALID_OPERATION,"Only the track being published can be inspected"))})()}generateRequestData(n,i){var s=this;return L(function*(){let{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_}=i;const E=Date.now(),v=yield n.getCurrentFrameImage("image/jpeg",s.quality),S=yield Rb(v,c,d),b=s.sequence+"-"+h+"-"+_+"-"+E+"-"+Ot(12,""),O={appId:c,cid:h,cname:d,deviceId:"",elapse:bv.intToLong(Number(E-s.inspectStartTime)),fileSize:S.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:S,networkType:6,osType:7,requestId:b,sdkVersion:"4.19.1",sequence:s.sequence,sid:m,timestamp:bv.intToLong(E),uid:_,vid:p,service:s._inspectMode,callbackData:s.extraInfo,ossFilePrefix:s.ossFilePrefix};void 0===s.extraInfo&&delete O.callbackData,void 0===s.ossFilePrefix&&delete O.ossFilePrefix;const P=function DT(o){let n=TO();return function(i,s){let c=i.appId;void 0!==c&&(_t(s,10),Fr(s,c));let d=i.cid;void 0!==d&&(_t(s,16),_t(s,d));let h=i.cname;void 0!==h&&(_t(s,26),Fr(s,h));let p=i.deviceId;void 0!==p&&(_t(s,34),Fr(s,p));let m=i.elapse;void 0!==m&&(_t(s,40),Oa(s,m));let _=i.fileSize;void 0!==_&&(_t(s,48),Oa(s,kh(_)));let E=i.height;void 0!==E&&(_t(s,56),Oa(s,kh(E)));let v=i.jpg;void 0!==v&&(_t(s,66),_t(s,v.length),function(Ct,ee){let ae=Dd(Ct,ee.length);Ct.bytes.set(ee,ae)}(s,v));let S=i.networkType;void 0!==S&&(_t(s,72),Oa(s,kh(S)));let b=i.osType;void 0!==b&&(_t(s,80),Oa(s,kh(b)));let O=i.requestId;void 0!==O&&(_t(s,90),Fr(s,O));let P=i.sdkVersion;void 0!==P&&(_t(s,98),Fr(s,P));let w=i.sequence;void 0!==w&&(_t(s,104),Oa(s,kh(w)));let M=i.sid;void 0!==M&&(_t(s,114),Fr(s,M));let V=i.timestamp;void 0!==V&&(_t(s,120),Oa(s,V));let U=i.uid;void 0!==U&&(_t(s,128),_t(s,U));let Y=i.vid;void 0!==Y&&(_t(s,136),_t(s,Y));let ie=i.width;void 0!==ie&&(_t(s,144),Oa(s,kh(ie)));let K=i.service;void 0!==K&&(_t(s,152),_t(s,K));let X=i.callbackData;void 0!==X&&(_t(s,162),Fr(s,X));let $=i.jpgEncryption;void 0!==$&&(_t(s,168),_t(s,$));let J=i.requestType;void 0!==J&&(_t(s,176),_t(s,J));let ge=i.scorePorn;void 0!==ge&&(_t(s,185),xT(s,ge));let Ee=i.scoreSexy;void 0!==Ee&&(_t(s,193),xT(s,Ee));let ze=i.scoreNeutral;void 0!==ze&&(_t(s,201),xT(s,ze));let ht=i.scene;void 0!==ht&&(_t(s,208),_t(s,ht));let St=i.ossFilePrefix;void 0!==St&&(_t(s,218),Fr(s,St));let st=i.serviceVendor;if(void 0!==st)for(let Ct of st){_t(s,226);let ee=TO();OT(Ct,ee),_t(s,ee.limit),Ex(s,ee),GU(ee)}}(o,n),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(n)}(O);if(P.byteLength<s.workerMessageLengthLimit){if(B("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const w=function(M){for(var V=1;V<arguments.length;V++){var U=null!=arguments[V]?arguments[V]:{};V%2?wO(Object(U),!0).forEach(function(Y){C(M,Y,U[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(U)):wO(Object(U)).forEach(function(Y){Object.defineProperty(M,Y,Object.getOwnPropertyDescriptor(U,Y))})}return M}({},O);delete w.jpg,T.debug("[".concat(s._inspectId,"] Request message for worker of inspect content "),JSON.stringify(w))}return P}return s.quality=s.quality*s.qualityRatio,yield s.generateRequestData(n,{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Hn.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=$r.CLOSED,this.emit(Wn.STATE_CHANGE,po.CLOSED)}}function OO(o,n){switch(n){case 0:for(;128&gs(o););break;case 2:PO(o,bm(o));break;case 5:PO(o,4);break;case 1:PO(o,8);break;default:throw new Error("Unimplemented type: "+n)}}function Mh(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let NO=[];function PO(o,n){if(o.offset+n>o.limit)throw new Error("Skip past limit");o.offset+=n}function WU(o){return o.offset>=o.limit}function FT(o,n){let i=o.bytes,s=o.offset,c=o.limit,d=s+n;if(d>i.length){let h=new Uint8Array(2*d);h.set(i),o.bytes=h}return o.offset=d,d>c&&(o.limit=d),s}function kO(o,n){let i=o.offset;if(i+n>o.limit)throw new Error("Read past limit");return o.offset+=n,i}function yx(o,n){let i=FT(o,n.length);o.bytes.set(n,i)}function UT(o,n){let i=kO(o,n),s=String.fromCharCode,c=o.bytes,d="\ufffd",h="";for(let p=0;p<n;p++){let m,_,E,v,S=c[p+i];0==(128&S)?h+=s(S):192==(224&S)?p+1>=n?h+=d:(m=c[p+i+1],128!=(192&m)?h+=d:(v=(31&S)<<6|63&m,v<128?h+=d:(h+=s(v),p++))):224==(240&S)?p+2>=n?h+=d:(m=c[p+i+1],_=c[p+i+2],32896!=(49344&(m|_<<8))?h+=d:(v=(15&S)<<12|(63&m)<<6|63&_,v<2048||v>=55296&&v<=57343?h+=d:(h+=s(v),p+=2))):240==(248&S)?p+3>=n?h+=d:(m=c[p+i+1],_=c[p+i+2],E=c[p+i+3],8421504!=(12632256&(m|_<<8|E<<16))?h+=d:(v=(7&S)<<18|(63&m)<<12|(63&_)<<6|63&E,v<65536||v>1114111?h+=d:(v-=65536,h+=s(55296+(v>>10),56320+(1023&v)),p+=3))):h+=d}return h}function Od(o,n){let i=n.length,s=0;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),s+=p<128?1:p<2048?2:p<65536?3:4}Bn(o,s);let c=FT(o,s),d=o.bytes;for(let h=0;h<i;h++){let p=n.charCodeAt(h);p>=55296&&p<=56319&&h+1<i&&(p=(p<<10)+n.charCodeAt(++h)-56613888),p<128?d[c++]=p:(p<2048?d[c++]=p>>6&31|192:(p<65536?d[c++]=p>>12&15|224:(d[c++]=p>>18&7|240,d[c++]=p>>12&63|128),d[c++]=p>>6&63|128),d[c++]=63&p|128)}}function gs(o){return o.bytes[kO(o,1)]}function Sx(o,n){let i=FT(o,1);o.bytes[i]=n}function bm(o){let n,i=0,s=0;do{n=gs(o),i<32&&(s|=(127&n)<<i),i+=7}while(128&n);return s}function Bn(o,n){for(n>>>=0;n>=128;)Sx(o,127&n|128),n>>>=7;Sx(o,n)}function Cx(o,n){let i,s=0,c=0,d=0;return i=gs(o),s=127&i,128&i&&(i=gs(o),s|=(127&i)<<7,128&i&&(i=gs(o),s|=(127&i)<<14,128&i&&(i=gs(o),s|=(127&i)<<21,128&i&&(i=gs(o),c=127&i,128&i&&(i=gs(o),c|=(127&i)<<7,128&i&&(i=gs(o),c|=(127&i)<<14,128&i&&(i=gs(o),c|=(127&i)<<21,128&i&&(i=gs(o),d=127&i,128&i&&(i=gs(o),d|=(127&i)<<7))))))))),{low:s|c<<28,high:c>>>4|d<<24,unsigned:n}}function _l(o,n){let i=n.low>>>0,s=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,d=0===c?0===s?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:c<128?9:10,h=FT(o,d),p=o.bytes;switch(d){case 10:p[h+9]=c>>>7&1;case 9:p[h+8]=9!==d?128|c:127&c;case 8:p[h+7]=8!==d?s>>>21|128:s>>>21&127;case 7:p[h+6]=7!==d?s>>>14|128:s>>>14&127;case 6:p[h+5]=6!==d?s>>>7|128:s>>>7&127;case 5:p[h+4]=5!==d?128|s:127&s;case 4:p[h+3]=4!==d?i>>>21|128:i>>>21&127;case 3:p[h+2]=3!==d?i>>>14|128:i>>>14&127;case 2:p[h+1]=2!==d?i>>>7|128:i>>>7&127;case 1:p[h]=1!==d?128|i:127&i}}const Tv={},bx={},gl=4294967296,VT=gl*gl,Rv=VT/2,Tr=xh(0,!0),Tx=xh(0),Lh=Fh(0,-2147483648,!1),MO=Fh(-1,2147483647,!1),LO=Fh(-1,-1,!0);function xh(o,n){let i,s,c;return n?(c=0<=(o>>>=0)&&o<256)&&(s=bx[o],s)?s:(i=Fh(o,0,!0),c&&(bx[o]=i),i):(c=-128<=(o|=0)&&o<128)&&(s=Tv[o],s)?s:(i=Fh(o,o<0?-1:0,!1),c&&(Tv[o]=i),i)}function Fh(o,n,i){return{low:0|o,high:0|n,unsigned:!!i}}function Tm(o,n){if(isNaN(o))return n?Tr:Tx;if(n){if(o<0)return Tr;if(o>=VT)return LO}else{if(o<=-Rv)return Lh;if(o+1>=Rv)return MO}return o<0?n?Tr:Tx:Fh(o%gl|0,o/gl|0,n)}function Rm(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}class Cc extends jt{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(fo.CONNECTION_STATE_CHANGE,n,i)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var i;super(),C(this,"name","AgoraRTCImageModeration"),C(this,"_connectionState",Xr.CONNECTING),C(this,"_sequence",0),C(this,"_moderationStartTime",void 0),C(this,"_workerConnection",void 0),C(this,"_workerMessageLengthLimit",void 0),C(this,"_qualityRatio",void 0),C(this,"_connectInfo",void 0),C(this,"_cancelTokenSource",Hn.CancelToken.source()),C(this,"_retryConfig",void 0),C(this,"_moderationInterval",void 0),C(this,"_moderationTimer",null),C(this,"_moderationMode",1),C(this,"_quality",1),C(this,"_qualityTimer",null),C(this,"_ticket",void 0),C(this,"_moderationIntervalMinimum",void 0),C(this,"_uploadFailedNum",0),C(this,"_uploadNum",0),C(this,"_uploadTimer",null),C(this,"_moderationId",void 0),C(this,"inspectImage",()=>{if(this.connectionState!==Xr.CONNECTED)throw new W(k.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Xr.CONNECTED?this.requestToInspectImage():T.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=Ot(5,"image-moderation-"),this._workerMessageLengthLimit=B("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=B("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(i=n.interval)&&void 0!==i?i:1e3,this._qualityRatio=B("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new sh("worker-"+this._moderationId,Ln),this.on(fo.STATE_CHANGE,(s,c)=>{T.debug("[".concat(this._moderationId,"] Moderation operation :").concat(ss[s]," ").concat(c||""))}),this.handleWorkerEvents()}init(n,i){var s=this;return L(function*(){s.emit(fo.STATE_CHANGE,ss.CONNECT_AP),s._connectInfo=n;const c=s._cancelTokenSource.token;return s._retryConfig=i,new z((d,h)=>{s.on(fo.CONNECTION_STATE_CHANGE,(p,m)=>{p===Xr.CONNECTED&&d()}),s.requestAP(n,c,i).then(p=>{s.connectWorker(p)}).catch(p=>{h(p)})})})()}updateConfig(n){var i;this._moderationInterval=null!==(i=n.interval)&&void 0!==i?i:1e3,T.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===Xr.CONNECTED&&this.inspectImage()}requestAP(n,i,s){var c=this;return L(function*(){const d=B("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),h=yield function(_,E,v,S){let{appId:b,areaCode:O,cname:P,sid:w,token:M,uid:V}=E;bd++;const U="moderation_plugin",Y={service_name:U,json_body:JSON.stringify({appId:b,areaCode:O,cname:P,command:"allocateEdge",requestId:bd,seq:bd,sid:w,appToken:M,ts:Date.now(),uid:V+""})};let ie,K,X=_[0];return Fs(L(function*(){ie=Date.now();const $=yield pl(X,{data:Y,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-ie,0!==$.code){const Ee=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+$.code,{retry:!0,responseTime:K});throw T.error(Ee.toString()),Ee}const J=JSON.parse($.json_body);if(200!==J.code){const Ee=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(J.code,", reason: ").concat(J.reason),{code:J.code,responseTime:K});throw T.error(Ee.toString()),Ee}if(!J.servers||!Array.isArray(J.servers)||0===J.servers.length){const Ee=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:J.code,responseTime:K});throw T.error(Ee.toString()),Ee}if(!J.servers.some(Ee=>!!Ee.wss)){const Ee=new W(k.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:J.code,responseTime:K});throw T.error(Ee.toString()),Ee}const ge=B("IMAGE_MODERATION_WORKER_HOST");return{addressList:J.servers.map(Ee=>{let{address:ze,wss:ht}=Ee;if(ze&&ht)return"wss://".concat(ze.replace(/\./g,"-"),".").concat(ge,":").concat(ht,"/moderation")}).filter(Ee=>!!Ee),workerToken:J.workerToken,vid:J.vid,ticket:J.appTicket,responseTime:K}}),($,J)=>(ye.apworkerEvent(w,{success:!0,sc:200,serviceName:U,responseDetail:JSON.stringify($.addressList),firstSuccess:0===J,responseTime:K,serverIp:_[J%_.length]}),!1),($,J)=>(ye.apworkerEvent(w,{success:!1,sc:$.data&&$.data.code||200,serviceName:U,responseTime:K,serverIp:_[J%_.length]}),!!($.code!==k.OPERATION_ABORTED&&$.code!==k.UNEXPECTED_RESPONSE||$.data&&$.data.retry)&&(X=_[(J+1)%_.length],!0)),S)}(d,n,i,s);c.emit(fo.STATE_CHANGE,ss.AP_CONNECTED);const{addressList:p,ticket:m}=h;return c._ticket=m,p})()}connectWorker(n){var i=this;return L(function*(){i.emit(fo.STATE_CHANGE,ss.CONNECT_WORKER),yield i._workerConnection.init(n,1e4)})()}handleWorkerEvents(){var n=this;this._workerConnection.on(we.CONNECTED,L(function*(){n.emit(fo.STATE_CHANGE,ss.WORKER_CONNECTED,n._workerConnection.url),n.connectionState=Xr.CONNECTED})),this._workerConnection.on(we.CLOSED,()=>{this.connectionState=Xr.CLOSED}),this._workerConnection.on(we.FAILED,()=>{this.connectionState=Xr.CLOSED}),this._workerConnection.on(we.RECONNECTING,()=>{this.connectionState=this.connectionState===Xr.CONNECTED?Xr.RECONNECTING:Xr.CONNECTING}),this._workerConnection.on(we.ON_MESSAGE,function(){var i=L(function*(s){if(s.data instanceof ArrayBuffer){const c=function vx(o){return function(i){let s={};e:for(;!WU(i);){let c=bm(i);switch(c>>>3){case 0:break e;case 1:s.code=bm(i);break;case 2:s.msg=UT(i,bm(i));break;case 3:s.requestId=UT(i,bm(i));break;case 4:s.timestamp=Cx(i,!1);break;default:OO(i,7&c)}}return s}({bytes:n=o,offset:0,limit:n.length});var n}(new Uint8Array(s.data));B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("[".concat(n._moderationId,"] Response message for worker of image moderation "),JSON.stringify(c)),n._uploadNum++,void 0===c.code||0===c.code||(n._uploadFailedNum++,T.error("[".concat(n._moderationId,"] Error response from worke, code is ").concat(c.code,", msg is ").concat(c.msg)),n._uploadTimer||(n._uploadTimer=window.setTimeout(()=>{ye.reportApiInvoke(n._connectInfo.sid||null,{name:fn.IMAGE_MODERATION_UPLOAD,options:[n._uploadFailedNum,n._uploadNum,c.code],tag:nn.TRACER}).onError(new W(k.IMAGE_MODERATION_UPLOAD_FAILED,c.msg)),n._uploadTimer=null},B("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else T.error("[".concat(n._moderationId,"] Unexpected message type from worker"))});return function(s){return i.apply(this,arguments)}}()),this._workerConnection.on(we.WILL_RECONNECT,(i,s,c)=>{"recover"===i&&c(i),c("tryNext")}),this._workerConnection.on(we.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}requestToInspectImage(){var n=this;return L(function*(){const i=lo(n,fo.CLIENT_LOCAL_VIDEO_TRACK),s={appId:n._connectInfo.appId,cname:n._connectInfo.cname,cid:n._connectInfo.cid,sid:n._connectInfo.sid,uid:n._connectInfo.uid,vid:n._connectInfo.vid};if(i){if(!i.isPlaying)return void(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being played can be inspected"));n._sequence++;const c=yield n.generateRequestData(i,s);n._workerConnection.sendMessage(c,!0,!0)}else B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&T.debug("Only the track being published can be inspected")})()}generateRequestData(n,i){var s=this;return L(function*(){let{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_}=i;const E=Date.now(),v=yield n.getCurrentFrameImage("image/jpeg",s.quality),S=yield Rb(v,c,d),b=s._sequence+"-"+h+"-"+_+"-"+E+"-"+Ot(12,""),O={appId:c,cid:h,cname:d,deviceId:"",elapse:Cc.intToLong(Number(E-s._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:S,networkType:6,osType:7,requestId:b,sdkVersion:"4.19.1",sequence:s._sequence,sid:m,timestamp:Tm(E),uid:_,vid:p,service:s._moderationMode,ticket:s._ticket},P=function DO(o){let n=function(){const i=NO.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,s){let c=i.appId;void 0!==c&&(Bn(s,10),Od(s,c));let d=i.cid;void 0!==d&&(Bn(s,16),Bn(s,d));let h=i.cname;void 0!==h&&(Bn(s,26),Od(s,h));let p=i.deviceId;void 0!==p&&(Bn(s,34),Od(s,p));let m=i.elapse;void 0!==m&&(Bn(s,40),_l(s,m));let _=i.fileSize;void 0!==_&&(Bn(s,48),_l(s,Mh(_)));let E=i.height;void 0!==E&&(Bn(s,56),_l(s,Mh(E)));let v=i.jpg;void 0!==v&&(Bn(s,66),Bn(s,v.length),yx(s,v));let S=i.networkType;void 0!==S&&(Bn(s,72),_l(s,Mh(S)));let b=i.osType;void 0!==b&&(Bn(s,80),_l(s,Mh(b)));let O=i.requestId;void 0!==O&&(Bn(s,90),Od(s,O));let P=i.sdkVersion;void 0!==P&&(Bn(s,98),Od(s,P));let w=i.sequence;void 0!==w&&(Bn(s,104),_l(s,Mh(w)));let M=i.sid;void 0!==M&&(Bn(s,114),Od(s,M));let V=i.timestamp;void 0!==V&&(Bn(s,120),_l(s,V));let U=i.uid;void 0!==U&&(Bn(s,128),Bn(s,U));let Y=i.vid;void 0!==Y&&(Bn(s,136),Bn(s,Y));let ie=i.width;void 0!==ie&&(Bn(s,144),_l(s,Mh(ie)));let K=i.service;void 0!==K&&(Bn(s,152),Bn(s,K));let X=i.callbackData;void 0!==X&&(Bn(s,162),Bn(s,X.length),yx(s,X));let $=i.ticket;void 0!==$&&(Bn(s,170),Od(s,$))}(o,n),function(i){let s=i.bytes,c=i.limit;return s.length===c?s:s.subarray(0,c)}(n)}(O);if(P.byteLength<s._workerMessageLengthLimit){if(B("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const w=function(M){for(var V=1;V<arguments.length;V++){var U=null!=arguments[V]?arguments[V]:{};V%2?Rm(Object(U),!0).forEach(function(Y){C(M,Y,U[Y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(U)):Rm(Object(U)).forEach(function(Y){Object.defineProperty(M,Y,Object.getOwnPropertyDescriptor(U,Y))})}return M}({},O);delete w.jpg,T.debug("[".concat(s._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(w))}return P}return s.quality=s.quality*s._qualityRatio,yield s.generateRequestData(n,{appId:c,cname:d,cid:h,vid:p,sid:m,uid:_})})()}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Hn.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Xr.CLOSED,this.emit(fo.STATE_CHANGE,ss.CLOSED)}}function xO(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function BT(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?xO(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):xO(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}class Gi extends ib{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return null!==(n=null===(i=this.peerConnection.getReceivers()[0])||void 0===i||null===(i=i.transport)||void 0===i?void 0:i.state)&&void 0!==n?n:null}constructor(n,i,s){super(n,i),C(this,"direction",void 0),C(this,"store",void 0),C(this,"peerConnection",void 0),C(this,"transportEventReceiver",void 0),C(this,"statsFilter",void 0),C(this,"localCandidateCount",0),C(this,"allCandidatesReceived",!1),C(this,"mutex",new ni("P2PConnection-mutex")),C(this,"dataChannel",void 0),C(this,"onLocalCandidate",void 0),this.store=i,this.peerConnection=new RTCPeerConnection(Gi.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.direction=null!=s?s:Rf.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=_m(this.peerConnection,B("STATS_UPDATE_INTERVAL"),void 0,Bt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}establish(n){var i=this;return L(function*(){try{if(n){yield i.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=yield i.peerConnection.createAnswer();if(yield i.peerConnection.setLocalDescription(s),!s.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return s.sdp}{const s=yield i.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return yield i.peerConnection.setLocalDescription(s),s.sdp}}catch(s){throw new Q(k.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}})()}connect(n){var i=this;return L(function*(){try{yield i.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(s){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}})()}addRemoteCandidate(n){var i=this;return L(function*(){try{yield i.peerConnection.addIceCandidate(n)}catch(s){throw new Q(k.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}})()}send(n){var i=this;return L(function*(){try{const s=[];n.forEach(h=>{const p=i.peerConnection.addTransceiver(h._mediaStreamTrack,{direction:"sendonly"});s.push(p)}),Bt()&&!0===B("SIMULCAST")&&(yield i.applySimulcastForFirefox(s,n)),yield i.applySimulcastEncodings(s,n),yield i.applySendEncodings(s,n);const c=yield i.peerConnection.createOffer();if(yield i.peerConnection.setLocalDescription(c),!c.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const d=s.map(h=>{const p=i.getLocalSSRC(h.mid,c.sdp);if(!p)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:h.mid,localSSRC:[{ssrcId:p}]}});return{sdp:c.sdp,trackMessage:d}}catch(s){throw s instanceof Q?s:new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}})()}stopSending(n,i){var s=this;return L(function*(){const c=i?void 0:yield s.mutex.lock("From P2PConnection.stopSending");try{const d=s.peerConnection.getTransceivers().filter(p=>-1!==n.indexOf(p.mid));if(d.length!==n.length)throw new Error("Transceivers' length (".concat(d.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));d.map(p=>{var m;p.direction="inactive",null===(m=p.stop)||void 0===m||m.call(p),s.peerConnection.removeTrack(p.sender)});const h=yield s.peerConnection.createOffer();if(yield s.peerConnection.setLocalDescription(h),!h.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return h.sdp}catch(d){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}finally{c&&c()}})()}receive(n,i,s){var c=this;return L(function*(){try{yield c.peerConnection.setRemoteDescription({type:"offer",sdp:i});const d=yield c.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");yield c.peerConnection.setLocalDescription(d),T.debug("[".concat(c.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."));const h=c.getRemoteMid(s,i);if(void 0===h)throw new Error("Cannot get transceiver mid when trying to receive track.");const p=c.peerConnection.getTransceivers().find(m=>m.mid===h);if(!p||null===p.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:p.receiver.track,mid:p.mid,sdp:d.sdp}}catch(d){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}})()}setDescription(n,i){var s=this;return L(function*(){try{if("remote"===n){yield s.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=yield s.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return yield s.peerConnection.setLocalDescription(c),T.debug("[".concat(s.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(n)),c.sdp}yield s.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(c){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(c.toString()))}})()}stopReceiving(n,i){var s=this;return L(function*(){try{const c=s.peerConnection.getTransceivers().filter(h=>-1!==n.indexOf(h.mid));if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(h=>{var p;h.direction="inactive",null===(p=h.stop)||void 0===p||p.call(h)}),yield s.peerConnection.setRemoteDescription({type:"offer",sdp:i});const d=yield s.peerConnection.createAnswer();if(yield s.peerConnection.setLocalDescription(d),!d.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return d.sdp}catch(c){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(c.toString()))}})()}restartICE(){var n=this;return L(function*(){try{const i=yield n.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return n.store.descriptionStart(),yield n.peerConnection.setLocalDescription(i),i.sdp}catch(i){throw new Q(k.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}})()}close(){var n;this.peerConnection.close(),null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}updateEncoderConfig(n,i){return L(function*(){})()}updateSendParameters(n,i){var s=this;return L(function*(){const c=s.peerConnection.getTransceivers().filter(d=>d.mid===n);1===c.length&&(s.isVP8Simulcast(i)?Bt()||(yield s.applySimulcastEncodings(c,[i])):yield s.applySendEncodings(c,[i]))})()}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}replaceTrack(n,i){var s=this;return L(function*(){const c=s.peerConnection.getTransceivers().find(d=>d.mid===i);c&&(yield c.sender.replaceTrack(n._mediaStreamTrack))})()}getSelectedCandidatePair(){var n=this;return L(function*(){const i=n.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:c,remote:d}=s.getSelectedCandidatePair();return{local:BT(BT({},_s),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port}),remote:BT(BT({},_s),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})}}return n.statsFilter.getSelectedCandidatePair()})()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;null===(n=this.onICEConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;null===(n=this.onConnectionStateChange)||void 0===n||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{var i;n.candidate&&(null===(i=this.onLocalCandidate)||void 0===i||i.call(this,n.candidate)),n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,T.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},B("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&"off"!==n.turnServer.mode&&(zu(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Gi.turnServerConfigToIceServers(n.turnServer.servers)),B("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Gi.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),B("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),B("ENABLE_ENCODED_TRANSFORM")&&Ge().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(s=>{s.tcpport&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(om(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"stun:".concat(s.turnServerURL,":").concat(s.tcpport)}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;null!=i&&i.state&&(null===(c=this.onDTLSTransportStateChange)||void 0===c||c.call(this,i.state))},i.onerror=c=>{var d;null===(d=this.onDTLSTransportError)||void 0===d||d.call(this,"error"in c?c.error:c)};const s=i.iceTransport;s&&(s.onstatechange=()=>{const c=null==i?void 0:i.iceTransport.state;var d;c&&(null===(d=this.onICETransportStateChange)||void 0===d||d.call(this,c))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:c,remote:d}=s.getSelectedCandidatePair();T.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}updateRtpSenderEncodings(n,i){var s=this;return L(function*(){var c;if(i||(i=s.peerConnection.getSenders().find(v=>v.track===n._mediaStreamTrack)),!i)return T.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(s.isVP8Simulcast(n))return T.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ge().supportSetRtpSenderParameters)return T.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(n._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;default:d.degradationPreference="balanced"}if(n._encoderConfig){var p;const{bitrateMax:v,frameRate:S,scaleResolutionDownBy:b}=n._encoderConfig;v&&(h.maxBitrate=1e3*v),Re(p=n._hints).call(p,Ht.LOW_STREAM)&&(S&&(h.maxFramerate=vo(S)),b&&b>=1&&(h.scaleResolutionDownBy=b))}if(B("DSCP_TYPE")&&$c()){var m;const v=B("DSCP_TYPE");Re(m=["very-low","low","medium","high"]).call(m,v)&&(h.networkPriority=v)}const _=i.getParameters(),E=null===(c=_.encodings)||void 0===c?void 0:c[0];Bt()&&!E&&(d.encodings=[h]),E&&Object.assign(E,h),Object.assign(_,d),T.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),yield i.setParameters(_)})()}applySendEncodings(n,i){var s=this;return L(function*(){try{if(!Ge().supportSetRtpSenderParameters||n.length!==i.length)return;for(let c=0;c<n.length;c++){const d=n[c],h=i[c];h instanceof We&&!s.isVP8Simulcast(h)&&(yield s.updateRtpSenderEncodings(h,d.sender))}}catch(c){T.debug("[".concat(s.store.clientId,"] Apply RTPSendEncodings failed."))}})()}mungSendOfferSDP(n,i,s){const c=un.parse(n);return i.forEach((d,h)=>{const p=s[h],m=c.mediaDescriptions.find(_=>_.attributes.mid===p);m&&(Id(m,d),dv(m,d,this.store.codec))}),un.print(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;null===(i=this.onFirstAudioReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;null===(i=this.onFirstVideoReceived)||void 0===i||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;null===(i=this.onFirstAudioDecoded)||void 0===i||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,s)=>{var c;null===(c=this.onFirstVideoDecoded)||void 0===c||c.call(this,n,i,s)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedLocalCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var s;null===(s=this.onSelectedRemoteCandidateChanged)||void 0===s||s.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;null===(i=this.onFirstVideoDecodedTimeout)||void 0===i||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}applySimulcastForFirefox(n,i){var s=this;return L(function*(){if(n.length===i.length)for(let _=0;_<n.length;_++){var c,d,h,p,m;const E=n[_],v=i[_];if(v instanceof We&&!Re(c=v._hints).call(c,Ht.LOW_STREAM)&&null!==(d=v._encoderConfig)&&void 0!==d&&d.bitrateMax&&(null===(h=v._encoderConfig)||void 0===h?void 0:h.bitrateMax)>200&&null!==(p=v._scalabilityMode)&&void 0!==p&&p.numSpatialLayers&&(null===(m=v._scalabilityMode)||void 0===m?void 0:m.numSpatialLayers)>1&&"vp8"===s.store.codec){const S={},b={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];const O=E.sender.getParameters();yield E.sender.setParameters(Object.assign(O,S))}}})()}applySimulcastEncodings(n,i){var s=this;return L(function*(){if(!Bt()&&n.length===i.length)for(let c=0;c<n.length;c++){const d=i[c];if(d instanceof We&&s.isVP8Simulcast(d)){const h=n[c],p={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};p.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=h.sender.getParameters();yield h.sender.setParameters(Object.assign(_,p))}}})()}isVP8Simulcast(n){var i,s,c,d,h;return!!(n instanceof We&&B("SIMULCAST")&&"vp8"===this.store.codec&&!Re(i=n._hints).call(i,Ht.LOW_STREAM)&&null!==(s=n._encoderConfig)&&void 0!==s&&s.bitrateMax&&(null===(c=n._encoderConfig)||void 0===c?void 0:c.bitrateMax)>200&&null!==(d=n._scalabilityMode)&&void 0!==d&&d.numSpatialLayers&&(null===(h=n._scalabilityMode)||void 0===h?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,s,c){if(B("SDP_LOGGING"))return T.upload("[".concat(this.store.clientId,"] exchanging ").concat(s," ").concat(i," SDP during P2PConnection.").concat(c,"\n"),n),"offer"===i?d=>{this.logSDPExchange(d,"answer","local"===s?"remote":"local",c)}:void 0}getLocalSSRC(n,i){var s,c;if(i=null!==(s=i)&&void 0!==s?s:null===(c=this.currentLocalDescription)||void 0===c?void 0:c.sdp){var d;const h=null===(d=un.parse(i).mediaDescriptions.find(p=>p.attributes.mid===n))||void 0===d?void 0:d.attributes.ssrcs;return null==h?void 0:h[0].ssrcId}}getRemoteMid(n,i){var s,c,d;if(i=null!==(s=i)&&void 0!==s?s:null===(c=this.currentRemoteDescription)||void 0===c?void 0:c.sdp)return null===(d=un.parse(i).mediaDescriptions.find(h=>h.attributes.ssrcs.some(p=>p.ssrcId===n)))||void 0===d?void 0:d.attributes.mid}getRemoteSSRC(n,i){var s=this;return L(function*(){var c,d;if(i=null!==(c=i)&&void 0!==c?c:null===(d=s.currentRemoteDescription)||void 0===d?void 0:d.sdp){var h;const p=null===(h=un.parse(i).mediaDescriptions.find(m=>m.attributes.mid===n))||void 0===h?void 0:h.attributes.ssrcs;return null==p?void 0:p[0].ssrcId}})()}}function Es(o,n,i){const s=o[n];if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return i.value=L(function*(){const c=this.mutex,d=yield c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,p=new Array(h),m=0;m<h;m++)p[m]=arguments[m];return yield s.apply(this,p)}finally{d()}}),i}var Ho;function Rx(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function So(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Rx(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Rx(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([Es,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Gi.prototype,"establish",null),te([Es,N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Gi.prototype,"connect",null),te([Es,N("design:type",Function),N("design:paramtypes",[RTCIceCandidate]),N("design:returntype",z)],Gi.prototype,"addRemoteCandidate",null),te([Es,N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Gi.prototype,"send",null),te([Es,N("design:type",Function),N("design:paramtypes",[String,String,Number]),N("design:returntype",z)],Gi.prototype,"receive",null),te([Es,N("design:type",Function),N("design:paramtypes",[String,String]),N("design:returntype",z)],Gi.prototype,"setDescription",null),te([Es,N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",z)],Gi.prototype,"stopReceiving",null),te([Es,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Gi.prototype,"restartICE",null),te([Es,N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],Gi.prototype,"close",null),te([Es,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],Gi.prototype,"updateEncoderConfig",null),te([Es,N("design:type",Function),N("design:paramtypes",[String,zn]),N("design:returntype",z)],Gi.prototype,"updateSendParameters",null),te([Es,N("design:type",Function),N("design:paramtypes",[zn,String]),N("design:returntype",z)],Gi.prototype,"replaceTrack",null),function(o){o.SEND_ONLY="SEND_ONLY",o.RECEIVE_ONLY="RECEIVE_ONLY"}(Ho||(Ho={}));class Zt extends jt{get state(){return this._state}set state(n){const i=this._state;this._state=n,this.emit(Te.StateChange,i,this._state)}constructor(n,i){var s;super(),s=this,C(this,"store",void 0),C(this,"statsUploader",void 0),C(this,"sendConnection",void 0),C(this,"recvConnection",void 0),C(this,"localTrackMap",new Map),C(this,"remoteUserMap",new Map),C(this,"localDataChannels",[]),C(this,"pendingLocalTracks",[]),C(this,"pendingRemoteTracks",[]),C(this,"statsCollector",void 0),C(this,"dtlsFailedCount",0),C(this,"sendMutex",new ni("P2PChannel2-send-mutex")),C(this,"recvMutex",new ni("P2PChannel2-recv-mutex")),C(this,"_state",rt.Disconnected),C(this,"_restartStates",["disconnected","failed"]),C(this,"_restartTimer",void 0),C(this,"handleMuteLocalTrack",function(){var c=L(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!s.sendConnection||s.state!==rt.Connected)return void p(new Q(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const v=s.filterTobeMutedTracks(d);if(0===v.length)return void h();const S=v.find(U=>"videoLowTrack"===U[0]);S&&S[1].track._originMediaStreamTrack.stop();let b=!1;var _,E;b="video"===d.trackMediaType?!(null===(_=s.localTrackMap.get(ne.LocalAudioTrack))||void 0===_||!_.track._muted):void 0===(null===(E=s.localTrackMap.get(ne.LocalVideoTrack))||void 0===E?void 0:E.id);const O=v.filter(U=>{let[Y,ie]=U;return(Y!==ne.LocalAudioTrack||b)&&void 0!==ie.id}).map(U=>{let[,Y]=U;return Y});let P;O.length>0&&(P=yield s.sendConnection.stopSending(O.map(U=>U.id)),O.forEach(U=>{U.id=void 0,U.ssrcs=void 0}));const w=s.createMuteMessage(v),M="video"===d.trackMediaType?Hs.MUTE_LOCAL_VIDEO:Hs.MUTE_LOCAL_AUDIO,V=yield cn(s,Te.RequestP2PMuteLocal,{action:M,sdp:P,message:w,isMuteAll:b});V&&(yield s.sendConnection.setDescription("local",V)),(P||"audio"===d.trackMediaType)&&(yield Lt(s,Te.RequestMuteLocal,w)),h()}catch(v){p(v)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleUnmuteLocalTrack",function(){var c=L(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!s.sendConnection||s.state!==rt.Connected)return void p(new Q(k.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const _=s.filterTobeUnmutedTracks(d);if(0===_.length)return void h();const E=s.createUnmuteMessage(_),v="video"===d.trackMediaType?Hs.UNMUTE_LOCAL_VIDEO:Hs.UNMUTE_LOCAL_AUDIO;yield Lt(s,Te.RequestP2PMuteLocal,{action:v,message:E}),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleUpdateVideoEncoder",function(){var c=L(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const _=s.localTrackMap.get(ne.LocalVideoTrack);if(!s.sendConnection||!_||_.track!==d||s.state!==rt.Connected)return void h();const{id:E,track:v}=_;E&&(yield s.sendConnection.updateSendParameters(E,v),yield s.sendConnection.updateEncoderConfig(E,v),s.emit(Te.UpdateVideoEncoder,v)),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleSetOptimizationMode",function(){var c=L(function*(d,h,p){const m=yield s.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const _=s.localTrackMap.get(ne.LocalVideoTrack);if(!s.sendConnection||!_||_.track!==d||s.state!==rt.Connected)return;const{id:E,track:v}=_;E&&(yield s.sendConnection.updateSendParameters(E,v)),h()}catch(_){p(_)}finally{m()}});return function(d,h,p){return c.apply(this,arguments)}}()),C(this,"handleReplaceTrack",function(){var c=L(function*(d,h,p,m){let _;T.debug("[".concat(s.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),"boolean"==typeof m&&m||(_=yield s.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var E;const S=Array.from(s.localTrackMap.entries()).find(b=>{let[,{track:O}]=b;return d===O});if(!s.sendConnection||!S||void 0===S[1].id||s.state!==rt.Connected)return void h();if(yield null===(E=s.sendConnection)||void 0===E?void 0:E.replaceTrack(d,S[1].id),S[0]===ne.LocalVideoTrack&&Ge().supportDualStreamEncoding){const b=s.localTrackMap.get(ne.LocalVideoLowTrack);if(b){const O=d._mediaStreamTrack.clone();b.track._originMediaStreamTrack.stop(),b.track._mediaStreamTrack=O,b.track._originMediaStreamTrack=O,yield new z((P,w)=>{s.handleReplaceTrack(b.track,P,w,!0)})}}h()}catch(S){p(S)}finally{var v;null===(v=_)||void 0===v||v()}});return function(d,h,p,m){return c.apply(this,arguments)}}()),C(this,"handleGetLocalVideoStats",c=>{c(this.statsCollector.getLocalVideoTrackStats())}),C(this,"handleGetLocalAudioStats",c=>{c(this.statsCollector.getLocalAudioTrackStats())}),C(this,"handleGetRemoteVideoStats",c=>this.statsCollector.getRemoteVideoTrackStats(c.uid)[c.uid]),C(this,"handleGetRemoteAudioStats",c=>this.statsCollector.getRemoteAudioTrackStats(c.uid)[c.uid]),this.store=n,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new CO,this.bindStatsUploaderEvents()}startP2PConnection(n,i){return L(function*(){throw new Q(k.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")})()}connect(n,i,s,c,d,h){return L(function*(){throw new Q(k.NOT_SUPPORTED,"p2p mode does not support connect.")})()}startP2P(n,i){var s=this;return L(function*(){if(s.state=rt.New,s.sendConnection&&(T.warning("[".concat(s.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),s.sendConnection.close(),s.unbindConnectionEvents(s.sendConnection)),s.recvConnection&&(T.warning("[".concat(s.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),s.recvConnection.close(),s.unbindConnectionEvents(s.recvConnection)),s.sendConnection=new Gi(n,s.store),s.bindConnectionEvents(s.sendConnection),s.recvConnection=new Gi(n,s.store,Rf.RECEIVE_ONLY),s.bindConnectionEvents(s.recvConnection),i){s.store.peerConnectionStart(),yield s.recvConnection.establish(i);const c=yield s.sendConnection.establish(i);return s.statsUploader.startUploadTransportStats(!0),s.statsUploader.startUploadExtensionUsageStats(),s.state=rt.Connected,c}return yield s.recvConnection.establish(i),s.sendConnection.establish(i)})()}p2pConnect(n){var i=this;return L(function*(){if(!i.sendConnection||!i.recvConnection)throw new Q(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");i.store.peerConnectionStart(),yield i.recvConnection.connect(n),yield i.sendConnection.connect(n),i.statsUploader.startUploadTransportStats(),i.statsUploader.startUploadExtensionUsageStats(),i.state=rt.Connected})()}addRemoteCandidate(n){var i=this;return L(function*(){if(!i.sendConnection||!i.recvConnection)throw new Q(k.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");yield i.recvConnection.addRemoteCandidate(n),yield i.sendConnection.addRemoteCandidate(n)})()}publish(n,i,s){var c=this;return L(function*(){if(!c.sendConnection||c.state!==rt.Connected){c.throwIfTrackTypeNotMatch(n);const p=n.filter(m=>-1===c.pendingLocalTracks.indexOf(m));return void(c.pendingLocalTracks=c.pendingLocalTracks.concat(p))}c.store.pubId=c.store.pubId+1,Ai.markPublishStart(c.store.clientId,c.store.pubId);const d=c.filterTobePublishedTracks(n,i,s);if(0===d.length)return void(yield c.tryToUnmuteAudio(n));d.forEach(p=>{let{track:m,type:_}=p;const E=Date.now();c.store.publish(m.getTrackId(),_===ne.LocalAudioTrack?"audio":"video",E)}),c.bindLocalTrackEvents(d);const h=c.createGatewayPublishMessage(d);return c.assignLocalTracks(d),d.forEach(p=>{let{track:m,type:_}=p;const E=Date.now();c.store.publish(m.getTrackId(),_===ne.LocalAudioTrack?"audio":"video",void 0,E)}),h})()}dopublish(n){var i=this;return L(function*(){if(!i.sendConnection||i.state!==rt.Connected)return;const s=i.localTrackMap.get(n);if(s){const{sdp:c,trackMessage:d}=yield i.sendConnection.send([s.track]),{mid:h,localSSRC:p}=d[0];s.id=h,s.ssrcs=p,i.statsCollector.addLocalStats(n),i.statsUploader.startUploadUplinkStats();const m=yield cn(i,Te.RequestP2PPublish,{kind:n===ne.LocalAudioTrack?fe.AUDIO:fe.VIDEO,sdp:c,ssrcId:p[0].ssrcId});yield i.sendConnection.setDescription("local",m);const _=i.createUnmuteMessage([[n,s]]);yield Lt(i,Te.RequestUnmuteLocal,_)}})()}setDescription(n,i){var s=this;return L(function*(){let c,d;"local"===n?(c=yield s.sendMutex.lock("From P2PChannel.restartICE"),d=s.sendConnection):(c=yield s.recvMutex.lock("From P2PChannel.restartICE"),d=s.recvConnection);try{return d&&s.state===rt.Connected?yield d.setDescription(n,i):void 0}finally{c()}})()}publishLowStream(n){return fs(function*(){throw new Q(k.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}republish(){var n=this;return L(function*(){n.pendingLocalTracks.length>0&&(T.debug("[".concat(n.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),yield cn(n,Te.RequestRePublish,n.pendingLocalTracks),n.emit(Te.MediaReconnectEnd,n.store.uid),n.pendingLocalTracks=[])})()}unpublish(n){var i=this;return L(function*(){if(!i.sendConnection||i.state!==rt.Connected)return void(0===n.length?i.pendingLocalTracks.length=0:i.pendingLocalTracks=i.pendingLocalTracks.filter(_=>!Re(n).call(n,_)));const s=i.filterTobeUnpublishedTracks(n);if(0===s.length)return;i.unbindLocalTrackEvents(s.map(_=>{let[E,{track:v}]=_;return{type:E,track:v}}));const c=s.filter(_=>{let[,{id:E}]=_;return void 0!==E});if(!i.sendConnection||i.state!==rt.Connected)return void n.forEach(_=>{const E=i.pendingLocalTracks.indexOf(_);-1!==E&&i.pendingLocalTracks.splice(E,1)});const d=s.find(_=>"videoLowTrack"===_[0]);let h;d&&d[1].track.close();const p=i.createGatewayUnpublishMessage(s);c.length>0&&(h=yield i.sendConnection.stopSending(c.map(_=>{let[,{id:E}]=_;return E}))),i.withdrawLocalTracks(s),i.unbindLocalTrackEvents(s.map(_=>{let[E,{track:v}]=_;return{type:E,track:v}})),s.forEach(_=>{let[E]=_;i.statsCollector.removeLocalStats(E)}),0===i.localTrackMap.size&&i.statsUploader.stopUploadUplinkStats();const m=i.createMuteMessage(s);return yield z.all(m.map(function(){var _=L(function*(E){yield Lt(i,Te.RequestMuteLocal,[E])});return function(E){return _.apply(this,arguments)}}())),{sdp:h,unpubMsg:p}})()}unpublishLowStream(){return L(function*(){throw new Q(k.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")})()}doUnpublish(n){var i=this;return L(function*(){if(!i.sendConnection||i.state!==rt.Connected)return;const s=[];if(n!==fe.AUDIO){const c=i.localTrackMap.get(ne.LocalVideoTrack);void 0!==(null==c?void 0:c.id)&&s.push([ne.LocalVideoTrack,c]);const d=i.localTrackMap.get(ne.LocalVideoLowTrack);void 0!==(null==d?void 0:d.id)&&s.push([ne.LocalVideoLowTrack,d]),i.statsCollector.removeLocalStats(ne.LocalVideoTrack),i.statsCollector.removeLocalStats(ne.LocalVideoLowTrack)}if(n!==fe.VIDEO){const c=i.localTrackMap.get(ne.LocalAudioTrack);void 0!==(null==c?void 0:c.id)&&s.push([ne.LocalAudioTrack,c]),i.statsCollector.removeLocalStats(ne.LocalAudioTrack)}if(s.length>0){const c=yield i.sendConnection.stopSending(s.map(p=>{let[,m]=p;return m.id}));s.forEach(p=>{let[,m]=p;m.id=void 0,m.ssrcs=void 0});const d=yield cn(i,Te.RequestP2PUnPublish,{sdp:c,kind:n});yield i.sendConnection.setDescription("local",d);const h=i.createMuteMessage(s);yield z.all(h.map(function(){var p=L(function*(m){yield Lt(i,Te.RequestMuteLocal,[m])});return function(m){return p.apply(this,arguments)}}()))}})()}subscribe(n,i,s,c){var d=this;return L(function*(){var h;if(!d.recvConnection||d.state!==rt.Connected)throw new Q(k.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(h=d.remoteUserMap.get(n))&&void 0!==h&&h.has(i))return;const{track:p,mid:m,sdp:_}=yield d.recvConnection.receive(i,s,c);i===fe.AUDIO?(n._audioSSRC=c,n._audioTrack?n._audioTrack._updateOriginMediaStreamTrack(p):(n._audioTrack=new go(p,n.uid,n._uintid,d.store),T.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote audio track: ").concat(n._audioTrack.getTrackId()))),d.bindRemoteTrackEvents(n,n._audioTrack)):(n._videoSSRC=c,n._videoTrack?n._videoTrack._updateOriginMediaStreamTrack(p):(n._videoTrack=new Ta(p,n.uid,n._uintid,d.store),T.info("[".concat(d.store.clientId,"] [").concat(d.store.p2pId,"] create remote video track: ").concat(n._videoTrack.getTrackId()))),d.bindRemoteTrackEvents(n,n._videoTrack));const E=d.remoteUserMap.get(n);E?E.set(i,m):d.remoteUserMap.set(n,new Map([[i,m]])),d.statsCollector.addRemoteStats(n.uid),d.statsUploader.startUploadDownlinkStats(),yield Lt(d,Te.RequestP2PUnmuteRemote,i);const v=d.pendingRemoteTracks.findIndex(S=>{let{user:b,kind:O}=S;return b.uid===n.uid&&i===O});return-1!==v&&(d.pendingRemoteTracks.splice(v,1),d.emit(Te.MediaReconnectEnd,n.uid)),_})()}unsubscribe(n,i,s,c){var d=this;return L(function*(){const h=d.pendingRemoteTracks.filter(_=>{let{user:E,kind:v}=_;return void 0!==s?E.uid===n.uid&&s===v:E.uid===n.uid});if(h.forEach(_=>{const E=d.pendingRemoteTracks.indexOf(_);d.pendingRemoteTracks.splice(E,1)}),d.recvConnection&&d.state===rt.Connected||c||h.forEach(_=>{let{kind:E}=_;var v;if(E===fe.AUDIO)null===(v=n._audioTrack)||void 0===v||v._destroy(),n._audioTrack=void 0;else if(E===fe.VIDEO){var S;null===(S=n._videoTrack)||void 0===S||S._destroy(),n._videoTrack=void 0}}),!d.recvConnection||d.state!==rt.Connected)return;const p=d.filterTobeUnSubscribedTracks(n,s);if(0===p.length)return void(s!==fe.VIDEO&&Lt(d,Te.RequestP2PMuteRemote,fe.AUDIO));const m=yield d.recvConnection.stopReceiving(p.map(_=>{let[,{id:E}]=_;return E}),i);return d.withdrawRemoteTracks(p),0===d.remoteUserMap.size&&d.statsUploader.stopUploadDownlinkStats(),p.forEach(_=>{let[E,{kind:v}]=_;var S,b;if(v===fe.VIDEO&&E._videoSSRC&&(null===(S=d.recvConnection)||void 0===S||S.setStatsRemoteVideoIsReady(E._videoSSRC,!1)),v===fe.VIDEO)d.unbindRemoteTrackEvents(E._videoTrack),c||(null===(b=E._videoTrack)||void 0===b||b._destroy(),E._videoTrack=void 0);else if(v===fe.AUDIO){var O;d.unbindRemoteTrackEvents(E._audioTrack),!c&&(null===(O=E._audioTrack)||void 0===O||O._destroy(),E._audioTrack=void 0)}}),p.filter(_=>{let[,{kind:E}]=_;return E!==fe.AUDIO}).forEach(_=>{let[,{kind:E}]=_;Lt(d,Te.RequestP2PMuteRemote,E)}),s!==fe.VIDEO&&Lt(d,Te.RequestP2PMuteRemote,fe.AUDIO),m})()}getAllDataChannels(){return this.localDataChannels}massSubscribe(n){return L(function*(){throw new Q(k.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")})()}massSubscribeNoLock(n){return L(function*(){throw new Q(k.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")})()}massUnsubscribe(n){return L(function*(){throw new Q(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")})()}massUnsubscribeNoLock(n){return L(function*(){throw new Q(k.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")})()}muteRemote(n,i){var s=this;return L(function*(){if(!s.recvConnection)return;const c=s.remoteUserMap.get(n);if(!c)return void T.warning("[".concat(s.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid,"."));if(!c.get(i))return void T.warning("[".concat(s.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(n.uid," media type ").concat(i,"."));const d=i===fe.VIDEO?n._videoSSRC:n._audioSSRC;void 0!==d&&s.recvConnection.setStatsRemoteVideoIsReady(d,!1)})()}unmuteRemote(n,i){var s=this;return L(function*(){return s.unmuteRemoteNoLock(n,i)})()}unmuteRemoteNoLock(n,i){var s=this;return L(function*(){if(!s.recvConnection)return;const c=s.remoteUserMap.get(n);c?c.get(i)||T.warning("[".concat(s.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid," media type ").concat(i,".")):T.warning("[".concat(s.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(n.uid,"."))})()}getAllTracks(n){const i=this.localTrackMap.get(ne.LocalAudioTrack);if((null==i?void 0:i.track)instanceof Un){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(c=>{let[d]=c;return d!==ne.LocalAudioTrack}).filter(c=>{let[d]=c;return!(n&&d===ne.LocalVideoLowTrack)}).map(c=>{let[,{track:d}]=c;return d}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[c]=s;return!(n&&c===ne.LocalVideoLowTrack)}).map(s=>{let[,{track:c}]=s;return c})}reportPublishEvent(n,i,s,c,d){if(n){const p=this.localTrackMap.get(ne.LocalAudioTrack),m=this.localTrackMap.get(c?ne.LocalVideoLowTrack:ne.LocalVideoTrack);ye.publish(this.store.sessionId,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:null==p?void 0:p.track.getTrackLabel(),videoName:null==m?void 0:m.track.getTrackLabel(),screenshare:-1!==(null==m?void 0:m.track._hints.indexOf(Ht.SCREEN_TRACK)),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}else{var h;s||(s=[]);const p=s.find(_=>_ instanceof xe),m=c?null===(h=this.localTrackMap.get(ne.LocalVideoTrack))||void 0===h?void 0:h.track:s.find(_=>_ instanceof We);ye.publish(this.store.sessionId,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:n,ec:i,audioName:null==p?void 0:p.getTrackLabel(),videoName:null==m?void 0:m.getTrackLabel(),screenshare:-1!==(null==m?void 0:m._hints.indexOf(Ht.SCREEN_TRACK)),audio:!!p,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:d})}}reportSubscribeEvent(n,i,s,c){const d=c===fe.VIDEO?s._videoSSRC:s._audioSSRC;d&&ye.subscribe(this.store.sessionId,{succ:n,ec:i,video:c===fe.VIDEO,audio:c===fe.AUDIO,peerid:s.uid,subscribeRequestid:c===fe.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ai.measureFromSubscribeStart(this.store.clientId,d)})}reset(){T.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ni("P2PChannel2-send-mutex"),this.sendMutex=new ni("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const n=this.localTrackMap.get(ne.LocalAudioTrack);if((null==n?void 0:n.track)instanceof Un){if(n.track.trackList.length>0){const i=n.track;n.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}n.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=rt.Disconnected}getStats(n){var i,s;return n?null===(s=this.recvConnection)||void 0===s?void 0:s.getStats():null===(i=this.sendConnection)||void 0===i?void 0:i.getStats()}getRemoteVideoIsReady(n){var i;return(null===(i=this.recvConnection)||void 0===i?void 0:i.getRemoteVideoIsReady(n))||!1}getLocalAudioVolume(){const n=this.localTrackMap.get(ne.LocalAudioTrack);if(n)return n.track.getVolumeLevel()}getLocalVideoSize(){const n=this.localTrackMap.get(ne.LocalVideoTrack);if(n)return{width:n.track._videoWidth||0,height:n.track._videoHeight||0}}getEncoderConfig(n){const i=this.localTrackMap.get(n);return i&&i.track instanceof We||i&&i.track instanceof xe?i.track._encoderConfig:void 0}getLocalMedia(n){return this.localTrackMap.get(n)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(n,i){if(!n)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(n);return!!s&&(!i||s.has(i))}hasRemoteMediaWithLock(n,i){var s=this;return L(function*(){if(!n)return s.remoteUserMap.size>0;const c=s.remoteUserMap.get(n);return!!c&&(!i||c.has(i))})()}getRemoteMedia(n){var i;const s=Array.from(zr(i=this.remoteUserMap).call(i)).find(c=>c.uid===n);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let n=Array.from(this.remoteUserMap.entries()).map(s=>{let[c]=s;return{uid:c.uid,level:c.audioTrack?100*c.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(ne.LocalAudioTrack);return i&&n.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),n=wu(n).call(n,(s,c)=>s.level-c.level),n}disconnectForReconnect(){var n=this;return L(function*(){n.sendConnection&&n.recvConnection&&(T.debug("[".concat(n.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),n.state=rt.Reconnecting,B("KEEP_LAST_FRAME")&&0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(i=>{let[s]=i;var c;s._videoTrack&&s._videoTrack._player&&(null===(c=s._videoTrack._player.getVideoElement())||void 0===c||c.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),n.sendConnection.close(),n.unbindConnectionEvents(n.sendConnection),n.sendConnection=void 0,n.recvConnection.close(),n.unbindConnectionEvents(n.recvConnection),n.recvConnection=void 0,0!==n.localTrackMap.size&&(Array.from(n.localTrackMap.entries()).forEach(i=>{var s;let[c,{track:d}]=i;switch(c){case ne.LocalVideoTrack:Re(s=d._hints).call(s,Ht.LOW_STREAM)?d.close():n.pendingLocalTracks.push(d);break;case ne.LocalAudioTrack:d instanceof Un?n.pendingLocalTracks=n.pendingLocalTracks.concat(d.trackList):n.pendingLocalTracks.push(d)}}),n.emit(Te.MediaReconnectStart,n.store.uid)),n.unbindLocalTrackEvents(),n.localTrackMap.clear(),0!==n.remoteUserMap.size&&Array.from(n.remoteUserMap.entries()).forEach(i=>{let[s,c]=i;Array.from(zr(c).call(c)).forEach(d=>{n.setPendingRemoteMedia(s,d)}),n.emit(Te.MediaReconnectStart,s.uid)}),n.unbindAllRemoteTrackEvents(),n.remoteUserMap.clear(),n.statsUploader.stopUploadUplinkStats(),n.statsUploader.stopUploadDownlinkStats(),n.statsUploader.stopUploadTransportStats(),T.debug("[".concat(n.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))})()}hasPendingRemoteMedia(n,i){for(const s of this.pendingRemoteTracks){const{user:c,kind:d}=s;if((n instanceof ji?n.uid:n)===c.uid&&i===d)return!0}return!1}setPendingRemoteMedia(n,i){this.hasPendingRemoteMedia(n,i)||this.pendingRemoteTracks.push({user:n,kind:i})}restartICE(n){var i=this;return L(function*(){let s;s=n.direction===Rf.SEND_ONLY?yield i.sendMutex.lock("From P2PChannel.restartICE"):yield i.recvMutex.lock("From P2PChannel.restartICE");try{const c=yield n.restartICE(),d=yield cn(i,Te.RequestP2PRestartICE,c);n.setDescription("local",d)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const n=this.sendConnection.getStats(),i=this.localTrackMap.get(ne.LocalVideoTrack),s=this.localTrackMap.get(ne.LocalAudioTrack),c=n.videoSend.find(O=>{var P;return O.ssrc===(null==i||null===(P=i.ssrcs)||void 0===P?void 0:P[0].ssrcId)}),d=n.audioSend.find(O=>{var P;return O.ssrc===(null==s||null===(P=s.ssrcs)||void 0===P?void 0:P[0].ssrcId)});if(!c||!d)return 1;const h=lo(this,Te.NeedSignalRTT),p=c?c.rttMs:void 0,m=d?d.rttMs:void 0,_=p&&m?(p+m)/2:p||m,v=100*n.sendPacketLossRate*.7/50+.3*((_&&h?(_+h)/2:_||h)||0)/1500,S=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,b=null==i?void 0:i.track;if(b&&b._encoderConfig&&-1===b._hints.indexOf(Ht.SCREEN_TRACK)){const O=b._encoderConfig.bitrateMax,P=n.bitrate.actualEncoded;if(O&&P){const w=(1e3*O-P)/(1e3*O);return LA[w<.15?0:w<.3?1:w<.45?2:w<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const n=this.recvConnection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[c]=s;const d=c._audioSSRC,h=c._videoSSRC,p=n.audioRecv.find(P=>P.ssrc===d),m=n.videoRecv.find(P=>P.ssrc===h);if(!p&&!m)return void(i+=1);const _=lo(this,Te.NeedSignalRTT),E=n.rtt,v=(E&&_?(E+_)/2:E||_)||0,S=p?p.jitterMs:void 0,b=n.recvPacketLossRate;let O=.7*b*100/50+.3*v/1500;S&&(O=.6*b*100/50+.2*v/1500+.2*S/400),i+=O<.1?1:O<.17?2:O<.36?3:O<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}muteLocalTrack(n){var i=this;return L(function*(){return new z((s,c)=>{i.handleMuteLocalTrack(n,s,c)})})()}filterTobePublishedTracks(n,i,s){const c=[],d=Ge(),h=this.getAllTracks();n=ga(n=n.filter(_=>-1===h.indexOf(_)));let p=!1,m=!1;for(const _ of n){if(_ instanceof We&&(this.localTrackMap.has(ne.LocalVideoTrack)||p?new Q(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(c.push({track:_,type:ne.LocalVideoTrack}),p=!0),i)){const E=this.getLowVideoTrack(_,s);c.push({track:E,type:ne.LocalVideoLowTrack})}if(_ instanceof xe){const E=this.localTrackMap.get(ne.LocalAudioTrack);if(E){if(!(E.track instanceof Un))throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const v=c.find(S=>{let{type:b}=S;return b===ne.LocalAudioTrack});if(!(v.track instanceof Un))throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(_)}else{if(!d.webAudioMediaStreamDest||_ instanceof Un||_._bypassWebAudio)c.push({track:_,type:ne.LocalAudioTrack});else{const v=new Un;v.addAudioTrack(_),c.push({track:v,type:ne.LocalAudioTrack})}m=!0}}}return c}filterTobeUnpublishedTracks(n){const i=[],s=this.getAllTracks();n=ga(n=n.filter(c=>-1!==s.indexOf(c)));for(const c of n){if(c instanceof xe){const d=this.localTrackMap.get(ne.LocalAudioTrack);if(!d)continue;d.track instanceof Un?(d.track.removeAudioTrack(c),this.unbindLocalAudioTrackEvents(c),0===d.track.trackList.length&&(i.push([ne.LocalAudioTrack,d]),d.track.close())):i.push([ne.LocalAudioTrack,d])}if(c instanceof We){const d=this.localTrackMap.get(ne.LocalVideoTrack);if(!d)continue;i.push([ne.LocalVideoTrack,d]);const h=this.localTrackMap.get(ne.LocalVideoLowTrack);h&&i.push([ne.LocalVideoLowTrack,h])}}return i}bindLocalTrackEvents(n){n.forEach(i=>{let{track:s,type:c}=i;switch(c){case ne.LocalVideoTrack:s.addListener(pe.GET_STATS,this.handleGetLocalVideoStats),s.addListener(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(pe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(pe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.addListener(pe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.bindLocalAudioTrackEvents(s)}})}bindLocalAudioTrackEvents(n,i){n instanceof Un?n.trackList.forEach(s=>{s.addListener(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(pe.GET_STATS,this.handleGetLocalAudioStats),s.addListener(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.addListener(pe.GET_STATS,this.handleGetLocalAudioStats),n.addListener(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||n.addListener(pe.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(n){n||(n=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:c}]=i;return{track:c,type:s}})),n.forEach(i=>{let{track:s,type:c}=i;switch(c){case ne.LocalVideoTrack:s.off(pe.GET_STATS,this.handleGetLocalVideoStats),s.off(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(pe.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(pe.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.off(pe.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ne.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s)}})}unbindLocalAudioTrackEvents(n){n instanceof Un?n.trackList.forEach(i=>{i.off(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(pe.GET_STATS,this.handleGetLocalAudioStats),i.off(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(n.off(pe.GET_STATS,this.handleGetLocalAudioStats),n.off(pe.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(pe.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(pe.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(pe.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(pe.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(n,i){i instanceof Ta&&i.addListener(pe.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(n))}),i instanceof go&&i.addListener(pe.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(n))})}unbindRemoteTrackEvents(n){n&&n.removeAllListeners(pe.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(n=>{let[i,s]=n;s.has(fe.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(fe.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(n){return n.map(i=>{var s;let c,d,{track:h,type:p}=i;switch(p){case ne.LocalAudioTrack:c=bt.Audio,d={dtx:h instanceof ol&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ne.LocalVideoTrack:c=Re(s=h._hints).call(s,Ht.SCREEN_TRACK)?bt.Screen:bt.High,d=So(So({},$b(h)),{},{codec:this.store.codec});break;case ne.LocalVideoLowTrack:c=bt.Low,d=So(So({},$b(h)),{},{codec:this.store.codec})}return{kind:p===ne.LocalAudioTrack?fe.AUDIO:fe.VIDEO,stream_type:c,attributes:d,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalVideoTrack:c=Re(s=h._hints).call(s,Ht.SCREEN_TRACK)?bt.Screen:bt.High;break;case ne.LocalAudioTrack:c=bt.Audio;break;case ne.LocalVideoLowTrack:c=bt.Low}return{stream_type:c,ssrcs:p,mid:m}})}assignLocalTracks(n){n.forEach(i=>{let{track:s,type:c}=i;this.localTrackMap.set(c,{track:s})})}withdrawLocalTracks(n){n.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(n){var i=this;n.onConnectionStateChange=function(){var s=L(function*(c){var d;if(T.info("[".concat(i.store.clientId,"] [p2pId: ").concat(i.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(c,")")),i.emit(Te.PeerConnectionStateChange,c),"connected"!==c||i.store.keyMetrics.peerConnectionEnd||i.store.peerConnectionEnd(),Re(d=i._restartStates).call(d,c)||n.direction===Rf.SEND_ONLY){if(i._restartTimer)return;const h=()=>{("disconnected"===n.iceConnectionState||"checking"===n.iceConnectionState||"failed"===n.iceConnectionState)&&(T.debug("[".concat(i.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===lo(i,Te.QueryClientConnectionState)&&i.restartICE(n))};i._restartTimer=window.setTimeout(()=>{h(),i._restartTimer=void 0},800)}});return function(c){return s.apply(this,arguments)}}(),n.onICEConnectionStateChange=s=>{"connected"!==s||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),ye.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:nn.TRACER}).onSuccess(),this.emit(Te.IceConnectionStateChange,s)},n.onICETransportStateChange=s=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},n.onDTLSTransportStateChange=s=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},n.onDTLSTransportError=s=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},n.onFirstAudioDecoded=s=>{var c;const d=Array.from(zr(c=this.remoteUserMap).call(c)).find(p=>p._audioSSRC===s);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),null===(h=d.audioTrack)||void 0===h||h.emit(ch.FIRST_FRAME_DECODED),ye.firstRemoteFrame(this.store.sessionId,ii.FIRST_AUDIO_DECODE,Kt.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},n.onFirstAudioReceived=s=>{var c;const d=Array.from(zr(c=this.remoteUserMap).call(c)).find(h=>h._audioSSRC===s);d&&ye.firstRemoteFrame(this.store.sessionId,ii.FIRST_AUDIO_RECEIVED,Kt.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onFirstVideoDecoded=(s,c,d)=>{this.reportVideoFirstFrameDecoded(s,c,d)},n.onFirstVideoReceived=s=>{var c;const d=Array.from(zr(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===s);d&&ye.firstRemoteFrame(this.store.sessionId,ii.FIRST_VIDEO_RECEIVED,Kt.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},n.onSelectedLocalCandidateChanged=(s,c)=>{const d="relay"===s.candidateType;"unknown"!==c.candidateType&&d===("relay"===c.candidateType)||this.emit(Te.ConnectionTypeChange,d),T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(mc(c))," -> ").concat(JSON.stringify(mc(s)),")"))},n.onSelectedRemoteCandidateChanged=(s,c)=>{T.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(mc(c))," -> ").concat(JSON.stringify(mc(s)),")"))},n.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)},n.onLocalCandidate=s=>{this.emit(Te.LocalCandidate,s)}}unbindConnectionEvents(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.onLocalCandidate=void 0}filterTobeMutedTracks(n){const i=[];if(-1===this.getAllTracks().indexOf(n))return i;const s=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof xe&&(null==s?void 0:s.track)instanceof Un)return s.track.isActive||i.push([ne.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c&&(i.push(c),c[0]===ne.LocalVideoTrack)){const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&i.push([ne.LocalVideoLowTrack,d])}return i}filterTobeUnmutedTracks(n){const i=[],s=this.localTrackMap.get(ne.LocalAudioTrack);if(n instanceof xe&&(null==s?void 0:s.track)instanceof Un)return s.track.isActive&&i.push([ne.LocalAudioTrack,s]),i;const c=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:h}]=d;return n===h});if(c)if(c[0]===ne.LocalVideoTrack){i.push(c);const d=this.localTrackMap.get(ne.LocalVideoLowTrack);d&&i.push([ne.LocalVideoLowTrack,d])}else i.push(c);return i}createMuteMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalAudioTrack:c=bt.Audio;break;case ne.LocalVideoTrack:c=Re(s=h._hints).call(s,Ht.SCREEN_TRACK)?bt.Screen:bt.High;break;case ne.LocalVideoLowTrack:c=bt.Low}return{stream_type:c,ssrcs:p,mid:m}})}createUnmuteMessage(n){return n.map(i=>{var s;let c,[d,{track:h,ssrcs:p,id:m}]=i;switch(d){case ne.LocalAudioTrack:c=bt.Audio;break;case ne.LocalVideoTrack:c=Re(s=h._hints).call(s,Ht.SCREEN_TRACK)?bt.Screen:bt.High;break;case ne.LocalVideoLowTrack:c=bt.Low}return{stream_type:c,ssrcs:p,mid:m}})}filterTobeUnSubscribedTracks(n,i){const s=[],c=this.remoteUserMap.get(n);if(!c)return s;if(i){const d=c.get(i);if(!d)return s;s.push([n,{kind:i,id:d}])}else Array.from(c.entries()).forEach(d=>{let[h,p]=d;s.push([n,{kind:h,id:p}])});return s}createUnsubscribeMessage(n){const i=[];return n.forEach(s=>{let[c,{kind:d}]=s;switch(d){case fe.VIDEO:return void(c._videoSSRC&&i.push({stream_type:fe.VIDEO,ssrcId:c._videoSSRC}));case fe.AUDIO:return void(c._audioSSRC&&i.push({stream_type:fe.AUDIO,ssrcId:c._audioSSRC}))}}),i}withdrawRemoteTracks(n){n.forEach(i=>{let[s,{kind:c}]=i;const d=this.remoteUserMap.get(s);d&&(d.delete(c),0===Array.from(d.entries()).length&&this.remoteUserMap.delete(s))})}updateBitrateLimit(n){var i=this;return L(function*(){const s=i.localTrackMap.get(ne.LocalVideoTrack),c=i.localTrackMap.get(ne.LocalVideoLowTrack);s&&(yield s.track.setBitrateLimit(n.uplink)),c&&n.low_stream_uplink&&(yield c.track.setBitrateLimit({max_bitrate:n.low_stream_uplink.bitrate,min_bitrate:n.low_stream_uplink.bitrate||0}))})()}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const i=this.recvConnection.peerConnectionState;return"connected"!==this.sendConnection.peerConnectionState&&"connected"!==i}return!0}tryToUnmuteAudio(n){var i=this;return L(function*(){for(let s=0;s<n.length;s++)if(n[s]instanceof xe){const c=i.filterTobeUnmutedTracks(n[s]);if(0===c.length)continue;const d=i.createUnmuteMessage(c);return void(yield Lt(i,Te.RequestUnmuteLocal,d))}})()}bindStatsUploaderEvents(){this.statsUploader.requestStats=n=>this.getStats(n),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(n=>{let[,{ssrcs:i}]=n;return!!i}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=n=>{var i;return!(null===(i=this.recvConnection)||void 0===i||!i.getRemoteVideoIsReady(n))},this.statsUploader.requestUpload=(n,i)=>this.emit(Te.RequestUploadStats,n,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}requestReconnect(){var n=this;return L(function*(){n.dtlsFailedCount+=1,yield pi(qu(n.dtlsFailedCount,Ln)),n.emit(Te.RequestReconnect)})()}reconnectP2P(){return L(function*(){})()}canPublishLowStream(){return this.localTrackMap.has(ne.LocalVideoTrack)||this.pendingLocalTracks.some(n=>n instanceof We)}throwIfTrackTypeNotMatch(n){if(n.filter(i=>i instanceof We).length>1)throw new Q(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n.filter(i=>i instanceof xe).length>1&&(n.some(i=>i instanceof xe&&i._bypassWebAudio)||!Ge().webAudioMediaStreamDest))throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of n){if(i instanceof We&&this.pendingLocalTracks.some(s=>s instanceof We))throw new Q(k.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof xe&&this.pendingLocalTracks.some(s=>s instanceof xe)&&(!Ge().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof xe&&s._bypassWebAudio)))throw new Q(k.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(n,i){const s=!B("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ge().supportDualStreamEncoding,c=So(So({},{width:160,height:120,framerate:15,bitrate:50}),i);let d;d=s?n._mediaStreamTrack.clone():EO(n,c);const h=Ot(8,"track-low-"),p=new We(d,So(So({},s&&{scaleResolutionDownBy:sm(c,n)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return p.on(Mf.TRANSCEIVER_UPDATED,m=>{n._updateRtpTransceiver(m,hd.LOW_STREAM)}),p._hints.push(Ht.LOW_STREAM),n.addListener(pe.NEED_CLOSE,()=>{p.close()}),p}globalLock(){var n=this;return L(function*(){return n.recvMutex.lock("From P2PChannel2.globalLock")})()}reportVideoFirstFrameDecoded(n,i,s,c){var d;const h=Array.from(zr(d=this.remoteUserMap).call(d)).find(p=>p._videoSSRC===n);if(h){c||this.store.subscribe(h.uid,"video",void 0,void 0,void 0,void 0,Date.now());const p=this.store.keyMetrics,m=p.subscribe.find(_=>_.userId===h.uid&&"video"===_.type);ye.firstRemoteVideoDecode(this.store.sessionId,ii.FIRST_VIDEO_DECODE,Kt.FIRST_VIDEO_DECODE,{peer:h._uintid,videowidth:i,videoheight:s,subscribeElapse:Ai.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId,apEnd:p.requestAPEnd||0,apStart:p.requestAPStart||0,joinGwEnd:p.joinGatewayEnd||0,joinGwStart:p.joinGatewayStart||0,pcEnd:p.peerConnectionEnd||0,pcStart:p.peerConnectionStart||0,subscriberEnd:(null==m?void 0:m.subscribeEnd)||0,subscriberStart:(null==m?void 0:m.subscribeStart)||0,videoAddNotify:(null==m?void 0:m.streamAdded)||0,state:c?1:0})}}remoteMediaSsrcChanged(n,i,s){var c=this;return L(function*(){if(!c.recvConnection)return!1;const d=c.remoteUserMap.get(n);if(!d)return!1;const h=d.get(i);if(!h)return!1;const p=yield c.recvConnection.getRemoteSSRC(h);return void 0!==p&&p!==s})()}resetConnection(n){T.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(n)),this.state===rt.Connected?(T.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}publishDataChannel(n){return L(function*(){throw new Q(k.NOT_SUPPORTED)})()}unpublishDataChannel(n){return L(function*(){throw new Q(k.NOT_SUPPORTED)})()}subscribeDataChannel(n,i){return L(function*(){throw new Q(k.NOT_SUPPORTED)})()}unsubscribeDataChannel(n,i){return L(function*(){throw new Q(k.NOT_SUPPORTED)})()}hasPendingRemoteDataChannel(n,i){throw new Q(k.NOT_SUPPORTED)}setPendingRemoteDataChannel(n,i){throw new Q(k.NOT_SUPPORTED)}preConnect(n,i,s,c,d,h){return L(function*(){throw new Q(k.NOT_SUPPORTED)})()}getEstablishParams(){throw new Q(k.NOT_SUPPORTED)}reSubscribe(n){return L(function*(){throw new Q(k.NOT_SUPPORTED)})()}updateVideoStreamParameter(n,i){return L(function*(){throw new Q(k.NOT_SUPPORTED)})()}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s}]=n;i===ne.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,hd.LOW_STREAM):s._updateRtpTransceiver(void 0)})}}function Yn(o){return function(n,i,s){const c=n[i];if("function"!=typeof c)throw new Error("Cannot use mutex on object property.");return s.value=L(function*(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];switch(o){case Ho.SEND_ONLY:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(i));try{return yield c.apply(this,h)}finally{m()}}case Ho.RECEIVE_ONLY:{const m=yield this.recvMutex.lock("From P2PChannel2.".concat(i));try{return yield c.apply(this,h)}finally{m()}}default:{const m=yield this.sendMutex.lock("From P2PChannel2.".concat(i)),_=yield this.recvMutex.lock("From P2PChannel2.".concat(i));try{return yield c.apply(this,h)}finally{m(),_()}}}}),s}}function ut(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Ix(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?ut(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):ut(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}te([Yn(),N("design:type",Function),N("design:paramtypes",[Object,String]),N("design:returntype",z)],Zt.prototype,"startP2P",null),te([Yn(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Zt.prototype,"p2pConnect",null),te([Yn(Ho.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Zt.prototype,"dopublish",null),te([Yn(Ho.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],Zt.prototype,"unpublish",null),te([Yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Zt.prototype,"unpublishLowStream",null),te([Yn(Ho.SEND_ONLY),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],Zt.prototype,"doUnpublish",null),te([Yn(Ho.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[ji,String,String,Number]),N("design:returntype",z)],Zt.prototype,"subscribe",null),te([Yn(Ho.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[ji,String,String,Boolean]),N("design:returntype",z)],Zt.prototype,"unsubscribe",null),te([Yn(Ho.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[ji,String]),N("design:returntype",z)],Zt.prototype,"muteRemote",null),te([Yn(Ho.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[ji,String]),N("design:returntype",z)],Zt.prototype,"unmuteRemote",null),te([Yn(Ho.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[ji,String]),N("design:returntype",z)],Zt.prototype,"hasRemoteMediaWithLock",null),te([Yn(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],Zt.prototype,"disconnectForReconnect",null),te([Yn(Ho.RECEIVE_ONLY),N("design:type",Function),N("design:paramtypes",[ji,String,Number]),N("design:returntype",z)],Zt.prototype,"remoteMediaSsrcChanged",null);const zU=Date.now(),FO=new Map,jT=new Map;function UO(o){return HT.apply(this,arguments)}function HT(){return HT=L(function*(o){const n=FO.get(o),i=Array.isArray(n)&&n[n.length-1],s=jT.get(o);if(!i)return void(s.isSyncing=!1);const c={uid:i.uid,payload:cf(i.payload)};0===s.firstRecvTs&&(s.firstRecvTs=i.recvTs,s.firstSendTs=i.sendTs);const d=i.sendTs-s.firstSendTs,h=d-(Date.now()-s.firstRecvTs);h>0&&(s.firstRecvTs=Date.now()-d);let p=i.mediaDelay+h;p<=0?(n.pop(),VO(i.context,c),p=0):p=Math.min(p,20),setTimeout(()=>n.length&&UO(o),p)}),HT.apply(this,arguments)}function VO(o,n){o.safeEmit($e.STREAM_MESSAGE,n.uid,n.payload),o.onStreamMessage&&o.onStreamMessage(n)}function wx(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Im(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?wx(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):wx(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}ni.setLogger(T);class kt extends jt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var n;return(null===(n=this._config)||void 0===n?void 0:n.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(n){var i;let s;if(super(),i=this,C(this,"store",void 0),C(this,"_uid",void 0),C(this,"_channelName",void 0),C(this,"_uintUid",void 0),C(this,"_users",[]),C(this,"_config",void 0),C(this,"_clientId",void 0),C(this,"_appId",void 0),C(this,"_sessionId",null),C(this,"_key",void 0),C(this,"_joinInfo",void 0),C(this,"_gateway",void 0),C(this,"_statsCollector",void 0),C(this,"_configDistribute",void 0),C(this,"_leaveMutex",new ni("client-leave")),C(this,"_publishMutex",new ni("client-publish")),C(this,"_renewTokenMutex",new ni("client-renewtoken")),C(this,"_subscribeMutex",new ni("client-subscribe")),C(this,"_encryptionMode","none"),C(this,"_encryptionSecret",null),C(this,"_encryptionSalt",null),C(this,"_proxyServer",void 0),C(this,"_turnServer",{servers:[],mode:"auto"}),C(this,"_cloudProxyServerMode","disabled"),C(this,"_isDualStreamEnabled",!1),C(this,"_defaultStreamFallbackType",void 0),C(this,"_lowStreamParameter",void 0),C(this,"_streamFallbackTypeCacheMap",new Map),C(this,"_remoteStreamTypeCacheMap",new Map),C(this,"_axiosCancelSource",Hn.CancelToken.source()),C(this,"_audioVolumeIndicationInterval",void 0),C(this,"_networkQualityInterval",void 0),C(this,"_userOfflineTimeout",void 0),C(this,"_streamRemovedTimeout",void 0),C(this,"_injectStreamingClient",void 0),C(this,"_liveTranscodeStreamingClient",void 0),C(this,"_liveRawStreamingClient",void 0),C(this,"_channelMediaRelayClient",void 0),C(this,"_networkQualitySensitivity","normal"),C(this,"_p2pChannel",void 0),C(this,"_useLocalAccessPoint",!1),C(this,"_setLocalAPVersion",void 0),C(this,"_joinAndNotLeaveYet",!1),C(this,"_numberOfJoinCount",0),C(this,"_remoteDefaultVideoStreamType",void 0),C(this,"_inspect",void 0),C(this,"_moderation",void 0),C(this,"_license",void 0),C(this,"_pendingPublishedUsers",[]),C(this,"ntpAlignErrorCount",0),C(this,"remoteInboundOffset",0),C(this,"_handleLocalTrackEnable",(c,d,h)=>{this.publish(c,!1).then(d).catch(h)}),C(this,"_handleLocalTrackDisable",(c,d,h)=>{this.unpublish(c).then(d).catch(h)}),C(this,"_handleUserOnline",c=>{if(B("BLOCK_LOCAL_CLIENT")&&Zc(c.uid,this.channelName))return void T.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof c.uid&&T.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find(h=>h.uid===c.uid);if(d)d._trust_in_room_=!0;else{const h=new ji(c.uid,c.uint_id||c.uid);this._users.push(h),T.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit($e.USER_JOINED,h)}}),C(this,"_handleUserOffline",c=>{if(B("BLOCK_LOCAL_CLIENT")&&Zc(c.uid,this.channelName))return;const d=this._users.find(h=>h.uid===c.uid);d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),Vg(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),T.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit($e.USER_LEAVED,d,c.reason))}),C(this,"_handleAddAudioOrVideoStream",(c,d,h,p,m,_,E)=>{if(B("BLOCK_LOCAL_CLIENT")&&Zc(d,this.channelName))return;const v=this._users.find(b=>b.uid===d);if(!v)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(v.uid,c,void 0,void 0,void 0,Date.now());const S="audio"===c?v.hasAudio:v.hasVideo;v._uintid||(v._uintid=m||d),"audio"===c?v._trust_audio_stream_added_state_=!0:v._trust_video_stream_added_state_=!0,"audio"===c?(v._audio_added_=!0,void 0!==h&&(v._audioSSRC=h),void 0!==p&&(v._cname=p),_&&(v._audioOrtc=_)):(v._video_added_=!0,void 0!==h&&(v._videoSSRC=h),void 0!==p&&(v._cname=p),void 0!==E&&(v._rtxSsrcId=E),_&&(v._videoOrtc=_)),("audio"===c?v.hasAudio:v.hasVideo)&&!S&&(T.info("[".concat(this._clientId,"] remote user ").concat(v.uid," published ").concat(c)),this.safeEmit($e.USER_PUBLISHED,v,c)),"video"===c?ye.onGatewayStream(this._sessionId,ii.ON_ADD_VIDEO_STREAM,Kt.ON_ADD_VIDEO_STREAM,{peer:m||d,ssrc:v._videoSSRC}):ye.onGatewayStream(this._sessionId,ii.ON_ADD_AUDIO_STREAM,Kt.ON_ADD_AUDIO_STREAM,{peer:m||d,ssrc:v._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(v,c,h).then(b=>{if(b&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(v.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof ai))return this._p2pChannel.unsubscribe(v,c,!0).then(()=>this._subscribe(v,c,!0).catch(O=>{T.error("[".concat(this._clientId,"] resubscribe error"),O.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(v,c)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(v.uid," after reconnect.")),this._subscribe(v,c,!0).catch(b=>{T.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),C(this,"_handleRemoveStream",(c,d,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&Zc(c.uid,this.channelName))return;const p=this._users.find(_=>_.uid===c.uid);if(!p)return void T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));T.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let m=()=>{};if(p.hasAudio&&p.hasVideo?m=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit($e.USER_UNPUBLISHED,p,"audio"),T.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit($e.USER_UNPUBLISHED,p,"video")}:p.hasVideo?m=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit($e.USER_UNPUBLISHED,p,"video")}:p.hasAudio&&(m=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit($e.USER_UNPUBLISHED,p,"audio")}),p._trust_audio_stream_added_state_=!0,p._trust_video_stream_added_state_=!0,p._audio_added_=!1,p._video_added_=!1,this._p2pChannel instanceof ai)this._p2pChannel.unsubscribe(p).then(_=>{if(_)return this._gateway.unsubscribe(_,p.uid)});else if(d&&h)if(c.sdp){const{sdp:_}=c;this._p2pChannel.unsubscribe(p,_).then(E=>{E&&d(E)}).catch(h)}else d&&d();p._audioSSRC=void 0,p._videoSSRC=void 0,p._audioOrtc=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0,ye.onGatewayStream(this._sessionId,ii.ON_REMOVE_STREAM,Kt.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),m()}),C(this,"_handleSetStreamLocalEnable",(c,d,h)=>{if(B("BLOCK_LOCAL_CLIENT")&&Zc(d,this.channelName))return;const p=this._users.find(E=>E.uid===d);if(!p)return void T.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));T.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const m="audio"===c?p.hasAudio:p.hasVideo;if("audio"===c){p._trust_audio_enabled_state_=!0;const E=p._audio_enabled_;if(p._audio_enabled_=h,p._audio_enabled_===E)return;{const v=p._audio_enabled_?"enable-local-audio":"disable-local-audio";T.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(v)),this.safeEmit($e.USER_INFO_UPDATED,d,v)}}else{p._trust_video_enabled_state_=!0;const E=p._video_enabled_;if(p._video_enabled_=h,p._video_enabled_===E)return;{const v=p._video_enabled_?"enable-local-video":"disable-local-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(v)),this.safeEmit($e.USER_INFO_UPDATED,d,v)}}const _="audio"===c?p.hasAudio:p.hasVideo;return m!==_?!m&&_?(T.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit($e.USER_PUBLISHED,p,c)):("video"===c&&p._videoTrack&&p._videoTrack._destroy(),this._p2pChannel.muteRemote(p,c),T.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit($e.USER_UNPUBLISHED,p,c)):void 0}),C(this,"_handleMuteStream",(c,d,h,p,m,_)=>{if(B("BLOCK_LOCAL_CLIENT")&&Zc(c,this.channelName))return;T.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const E=this._users.find(b=>b.uid===c);if(!E)return void T.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const v="audio"===d?E.hasAudio:E.hasVideo;if("audio"===d){E._trust_audio_mute_state_=!0;const b=E._audio_muted_;if(E._audio_muted_=h,E._audio_muted_===b)return;{const O=E._audio_muted_?"mute-audio":"unmute-audio";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(O)),this.safeEmit($e.USER_INFO_UPDATED,c,O)}}else{E._trust_video_mute_state_=!0;const b=E._video_muted_;if(E._video_muted_=h,E._video_muted_===b)return;{const O=E._video_muted_?"mute-video":"unmute-video";T.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(O)),this.safeEmit($e.USER_INFO_UPDATED,c,O)}}const S="audio"===d?E.hasAudio:E.hasVideo;if(v!==S){if(!v&&S)return this.store.useP2P||("audio"===d?E._audioSSRC:E._videoSSRC)?(T.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit($e.USER_PUBLISHED,E,d)):void T.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));"video"===d&&E._videoTrack&&E._videoTrack._destroy(),m&&_&&this._p2pChannel instanceof Zt&&(p?this._p2pChannel.unsubscribe(E,p,d).then(b=>{m(b)}).catch(_):m()),this._p2pChannel.muteRemote(E,d),T.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit($e.USER_UNPUBLISHED,E,d)}}),C(this,"_handleP2PLost",function(){var c=L(function*(d){T.debug("[".concat(i._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===i.store.p2pId?yield i._p2pChannel.requestReconnect():T.warning("[".concat(i._clientId,"] P2PLost stream not found"),d)});return function(d){return c.apply(this,arguments)}}()),C(this,"_handleTokenWillExpire",()=>{T.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit($e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),C(this,"_handleBeforeUnload",c=>{"beforeunload"===c.type&&void 0!==c.returnValue&&""!==c.returnValue||(this.leave(),T.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),C(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit($e.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit($e.NETWORK_QUALITY,c)}),C(this,"_handleP2PAddAudioOrVideoStream",(c,d)=>{const h=this._users.find(m=>m.uid===d);if(!h)return void T.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));T.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(h.uid,c,void 0,void 0,void 0,Date.now());const p="audio"===c?h.hasAudio:h.hasVideo;"audio"===c?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,"audio"===c?h._audio_added_=!0:h._video_added_=!0,("audio"===c?h.hasAudio:h.hasVideo)&&!p&&(T.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(c)),this.safeEmit($e.USER_PUBLISHED,h,c)),this._p2pChannel.hasPendingRemoteMedia(h,c)&&(T.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,c,!0).catch(m=>{T.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=n,this._clientId=Ot(5,"client-"),this.store=new X1(n.codec,n.audioCodec,n.mode,this._clientId),this.store.clientCreated(),n.proxyServer&&this.setProxyServer(n.proxyServer,!0),n.turnServer&&this.setTurnServer(n.turnServer,!0),T.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Kr," build: ").concat(nE,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),n.clientRoleOptions)try{b1(n.clientRoleOptions),s=Object.assign({},n.clientRoleOptions)}catch(c){T.warning("[".concat(this._clientId,"] ").concat(c.toString()))}this._statsCollector=new Rh(this.store),this._statsCollector.onStatsException=(c,d,h)=>{T.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),this.safeEmit($e.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,p)=>{const m=this._users.find(_=>_.uid===c);m&&ye.peerPublishStatus(this._sessionId,{subscribeElapse:p,audioPublishDuration:d,videoPublishDuration:h,peer:m._uintid})},this.store.useDataChannel=Ge().supportDataChannel&&B("SIGNAL_CHANNEL"),this.store.useP2P=B("P2P"),this._gateway=new BU(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:n.websocketRetryConfig||Ln,httpRetryConfig:n.httpRetryConfig||Ln,forceWaitGatewayResponse:void 0===n.forceWaitGatewayResponse||n.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:n.role,clientRoleOptions:s}),this._configDistribute=new iO,this.store.useP2P?(this._p2pChannel=new Zt(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new ai(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}joinMeta(n,i,s,c,d){var h=arguments,p=this;return L(function*(){let m=!(h.length>5&&void 0!==h[5])||h[5],_=h.length>6&&void 0!==h[6]&&h[6];Nt("JOIN_GATEWAY_USE_443PORT_ONLY",m),Nt("JOIN_GATEWAY_USE_DUAL_DOMAIN",_);const E=p._gateway.signal.websocket;return E instanceof Nf&&(E.use443PortOnly=m,E.tryDoubleDomain=_),(v=L(function*(S,b,O){Ng.get(S)||Ng.set(S,[]),Pg.get(S)||Pg.set(S,b),ua.get(S)||ua.set(S,0);const P=Ng.get(S),w=Pg.get(S);if(!P||!w)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ua.get(S)===w){const ie=Qp();P.push(ie),yield ie.promise}ua.set(S,ua.get(S)+1);for(var M=arguments.length,V=new Array(M>3?M-3:0),U=3;U<M;U++)V[U-3]=arguments[U];const Y=yield O(...V);return ua.set(S,ua.get(S)-1),ua.get(S)===w-1&&P.length>0&&(P[0].resolve(),P.shift()),0===ua.get(S)&&(Ng.set(S,[]),Pg.set(S,0),ua.set(S,0)),Y}),function(S,b,O){return v.apply(this,arguments)})("client.join",B("JOIN_MAX_CONCURRENCY"),p.join.bind(p),n,i,s,c,d);var v})()}join(n,i,s,c,d){var h=this;return L(function*(){const p=++h._numberOfJoinCount;h.store.joinStart(),c&&(h.store.uid=c);const m="HTTPS"===(yf||yf||(yf=(window.location.protocol.split(":")[0]||"").toUpperCase(),yf)),_=NA()?window.isSecureContext:"Browser Not Support";(NA()||m)&&window.isSecureContext||T.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");const E=jg();"DISCONNECTED"===h.connectionState&&(h.store.avoidJoinStart=Math.round(Date.now()),T.debug("[".concat(h._clientId,"] set avoidJoinStart to ").concat(h.store.avoidJoinStart)));const v=ye.reportApiInvoke(E,{name:fn.JOIN,options:[n,i,s,c],states:{isHttps:m,isSecureContext:_},tag:nn.TRACER});ye.setAppId(n);try{if(!s&&null!==s)throw new W(k.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&Ei(s,"token",1,2047),Ei(n,"appid",1,2047),Bs(i),c&&nb(c),d&&Ei(d,"optionalInfo",1,2047)}catch(w){throw v.onError(w),w}if(T.info("[".concat(h._clientId,"] start join channel ").concat(i,", join number: ").concat(p)),h._leaveMutex.isLocked&&(T.debug("[".concat(h._clientId,"] join: waiting leave operation")),(yield h._leaveMutex.lock())(),T.debug("[".concat(h._clientId,"] join: continue"))),h._joinAndNotLeaveYet=!0,"DISCONNECTED"!==h.connectionState){const w=new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already in connecting/connected state"));throw v.onError(w),w}h._sessionId||(h._sessionId=E,h.store.sessionId=h._sessionId),h._gateway.state="CONNECTING";const S=Im({clientId:h._clientId,appId:n,sid:h._sessionId,cname:i,uid:"string"!=typeof c?c:null,turnServer:h._turnServer,proxyServer:h._proxyServer,token:s||n,cloudProxyServer:h._cloudProxyServerMode,optionalInfo:d,license:h._license,useLocalAccessPoint:h._useLocalAccessPoint},void 0!==h._remoteDefaultVideoStreamType&&{defaultVideoStream:h._remoteDefaultVideoStreamType});if(h._useLocalAccessPoint&&(S.setLocalAPVersion=h._setLocalAPVersion),"string"==typeof c&&(S.stringUid=c,h._uintUid?(S.uid=h._uintUid,h._uintUid=void 0):S.uid=0),"none"!==h._encryptionMode&&h._encryptionSecret){if(S.aesmode=h._encryptionMode,S.aespassword=yield Gw(h._encryptionSecret),!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h._encryptionSalt&&(S.aessalt=h._encryptionSalt)}h._startSession(h._sessionId,{channel:i,appId:n});const b=h._sessionId;setTimeout(()=>{"CONNECTING"===h.connectionState&&b===h._sessionId&&ye.joinChannelTimeout(h._sessionId,5)},5e3);try{var O;let w;const M=S.cloudProxyServer;if(Re(O=["proxy3","proxy4","proxy5"]).call(O,M)){const ie=B("PROXY_SERVER_TYPE3");S.proxyServer=Array.isArray(ie)?ie[0]:ie}if(ye.setProxyServer(S.proxyServer),T.setProxyServer(S.proxyServer),h.store.requestAPStart(),S.stringUid&&!S.uid){const ie=yield cT(S.stringUid,S,h._axiosCancelSource.token,h._config.httpRetryConfig||Ln,h.store);T.debug("[".concat(h._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(ie)),S.uid=ie,w=yield aT(S,h._axiosCancelSource.token,h._config.httpRetryConfig||Ln,!0,h.store)}else w=yield aT(S,h._axiosCancelSource.token,h._config.httpRetryConfig||Ln,!0,h.store);if(!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));h.store.requestAPEnd(),setTimeout(()=>{h._configDistribute.startGetConfigDistribute(S,h._axiosCancelSource.token),h._configDistribute.on(ud.UPDATE_BITRATE_LIMIT,ie=>{h._p2pChannel.updateBitrateLimit(ie)})},0),h._key=s||n;const V=w.gatewayInfo;h._joinInfo=Im(Im({},S),{},{cid:V.cid,uid:S.uid?S.uid:V.uid,vid:V.vid,apResponse:V.res,uni_lbs_ip:V.uni_lbs_ip,gatewayAddrs:V.gatewayAddrs});const U=yield h._joinGateway();if(!h._joinAndNotLeaveYet)throw new W(k.INVALID_OPERATION,"[".concat(h._clientId,"] Client already left"));v.onSuccess(U),h._appId=n,h._channelName=S.cname,h._uid=U,h.store.uid=U,setTimeout(()=>{h._networkQualityInterval&&window.clearInterval(h._networkQualityInterval),h._networkQualityInterval=window.setInterval(h._handleUpdateNetworkQuality,2e3),window.addEventListener(or()?"beforeunload":"pagehide",h._handleBeforeUnload)},0);const Y=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(h._uid);return T.info("[".concat(h._clientId,"] Joining channel success: channel: ").concat(i,",").concat(Y)),setTimeout(()=>{T.startUpload()},5e3),h.store.joinEnd(),P=h,Re(rc).call(rc,P)||rc.push(P),U}catch(w){const M=Array.isArray(w)?w[0]:w;throw M&&M.code===k.OPERATION_ABORTED?T.warning("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),M):T.error("[".concat(h._clientId,"] join number: ").concat(p,", Joining channel failed, rollback"),M),M.code!==k.OPERATION_ABORTED&&h._numberOfJoinCount===p&&(h._gateway.state="DISCONNECTED",h._reset()),v.onError(M),M}var P})()}_joinGateway(){if(!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!B("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(n=>n).catch(n=>{if(n.code===k.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Ye.FALLBACK),n;if(n.code===k.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Ye.FALLBACK),n;throw n}).then(n=>{if(n instanceof W){if(n.code===k.INIT_WEBSOCKET_TIMEOUT){if(T.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const i=B("PROXY_SERVER_TYPE3");if(Array.isArray(i))if(this._joinInfo.apUrl){const c=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),d=c.slice(c.length-2).join(".");i.forEach(h=>{this._joinInfo&&Re(h).call(h,d)&&(this._joinInfo.proxyServer=h)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=i[0])}else this._joinInfo.proxyServer=i[0];else this._joinInfo.proxyServer=i;const s=B("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return s&&s[1]&&"443"!==s[1]&&T.setProxyServer(this._joinInfo.proxyServer),"443"!==B("STATS_COLLECTOR_PORT").toString()&&ye.setProxyServer(this._joinInfo.proxyServer),ye.reportApiInvoke(this._sessionId,{name:fn.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:nn.TRACER}).onSuccess(),this.safeEmit($e.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),B("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(c=>{"forceturn"in c&&(c.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(T.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new W(k.INVALID_OPERATION);return ye.reportApiInvoke(this._sessionId,{name:fn.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:nn.TRACER}).onSuccess(),this._joinGateway()}return n}).then(n=>n)}leave(){var n=this;return L(function*(){T.info("[".concat(n._clientId,"] Leaving channel")),window.removeEventListener(or()?"beforeunload":"pagehide",n._handleBeforeUnload),n._reset(),function(s){const c=rc.indexOf(s);-1!==c&&rc.splice(c,1)}(n);const i=yield n._leaveMutex.lock();if("DISCONNECTED"===n.connectionState)return T.info("[".concat(n._clientId,"] Leaving channel repeated, success")),void i();yield n._gateway.leave("CONNECTED"!==n.connectionState),T.info("[".concat(n._clientId,"] Leaving channel success")),n._joinAndNotLeaveYet=!1,n.store.resetJoinChannelServiceRecords(),i()})()}publish(n){var i=arguments,s=this;return L(function*(){let c=!(i.length>1&&void 0!==i[1])||i[1];if(!Array.isArray(n)){if(!(n instanceof zn))return s._publishDataChannel(n);n=[n]}if(0===n.length)throw new W(k.INVALID_PARAMS,"param list is empty");const d=n;if("audience"===s._gateway.role)throw new W(k.INVALID_OPERATION,"audience can not publish stream");for(const p of d){if(!(p instanceof zn))throw new W(k.INVALID_PARAMS,"parameter is not local track");if(!p._enabled&&c)throw new W(k.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()))}T.info("[".concat(s._clientId,"] Publishing tracks, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))));const h=yield s._publishMutex.lock();yield s._configDistribute.awaitConfigDistributeComplete(),c&&d.forEach(p=>{const m=s._configDistribute.getBitrateLimit();p instanceof We&&m&&p.setBitrateLimit(m.uplink)});try{yield s._publishHighStream(d),T.info("[".concat(s._clientId,"] Publish success, id ").concat(d.map(p=>"".concat(p.getTrackId()," "))))}catch(p){throw T.error("[".concat(s._clientId,"] publish error"),p.toString()),p}finally{h()}})()}_publishDataChannel(n){var i=this;return L(function*(){Dt(n.id,"id",0,65535,!0),Jc(n.ordered,"ordered"),Ei(n.metadata,"metadata",0,512),T.info("[".concat(i._clientId,"] Publishing datachannels, id ").concat(n.id));const s=yield i._publishMutex.lock();try{if(-1!==i._p2pChannel.getAllDataChannels().findIndex(d=>d.id===n.id))throw new W(k.INVALID_PARAMS,"Invalid id: ".concat(n.id,". If you want to republish the datachannel, unpublish first"));if(!i._joinInfo||void 0===i._uid)throw new W(k.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(k.INVALID_OPERATION,"can not publish datachannel in ".concat(i.connectionState," state"));if("auto"===i._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new W(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const c=new XD(n);yield i._p2pChannel.publishDataChannel([c]);try{const d={streamId:n.id,ordered:n.ordered,maxRetransmits:B("DATASTREAM_MAX_RETRANSMITS"),metadata:n.metadata,channelId:c._originDataChannelId};yield i._gateway.publishDataChannel(i._uid,d,!0)}catch(d){if(d.code!==k.DISCONNECT_P2P)throw d}return yield c._waitTillOpen(),T.info("[".concat(i._clientId,"] Publish dataChannels success, id ").concat(c.id)),c}catch(c){throw T.error("[".concat(i._clientId,"] publish datachannels error"),c.toString()),c}finally{s()}})()}unpublish(n){var i=this;return L(function*(){if(!i._joinInfo||void 0===i._uid)throw new W(k.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let s=[];if(n)if(Array.isArray(n))s=n;else{if(!(n instanceof zn))return i._unpublishDataChannel([n]);s=[n]}else i.store.useP2P||(yield i._unpublishDataChannel()),s=i._p2pChannel.getAllTracks(!0);T.info("[".concat(i._clientId,"] Unpublish tracks, tracks ").concat(s.map(d=>"".concat(d.getTrackId()," "))," "));const c=yield i._publishMutex.lock();try{if(i._p2pChannel instanceof Zt){const d=yield i._p2pChannel.unpublish(s);if(d){const h=yield i._gateway.sendExtensionMessage(Pt.UNPUBLISH,d);h&&(yield i._p2pChannel.setDescription("local",h))}}else{const d=yield i._p2pChannel.unpublish(s);d&&(yield i._gateway.unpublish(d,i._uid)),T.info("[".concat(i._clientId,"] Unpublish success,tracks ").concat(s.map(h=>"".concat(h.getTrackId()))))}}catch(d){throw T.error("[".concat(i._clientId,"] unpublish error"),d.toString()),d}finally{c&&c()}})()}_unpublishDataChannel(n){var i=this;return L(function*(){void 0!==n&&0!==n.length||(n=i._p2pChannel.getAllDataChannels()),T.info("[".concat(i._clientId,"] Unpublish datachannels, datachannels ").concat(n.map(c=>"".concat(c.id," "))," "));const s=yield i._publishMutex.lock();try{const c=yield i._p2pChannel.unpublishDataChannel(n);c&&(yield i._gateway.unpublishDataChannel(c)),T.info("[".concat(i._clientId,"] Unpublish dataChannel success,dataChannel ").concat(n.map(d=>"".concat(d.id))))}catch(c){throw T.error("[".concat(i._clientId,"] unpublish dataChannel error"),c.toString()),c}finally{s&&s()}})()}subscribe(n,i,s){var c=this;return L(function*(){return"datachannel"===i?c._subscribeDataChannel(n,s):c._subscribe(n,i)})()}_subscribeDataChannel(n,i){var s=this;return L(function*(){var c;if(Dt(i,"channelId",0,65535,!0),!s._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==s.connectionState&&"RECONNECTING"!==s.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(s.connectionState," state"));if(!s._users.find(m=>m===n))throw T.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),new W(k.INVALID_REMOTE_USER,"user is not in the channel");if(!n.hasAudio&&!n.hasVideo&&0===n._dataChannels.length)throw T.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),new W(k.INVALID_REMOTE_USER,"user is not published");const d=null===(c=n._dataChannels)||void 0===c?void 0:c.find(m=>m.id===i);if(!d)throw T.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, remote datachannel is not published")),new W(k.REMOTE_USER_IS_NOT_PUBLISHED);const h=yield s._subscribeMutex.lock();T.info("[".concat(s._clientId,"] subscribe user ").concat(n.uid,", mediaType: datachannel"));try{const m=yield s._p2pChannel.subscribeDataChannel(n,[d]);if(m&&Re(m).call(m,d.id))try{var p;if(!d._originDataChannelId)throw T.error("[".concat(s._clientId,"] can not subscribe ").concat(n.uid," with mediaType datachannel, cannot get RTCDatachannel")),new W(k.REMOTE_USER_IS_NOT_PUBLISHED);const _={id:d.id,datachannelId:d._originDataChannelId,ordered:d.ordered,maxRetransmits:d.maxRetransmits,metadata:null!==(p=d.metadata)&&void 0!==p?p:""};yield s._gateway.subscribeDataChannel(n.uid,_,!0)}catch(_){if((null==_?void 0:_.code)!==k.WS_ABORT)throw yield s._p2pChannel.unsubscribeDataChannel(n,[d]),_;yield s._p2pChannel.unsubscribeDataChannel(n,[d]),s._p2pChannel.setPendingRemoteDataChannel(n,d.id)}return yield d._waitTillOpen(),T.info("[".concat(s._clientId,"] subscribe success user ").concat(n.uid,", mediaType: datachannel")),d}finally{h()}})()}_p2pSubscribe(n,i,s){var c=this;return L(function*(){if(Jn(i,"mediaType",["audio","video"]),!c._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==c.connectionState&&"RECONNECTING"!==c.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(c.connectionState," state"));if(!c._users.find(p=>p===n)){const p=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),p}if(!n.hasAudio&&!n.hasVideo){const p=new W(k.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),p}if(!s&&("audio"===i&&!n.hasAudio||"video"===i&&!n.hasVideo)){const p=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(i,", remote track is not published")),p}const d=yield c._subscribeMutex.lock();T.info("[".concat(c._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(i));const h="audio"===i?ne.LocalAudioTrack:c._joinInfo.defaultVideoStream===mE.LOW_STREAM?ne.LocalVideoLowTrack:ne.LocalVideoTrack;try{(yield c._p2pChannel.hasRemoteMediaWithLock(n,i))?yield c._p2pChannel.unmuteRemote(n,i):(c.store.subscribe(n.uid,i,Date.now()),c._p2pChannel instanceof Zt&&(yield c._gateway.sendExtensionMessage(Pt.SUBSCRIBE,{trackType:h}))),T.info("[".concat(c._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(i)),c._defaultStreamFallbackType&&c.setStreamFallbackOption(n.uid,c._defaultStreamFallbackType).catch(m=>{T.warning("[".concat(c._clientId,"] auto set fallback failed"),m)});const p="audio"===i?n._audioTrack:n._videoTrack;if(!p)throw new W(k.UNEXPECTED_ERROR,"can not find remote track in user object");return p}catch(p){throw T.error("[".concat(c._clientId,"] subscribe user ").concat(n.uid," error"),p),p}finally{d()}})()}_subscribe(n,i,s){var c=this;return L(function*(){if(c._p2pChannel instanceof Zt)return c._p2pSubscribe(n,i);if(Jn(i,"mediaType",["audio","video"]),!c._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==c.connectionState&&"RECONNECTING"!==c.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(c.connectionState," state"));if(!c._users.find(E=>E===n)){const E=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", this user is not in the channel")),E}if(!n.hasAudio&&!n.hasVideo){const E=new W(k.INVALID_REMOTE_USER,"user is not published");throw T.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid,", user is not published")),E}if(!(s||("audio"!==i||n.hasAudio&&void 0!==n._audioSSRC)&&("video"!==i||n.hasVideo&&void 0!==n._videoSSRC))){const E=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(c._clientId,"] can not subscribe ").concat(n.uid," with mediaType ").concat(i,", remote track is not published")),E}let d="audio"===i?n._audioSSRC:n._videoSSRC,h="audio"===i?n._audioOrtc:n._videoOrtc,p="video"===i?n._rtxSsrcId:void 0,m={stream_type:"audio"===i?fe.AUDIO:fe.VIDEO,ssrcId:d};const _=yield c._subscribeMutex.lock();T.info("[".concat(c._clientId,"] subscribe user ").concat(n.uid,", mediaType: ").concat(i));try{if(yield c._p2pChannel.hasRemoteMediaWithLock(n,i))yield c._p2pChannel.unmuteRemote(n,i);else try{const v="audio"===i?n._audioSSRC:n._videoSSRC;void 0!==v&&v!==d&&(d=v,h="audio"===i?n._audioOrtc:n._videoOrtc,p="video"===i?n._rtxSsrcId:void 0,m={stream_type:"audio"===i?fe.AUDIO:fe.VIDEO,ssrcId:d}),Ai.markSubscribeStart(c.store.clientId,d),c.store.subscribe(n.uid,i,Date.now()),yield c._p2pChannel.subscribe(n,i,d,p,h);try{yield c._gateway.subscribe(n.uid,m,!0)}catch(S){if((null==S?void 0:S.code)!==k.WS_ABORT)throw yield c._p2pChannel.unsubscribe(n,i),S;yield c._p2pChannel.unsubscribe(n,i,!0),c._p2pChannel.setPendingRemoteMedia(n,i)}c.store.subscribe(n.uid,i,void 0,Date.now()),c._p2pChannel.reportSubscribeEvent(!0,null,n,i)}catch(v){throw c._p2pChannel.reportSubscribeEvent(!1,null==v?void 0:v.code,n,i),v}T.info("[".concat(c._clientId,"] subscribe success user ").concat(n.uid,", mediaType: ").concat(i)),c._defaultStreamFallbackType&&c.setStreamFallbackOption(n.uid,c._defaultStreamFallbackType).catch(v=>{T.warning("[".concat(c._clientId,"] auto set fallback failed"),v)});const E="audio"===i?n._audioTrack:n._videoTrack;if(!E)throw new W(k.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw T.error("[".concat(c._clientId,"] subscribe user ").concat(n.uid," error"),E),E}finally{_()}})()}massSubscribe(n){var i=this;return L(function*(){if(fa(n,"subscribeList"),!i._joinInfo)throw new W(k.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(k.INVALID_OPERATION,"Can't subscribe stream in ".concat(i.connectionState," state"));const s=Date.now(),c=new Map,d=yield i._subscribeMutex.lock();T.info("[".concat(i._clientId,"]start massSubscribe user ").concat(n.map(_=>{let{user:E,mediaType:v}=_;return"user: ".concat(null==E?void 0:E.uid,", mediaType: ").concat(v)}).join("; ")));const h=(n=[...n]).map(_=>{let{user:E,mediaType:v}=_;return{user:E,mediaType:v}}),p=yield i._p2pChannel.globalLock();try{var m;for(let E=n.length-1;E>=0;E--){const v=n[E],{user:S,mediaType:b}=v;if(Jn(b,"mediaType",["audio","video"]),!S){const w=new W(k.INVALID_PARAMS,"user property does not exist in subscribeList item");throw T.error("[".concat(i._clientId,"] user property does not exist in subscribeList item")),w}if(!i._users.find(w=>w===S)){const w=new W(k.INVALID_REMOTE_USER,"user is not in the channel");T.error("[".concat(i._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),h[E].error=w,n.splice(E,1);continue}if("audio"===b&&(!S.hasAudio||void 0===S._audioSSRC)||"video"===b&&(!S.hasVideo||void 0===S._videoSSRC)){const w=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);T.error("[".concat(i._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(b,", remote user is not published")),h[E].error=w,n.splice(E,1);continue}const O=Fn.Video|Fn.LwoVideo,P=c.get(S);if(P){if("video"===b?P&O:P&Fn.Audio){n.splice(E,1),T.warning("[".concat(i._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(b," twice"));continue}c.set(S,P|("video"===b?O:Fn.Audio))}else c.set(S,"video"===b?O:Fn.Audio)}for(let E=n.length-1;E>=0;E--){const v=n[E],{user:S,mediaType:b}=v,O=Fn.Video|Fn.LwoVideo;if(i._p2pChannel.hasRemoteMedia(S,b)){yield i._p2pChannel.unmuteRemoteNoLock(S,b);const P=c.get(S);c.set(S,"video"===b?P^O:P^Fn.Audio),n.splice(E,1)}}i.store.massSubscribe(n.map(E=>({userId:E.user.uid,type:E.mediaType})),s);const _=cd(m=Array.from(c.entries())).call(m,(E,v)=>{let[S,b]=v;if(0===b)return E;const O={stream_id:S.uid,stream_type:b};return b&Fn.Audio&&(O.audio_ssrc=S._audioSSRC),b&Fn.Video&&(O.video_ssrc=S._videoSSRC),E.push(O),E},[]);try{n.length>0&&(yield i._p2pChannel.massSubscribeNoLock(n.map(v=>{let{user:S,mediaType:b}=v;return{user:S,mediaType:b,ssrcId:b===fe.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:b===fe.VIDEO?S._rtxSsrcId:void 0}})));const E=new Map;if(_.length>0){const v=yield i._gateway.subscribeAll(_,!0);((null==v?void 0:v.users)||[]).forEach(S=>{let{stream_id:b,video_error_code:O,audio_error_code:P,error_code:w}=S;(O||P||w)&&E.set(b,{video_error_code:O,audio_error_code:P,error_code:w})})}if(Array.from(E.entries()).length>0){const v=Array.from(E.entries()).map(S=>{let b,[O,P]=S;return P.error_code||P.video_error_code&&P.audio_error_code?b=void 0:P.video_error_code?b=fe.VIDEO:P.audio_error_code&&(b=fe.AUDIO),{user:i.remoteUsers.find(w=>w.uid===O),mediaType:b}});yield i._p2pChannel.massUnsubscribeNoLock(v)}for(const v of h){const S=E.get(v.user.uid);if(S){const b=S.error_code||"audio"===v.mediaType&&S.audio_error_code||"video"===v.mediaType&&S.video_error_code;if(b){const O=oh(b);T.error("user:".concat(v.user.uid," mediaType:").concat(v.mediaType," has massSubscribe error ").concat(O.desc)),v.error=new W(k.SUBSCRIBE_FAILED,"code ".concat(b,": ").concat(O.desc))}}v.error||(v.track="video"===v.mediaType?v.user.videoTrack:v.user.audioTrack)}return i.store.massSubscribe(h.filter(v=>!v.error).map(v=>({userId:v.user.uid,type:v.mediaType})),void 0,Date.now()),h.forEach(v=>{var S;ye.subscribe(i.store.sessionId,{succ:!!v.error,ec:(null===(S=v.error)||void 0===S?void 0:S.code)||null,video:v.mediaType===fe.VIDEO,audio:v.mediaType===fe.AUDIO,peerid:v.user.uid,subscribeRequestid:v.mediaType===fe.VIDEO?v.user._videoSSRC:v.user._audioSSRC,p2pid:i.store.p2pId,eventElapse:Math.floor(performance.now()-s)},!0)}),T.info("[".concat(i._clientId,"] massSubscribe success ").concat(n.map(v=>{let{user:S,mediaType:b}=v;return"user: ".concat(null==S?void 0:S.uid,", mediaType: ").concat(b)}).join("; "))),h}catch(E){throw yield i._p2pChannel.massUnsubscribeNoLock(n),E}}finally{p(),d()}})()}unsubscribe(n,i,s){var c=this;return L(function*(){if(i||c.store.useP2P){if("datachannel"===i)return c._unsubscribeDataChannel(n,s)}else yield c._unsubscribeDataChannel(n,s);if(i&&Jn(i,"mediaType",["audio","video"]),!c._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!c._users.find(h=>h===n)){const h=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(c._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),h}T.info("[".concat(c._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: ").concat(i));const d=yield c._subscribeMutex.lock();try{if(c._p2pChannel instanceof Zt)yield c._gateway.sendExtensionMessage(Pt.UNSUBSCRIBE,{mediaType:i});else{const h=yield c._p2pChannel.unsubscribe(n,i);h&&(yield c._gateway.unsubscribe(h,n.uid)),T.info("[".concat(c._clientId,"] unsubscribe success uid: ").concat(n.uid,", mediaType: ").concat(i))}}catch(h){if(h.code===k.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(c._clientId,"] unsubscribe user ").concat(n.uid," error"),h.toString()),h}finally{d()}})()}_unsubscribeDataChannel(n,i){var s=this;return L(function*(){if(i&&Dt(i,"id",0,65535,!0),!s._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!s._users.find(d=>d===n)){const d=new W(k.INVALID_REMOTE_USER,"user is not in the channel");throw T.error("[".concat(s._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),d}let c;if("number"==typeof i){const d=n._dataChannels.find(h=>h.id===i);d&&(c=[d])}else c=n._dataChannels;if(void 0===c){const d=new W(k.REMOTE_USER_IS_NOT_PUBLISHED);throw T.error("[".concat(s._clientId,"] can not unsubscribe ").concat(n.uid," with channelId ").concat(i,", remote datachannel is not published")),d}T.info("[".concat(s._clientId,"] unsubscribe uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(c.map(d=>d.id)));try{const d=yield s._p2pChannel.unsubscribeDataChannel(n,c);d&&(yield s._gateway.unsubscribeDataChannel(d,n.uid)),T.info("[".concat(s._clientId,"] unsubscribe datachannel success uid: ").concat(n.uid,", mediaType: datachannel, ids: ").concat(d))}catch(d){if(d.code===k.DISCONNECT_P2P)return void T.warning("disconnecting p2p, abort unsubscribe request.");throw T.error("[".concat(s._clientId,"] unsubscribe user ").concat(n.uid," error"),d.toString()),d}})()}massUnsubscribe(n){var i=this;return L(function*(){if(fa(n,"unsubscribeList"),!i._joinInfo)throw new W(k.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");T.info("[".concat(i._clientId,"] start massUnsubscribe ").concat(n.map(c=>{let{user:d,mediaType:h}=c;return"user: ".concat(null==d?void 0:d.uid,", mediaType: ").concat(h,";")}).join())),n=[...n];const s=new Map;for(let c=n.length-1;c>=0;c--){const{user:d,mediaType:h}=n[c];if(!d){const m=new W(k.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw T.error("[".concat(i._clientId,"] user property does not exist in unsubscribeList item")),m}if(Jn(h,"mediaType",["video","audio",void 0]),!i._users.find(m=>m===d)){T.warning("[".concat(i._clientId,"] can not unsubscribe ").concat(d.uid,", user is not in the channel")),n.splice(c,1);continue}const p=Fn.Video|Fn.LwoVideo;if(s.has(d)){const m=s.get(d);let _;switch(h){case"video":_=m&p;break;case"audio":_=m&Fn.Audio;break;default:_=m&(Fn.Audio|p)}if(_){T.warning("[".concat(i._clientId,"] repeat massUnsubscribe user:").concat(d.uid,",mediaType:").concat(h," twice.")),n.splice(c,1);continue}h?"audio"===h?s.set(d,m|Fn.Audio):"video"===h&&s.set(d,m|p):s.set(d,m|Fn.Audio|p)}else h?"audio"===h?s.set(d,Fn.Audio):"video"===h&&s.set(d,p):s.set(d,Fn.Audio|p)}try{const c=yield i._p2pChannel.massUnsubscribe(n);c&&(yield i._gateway.massUnsubscribe(c)),T.info("[".concat(i._clientId,"] massUnsubscribe success ").concat(n.map(d=>{let{user:h,mediaType:p}=d;return"user: ".concat(null==h?void 0:h.uid,", mediaType: ").concat(p,";")}).join()))}catch(c){if(c.code===k.DISCONNECT_P2P)return void T.warning("[".concat(i._clientId,"] disconnecting p2p, abort unsubscribe request."));throw T.error("[".concat(i._clientId,"] massUnsubscribe error"),c.toString()),c}})()}setLowStreamParameter(n){var i=this;return L(function*(){(function(c){if(!c)throw new Q(k.INVALID_PARAMS);Jt(c.width)||Fg(c.width,"streamParameter.width"),Jt(c.height)||Fg(c.height,"streamParameter.height"),Jt(c.framerate)||Fg(c.framerate,"streamParameter.framerate"),Jt(c.bitrate)||Dt(c.bitrate,"streamParameter.bitrate")})(n),(!n.width&&n.height||n.width&&!n.height)&&T.warning("[".concat(i._clientId,"] The width and height parameters take effect only when both are set")),T.info("[".concat(i._clientId,"] set low stream parameter to"),JSON.stringify(n));const s=i._configDistribute.getLowStreamConfigDistribute();if(s&&s.bitrate&&n.bitrate&&s.bitrate<n.bitrate&&(n.bitrate=s.bitrate),i._lowStreamParameter=n,i._isDualStreamEnabled)return i._p2pChannel.updateVideoStreamParameter(n,ne.LocalVideoLowTrack)})()}enableDualStream(){var n=this;return L(function*(){if(!Ge().supportDualStream)throw ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new W(k.NOT_SUPPORTED,"Your browser is not support dual stream");if(n._isDualStreamEnabled)throw new W(k.INVALID_OPERATION,"Dual stream is already enabled");if(n._p2pChannel.canPublishLowStream())try{yield n._publishLowStream()}catch(i){throw ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),i}n._isDualStreamEnabled=!0,ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),T.info("[".concat(n._clientId,"] enable dual stream"))})()}disableDualStream(){var n=this;return L(function*(){if(n._isDualStreamEnabled){if(!n._joinInfo)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(n._p2pChannel.getLocalMedia(ne.LocalVideoLowTrack))try{const i=yield n._p2pChannel.unpublishLowStream();i&&(yield n._gateway.unpublish(i,n._joinInfo.stringUid||n._joinInfo.uid))}catch(i){throw ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),i}n._isDualStreamEnabled=!1,ye.streamSwitch(n._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),T.info("[".concat(n._clientId,"] disable dual stream"))}})()}setClientRole(n,i){var s=this;return L(function*(){if(Jn(n,"role",["audience","host"]),i&&b1(i),"rtc"===s.mode)throw T.warning("[".concat(s._clientId,"]rtc mode can not use setClientRole")),new W(k.INVALID_OPERATION,"rtc mode can not use setClientRole");if(i&&i.level&&"host"===n)throw new W(k.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===n&&s._p2pChannel.hasLocalMedia())throw new W(k.INVALID_OPERATION,"can not set client role to audience when publishing stream");yield s._gateway.setClientRole(n,i),s._config.role=n,T.info("[".concat(s._clientId,"] set client role to ").concat(n,", level: ").concat(i&&i.level))})()}getRemoteInboundOffset(){var n;const i=null===(n=this._p2pChannel.getStats())||void 0===n?void 0:n.audioSend[0];if(!i||!i.timestamp)return 0;const s=i.timestamp-Date.now();return Math.abs(s)>1e3+i.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(n,i){if(Ei(n,"proxyServer"),!i){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=n,ye.setProxyServer(this._proxyServer),T.setProxyServer(this._proxyServer),T.info("[".concat(this._clientId,"] Set proxy server ").concat(i?"by initialize call":""," success."))}setTurnServer(n,i){if(Array.isArray(n)||(n=[n]),!i){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy")}if(zu(n))return this._turnServer={servers:n,mode:"original-manual"},void T.info("[".concat(this._clientId,"] Set original turnserver ").concat(i?"by initialize call":""," success: ").concat(n.map(s=>s.urls).join(","),"."));n.forEach(s=>zw(s)),this._turnServer={servers:n,mode:"manual"},T.info("[".concat(this._clientId,"] Set turnserver ").concat(i?"by initialize call":""," success."))}setLicense(n){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"you should set license before join channel");if(Ei(n,"license",32,32),!/^[A-Za-z\d]+$/.test(n))throw new W(k.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=n,T.info("[".concat(this._clientId,"] set license success"),n)}startProxyServer(n){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new W(k.INVALID_OPERATION,"You have already set the proxy");const i=[3,4,5];let s;switch(void 0===n&&(n=3),n){case 1:case 2:throw new W(k.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new W(k.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Stop proxy server after leave channel");ye.setProxyServer(),T.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",T.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(n){if(!n.accessPoints)throw new W(k.INVALID_PARAMS,"accessPoints is required.");fa(n.accessPoints.serverList,"accessPoints.serverList"),Ei(n.accessPoints.domain,"accessPoints.domain");const i=(b,O)=>{Dt(b,O,0,65535,!0)};let s=443;if(n.accessPoints.port&&(i(n.accessPoints.port,"accessPoints.port"),s=n.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");B("CLOSE_AFB_FOR_LOCAL_AP")&&(Nt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Nt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const c=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,d=n.accessPoints.domain,h=n.accessPoints.serverList.map(b=>c.test(b)?"".concat(b.replace(/\./g,"-"),".").concat(d):b),p=h.map(b=>"".concat(b,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Nt("WEBCS_DOMAIN",p),Nt("WEBCS_DOMAIN_BACKUP_LIST",p),Nt("GATEWAY_DOMAINS",[d]),n.report&&n.report.hostname&&Array.isArray(n.report.hostname)&&n.report.hostname.length?(fa(n.report.hostname,"report.hostname"),Nt("EVENT_REPORT_DOMAIN",n.report.hostname[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",n.report.hostname[1]||n.report.hostname[0])):(Nt("EVENT_REPORT_DOMAIN",h[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",h[1]||h[0]));let m=6443;n.report&&n.report.port&&(i(n.report.port,"report.port"),m=n.report.port),Nt("STATS_COLLECTOR_PORT",m),Nt("ENABLE_EVENT_REPORT",!!n.report);let _="";n.log&&n.log.hostname&&Array.isArray(n.log.hostname)&&n.log.hostname.length?(fa(n.log.hostname,"log.hostname"),_=n.log.hostname[0]):_=h[0];let E=6444;n.log&&n.log.port&&(i(n.log.port,"log.port"),E=n.log.port),Nt("LOG_UPLOAD_SERVER","".concat(_,":").concat(E));let v=[];n.cds&&n.cds.hostname&&Array.isArray(n.cds.hostname)&&n.cds.hostname.length?(fa(n.cds.hostname,"cds.hostname"),v=n.cds.hostname):v=h;let S=443;n.cds&&n.cds.port&&(i(n.cds.port,"cds.port"),S=n.cds.port),Nt("CDS_AP",v.map(b=>"".concat(b,":").concat(S))),Nt("ENABLE_CONFIG_DISTRIBUTE",!!n.cds),T.info("set local access point v2 success")}setLocalAccessPoints(n,i){if(fa(n,"serverList"),Ei(i,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new W(k.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;n=n.map(c=>s.test(c)?"".concat(c.replace(/\./g,"-"),".").concat(i):c),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Nt("WEBCS_DOMAIN",n),Nt("WEBCS_DOMAIN_BACKUP_LIST",n),Nt("GATEWAY_DOMAINS",[i]),Nt("EVENT_REPORT_DOMAIN",n[0]),Nt("EVENT_REPORT_BACKUP_DOMAIN",n[1]||n[0]),Nt("LOG_UPLOAD_SERVER","".concat(n[0],":6444")),T.info("[".concat(this._clientId,"] set local access point success"))}setRemoteDefaultVideoStreamType(n){var i=this;return L(function*(){if(Jn(n,"streamType",[0,1]),i._remoteDefaultVideoStreamType=n,i._joinInfo)try{yield i._gateway.setDefaultRemoteVideoStreamType(n),i._joinInfo.defaultVideoStream=i._remoteDefaultVideoStreamType}catch(s){throw T.error("[".concat(i._clientId,"] set default remote video stream type error"),s.toString()),s}else T.debug("[".concat(i._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(n))})()}setRemoteVideoStreamType(n,i){var s=this;return L(function*(){Jn(i,"streamType",[0,1]);try{yield s._gateway.setRemoteVideoStreamType(n,i),setTimeout(()=>{const c=s._users.find(d=>d.uid===n);c&&c.videoTrack&&c.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(c){throw T.error("[".concat(s._clientId,"] set remote video stream type error"),c.toString()),c}T.info("[".concat(s._clientId,"] set remote ").concat(n," video stream type to ").concat(i)),s._remoteStreamTypeCacheMap.set(n,i)})()}setStreamFallbackOption(n,i){var s=this;return L(function*(){Jn(i,"fallbackType",[0,1,2]);try{yield s._gateway.setStreamFallbackOption(n,i)}catch(c){throw T.error("[".concat(s._clientId,"] set stream fallback option"),c.toString()),c}T.info("[".concat(s._clientId,"] set remote ").concat(n," stream fallback type to ").concat(i)),s._streamFallbackTypeCacheMap.set(n,i)})()}setEncryptionConfig(n,i,s){Jn(n,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"]),Ei(i,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(Re(c).call(c,n)){if(!s||!(s instanceof Uint8Array&&32===s.length))throw new W(k.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new W(k.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(i)||T.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=n,this._encryptionSecret=i,s&&(this._encryptionSalt=Bg(s))}renewToken(n){var i=this;return L(function*(){if(Ei(n,"token",1,2047),!i._key||!i._joinInfo)throw new W(k.INVALID_OPERATION,"renewToken should not be called before user join");const s=i._key;i._key=n,i._joinInfo&&(i._joinInfo.token=n);const c=yield i._renewTokenMutex.lock();try{if(B("USE_NEW_TOKEN")){T.debug("[".concat(i._clientId,"] start renew token with ticket from unilbs"));const d=yield function hT(o,n,i){return iv.apply(this,arguments)}(i._joinInfo,i._axiosCancelSource.token,i._config.httpRetryConfig||Ln);T.debug("[".concat(i._clientId,"] get ticket from unilbs success")),yield i._gateway.renewToken({token:n,ticket:d})}else T.debug("[".concat(i._clientId,"] start renew token without ticket")),yield i._gateway.renewToken({token:n});T.debug("[".concat(i._clientId,"] renewToken success"))}catch(d){throw i._key=s,i._joinInfo.token=s,T.error("[".concat(i._clientId,"] renewToken failed"),d.toString()),d}finally{c()}})()}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?T.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const n=this._p2pChannel.getAudioLevels();this.safeEmit($e.VOLUME_INDICATOR,n)},B("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const n=this._statsCollector.getRTCStats(),i=this._gateway.getInChannelInfo();return n.Duration=Math.round(i.duration/1e3),n}startLiveStreaming(n,i){var s=this;return L(function*(){if(!i){if("h264"!==s.codec)throw new W(k.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!s._p2pChannel.hasLocalMedia())throw new W(k.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(s._liveRawStreamingClient&&s._liveRawStreamingClient.hasUrl(n)||s._liveTranscodeStreamingClient&&s._liveTranscodeStreamingClient.hasUrl(n))throw new W(k.LIVE_STREAMING_TASK_CONFLICT);const c=i?Qn.TRANSCODE:Qn.RAW;return s._createLiveStreamingClient(c).startLiveStreamingTask(n,c)})()}setLiveTranscoding(n){return this._createLiveStreamingClient(Qn.TRANSCODE).setTranscodingConfig(n)}stopLiveStreaming(n){var i=this;return L(function*(){const s=[i._liveRawStreamingClient,i._liveTranscodeStreamingClient].filter(c=>c&&c.hasUrl(n));if(!s.length)throw new W(k.INVALID_PARAMS,"can not find live streaming url to stop");yield z.all(s.map(c=>c&&c.stopLiveStreamingTask(n)))})()}addInjectStreamUrl(n,i){var s=this;return L(function*(){if(!s._joinInfo)throw new W(k.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const c=s._createLiveStreamingClient(Qn.INJECT);c.setInjectStreamConfig(i,0),yield c.startLiveStreamingTask(n,Qn.INJECT)})()}removeInjectStreamUrl(){var n=this;return L(function*(){var i;const s=n._createLiveStreamingClient(Qn.INJECT),c=Array.from(Vs(i=s.streamingTasks).call(i)).find(d=>d.mode===Qn.INJECT);if(!n._joinInfo||!c)throw new W(k.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield s.stopLiveStreamingTask(c.url)})()}startChannelMediaRelay(n){var i=this;return L(function*(){Mr(n),yield i._createChannelMediaRelayClient().startChannelMediaRelay(n)})()}updateChannelMediaRelay(n){var i=this;return L(function*(){Mr(n),yield i._createChannelMediaRelayClient().updateChannelMediaRelay(n)})()}stopChannelMediaRelay(){var n=this;return L(function*(){yield n._createChannelMediaRelayClient().stopChannelMediaRelay(),n._statsCollector.onStatsChanged&&(n._statsCollector.onStatsChanged=void 0)})()}sendStreamMessage(n){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new W(k.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof n||n instanceof Uint8Array)&&(n={payload:n}),"string"==typeof n.payload){const s=new TextEncoder;n.payload=s.encode(n.payload)}if(new Blob([n.payload]).size>1024)throw new W(k.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(ve.DATA_STREAM,{payload:Bg(n.payload),syncWithAudio:n.syncWithAudio,sendTs:Date.now()-zU},!i)}sendMetadata(n){if(!this._joinInfo)throw new W(k.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([n]).size>1024)throw new W(k.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ve.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Bg(n)})}sendCustomReportMessage(n){var i=this;return L(function*(){if(Array.isArray(n)||(n=[n]),n.forEach($C),!i._joinInfo)throw new W(k.INVALID_OPERATION,"can not send custom report, not joined");yield ye.sendCustomReportMessage(i._joinInfo.sid,n)})()}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}pickSVCLayer(n,i){var s=this;return L(function*(){Jn(i.spatialLayer,"spatialLayer",[0,1,2,3]),Jn(i.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield s._gateway.pickSVCLayer(n,i)}catch(c){throw T.error("[".concat(s._clientId,"] pick SVC layer failed"),c.toString()),c}})()}setRTM2Flag(n){if(Jn(n,"flag",[0,1]),!this._joinInfo)throw new W(k.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new W(k.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(n)}_reset(){if(T.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Hn.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(n=>{n._audioTrack&&n._audioTrack._destroy(),n._videoTrack&&n._videoTrack._destroy(),n._dataChannels&&(n._dataChannels.forEach(i=>i._close()),n._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ni("client-publish"),this._subscribeMutex=new ni("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(n){}if(this._moderation)try{this.setImageModeration(!1)}catch(n){}}_startSession(n,i){const s=n||jg();T.debug(n?"[".concat(this._clientId,"] new Session ").concat(s):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s)),this._sessionId=s,this.store.sessionId=s,i?ye.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:i.channel,appid:i.appId,mode:this.mode}):this._joinInfo?ye.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&ye.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}_publishHighStream(n){var i=this;return L(function*(){if(!i._joinInfo||void 0===i._uid)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==i.connectionState&&"RECONNECTING"!==i.connectionState)throw new W(k.INVALID_OPERATION,"can not publish stream in ".concat(i.connectionState," state"));if("auto"===i._turnServer.mode&&B("FORCE_TURN")&&!B("TURN_ENABLE_TCP")&&!B("TURN_ENABLE_UDP"))throw new W(k.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");T.debug("[".concat(i._clientId,"] publish high stream"));try{if(i._p2pChannel instanceof Zt){const c=yield i._p2pChannel.publish(n,i._isDualStreamEnabled,i._lowStreamParameter);if(c)try{yield i._gateway.sendExtensionMessage(Pt.PUBLISH,c)}catch(d){throw i._p2pChannel.unpublish(n),d}}else{const c=yield i._p2pChannel.publish(n,i._isDualStreamEnabled,i._lowStreamParameter),d=(yield c.next()).value;if(d){var s;let h;try{h=yield i._gateway.publish(i._uid,d,!0)}catch(p){if(p.code!==k.DISCONNECT_P2P)throw c.throw(p),p}yield c.next((null===(s=h)||void 0===s?void 0:s.ortc)||[])}i._p2pChannel.reportPublishEvent(!0,null);for(const h of n)h instanceof We&&h._encoderConfig&&i._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||(yield i._p2pChannel.muteLocalTrack(h))}}catch(c){if(i._p2pChannel.reportPublishEvent(!1,null==c?void 0:c.code,n),(null==c?void 0:c.code)===k.WS_ABORT)return;throw c}})()}_publishLowStream(){var n=this;return L(function*(){if(!n._joinInfo||void 0===n._uid)throw new W(k.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==n.connectionState&&"RECONNECTING"!==n.connectionState)throw new W(k.INVALID_OPERATION,"can not publish stream in ".concat(n.connectionState," state"));T.debug("[".concat(n._clientId,"] publish low stream"));const i=n._configDistribute.getLowStreamConfigDistribute();i&&i.bitrate&&(n._lowStreamParameter||(n._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),n._lowStreamParameter&&n._lowStreamParameter.bitrate&&i.bitrate<n._lowStreamParameter.bitrate&&(n._lowStreamParameter.bitrate=i.bitrate));try{const c=yield n._p2pChannel.publishLowStream(n._lowStreamParameter),d=(yield c.next()).value;if(d){var s;let h;try{h=yield n._gateway.publish(n._uid,d,!0)}catch(p){if(p.code!==k.DISCONNECT_P2P)throw c.throw(p),p}c.next((null===(s=h)||void 0===s?void 0:s.ortc)||[]),n._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(c){if(n._p2pChannel.reportPublishEvent(!1,null==c?void 0:c.code,void 0,!0),(null==c?void 0:c.code)===k.WS_ABORT)return;throw c}})()}_createLiveStreamingClient(n){if(!this._joinInfo||!this._appId)return new W(k.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=()=>new rO(this._joinInfo,this._config.websocketRetryConfig||Ln,this._config.httpRetryConfig||Ln),s=c=>{c.onLiveStreamError=(d,h)=>{ye.reportApiInvoke(this._sessionId,{name:fn.ON_LIVE_STREAM_ERROR,options:[d,h],tag:nn.TRACER}).onSuccess(),this.safeEmit($e.LIVE_STREAMING_ERROR,d,h)},c.onLiveStreamWarning=(d,h)=>{ye.reportApiInvoke(this._sessionId,{name:fn.ON_LIVE_STREAM_WARNING,options:[d,h],tag:nn.TRACER}).onSuccess(),this.safeEmit($e.LIVE_STREAMING_WARNING,d,h)},c.on(wf.REQUEST_WORKER_MANAGER_LIST,(d,h,p)=>{if(!this._joinInfo)return p(new W(k.INVALID_OPERATION,"can not find join info to get worker manager"));dT(d,this._joinInfo,this._axiosCancelSource.token,Ln).then(h).catch(p)})};switch(n){case Qn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=i(),s(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Qn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=i(),s(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Qn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=i(),this._injectStreamingClient.on(wf.REQUEST_WORKER_MANAGER_LIST,(c,d,h)=>{if(!this._joinInfo)return h(new W(k.INVALID_OPERATION,"can not find join info to get worker manager"));dT(c,this._joinInfo,this._axiosCancelSource.token,Ln).then(d).catch(h)}),this._injectStreamingClient.onInjectStatusChange=(c,d,h)=>{this.safeEmit($e.INJECT_STREAM_STATUS,c,d,h)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new W(k.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:i}=this.getLocalVideoStats();this._channelMediaRelayClient=new HU(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Ln,this._config.httpRetryConfig||Ln,{width:n,height:i}),this._channelMediaRelayClient.on("state",c=>{c===cr.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit($e.CHANNEL_MEDIA_RELAY_STATE,c)}),this._channelMediaRelayClient.on("event",c=>{this.safeEmit($e.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._statsCollector.onStatsChanged=(c,d)=>{var h;"resolution"===c&&(null===(h=this._channelMediaRelayClient)||void 0===h||h.setVideoProfile(d))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(n,i){const{added:s,deleted:c}=n,d=[];Array.isArray(s)&&s.length>0&&s.forEach(h=>{const{uid:p,stream_id:m,ordered:_,max_retrans_times:E,metadata:v}=h,S=this._users.find(b=>b._uintid===p);if(S){if(T.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(p)),Re(d).call(d,S)||d.push(S),S._uintid||(S._uintid=p),-1===S._dataChannels.findIndex(b=>b.id===h.stream_id)){const b={id:m,ordered:!!_,maxRetransmits:E,metadata:v},O=new ZL(b);S._dataChannels.push(O),T.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published datachannel")),i||this.safeEmit($e.USER_PUBLISHED,S,"datachannel",b)}this._p2pChannel.hasPendingRemoteDataChannel(S,h.stream_id)&&(T.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(S.uid," after reconnect.")),this._subscribeDataChannel(S,h.stream_id).catch(b=>{T.error("[".concat(this._clientId,"] resubscribe datachannel error"),b.toString())}))}else T.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),i&&(this.safeEmit($e.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(c)&&c.length>0&&c.forEach(h=>{const{uid:p}=h,_=this._users.find(v=>v._uintid===p);if(!_)return void T.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=_._dataChannels.find(v=>v.id===h.stream_id);E&&(T.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(p)),this._p2pChannel.unsubscribeDataChannel(_,[E]).then(v=>{if(v)return _._dataChannels=_._dataChannels.filter(S=>S!==E),this._gateway.unsubscribeDataChannel(v,_.uid)}),T.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished datachannel ,id:").concat(E.id)),this.safeEmit($e.USER_UNPUBLISHED,_,"datachannel",E._config))})}_handleRemoveDataChannels(n){const i=this._users.find(s=>s.uid===n.uid);if(i){if(void 0!==i._dataChannels&&i._dataChannels.length>0){T.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(n.uid));const s=()=>{T.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished datachannel")),i._dataChannels.forEach(c=>{this.safeEmit($e.USER_UNPUBLISHED,i,"datachannel",c._config)})};this._p2pChannel.unsubscribeDataChannel(i,i._dataChannels).then(c=>{if(c)return this._gateway.unsubscribeDataChannel(c,i.uid)}),s()}}else T.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){var n=this;this._gateway.on(ln.DISCONNECT_P2P,L(function*(){yield n._p2pChannel.disconnectForReconnect()})),this._gateway.on(ln.CONNECTION_STATE_CHANGE,(i,s,c)=>{var d;if(c===Ye.FALLBACK)return;const h=()=>{this.safeEmit($e.CONNECTION_STATE_CHANGE,i,s,c)};if(ye.reportApiInvoke(this._sessionId||(null===(d=this._gateway.joinInfo)||void 0===d?void 0:d.sid)||null,{name:fn.CONNECTION_STATE_CHANGE,options:[i,s,c],tag:nn.TRACER}).onSuccess(JSON.stringify({cur:i,prev:s,reason:c})),T.info("[".concat(this._clientId,"] connection state change: ").concat(s," -> ").concat(i)),"DISCONNECTED"===i)return this._reset(),void h();if("RECONNECTING"===i)this._users.forEach(m=>{m._trust_in_room_=!1,m._trust_audio_enabled_state_=!1,m._trust_video_enabled_state_=!1,m._trust_audio_mute_state_=!1,m._trust_video_mute_state_=!1,m._trust_audio_stream_added_state_=!1,m._trust_video_stream_added_state_=!1,m._audioSSRC=void 0,m._videoSSRC=void 0,m._videoOrtc=void 0,m._audioOrtc=void 0,m._cname=void 0,m._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===i){var p;this._streamFallbackTypeCacheMap.forEach((m,_)=>{this._gateway.setStreamFallbackOption(_,m).catch(E=>{T.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),E)})}),this._remoteStreamTypeCacheMap.forEach((m,_)=>{this._gateway.setRemoteVideoStreamType(_,m).catch(E=>{T.warning("[".concat(this._clientId,"] auto set remote stream type failed"),E)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(p=this._joinInfo)||void 0===p?void 0:p.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{T.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(m=>{T.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(m))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(m=>!m._trust_in_room_).forEach(m=>{T.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(m.uid)),this._handleUserOffline({uid:m.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(m=>{m._trust_audio_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,fe.AUDIO,!1)),m._trust_video_mute_state_||(T.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(m.uid)),this._handleMuteStream(m.uid,fe.VIDEO,!1)),m._trust_audio_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(m.uid)),this._handleSetStreamLocalEnable("audio",m.uid,!0)),m._trust_video_enabled_state_||(T.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(m.uid)),this._handleSetStreamLocalEnable("video",m.uid,!0)),m._trust_video_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(m.uid)),this._handleResetAddStream(m,"video")),m._trust_audio_stream_added_state_||(T.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(m.uid)),this._handleResetAddStream(m,"audio")),m._video_added_||m._audio_added_||(T.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(m.uid)),this._handleRemoveStream({uid:m.uid,uint_id:m._uintid}))}))},1e3))}h()}),this._gateway.on(ln.REQUEST_NEW_GATEWAY_LIST,(i,s)=>{if(!this._joinInfo)return s(new W(k.UNEXPECTED_ERROR,"can not recover, no join info"));$E(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ln,this.store).then(c=>{this._joinInfo&&(this._joinInfo.apResponse=c.gatewayInfo.res,this._joinInfo.gatewayAddrs=c.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=c.gatewayInfo.uni_lbs_ip);const d=[];c.gatewayInfo.gatewayAddrs.forEach(h=>{let{address:p}=h;const[m,_]=p.split(":");d.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:m,port:_}:{host:m,port:_})}),i(d)}).catch(s)}),this._gateway.on(ln.NETWORK_QUALITY,i=>{"normal"===this._networkQualitySensitivity&&this.safeEmit($e.NETWORK_QUALITY,i)}),this._gateway.on(ln.STREAM_TYPE_CHANGE,(i,s)=>{this.safeEmit($e.STREAM_TYPE_CHANGED,i,s),ye.reportApiInvoke(this._sessionId,{name:fn.STREAM_TYPE_CHANGE,options:[i,s],tag:nn.TRACER}).onSuccess(JSON.stringify({uid:i,streamType:s}))}),this._gateway.on(ln.IS_P2P_DISCONNECTED,i=>{this._p2pChannel.isP2PDisconnected()?i(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?i(!1):i(!0)}),this._gateway.on(ln.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(ln.REQUEST_P2P_CONNECTION_PARAMS,function(){var i=L(function*(s,c,d){try{c(yield n._p2pChannel.startP2PConnection(s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.on(ln.JOIN_RESPONSE,(i,s)=>{if(this.store.useP2P)return;const{dtlsParameters:c,iceParameters:d,candidates:h,rtpCapabilities:p,setup:m,cname:_}=cm(i.ortc,s);this._p2pChannel.connect(d,c,h,p,m,_)}),this._gateway.on(ln.REQUEST_DC_CONNECTION_PARAMS,i=>{i(this._p2pChannel.getEstablishParams())}),this._gateway.on(ln.RESET_SIGNAL,i=>{this._p2pChannel.resetConnection(i),this._handleGatewaySignalEvents()}),this._gateway.on(ln.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(ln.DATACHANNEL_PRECONNECT,function(){var i=L(function*(s,c,d,h){var p,m,_,E,v,S;yield n._p2pChannel.startP2PConnection({turnServer:null===(p=n._joinInfo)||void 0===p?void 0:p.turnServer},!0);const b=function(O,P){let w;return P&&P.ip&&"number"==typeof P.port?(w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip,port:P.port.toString(),type:"host",extension:{}}],T.debug("Using remote candidate from AP ".concat(P.ip,":").concat(P.port)),P.ip6&&(w.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:P.ip6,port:P.port.toString(),type:"host",extension:{}}),T.debug("Using IPV6 remote candidate from AP ".concat(P.ip6,":").concat(P.port)))):w=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:O.ip,port:O.port.toString(),type:"host",extension:{}}],w}(s,c);return n._p2pChannel.preConnect({iceUfrag:"".concat(null===(m=n._joinInfo)||void 0===m?void 0:m.apResponse.cid,"_").concat(null===(_=n._joinInfo)||void 0===_?void 0:_.apResponse.cert),icePwd:"".concat(null===(E=n._joinInfo)||void 0===E?void 0:E.apResponse.cid,"_").concat(null===(v=n._joinInfo)||void 0===v?void 0:v.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(S=B("FINGERPRINT"))&&void 0!==S?S:s.fingerprint}]},b,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(d).catch(h)});return function(s,c,d,h){return i.apply(this,arguments)}}())}_handleGatewaySignalEvents(){var n=this;this._gateway.signal.on(Me.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Me.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Me.ON_ADD_AUDIO_STREAM,i=>this._handleAddAudioOrVideoStream("audio",i.uid,i.ssrcId,i.cname,i.uint_id,i.ortc)),this._gateway.signal.on(Me.ON_ADD_VIDEO_STREAM,i=>this._handleAddAudioOrVideoStream("video",i.uid,i.ssrcId,i.cname,i.uint_id,i.ortc,i.rtxSsrcId)),this._gateway.signal.on(Me.ON_REMOTE_DATASTREAM_UPDATE,i=>{this._handleUpdateDataChannel(i)}),this._gateway.signal.on(Me.ON_REMOTE_FULL_DATASTREAM_INFO,i=>{this._handleUpdateDataChannel({added:i.datastreams,deleted:[]},!0)}),this._gateway.signal.on(Me.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Me.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Me.MUTE_AUDIO,i=>this._handleMuteStream(i.uid,fe.AUDIO,!0)),this._gateway.signal.on(Me.UNMUTE_AUDIO,i=>this._handleMuteStream(i.uid,fe.AUDIO,!1)),this._gateway.signal.on(Me.MUTE_VIDEO,i=>this._handleMuteStream(i.uid,fe.VIDEO,!0)),this._gateway.signal.on(Me.UNMUTE_VIDEO,i=>this._handleMuteStream(i.uid,fe.VIDEO,!1)),this._gateway.signal.on(Me.RECEIVE_METADATA,i=>{const s=cf(i.metadata);this.safeEmit($e.RECEIVE_METADATA,i.uid,s)}),this._gateway.signal.on(Me.ON_DATA_STREAM,function(){var i=L(function*(s){if(!s)return;let c=0;if(s.ordered||s.syncWithAudio){const d=n._p2pChannel.getStats(),h=n.remoteUsers.find(m=>m.uid===s.uid),p=null==d?void 0:d.audioRecv.find(m=>m.ssrc===(null==h?void 0:h._audioSSRC));c=null==p?void 0:p.jitterBufferMs}null==c&&(c=0),function qU(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!o.syncWithAudio)return VO(i,{uid:o.uid,payload:cf(o.payload)});const s="".concat(i.id,"-").concat(o.uid),c=FO.get(s)||[],d=c.findIndex(_=>o.sendTs>=_.sendTs),h=Ix(Ix({},o),{},{context:i,mediaDelay:n,recvTs:Date.now()});-1===d?c.push(h):c.splice(d,0,h),FO.set(s,c);let p=!1;var m;jT.has(s)?p=!(null===(m=jT.get(s))||void 0===m||!m.isSyncing):jT.set(s,{isSyncing:p,firstRecvTs:0,firstSendTs:0}),p||UO(s)}(s,c,{id:n._clientId,onStreamMessage:"function"==typeof n.onStreamMessage?n.onStreamMessage.bind(n):void 0,safeEmit:n.safeEmit.bind(n)})});return function(s){return i.apply(this,arguments)}}()),this._gateway.signal.on(Me.ON_CRYPT_ERROR,()=>{af(()=>{T.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit($e.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Me.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{T.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ye.TOKEN_EXPIRE),this.safeEmit($e.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Me.ON_STREAM_FALLBACK_UPDATE,i=>{T.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(i.stream_id,", attr: ").concat(i.stream_type)),this.safeEmit($e.STREAM_FALLBACK,i.stream_id,1===i.stream_type?"fallback":"recover")}),this._gateway.signal.on(Me.ON_PUBLISH_STREAM,i=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:i.proxy})),T.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(i))))}),this._gateway.signal.on(Me.ENABLE_LOCAL_VIDEO,i=>{this._handleSetStreamLocalEnable("video",i.uid,!0)}),this._gateway.signal.on(Me.DISABLE_LOCAL_VIDEO,i=>{this._handleSetStreamLocalEnable("video",i.uid,!1)}),this._gateway.signal.on(de.REQUEST_TIMEOUT,(i,s)=>{if(this._joinInfo)switch(i){case ve.PUBLISH:{if(!s)return;const h=s.ortc;if(h){var c,d;const p=h.some(E=>{let{stream_type:v}=E;return v===bt.Audio}),m=h.some(E=>{let{stream_type:v}=E;return v!==bt.Audio}),_=h.some(E=>{let{stream_type:v}=E;return v===bt.Screen||v===bt.ScreenLow});"offer"===s.state&&ye.publish(this._joinInfo.sid,{eventElapse:Ai.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:k.TIMEOUT,audio:p,video:m,p2pid:s.p2p_id,publishRequestid:this.store.pubId,screenshare:_,audioName:p?null===(c=h.find(E=>{let{stream_type:v}=E;return v===bt.Audio}))||void 0===c||null===(c=c.ssrcs[0])||void 0===c?void 0:c.ssrcId.toString():void 0,videoName:m?null===(d=h.find(E=>{let{stream_type:v}=E;return v!==bt.Audio}))||void 0===d||null===(d=d.ssrcs[0])||void 0===d?void 0:d.ssrcId.toString():void 0})}break}case ve.SUBSCRIBE:s&&ye.subscribe(this._joinInfo.sid,{succ:!1,ec:k.TIMEOUT,audio:s.stream_type===fe.AUDIO,video:s.stream_type===fe.VIDEO,peerid:s.stream_id,subscribeRequestid:s.ssrcId,p2pid:this.store.p2pId,eventElapse:Ai.measureFromSubscribeStart(this.store.clientId,s.ssrcId)})}}),this._gateway.signal.on(Me.ON_P2P_OK,i=>{}),this._gateway.signal.on(Me.ON_PUBLISHED_USER_LIST,i=>{if(null==i||!i.users)return;B("BLOCK_LOCAL_CLIENT")&&(i.users=i.users.filter(d=>!Zc(d.string_id||d.stream_id,this.channelName)));const s=[],c=[];for(const d of i.users){let h=this._users.find(S=>S._uintid===d.stream_id);h?h._trust_in_room_=!0:(h=new ji(d.string_id||d.stream_id,d.stream_id),this._users.push(h),0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(T.debug("[".concat(this._clientId,"] user online"),d.stream_id),this.safeEmit($e.USER_JOINED,h)));const p=Fn.Audio&d.stream_type,m=(Fn.Video|Fn.LwoVideo)&d.stream_type,_=0!=(65280&d.stream_type),E=p&&h.hasAudio,v=m&&h.hasVideo;m&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=d.video_ssrc,h._rtxSsrcId=d.video_rtx),p&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=d.audio_ssrc),p&&!E&&0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(T.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit($e.USER_PUBLISHED,h,"audio")),m&&!v&&0===this.getListeners($e.PUBLISHED_USER_LIST).length&&(T.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit($e.USER_PUBLISHED,h,"video")),(p&&!E||m&&!v||_)&&s.push(h),m&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&c.push({user:h,mediaType:"video"}),p&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&c.push({user:h,mediaType:"audio"})}c.length>0&&(T.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(c.map(d=>"user: ".concat(d.user.uid,", mediaType: ").concat(d.mediaType)).join("; ")," ")),this.massSubscribe(c).catch(d=>{T.error("[".concat(this._clientId,"] mass resubscribe error"),d.toString())})),this.getListeners($e.PUBLISHED_USER_LIST).length>0?B("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=s:(T.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(s.map(d=>d.uid).join(", "))),this.safeEmit($e.PUBLISHED_USER_LIST,s)):T.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(s.map(d=>d.uid).join(", ")))})}_handleP2PEvents(){var n=this;this._gateway.signal.on(Me.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Pt.PUBLISH,function(){var i=L(function*(s,c){s.forEach(d=>d.kind===fe.VIDEO?(n._handleP2PAddAudioOrVideoStream("video",c),n._handleMuteStream(c,fe.VIDEO,!!d.isMuted)):(n._handleP2PAddAudioOrVideoStream("audio",c),n._handleMuteStream(c,fe.AUDIO,!!d.isMuted)))});return function(s,c){return i.apply(this,arguments)}}()),this._gateway.signal.on(de.P2P_START,function(){var i=L(function*(s,c){var d;n._p2pChannel instanceof Zt&&c(yield n._p2pChannel.startP2P({turnServer:null===(d=n._joinInfo)||void 0===d?void 0:d.turnServer},s))});return function(s,c){return i.apply(this,arguments)}}()),this._gateway.signal.on(de.P2P_CONNECTION,function(){var i=L(function*(s){n._p2pChannel instanceof Zt&&(yield n._p2pChannel.p2pConnect(s))});return function(s){return i.apply(this,arguments)}}()),this._gateway.signal.on(de.P2P_REMOTE_CANDIDATE_UPDATE,i=>{this._p2pChannel instanceof Zt&&this._p2pChannel.addRemoteCandidate(JSON.parse(i))}),this._gateway.signal.on(Pt.SUBSCRIBE,function(){var i=L(function*(s,c,d){if(n._p2pChannel instanceof Zt){const{trackType:h}=JSON.parse(s);try{yield n._p2pChannel.dopublish(h),c()}catch(p){d(p)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Pt.UNSUBSCRIBE,function(){var i=L(function*(s,c,d){if(n._p2pChannel instanceof Zt){const{mediaType:h}=JSON.parse(s);try{yield n._p2pChannel.doUnpublish(h),c()}catch(p){d(p)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Pt.EXCHANGE_SDP,function(){var i=L(function*(s,c,d){if(n._p2pChannel instanceof Zt){const{type:h,sdp:p}=JSON.parse(s);try{c(yield n._p2pChannel.setDescription(h,p))}catch(m){d(m)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Pt.UNPUBLISH,function(){var i=L(function*(s,c,d){if(n._p2pChannel instanceof Zt){const{unpubMsg:h,uid:p}=s;if(1===h.length){const m=h[0].stream_type===bt.Audio?fe.AUDIO:fe.VIDEO;n._handleMuteStream(p,m,!0);const{sdp:_}=s;if(n._p2pChannel instanceof Zt&&_){const E=n._users.find(v=>v.uid===p);if(!E)return T.warning("[".concat(n._clientId,"] can not find remote user, ignore mute event, uid: ").concat(p)),void c();n._p2pChannel.unsubscribe(E,_,m).then(v=>{v&&c(v)}).catch(d)}else c()}else n._handleRemoveStream(s,c,d)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Pt.CONTROL,function(){var i=L(function*(s,c,d){const{action:h,sdp:p,isMuteAll:m,uid:_}=s;switch(h){case Hs.MUTE_LOCAL_VIDEO:n._handleMuteStream(_,fe.VIDEO,!0,p,c,d);break;case Hs.MUTE_LOCAL_AUDIO:c(),n._handleMuteStream(_,fe.AUDIO,!0);break;case Hs.UNMUTE_LOCAL_VIDEO:c(),n._handleP2PAddAudioOrVideoStream("video",_),n._handleMuteStream(_,fe.VIDEO,!1);break;case Hs.UNMUTE_LOCAL_AUDIO:c(),n._handleP2PAddAudioOrVideoStream("audio",_),n._handleMuteStream(_,fe.AUDIO,!1)}m&&n._handleRemoveStream(s,c,d)});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Pt.DO_SUBSCRIBE,function(){var i=L(function*(s,c,d){if(n._p2pChannel instanceof Zt){const{kind:h,sdp:p,ssrcId:m,uid:_}=s,E=n._users.find(v=>v.uid===_);if(!E)return T.error("[".concat(n._clientId,"] can not find target user!(on_add_stream)")),void c();try{c(yield n._p2pChannel.subscribe(E,h,p,m))}catch(v){d(v)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Pt.DO_UNSUBSCRIBE,function(){var i=L(function*(s,c,d){if(n._p2pChannel instanceof Zt){const{uid:h,kind:p,sdp:m}=s,_=n._users.find(E=>E.uid===h);if(!_)return T.error("[".concat(n._clientId,"] can not find target user!(on_add_stream)")),void c();try{c(yield n._p2pChannel.unsubscribe(_,m,p))}catch(E){d(E)}}});return function(s,c,d){return i.apply(this,arguments)}}()),this._gateway.signal.on(Pt.RESTART_ICE,function(){var i=L(function*(s,c,d){if(n._p2pChannel instanceof Zt)try{c(yield n._p2pChannel.setDescription("remote",s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestP2PRestartICE,function(){var i=L(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(Pt.RESTART_ICE,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.LocalCandidate,i=>{this._gateway.sendExtensionMessage(Pt.CANDIDATE,JSON.stringify(i))}),this._p2pChannel.on(Te.RequestP2PMuteLocal,function(){var i=L(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(Pt.CONTROL,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestP2PPublish,function(){var i=L(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(Pt.DO_SUBSCRIBE,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestP2PUnPublish,function(){var i=L(function*(s,c,d){try{c(yield n._gateway.sendExtensionMessage(Pt.DO_UNSUBSCRIBE,s))}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestP2PUnmuteRemote,function(){var i=L(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.unmuteRemote(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===k.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestP2PMuteRemote,function(){var i=L(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.muteRemote(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===k.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.StateChange,(i,s)=>{s===rt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){var n=this;this._p2pChannel.on(Te.RequestMuteLocal,function(){var i=L(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.muteLocal(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===k.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestUnmuteLocal,function(){var i=L(function*(s,c,d){if(n._joinInfo)try{yield n._gateway.unmuteLocal(s,n._joinInfo.stringUid||n._joinInfo.uid),c()}catch(h){h.code===k.DISCONNECT_P2P?c():d(h)}else c()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestRePublish,(i,s,c)=>{this.publish(i,!1).then(s).catch(c)}),this._p2pChannel.on(Te.RequestRePublishDataChannel,(i,s,c)=>{z.all(i.map(function(){var d=L(function*(h){yield n._p2pChannel.publishDataChannel([h]);const p={streamId:h.id,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:h.metadata,channelId:h._originDataChannelId};try{yield n._gateway.publishDataChannel(n._uid,p,!0)}catch(m){if(m.code!==k.DISCONNECT_P2P)throw m}});return function(h){return d.apply(this,arguments)}}())).then(s).catch(c)}),this._p2pChannel.on(Te.RequestReSubscribe,function(){var i=L(function*(s,c,d){try{for(const{user:h,kind:p}of s)p===fe.VIDEO?yield n.subscribe(h,"video"):yield n.subscribe(h,"audio");c()}catch(h){d(h)}});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestUploadStats,(i,s)=>{this._gateway.uploadStats(i,s)}),this._p2pChannel.on(Te.MediaReconnectStart,i=>{this.safeEmit($e.MEDIA_RECONNECT_START,i)}),this._p2pChannel.on(Te.MediaReconnectEnd,i=>{this.safeEmit($e.MEDIA_RECONNECT_END,i)}),this._p2pChannel.on(Te.NeedSignalRTT,i=>{i(this._gateway.getSignalRTT())}),this._p2pChannel.on(Te.RequestRestartICE,function(){var i=L(function*(s){if(n._p2pChannel instanceof Zt)return;const c=yield n._p2pChannel.restartICE(s),d=yield c.next();if(d.done)return;const h=d.value;let p;try{p=yield n._gateway.restartICE({iceParameters:h})}catch(_){return void c.throw(_)}const{iceParameters:m}=function(_){const E=_.iceParameters;return{iceParameters:{iceUfrag:E.iceUfrag,icePwd:E.icePwd}}}(p);yield c.next({remoteIceParameters:m})});return function(s){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.RequestReconnect,L(function*(){n._gateway.reconnect()})),this._p2pChannel.on(Te.RequestReconnectPC,L(function*(){var i;const{iceParameters:s,dtlsParameters:c,rtpCapabilities:d}=yield n._p2pChannel.startP2PConnection({turnServer:null===(i=n._joinInfo)||void 0===i?void 0:i.turnServer}),{gatewayEstablishParams:h,gatewayAddress:p}=yield n._gateway.reconnectPC({iceParameters:s,dtlsParameters:c,rtpCapabilities:d}),{dtlsParameters:m,iceParameters:_,candidates:E,rtpCapabilities:v,setup:S,cname:b}=cm(h,p);yield n._p2pChannel.connect(_,m,E,v,S,b),yield n._p2pChannel.republish(),yield n._p2pChannel.reSubscribe()})),this._p2pChannel.on(Te.RequestUnpublishForReconnectPC,function(){var i=L(function*(s,c,d){n._joinInfo&&void 0!==n._uid?(yield n._gateway.unpublish(s,n._uid),c()):d()});return function(s,c,d){return i.apply(this,arguments)}}()),this._p2pChannel.on(Te.P2PLost,()=>{this.safeEmit($e.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Te.UpdateVideoEncoder,i=>{i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig)}),this._p2pChannel.on(Te.ConnectionTypeChange,i=>{this.safeEmit($e.IS_USING_CLOUD_PROXY,i)}),this._p2pChannel.on(Te.RequestLowStreamParameter,i=>{i(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Te.QueryClientConnectionState,i=>{i(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}enableContentInspect(n){var i=this;return L(function*(){if("CONNECTED"!==i.connectionState||!i._joinInfo)throw new W(k.INVALID_OPERATION,"[".concat(i._clientId,"] Client did not join channel"));if(i._inspect)throw new W(k.INVALID_OPERATION,"[".concat(i._clientId,"] Inspect content service already in connecting/connected state"));if(!n)throw new W(k.INVALID_PARAMS,"[".concat(i._clientId,"] inspectConfig is necessary"));if(!n.inspectType||!Array.isArray(n.inspectType))throw new W(k.INVALID_PARAMS,"[".concat(i._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const s=[...new Set(n.inspectType)];s.forEach(c=>{var d;if(!Re(d=["supervise","moderation"]).call(d,c))throw new W(k.INVALID_PARAMS,"[".concat(i._clientId,"] ").concat(c," is not a valid inspect type."))}),n.inspectType=s}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new W(k.INVALID_PARAMS,"[".concat(i._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const s=new bv(n);i._inspect=s,i.handleVideoInspectEvents(i._inspect),yield s.init({appId:i._joinInfo.appId,areaCode:"",cname:i._joinInfo.cname,sid:i._joinInfo.sid,token:i._joinInfo.token,uid:i._joinInfo.uid,cid:i._joinInfo.cid,vid:i._joinInfo.vid?Number(i._joinInfo.vid):0},Ln)}catch(s){throw Array.isArray(s)?s[0]:s}})()}disableContentInspect(){var n=this;return L(function*(){if(!n._inspect)throw new W(k.INVALID_OPERATION,"[".concat(n._clientId,"] inspectVideoContent not started"));try{n._inspect.close(),n._inspect=void 0}catch(i){throw Array.isArray(i)?i[0]:i}})()}setImageModeration(n,i){var s=this;return L(function*(){if(Jc(n,"enabled"),n){if(!i)throw new W(k.INVALID_PARAMS,"[".concat(s._clientId,"] config is necessary"));if(Dt(i.interval,"interval",1e3,1/0),"CONNECTED"!==s.connectionState||!s._joinInfo)throw new W(k.INVALID_OPERATION,"[".concat(s._clientId,'] can not enable image moderation, not joined"'));try{if(s._moderation)return void s._moderation.updateConfig(i);const c=new Cc(i);s._moderation=c,s.handleImageModerationEvents(s._moderation),yield c.init({appId:s._joinInfo.appId,areaCode:"",cname:s._joinInfo.cname,sid:s._joinInfo.sid,token:s._joinInfo.token,uid:s._joinInfo.uid,cid:s._joinInfo.cid,vid:s._joinInfo.vid?Number(s._joinInfo.vid):0},Ln)}catch(c){throw Array.isArray(c)?c[0]:c}}else{if(!s._moderation)throw new W(k.INVALID_OPERATION,"[".concat(s._clientId,"] image moderation not started"));try{s._moderation.close(),s._moderation.removeAllListeners(),s._moderation=void 0}catch(c){throw Array.isArray(c)?c[0]:c}}})()}handleImageModerationEvents(n){n.on(fo.CONNECTION_STATE_CHANGE,(i,s)=>{if(this.safeEmit($e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,i,s),i===Xr.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new W(k.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");n.inspectImage()}}),n.on(fo.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>"video"===s.trackMediaType)[0])})}handleVideoInspectEvents(n){n.on(Wn.CONNECTION_STATE_CHANGE,(i,s)=>{if(this.safeEmit($e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,i,s),s===$r.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit($e.CONTENT_INSPECT_ERROR,new W(k.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));n.inspectImage()}}),n.on(Wn.INSPECT_RESULT,(i,s)=>{var c;if((null==s?void 0:s.code)===k.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return T.debug("Stop inspect content because that has left channel"),null==this||null===(c=this._inspect)||void 0===c||c.close(),void(this._inspect=void 0);this.safeEmit($e.CONTENT_INSPECT_RESULT,i,s)}),n.on(Wn.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>"video"===s.trackMediaType)[0])})}getJoinChannelServiceRecords(){return T.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}setPublishAudioFilterEnabled(n){var i=this;return L(function*(){Jc(n,"enabled"),Nt("ENABLE_PUBLISH_AUDIO_FILTER",n),i._joinInfo&&(yield i._gateway.setPublishAudioFilterEnabled(n))})()}_handleResetAddStream(n,i){switch(i){case"audio":n._audio_added_=!1,n._trust_audio_stream_added_state_=!0;break;case"video":n._video_added_=!1,n._trust_video_stream_added_state_=!0}}}te([Ie(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],kt.prototype,"leave",null),te([Ie({argsMap:(o,n)=>{if(!Array.isArray(n)){if(!(n instanceof zn))return[n];n=[n]}return n.map(i=>i?Object(i).toString():"null")}}),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",z)],kt.prototype,"publish",null),te([Ie({argsMap:(o,n)=>(n||(n=[]),n instanceof XD?[n.getChannelId()]:(Array.isArray(n)||(n=[n]),n.map(i=>i.getTrackId())))}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],kt.prototype,"unpublish",null),te([Ie({argsMap:(o,n,i,s)=>[n.uid,i,s]}),N("design:type",Function),N("design:paramtypes",[ji,String,Number]),N("design:returntype",z)],kt.prototype,"subscribe",null),te([Ie({argsMap:(o,n)=>n.map(i=>{let{user:s,mediaType:c}=i;return[null==s?void 0:s.uid,c]})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],kt.prototype,"massSubscribe",null),te([Ie({argsMap:(o,n,i,s)=>[n.uid,i,s]}),N("design:type",Function),N("design:paramtypes",[ji,String,Number]),N("design:returntype",z)],kt.prototype,"unsubscribe",null),te([Ie({argsMap:(o,n)=>n.map(i=>{let{user:s,mediaType:c}=i;return{uid:null==s?void 0:s.uid,mediaType:c}})}),N("design:type",Function),N("design:paramtypes",[Array]),N("design:returntype",z)],kt.prototype,"massUnsubscribe",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],kt.prototype,"setLowStreamParameter",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],kt.prototype,"enableDualStream",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],kt.prototype,"disableDualStream",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",z)],kt.prototype,"setClientRole",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",void 0)],kt.prototype,"setProxyServer",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Object,Boolean]),N("design:returntype",void 0)],kt.prototype,"setTurnServer",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",void 0)],kt.prototype,"setLicense",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],kt.prototype,"startProxyServer",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],kt.prototype,"stopProxyServer",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],kt.prototype,"setLocalAccessPointsV2",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Array,String]),N("design:returntype",void 0)],kt.prototype,"setLocalAccessPoints",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",z)],kt.prototype,"setRemoteDefaultVideoStreamType",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",z)],kt.prototype,"setRemoteVideoStreamType",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Object,Number]),N("design:returntype",z)],kt.prototype,"setStreamFallbackOption",null),te([Ie({argsMap:(o,n)=>[n]}),N("design:type",Function),N("design:paramtypes",[String,String,Uint8Array]),N("design:returntype",void 0)],kt.prototype,"setEncryptionConfig",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],kt.prototype,"renewToken",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],kt.prototype,"enableAudioVolumeIndicator",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[String,Boolean]),N("design:returntype",z)],kt.prototype,"startLiveStreaming",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],kt.prototype,"setLiveTranscoding",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[String]),N("design:returntype",z)],kt.prototype,"stopLiveStreaming",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[String,Object]),N("design:returntype",z)],kt.prototype,"addInjectStreamUrl",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],kt.prototype,"removeInjectStreamUrl",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[ps]),N("design:returntype",z)],kt.prototype,"startChannelMediaRelay",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[ps]),N("design:returntype",z)],kt.prototype,"updateChannelMediaRelay",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],kt.prototype,"stopChannelMediaRelay",null),te([Ie({argsMap:(o,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],kt.prototype,"sendCustomReportMessage",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Object,Object]),N("design:returntype",z)],kt.prototype,"pickSVCLayer",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",z)],kt.prototype,"setRTM2Flag",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",z)],kt.prototype,"enableContentInspect",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",z)],kt.prototype,"disableContentInspect",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Boolean,Object]),N("design:returntype",z)],kt.prototype,"setImageModeration",null),te([Ie({reportResult:!0}),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",Array)],kt.prototype,"getJoinChannelServiceRecords",null),te([Ie(),N("design:type",Function),N("design:paramtypes",[Boolean]),N("design:returntype",z)],kt.prototype,"setPublishAudioFilterEnabled",null);const YU=lt().name;class Iv{constructor(n,i){C(this,"id",0),C(this,"element",void 0),C(this,"peerPair",void 0),C(this,"context",void 0),C(this,"audioPlayerElement",void 0),C(this,"audioTrack",void 0),Iv.count+=1,this.id=Iv.count,this.element=n,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const i=document.createElement("audio");i.srcObject=new MediaStream([n.track]),i.play(),this.audioPlayerElement=i}}switchSdp(){var n=this;return L(function*(){if(!n.peerPair)return;const i=function(){var c=L(function*(d,h){const p="offer"===h?yield d.createOffer():yield d.createAnswer();return yield d.setLocalDescription(p),"complete"===d.iceGatheringState?d.localDescription:new z(m=>{d.onicegatheringstatechange=()=>{"complete"===d.iceGatheringState&&m(d.localDescription)}})});return function(h,p){return c.apply(this,arguments)}}(),s=function(){var c=L(function*(d,h){return yield d.setRemoteDescription(h)});return function(h,p){return c.apply(this,arguments)}}();try{const c=yield i(n.peerPair[0],"offer");yield s(n.peerPair[1],c);const d=yield i(n.peerPair[1],"answer");yield s(n.peerPair[0],d)}catch(c){throw new W(k.LOCAL_AEC_ERROR,c.toString()).print()}})()}getTracksFromMediaElement(n){var i=this;return L(function*(){if(i.audioTrack)return i.audioTrack;let s;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),s=i.context.createMediaStreamDestination(),i.context.createMediaElementSource(n).connect(s)}catch(d){throw new W(k.LOCAL_AEC_ERROR,d.toString()).print()}if(!s)throw new W(k.LOCAL_AEC_ERROR,"no dest node when local aec").print();const c=s.stream.getAudioTracks()[0];return i.audioTrack=c,c})()}getElement(){return this.element}startEchoCancellation(){var n=this;return L(function*(){n.context.resume(),n.peerPair&&n.close(),n.initPeers();const i=n.element,s=yield n.getTracksFromMediaElement(i);n.peerPair&&n.peerPair[0].addTrack(s),yield n.switchSdp()})()}close(){T.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}C(Iv,"count",0);const $U=window.AudioContext||window.webkitAudioContext;class Ax{constructor(){C(this,"units",[]),C(this,"context",void 0)}processExternalMediaAEC(n){if(!this._doesEnvironmentNeedAEC())return T.debug("the system does not need to process local aec"),-1;this.context||(this.context=new $U);let i=this.units.find(s=>s&&s.getElement()===n);return i||(i=new Iv(n,this.context),this.units.push(i)),i.startEchoCancellation(),T.debug("start processing local audio echo cancellation, id is",i.id),i.id}_doesEnvironmentNeedAEC(){return lt().name!==mt.SAFARI}}te([Ie({report:ye}),N("design:type",Function),N("design:paramtypes",[HTMLAudioElement]),N("design:returntype",Number)],Ax.prototype,"processExternalMediaAEC",null);const XU=new Ax;function Dx(o,n){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(o);n&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,s)}return i}function Ox(o){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?Dx(Object(i),!0).forEach(function(s){C(o,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):Dx(Object(i)).forEach(function(s){Object.defineProperty(o,s,Object.getOwnPropertyDescriptor(i,s))})}return o}const BO=window||document;function Nx(o){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!BO)return;const i=ci._cspEventHandlerPointer;if(i&&n)return void console.error(i,n);const s=c=>{if(!(c&&c.blockedURI&&(ci.onSecurityPolicyViolation||ci.getListeners(os.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;B("CSP_DETECTED_HOSTNAME_LIST").some(h=>Re(d).call(d,h))&&(ci.onSecurityPolicyViolation&&"function"==typeof ci.onSecurityPolicyViolation&&ci.onSecurityPolicyViolation(c),ci.getListeners(os.SECURITY_POLICY_VIOLATION).length>0&&ci.safeEmit(os.SECURITY_POLICY_VIOLATION,c))};i&&BO.removeEventListener("securitypolicyviolation",i),(n||o&&"function"==typeof o||ci.getListeners(os.SECURITY_POLICY_VIOLATION).length>0)&&BO.addEventListener("securitypolicyviolation",s),ci._cspEventHandlerPointer=s}Nt("PROCESS_ID","process-".concat(Ot(8,""),"-").concat(Ot(4,""),"-").concat(Ot(4,""),"-").concat(Ot(4,""),"-").concat(Ot(12,""))),function(){const o=lt();xt.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),xt.getStreamFromExtension=o.name===mt.CHROME&&Number(o.version)>34,xt.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let i=!1;try{n.addTransceiver("audio"),i=!0}catch(s){}return n.close(),i}(),xt.supportMinBitrate=o.name===mt.CHROME||o.name===mt.EDGE,xt.supportSetRtpSenderParameters=function(){const n=lt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!$c()||!(!or()&&!ef())||n.name===mt.FIREFOX&&Number(n.version)>=64)}(),o.name===mt.SAFARI&&(xt.supportDualStream=Number(o.version)>=14),xt.webAudioMediaStreamDest=function(){const n=lt();return!(n.name===mt.SAFARI&&Number(n.version)<12)}(),xt.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,xt.supportWebGL="undefined"!=typeof WebGLRenderingContext,xt.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,$c()||(xt.webAudioWithAEC=!0),xt.supportShareAudio=function(){const n=lt();return(n.os===ti.WIN_10||n.os===ti.WIN_81||n.os===ti.WIN_7||n.os===ti.LINUX||n.os===ti.MAC_OS)&&n.name===mt.CHROME&&Number(n.version)>=74}(),xt.supportDataChannel=!!(xw(76)||function(n){const i=lt();return!(i.name!==mt.FIREFOX||!i.osVersion)&&Number(i.version)>=68}()||function(n){const i=lt();return!(i.name!==mt.SAFARI||!i.osVersion)&&Number(i.version)>=14}()),xt.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!Bt()&&!!n&&n.prototype.setConfiguration instanceof Function}(),xt.supportWebRTCEncodedTransform=function(){const n=lt();return"Chrome"===n.name&&Number(n.version)>=86}(),xt.supportWebRTCInsertableStream=function(){const n=lt();return(n.name===mt.CHROME||n.name===mt.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),is(()=>{xt.supportDualStreamEncoding=function(){const n=lt();return!!B("DISABLE_WEBAUDIO")||"Safari"===n.name&&Number(n.version)>=14||!!("Chrome"===n.name&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&B("CHROME_DUAL_STREAM_USE_ENCODING"))}(),T.info("browser compatibility",JSON.stringify(xt),JSON.stringify(o))})}(),function(){let o;try{o=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void T.error("Error loading sdk config",n.message)}if(o)try{const n=JSON.parse(window.atob(o)),i=Date.now();T.debug("Loading global parameters from cache",n),Object.keys(n).forEach(s=>{if(Object.prototype.hasOwnProperty.call(ar,s)){const{value:c,expires:d}=n[s];if(d&&d<=i)return;ic[s]=c,ar[s]=c}})}catch(n){T.error("Error loading mutableParamsCache: ".concat(o),n.message)}}(),Array.isArray(ic.AREAS)&&ic.AREAS.length>0&&gc(ic.AREAS,!0);const ci=function(o){const n=new jt,i=o,s={getListeners:n.getListeners.bind(n),on:(c,d)=>(c===os.SECURITY_POLICY_VIOLATION&&Nx(d,!0),n.on.bind(n)(c,d)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return Ox(Ox({},i),s)}({__TRACK_LIST__:kf,VERSION:Kr,BUILD:nE,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(o,n,i)=>{T.debug("setParameter key:".concat(o,", value:").concat(JSON.stringify(n))),Nt(o,n,i)},getParameter:B,getSupportedCodec:function(){var o=L(function*(){let n={audio:[],video:[]};try{let i=new RTCPeerConnection;i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(yield i.createOffer()).sdp;if(!s)return n;i.close(),i=null,n=function(c){const d={video:[],audio:[]};return c.match(/ VP8/i)&&d.video.push("VP8"),c.match(/ VP9/i)&&d.video.push("VP9"),c.match(/ AV1/i)&&d.video.push("AV1"),c.match(/ H264/i)&&d.video.push("H264"),c.match(/ H265/i)&&d.video.push("H265"),c.match(/ opus/i)&&d.audio.push("OPUS"),c.match(/ PCMU/i)&&d.audio.push("PCMU"),c.match(/ PCMA/i)&&d.audio.push("PCMA"),c.match(/ G722/i)&&d.audio.push("G722"),d}(s)}catch(i){throw new W(k.CREATE_OFFER_FAILED,i.toString&&i.toString()).print()}return n});return function(){return o.apply(this,arguments)}}(),checkSystemRequirements:function(){const o=ye.reportApiInvoke(null,{name:fn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:nn.TRACER});let n=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,p=window.WebSocket;n=!!(d&&h&&p)}catch(d){return T.error("check system requirement failed: ",d),!1}let i=!1;const s=lt();s.name===mt.CHROME&&Number(s.version)>=58&&(!function Lw(){return"WebKit"===ha.engine.name}()||function xg(){const o=lt();if(ef()){if(o.os===ti.MAC_OS)return!0;if(o.os===ti.IOS){const n=ha.os.version&&ha.os.version.split(".");if(n&&14===Number(n[0])&&n[1]&&Number(n[1])>=3||n&&Number(n[0])>14)return!0}}return!1}())&&(i=!0),s.name===mt.FIREFOX&&Number(s.version)>=56&&(i=!0),s.name===mt.OPERA&&Number(s.version)>=45&&(i=!0),s.name===mt.SAFARI&&Number(s.version)>=11&&(i=!0),(Uw()||lt().name===mt.QQ)&&(i=!0),T.debug("checkSystemRequirements, api:",n,"browser",i);const c=n&&i;return o.onSuccess(c),c},getDevices:function(o){return _o.enumerateDevices(!0,!0,o)},getMicrophones:function(o){return _o.getRecordingDevices(o)},getCameras:function(o){return _o.getCamerasDevices(o)},getElectronScreenSources:rD,getPlaybackDevices:function(o){return _o.getSpeakers(o)},createClient:function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=ye.reportApiInvoke(null,{name:fn.CREATE_CLIENT,options:[o],tag:nn.TRACER});try{Jn((i=o).codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Jn(i.mode,"config.mode",["rtc","live"]),void 0!==i.audioCodec&&Jn(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==i.proxyServer&&Ei(i.proxyServer,"config.proxyServer",1,1e4),void 0!==i.turnServer&&zw(i.turnServer),void 0!==i.httpRetryConfig&&SC(i.httpRetryConfig),void 0!==i.websocketRetryConfig&&SC(i.websocketRetryConfig)}catch(i){throw n.onError(i),i}var i;return void 0===o.audioCodec&&(o.audioCodec="opus"),n.onSuccess(),new kt(Im(Im({forceWaitGatewayResponse:!0},o),{},{role:"rtc"===o.mode?"host":o.role||"audience"}))},createCameraVideoTrack:function(){var o=L(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CREATE_CAM_VIDEO_TRACK,options:[jf({},n)]}),s=md(n),c=Ot(8,"track-cam-");let d=null;T.info("start create camera video track with config",JSON.stringify(n),"trackId",c);try{d=(yield Cr({video:s},c)).getVideoTracks()[0]||null}catch(p){throw i.onError(p),p}if(!d){const p=new Q(k.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(p),p.throw(T)}n.optimizationMode&&Ib(c,d,n,ac(n.encoderConfig));const h=new sl(d,n,s,n.scalabiltyMode?hb(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return i.onSuccess(h.getTrackId()),T.info("create camera video success, trackId:",c),h});return function(){return o.apply(this,arguments)}}(),createCustomVideoTrack:function(o){const n=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CREATE_CUSTOM_VIDEO_TRACK,options:[o]}),i=new We(o.mediaStreamTrack,{width:o.width,height:o.height,frameRate:o.frameRate,bitrateMax:o.bitrateMax,bitrateMin:o.bitrateMin},o.scalabiltyMode?hb(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,Ot(8,"track-cus-"),[Ht.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),T.info("create custom video track success with config",o,"trackId",i.getTrackId()),i},createScreenVideoTrack:function(){var o=L(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const s=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CREATE_SCREEN_VIDEO_TRACK,options:[jf({},n),i]});n.encoderConfig?"string"==typeof n.encoderConfig||n.encoderConfig.width&&n.encoderConfig.height||(n.encoderConfig.width={max:1920},n.encoderConfig.height={max:1080}):n.encoderConfig="1080p_2";const c=function(v){const S={};v.screenSourceType&&(S.mediaSource=v.screenSourceType),v.extensionId&&ec()&&(S.extensionId=v.extensionId);const{displaySurface:b,selfBrowserSurface:O,surfaceSwitching:P,systemAudio:w}=v;(xw(107)||Or(107)||C1(93))&&(b&&(Jn(b,"displaySurface",["browser","window","monitor"]),S.displaySurface=b),O?(Jn(O,"selfBrowserSurface",["exclude","include"]),S.selfBrowserSurface=O):S.selfBrowserSurface="include",P&&(Jn(P,"surfaceSwitching",["exclude","include"]),S.surfaceSwitching=P)),(xw(105)||Or(105)||C1(91))&&w&&(Jn(w,"systemAudio",["exclude","include"]),S.systemAudio=w),v.electronScreenSourceId&&(S.sourceId=v.electronScreenSourceId);const M=v.encoderConfig?QA(v.encoderConfig):null;return S.mandatory={chromeMediaSource:"desktop",maxWidth:M?M.width:void 0,maxHeight:M?M.height:void 0},M&&(M.frameRate&&("number"==typeof M.frameRate?(S.mandatory.maxFrameRate=M.frameRate,S.mandatory.minFrameRate=M.frameRate):(S.mandatory.maxFrameRate=M.frameRate.max||M.frameRate.ideal||M.frameRate.exact||void 0,S.mandatory.minFrameRate=M.frameRate.min||M.frameRate.ideal||M.frameRate.exact||void 0),S.frameRate=M.frameRate),M.width&&(S.width=M.width),M.height&&(S.height=M.height)),S}(n),d=Ot(8,"track-scr-v-");let h=null,p=null;const m=Ge();if(!m.supportShareAudio&&"enable"===i){const v=new Q(k.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(v),v.throw(T)}T.info("start create screen video track with config",n,"withAudio",i,"trackId",d);try{const v=yield Cr({screen:c,screenAudio:"auto"===i?m.supportShareAudio:"enable"===i},d);h=v.getVideoTracks()[0]||null,p=v.getAudioTracks()[0]||null}catch(v){throw s.onError(v),v}if(!h){const v=new Q(k.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(v),v.throw(T)}if(!p&&"enable"===i){h&&h.stop();const v=new Q(k.SHARE_AUDIO_NOT_ALLOWED);return s.onError(v),v.throw(T)}n.optimizationMode||(n.optimizationMode="detail"),n.optimizationMode&&(Ib(d,h,n,n.encoderConfig&&QA(n.encoderConfig)||void 0),n.encoderConfig&&"string"!=typeof n.encoderConfig&&(n.encoderConfig.bitrateMin=n.encoderConfig.bitrateMax));const _=new We(h,n.encoderConfig?QA(n.encoderConfig):{},n.scalabiltyMode?hb(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,d,[Ht.SCREEN_TRACK]);if(!p)return s.onSuccess(_.getTrackId()),T.info("create screen video track success","video:",_.getTrackId()),_;const E=new xe(p,void 0,Ot(8,"track-scr-a-"),!1,!0);return s.onSuccess([_.getTrackId(),E.getTrackId()]),T.info("create screen video track success","video:",_.getTrackId(),"audio:",E.getTrackId()),[_,E]});return function(){return o.apply(this,arguments)}}(),createMicrophoneAndCameraTracks:function(){var o=L(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CREATE_MIC_AND_CAM_TRACKS,options:[n,i]}),c=md(i),d=uD(n),h=Ot(8,"track-mic-"),p=Ot(8,"track-cam-");let m=null,_=null;T.info("start create camera video track(".concat(p,") and microphone audio track(").concat(h,") with config, audio: ").concat(JSON.stringify(n),", video: ").concat(JSON.stringify(i)));try{const S=yield Cr({audio:d,video:c},"".concat(h,"-").concat(p));m=S.getAudioTracks()[0],_=S.getVideoTracks()[0]}catch(S){throw s.onError(S),S}if(!m||!_){const S=new Q(k.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(S),S.throw(T)}i.optimizationMode&&Ib(p,_,i,ac(i.encoderConfig));const E=new ol(m,n,d,h),v=new sl(_,i,c,i.scalabiltyMode?hb(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,p);return s.onSuccess([E.getTrackId(),v.getTrackId()]),T.info("create camera video track(".concat(p,") and microphone audio track(").concat(h,") success")),[E,v]});return function(){return o.apply(this,arguments)}}(),createMicrophoneAudioTrack:function(){var o=L(function*(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CREATE_MIC_AUDIO_TRACK,options:[n]}),s=uD(n),c=Ot(8,"track-mic-");let d=null;T.info("start create microphone audio track with config",JSON.stringify(n),"trackId",c);try{d=(yield Cr({audio:s},c)).getAudioTracks()[0]||null}catch(p){throw i.onError(p),p}if(!d){const p=new Q(k.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(p),p.throw(T)}const h=new ol(d,n,s,c);return i.onSuccess(h.getTrackId()),T.info("create microphone audio track success, trackId:",c),h});return function(){return o.apply(this,arguments)}}(),createCustomAudioTrack:function(o){const n=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CREATE_CUSTOM_AUDIO_TRACK,options:[o]}),i=new xe(o.mediaStreamTrack,o.encoderConfig?fE(o.encoderConfig):{},Ot(8,"track-cus-"),!1,!0);return T.info("create custom audio track success with config",o,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:function(){var o=L(function*(n){var i;const{cacheOnlineFile:s,encoderConfig:c}=n;let{source:d}=n;const h={source:d instanceof AudioBuffer?"AudioBuffer":d instanceof File?null!==(i=File.name)&&void 0!==i?i:"File":d,cacheOnlineFile:s,encoderConfig:c},p=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CREATE_BUFFER_AUDIO_TRACK,options:[h]});if(B("DISABLE_WEBAUDIO"))throw new Q(k.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const m=Ot(8,"track-buf-");T.info("start create buffer source audio track with config",JSON.stringify(h),"trackId",m);const _=d;if(!(d instanceof AudioBuffer))try{d=yield function pD(o,n){return Vf.apply(this,arguments)}(d,s)}catch(S){return p.onError(S),S.throw(T)}const E=new yE(d),v=new rn(_,E,c?fE(c):{},m);return T.info("create buffer source audio track success, trackId:",m),p.onSuccess(v.getTrackId()),v});return function(i){return o.apply(this,arguments)}}(),setAppType:function(o){if(T.debug("setAppType: ".concat(o)),!(Number.isInteger(o)&&o>=0))throw T.debug("Invalid appType"),new W(k.INVALID_PARAMS,"invalid app type",o);Nt("APP_TYPE",Math.floor(o))},setLogLevel:function(o){T.setLogLevel(o)},enableLogUpload:function(){B("USE_NEW_LOG")?Nt("UPLOAD_LOG",!0):T.enableLogUpload()},disableLogUpload:function(){B("USE_NEW_LOG")?Nt("UPLOAD_LOG",!1):T.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new ps},checkAudioTrackIsActive:function(){var o=L(function*(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[i]});if(!(n instanceof xe||n instanceof go)){const _=new W(k.INVALID_TRACK,"the parameter is not a audio track");return s.onError(_),_.throw()}i&&i<1e3&&(i=1e3);const c=n instanceof xe?n.getTrackLabel():"remote_track",d=n.getVolumeLevel();let h=d,p=d;const m=Date.now();return new z(_=>{const E=setInterval(()=>{const v=n.getVolumeLevel();h=v>h?v:h,p=v<p?v:p;const S=h-p>1e-4,b=Date.now()-m;if(S||b>i){clearInterval(E);const O=S,P={duration:b,deviceLabel:c,maxVolumeLevel:h,result:O};T.info("[track-".concat(n.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(P))),s.onSuccess(P),_(O)}},200)})});return function(i){return o.apply(this,arguments)}}(),checkVideoTrackIsActive:function(){var o=L(function*(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const s=ye.reportApiInvoke(null,{tag:nn.TRACER,name:fn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[i]});if(!(n instanceof We||n instanceof Ta)){const S=new W(k.INVALID_TRACK,"the parameter is not a video track");return s.onError(S),S.throw()}i&&i<1e3&&(i=1e3);const c=n instanceof We?n.getTrackLabel():"remote_track",d=n.getMediaStreamTrack(!0),h=document.createElement("video");h.style.width="1px",h.style.height="1px",h.setAttribute("muted",""),h.muted=!0,h.setAttribute("playsinline",""),h.controls=!1,(or()||ef())&&(h.style.opacity="0.01",h.style.position="fixed",h.style.left="0",h.style.top="0",document.body.appendChild(h)),h.srcObject=new MediaStream([d]),h.play();const p=document.createElement("canvas");p.width=160,p.height=120;let m=0,_=0;try{const S=Date.now();m=yield function(b,O,P,w){let M,V=0,U=null;return new z((Y,ie)=>{setTimeout(()=>{M&&(M(),Y(V))},O),M=Pr(()=>{!function K(){V>4&&M&&(M(),Y(V));const X=P.getContext("2d");if(!X){const ge=new W(k.UNEXPECTED_ERROR,"can not get canvas 2d context.");return T.error(ge.toString()),void ie(ge)}X.drawImage(b,0,0,160,120);const $=X.getImageData(0,0,P.width,P.height),J=Math.floor($.data.length/3);if(U){for(let ge=0;ge<J;ge+=3)if($.data[ge]!==U[ge])return V+=1,void(U=$.data);U=$.data}else U=$.data}()},30)})}(h,i,p),_=Date.now()-S}catch(S){throw s.onError(S),S}YU===mt.SAFARI&&(h.pause(),h.remove()),h.srcObject=null;const E=m>4,v={duration:_,changedPicNum:m,deviceLabel:c,result:E};return T.info("[track-".concat(n.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),s.onSuccess(v),E});return function(i){return o.apply(this,arguments)}}(),setArea:gc,audioElementPlayCenter:eo,processExternalMediaAEC:function(o){XU.processExternalMediaAEC(o)},registerExtensions:function(o){o.forEach(n=>{const i=n;i.__registered__=!0,i.logger.hookLog=T.extLog,i.reporter.hookApiInvoke=ye.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach(s=>{i.parameters[s]=B(s)})})},ChannelMediaRelayError:Sa,ChannelMediaRelayEvent:yt,ChannelMediaRelayState:cr,RemoteStreamFallbackType:ZA,RemoteStreamType:mE,ConnectionDisconnectedReason:Ye,AudienceLatencyLevelType:yC,AREAS:it});return Object.defineProperties(ci,{onAudioAutoplayFailed:{get:()=>Zr.onAudioAutoplayFailed,set:o=>{Zr.onAudioAutoplayFailed=o}},onAutoplayFailed:{get:()=>Zr.onAutoplayFailed,set:o=>{Zr.onAutoplayFailed=o}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>ci._onSecurityPolicyViolation,set(o){ci._onSecurityPolicyViolation=o,Nx(o)}},__CLIENT_LIST__:{get:()=>B("SHOW_GLOBAL_CLIENT_LIST")?rc:[]}}),_o.on(Ca.CAMERA_DEVICE_CHANGED,o=>{T.info("camera device changed",JSON.stringify(o)),ci.onCameraChanged&&ci.onCameraChanged(o),ci.safeEmit(os.CAMERA_CHANGED,o)}),_o.on(Ca.RECORDING_DEVICE_CHANGED,o=>{T.info("microphone device changed",JSON.stringify(o)),ci.onMicrophoneChanged&&ci.onMicrophoneChanged(o),ci.safeEmit(os.MICROPHONE_CHANGED,o)}),_o.on(Ca.PLAYOUT_DEVICE_CHANGED,o=>{T.debug("playout device changed",JSON.stringify(o)),ci.onPlaybackDeviceChanged&&ci.onPlaybackDeviceChanged(o),ci.safeEmit(os.PLAYBACK_DEVICE_CHANGED,o)}),eo.onAutoplayFailed=()=>{T.info("detect audio element autoplay failed"),Zr.onAudioAutoplayFailed&&Zr.onAudioAutoplayFailed()},Tt.on("autoplay-failed",()=>{T.info("detect webaudio autoplay failed"),Zr.onAudioAutoplayFailed&&Zr.onAudioAutoplayFailed(),ci.safeEmit(os.AUTOPLAY_FAILED)}),mn.on(tc.NETWORK_STATE_CHANGE,(o,n)=>{T.info("[network-indicator] network state changed, ".concat(n," => ").concat(o))}),window&&(window.__ARTC__=ci),ci}()},926:wc=>{function Hm(L,Ac,Ji,qo,Yo,pr,La){try{var Vd=L[pr](La),$o=Vd.value}catch(En){return void Ji(En)}Vd.done?Ac($o):Promise.resolve($o).then(qo,Yo)}wc.exports=function Kh(L){return function(){var Ac=this,Ji=arguments;return new Promise(function(qo,Yo){var pr=L.apply(Ac,Ji);function La($o){Hm(pr,qo,Yo,La,Vd,"next",$o)}function Vd($o){Hm(pr,qo,Yo,La,Vd,"throw",$o)}La(void 0)})}},wc.exports.__esModule=!0,wc.exports.default=wc.exports}},wc=>{wc(wc.s=522)}]);